var loadedScripts={};var loadedTimers=[];var loadedPageTimers=[];var EMAIL_REGEX_PATTERN="^[A-Za-z0-9][\\'A-Za-z0-9_+/-]*(\\.[\\'_A-Za-z0-9-+/]+)*@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$";var qp_sectionDisplayScript={ID_PREFIX_FILE_UPLOAD_IFRAME:'fileUploadIframe_',FOCUS_MODE_MAIN_CLASS:'ts-sqpp-main',preventFormSubmitOnEnter:function(){$('#runForm').on('keyup keypress',function(e){var keyCode=e.keyCode||e.which;if(keyCode===13&&!$(e.target).is('textarea')){if("SurveySubmitButtonElement"==$(e.target).prop("id")&&$(e.target).is("button")){return true;}
e.preventDefault();return false;}});},runTVSurveyScript:function(){$('label').each(function(){$(this).attr('tabindex','0');});$('input[type="radio"]').each(function(){$(this).attr('tabindex','-1');});},initStarRatingBlinker:function(questionID){$('#QuestionSection_'+questionID).find('.star-rating .full').on('click',function(){$(this).parents('.star-rating').find('.full').removeClass('is-blink');if(!$(this).is('.is-blink')){$(this).addClass('is-blink');}});},initFlexRankOrder:function(masterQuestionID,questionID){var self=this;$('#QuestionSection_'+masterQuestionID).find('[data-id="'+questionID+'"] select').each(function(){var val=$(this).val();if(val){$(this).data('pre',val);self.disableFlexRankOrderOption($(this),masterQuestionID,questionID);}});$('#QuestionSection_'+masterQuestionID).find('[data-id="'+questionID+'"] select').on('change',function(){self.disableFlexRankOrderOption($(this),masterQuestionID,questionID);});},disableFlexRankOrderOption:function(elem,masterQuestionID,questionID){var val=elem.val();var previousVal=elem.data('pre');$('#QuestionSection_'+masterQuestionID).find('[data-id="'+questionID+'"] select').not(elem).find('option[value="'+previousVal+'"]').prop('disabled',false).removeClass('tsro-tooltip');if(val){$('#QuestionSection_'+masterQuestionID).find('[data-id="'+questionID+'"] select').not(elem).find('option[value="'+val+'"]').prop('disabled',true).addClass('tsro-tooltip');}
elem.data('pre',elem.val());$('#QuestionSection_'+masterQuestionID).find('[data-id="'+questionID+'"] select').selectpicker('refresh');},initRankOrder:function(questionID){var self=this;$('#QuestionSection_'+questionID+' select').each(function(){var val=$(this).val();if(val){$(this).data('pre',val);self.disableRankOrderOption($(this),questionID);}});$('#QuestionSection_'+questionID+' select').on('change',function(){self.disableRankOrderOption($(this),questionID);});},disableRankOrderOption:function(elem,questionID){var val=elem.val();var previousVal=elem.data('pre');$('#QuestionSection_'+questionID+' select').not(elem).find('option[value="'+previousVal+'"]').prop('disabled',false).removeClass('tsro-tooltip');if(val){$('#QuestionSection_'+questionID+' select').not(elem).find('option[value="'+val+'"]').prop('disabled',true).addClass('tsro-tooltip');}
elem.data('pre',elem.val());$('#QuestionSection_'+questionID+' select').selectpicker('refresh');},initTableColumnHighlighting:function(sectionClass){var allCells=$("."+sectionClass+" .parent-table > thead > tr > td, ."+sectionClass+" .parent-table > tbody > tr > td");allCells.unbind();allCells.on("mouseover",function(){var el=$(this),pos=el.index();el.parents('.parent-table').addClass("active-table");allCells.filter(":nth-child("+(pos+1)+")").addClass("hover");}).on("mouseout",function(){allCells.removeClass("hover");$('.'+sectionClass+' .parent-table').removeClass("active-table");}).on("click",function(){var el=$(this),pos=el.index();$('.'+sectionClass+' .parent-table td').removeClass("active");allCells.filter(":nth-child("+(pos+1)+")").addClass("active").find('.radio-check').prop('checked',true);showSubmitButtonWhenFocusMode();});},store_locator_addresss_init:function(mapData,questionID){$("#searchBox_"+questionID).geocomplete(mapData);$("#searchBox_"+questionID).bind("geocode:dragged",function(event,latLng){$("#sl_latitude_"+questionID).val(latLng.lat());$("#sl_longitude_"+questionID).val(latLng.lng());(new google.maps.Geocoder()).geocode({'latLng':latLng},function(results,status){$('#searchBox_'+questionID).geocomplete('filterGeocodeResults',results);if(status==google.maps.GeocoderStatus.OK){if(results[0]){$("#sl_formatted_adrs_"+questionID).val(results[0].formatted_address);$("#searchBox_"+questionID).val(results[0].formatted_address);}}else{$("#noResultFound_"+questionID).show();$("#noResultFound_"+questionID).delay(7000).fadeOut('fast');}});});$('#searchBox_'+questionID).geocomplete().bind("geocode:error",function(event,result){$("#noResultFound_"+questionID).show();$("#noResultFound_"+questionID).delay(7000).fadeOut('fast');document.getElementById("sl_formatted_adrs_"+questionID).value='';});$("#searchButton_"+questionID).click(function(){document.getElementById("sl_formatted_adrs_"+questionID).value='';if($('#searchBox_'+questionID).val()){$("#searchBox_"+questionID).trigger("geocode");}});$('input, textarea').placeholder();},store_locator_enable_address:function(questionID){if($('#sl_enable_address_'+questionID).is(":checked")){$('#slSearchCriteriaID_'+questionID+' .sl_address_box').attr('style','display: inline-block !important;');$('#slSearchCriteriaID_'+questionID+' .sl_location_box').hide();$('#slSearchCriteriaID_'+questionID+' .sl_query_box').hide();}else{$('#slSearchCriteriaID_'+questionID+' .sl_address_box').hide();$('#slSearchCriteriaID_'+questionID+' .sl_location_box').show();$('#slSearchCriteriaID_'+questionID+' .sl_query_box').show();}},store_locator_init:function(mapData,questionID,isRequired){$('#sl_searchButton_'+questionID).storelocator(mapData);$('input, textarea').placeholder();if(isRequired){$('#SurveySubmitButtonElement').hide();}},multitier_lookup_ajax_init:function(){$.widget('custom.catcomplete1',$.ui.autocomplete,{_renderMenu:function(ul,items){var ulwrapper=this.menu.element;ulwrapper.css('max-width',this.element.outerWidth());var that=this,currentCategory="";$.each(items,function(index,item){that._renderItemData(ul,item);});}});},multitier_lookup_ajax:function(surveyID,sourceQuestionID,targetQuestionID,data,onajaxcomplete){$('#u_'+sourceQuestionID+'ajax').catcomplete1({delay:1,source:data,minLength:1,select:function(event,ui){$('#u_'+sourceQuestionID).val(ui.item.answerID).trigger('change');if(targetQuestionID>0){qp_sectionDisplayScript.ajaxPostLink('LookupTable_'+targetQuestionID,'/a/AjaxProcessor?id='+surveyID+
'&questionID='+targetQuestionID+
'&divID=LookupTable_'+targetQuestionID+
'&mode=update&value='+$('#u_'+sourceQuestionID).val(),onajaxcomplete);}}});$('#u_'+sourceQuestionID+'ajax').keyup(function(event){var keycode=(event.keyCode?event.keyCode:event.which);$('#u_'+sourceQuestionID).val('-1').trigger('change');if(keycode!='37'&&keycode!='38'&&keycode!='39'&&keycode!='40'){for(var i=0,l=data.length;i<l;i++){if($('#u_'+sourceQuestionID+'ajax').val().toLowerCase()==data[i].label.toLowerCase()){$('#u_'+sourceQuestionID).val(data[i].answerID).trigger('change');onajaxcomplete();break;}}
if($('#u_'+sourceQuestionID).val()!='-1'&&targetQuestionID>0){if($('#LookupTable_'+targetQuestionID).is(':empty')){qp_sectionDisplayScript.ajaxPostLink('LookupTable_'+targetQuestionID,'/a/AjaxProcessor?id='+surveyID+
'&questionID='+targetQuestionID+
'&divID=LookupTable_'+targetQuestionID+
'&mode=update&value='+$('#u_'+sourceQuestionID).val(),onajaxcomplete);$(".ui-menu").hide();}
$('#LookupTable_'+targetQuestionID+'ajax').focus();}else{$('#LookupTable_'+targetQuestionID).html('');onajaxcomplete();}}});},multitier_lookup_change:function(surveyID,sourceQuestionID,targetQuestionID,onajaxcomplete){var selectedValue=$('select[name="u_'+sourceQuestionID+'"]').val();var targetURL='/a/AjaxProcessor?id='+surveyID+'&questionID='+targetQuestionID+
'&mode=update&value='+selectedValue;this.ajaxPostLink('LookupTable_'+targetQuestionID,targetURL,onajaxcomplete);},multichoice_lookup:function(questionID,surveyID,otherOptionAnswerID){var mySelObj=[];var availableTags=[];$("#div_m_"+questionID).on("click","span.tag",function(){var input=$("#m_"+questionID).val();$("#m_"+questionID).val(input.replace($(this).attr("value")+"_",""));if(otherOptionAnswerID!=undefined&&$(this).attr("value")==otherOptionAnswerID){qp_sectionDisplayScript.hideVisibility('other_'+otherOptionAnswerID);}
$(this).remove();});function split(val){return val.split(/,\s*/);}
function extractLast(term){return split(term).pop();}
$("#input_m_"+questionID).bind("keydown",function(event){if(event.keyCode===$.ui.keyCode.BACKSPACE&&!event.target.value){var input=$("#m_"+questionID).val();$("#m_"+questionID).val(input.replace($('span.tag').last().attr("value")+"_",""));if(otherOptionAnswerID!=undefined&&$('span.tag').last().attr("value")==otherOptionAnswerID){qp_sectionDisplayScript.hideVisibility('other_'+otherOptionAnswerID);}
$('span.tag').last().remove();$("#input_m_"+questionID).trigger("blur");$("#input_m_"+questionID).focus();$("#m_"+questionID).trigger("change");}
if(event.keyCode===$.ui.keyCode.TAB){event.preventDefault();}}).autoComplete({minChars:0,delay:400,cache:false,source:function(term,suggest){console.log("Inside source!!!!");term=term.toLowerCase();availableTags=[];qp_sectionDisplayScript.showVisibility('spinnerm_'+questionID);$.ajax({url:'/a/AjaxProcessor?id='+surveyID+'&questionID='+questionID+'&mode=update&value='
+$('#input_m_'+questionID).val()
+'&hiddenValue='+($('#m_'+questionID).length==0?'':$('#m_'+questionID).val()),type:'POST',dataType:'html',success:function(options){var html=$.parseHTML(options);nodeNames=[];$.each(html,function(i,element){if(element.nodeName=="OPTION"){var choice=[element.value,element.textContent];availableTags.push(choice);}});if(availableTags.length>0){qp_sectionDisplayScript.hideVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("");}else{qp_sectionDisplayScript.showVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("No suggestions found");}
qp_sectionDisplayScript.hideVisibility('spinnerm_'+questionID);suggest(availableTags);}});},renderItem:function(item,search){search=search.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');var re=new RegExp("("+search.split(' ').join('|')+")","gi");var itemVal=item[1].replace(/"/g,'&quot;');return '<div class="autocomplete-suggestion" data-langname="'+itemVal+'" data-lang="'+item[0]+'" data-val="'+search+'">'+item[1].replace(re,"<b>$1</b>")+'</div>';},onSelect:function(e,term,item){e.preventDefault();if(otherOptionAnswerID!=undefined&&item.data('lang')==otherOptionAnswerID){qp_sectionDisplayScript.showVisibility('other_'+otherOptionAnswerID);}
var input=$("#m_"+questionID).val();$("#m_"+questionID).val(input+item.data('lang')+"_");$("#input_m_"+questionID).parent('.input-wrapper').before("<span class='tag' value="+item.data('lang')+" aria-label="+item.data('langname')+
">"+item.data('langname')+"</span>");$("#input_m_"+questionID).val('');$("#input_m_"+questionID).trigger("blur");$("#input_m_"+questionID).focus();$("#m_"+questionID).trigger("change");return false;}});},unichoice_lookup:function(questionID,surveyID,otherOptionAnswerID){var mySelObj=document.getElementById("u_"+questionID);var availableTags=[];$("#autocompleteu_"+questionID).autoComplete({minChars:0,delay:700,source:function(term,suggest){term=term.toLowerCase();availableTags=[];$('#spinneru_'+questionID).removeClass("hidden");$.ajax({url:'/a/AjaxProcessor?id='+surveyID+'&questionID='+questionID+
'&mode=update&subMode=takeSurvey&value='+
document.getElementById('autocompleteu_'+questionID).value,type:'POST',dataType:'html',success:function(options){var html=$.parseHTML(options);nodeNames=[];var selectedValue=$('#u_'+questionID).val();$('#u_'+questionID).empty();if(otherOptionAnswerID!==undefined){qp_sectionDisplayScript.hideVisibility('other_'+otherOptionAnswerID);}
$.each(html,function(i,element){if(element.nodeName=="OPTION"){$('#u_'+questionID).append(element);var choice=[element.value,element.textContent];availableTags.push(choice);}
$('#u_'+questionID).val(selectedValue);});if(availableTags.length>0){qp_sectionDisplayScript.hideVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("");}else{qp_sectionDisplayScript.showVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("No suggestions found");}
$('#spinneru_'+questionID).addClass("hidden");suggest(availableTags);}});},renderItem:function(item,search){search=search.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');var re=new RegExp("("+search.split(' ').join('|')+")","gi");var itemVal=item[1].replace(/"/g,'&quot;');return '<div class="autocomplete-suggestion" data-langname="'+itemVal+
'" data-lang="'+item[0]+
'" aria-label="'+itemVal+
'" data-val="'+search+'">'+item[1].replace(re,"<b>$1</b>")+'</div>';},onSelect:function(e,term,item){e.preventDefault();$("#autocompleteu_"+questionID).val(item.data('langname'));$('#u_'+questionID).val(item.data('lang'));$("#u_"+questionID).trigger("change");}});$("#u_"+questionID).change(function(){if((otherOptionAnswerID!=undefined)&&(otherOptionAnswerID==$("#u_"+questionID).val())){qp_sectionDisplayScript.showVisibility("other_"+otherOptionAnswerID);}else{qp_sectionDisplayScript.hideVisibility("other_"+otherOptionAnswerID);}});},onLoadWidthScriptForLookupTable:function(inputID,maxAnswerText,isUnichoice){var lookupWidth=this.calculateWidthByAnswerText(maxAnswerText);if($(window).width()>=768){$('#'+inputID).parents(".input-wrapper").css('width',lookupWidth);}},calculateWidthByAnswerText:function(answerText){var minWidth=172;var maxWidth=500;var canvas=document.createElement('canvas');var ctx=canvas.getContext("2d");ctx.font="18px sans-serif";var width=ctx.measureText(answerText).width;if(width<minWidth){width=minWidth;}else if(width>maxWidth){width=maxWidth;}
return width;},delay:function(){var timer=0;return function(callback,ms){clearTimeout(timer);timer=setTimeout(callback,ms);};}(),disableTakeSurveySubmitButton:function(){$('#SurveySubmitButtonElement').attr('disabled','disabled');},enableTakeSurveySubmitButton:function(){$('#SurveySubmitButtonElement').removeAttr('disabled');},validateTextEmbedData:function(value,divID,ajaxProcessorURL){if(value!=null&&value!==''){this.ajaxPostLink(divID,ajaxProcessorURL,this.enableTakeSurveySubmitButton);}else{this.modifyTextNoCheck(divID,'');}},validateUSZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length==5){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateMexicoZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length==5){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateBelgiumZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length==4){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateUKZip:function(value,divID,ajaxProcessorURL){if(value!=null){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},retrieveUniversities:function(value,divID,ajaxProcessorURL){if(value!=null){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateCAZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length==7){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateAUZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length==4){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},validateZip:function(value,divID,ajaxProcessorURL){if(value!=null&&value.length>=5){this.ajaxPostLink(divID,ajaxProcessorURL);}else{this.modifyTextNoCheck(divID,'');}},modifyTextNoCheck:function(id,text){if(document.getElementById){obj=document.getElementById(id);if(obj){obj.innerHTML=text;}}},ajaxSubmitFormObject:function(){var options={};options.silent=false;options.evaluateJS=false;for(var i=0;i<arguments.length;i++){switch(i){case 0:options.divID=arguments[i];break;case 1:options.url=arguments[i];break;case 2:options.htmlForm=arguments[i];break;case 3:options.silent=arguments[i];break;case 4:options.spinnerDivID=arguments[i];break;case 5:options.onajaxcomplete=arguments[i];break;}}
this.ajaxRequest(options);},ajaxLink:function(divID,url){this.ajaxRequest({divID:divID,url:url});},ajaxLink:function(divID,url,onajaxcomplete){this.ajaxRequest({divID:divID,url:url,onajaxcomplete:onajaxcomplete});},ajaxPostLink:function(divID,url){this.ajaxRequest({divID:divID,url:url,isOnlyPost:true});},ajaxPostLink:function(divID,url,onajaxcomplete){this.ajaxRequest({divID:divID,url:url,onajaxcomplete:onajaxcomplete,isOnlyPost:true});},updateQueryStringParameter:function(uri,key,value){var reg=new RegExp("([?&])"+key+"=.*?(&|$)","i");var separator=uri.indexOf('?')!==-1?"&":"?";if(uri.match(reg)){return uri.replace(reg,'$1'+key+"="+value+'$2');}else{return uri+separator+key+"="+value;}},getUrlParameter:function(sParam){var pageURL=decodeURIComponent(window.location.search.substring(1));var urlVariables=pageURL.split('&');var parameterName;var i;for(i=0;i<urlVariables.length;i++){parameterName=urlVariables[i].split('=');if(parameterName[0]===sParam){return parameterName[1]===undefined?true:parameterName[1];}}},getCSRFTokenURL:function(url){var CSRFTOKEN="ct";var csrf_token=this.getUrlParameter(CSRFTOKEN);if(url.indexOf(CSRFTOKEN+"=")<=0&&(csrf_token!=undefined)){return this.updateQueryStringParameter(url,CSRFTOKEN,csrf_token);}else{return url;}},convertFormToURL:function(url,formObj){var str="";for(i=0;i<formObj.elements.length;i++){if(formObj[i].name&&formObj[i].name!=''&&formObj[i].type&&formObj[i].type.toLowerCase()!='button'&&formObj[i].type.toLowerCase()!='file'&&formObj[i].type.toLowerCase()!='submit'){if(formObj[i].type.toLowerCase()=='checkbox'||formObj[i].type.toLowerCase()=='radio'){str+=(formObj[i].checked?formObj[i].name+"="+encodeURIComponent(formObj[i].value)+"&":"");}else{if(formObj[i].type.toLowerCase().indexOf('select')>=0&&formObj[i].multiple){for(multiInd=0;multiInd<formObj[i].options.length;multiInd++){if(formObj[i].options[multiInd].selected){str+=formObj[i].name+"="+encodeURIComponent(formObj[i].options[multiInd].value)+"&";}}}else{str+=formObj[i].name+"="+encodeURIComponent(formObj[i].value)+"&";}}}}
str=url+(url.indexOf("?")>=0?"&":"?")+str.replace(/\&$/gi,"");return str;},encodeURL:function(url){if(url.split("?").length==0){return;}
url=url.split("#")[0];var ary=url.split("?")[1].split("&");var params="";for(i=0;i<ary.length;i++){params+=ary[i].split("=")[0]+"="+encodeURIComponent(ary[i].split("=")[1])+"&";}
return url.split("?")[0]+"?"+params.replace(/\&$/gi,"");},sendAjaxRequest:function(url,client,encURL,element){var debugURL=encodeURIComponent("["+url+"]");url=(url.indexOf("?")>0?url.split("?")[0]+"?ajax=true&engine=dojo&"+url.split("?")[1]:url+"?ajax=true&engine=dojo");url=(encURL?this.encodeURL(url):url);if(!encURL){var baseurl=url.split("?")[0];client.open("POST",baseurl,true);client.setRequestHeader('Content-type','application/x-www-form-urlencoded;charset=UTF-8');if(element&&(url.indexOf("discussionVote")>0)||(url.indexOf("showCreateTopic")>0)){client.setRequestHeader('AJAX-TARGET-DIV',element.id);}
var params=url.split("?")[1];client.send(params);}else{client.open("GET",url,true);client.setRequestHeader('Content-type','application/x-www-form-urlencoded;charset=UTF-8');if(element&&(url.indexOf("discussionVote")>0)||(url.indexOf("showCreateTopic")>0)){client.setRequestHeader('AJAX-TARGET-DIV',element.id);}
client.send(null);}},getAjaxRequestFinal:function(url,element,encURL){var client=(window.XMLHttpRequest?new XMLHttpRequest():new ActiveXObject("Microsoft.XMLHTTP"));if(!client){alert("Could not execute AJAX Request");return;}
this.sendAjaxRequest(url,client,encURL,element);return client;},getOverlaySpinnerHTML:function(isScreenCenter){var positionValue=isScreenCenter?"fixed":"absolute";return '<div style="position: '+positionValue+';width:100%; height: 100%; top: 0%; left: 0%; z-index: 20; ">'+
'<div style="position: absolute;top: 50%;left: 50%; transform: translate(-50%, -50%);">'+
'<img src="/images/app/spinner_96x96.gif" style="width: 50px; height: 50px; position: relative;" class="center-block"/>'+
'</div>'+
'</div>';},sendGAData:function(category,event,subcategory,importance){if(!(typeof ga==='undefined')){ga('send','event',category,event,subcategory,importance);}},formatUrlForGA:function(url){if(url.indexOf('?')>-1){return url.substring(url.lastIndexOf('/')+1,url.lastIndexOf('?'));}else{return url.substring(url.lastIndexOf('/')+1,url.length);}},unbindDocumentReadyState:function(){$(document).unbind("ready");$(document).unbind("jsTrigger");},showHideLockPopup:function(responseText){if(!$('#lockPopup').is(':visible')){this.showModal('lockPopup');}},populateLockPopupBoxBody:function(responseText){var ary=responseText.split("<lock-response/>");if(ary[1].indexOf('ajax-eval-code')>0){ary=ary[1].split("<ajax-eval-code>");$('#lockPopupBoxBody').html(ary[0]);eval(ary[1].split("</ajax-eval-code>")[0]);}else{$('#lockPopupBoxBody').html(ary[1]);}},appendTextToDiv:function(element,responseText){if(responseText.indexOf('<lock-response/>')>0){this.showHideLockPopup(responseText);this.populateLockPopupBoxBody(responseText);}else if(responseText.indexOf("ajax-eval-code")>0){var targetDivID=null;var ary=responseText.split("<ajax-eval-code>");if(ary[1].indexOf("target-div-id")>0){var target=responseText.split("<target-div-id>");targetDivID=target[1].split("</target-div-id>")[0];}else{targetDivID=element.id;}
$('#'+targetDivID).html(ary[0]);eval(ary[1].split("</ajax-eval-code>")[0]);}else if(responseText.indexOf("//JavaScript")>0){eval(responseText);}else{if(typeof element!=='undefined'){$('#'+element.id).html(responseText);}}
if(typeof element!=='undefined'){$('#'+element.id).ready(function(){$(document).trigger('jsTrigger');});}},appendPerformanceMonitor:function(responseText){if(responseText.indexOf("ajax-performance-monitor")>0){var originalResponseText=responseText;try{var ary=responseText.split("<ajax-performance-monitor>");responseText=ary[0];$('#performanceMonitorID').html(ary[1].split("</ajax-performance-monitor>")[0]);}catch(e){responseText=originalResponseText;}}
return responseText;},sendGADataIfGAPresent:function(localUrl,isHtmlForm,startTime){var endTime=new Date().getTime();if(!(typeof ga==='undefined')){try{var mode='';if(localUrl.indexOf('mode')>0){mode='?'+(localUrl.substring(localUrl.indexOf('mode='),localUrl.length).substring(0,localUrl.substring(localUrl.indexOf('mode='),localUrl.length).indexOf('&')));}
this.sendGAData('AJAX CALL',isHtmlForm?'form-submit':'get',this.formatUrlForGA(localUrl)+mode,endTime-startTime);}catch(e){}}},performAjaxOnComplete:function(onajaxcomplete){if(onajaxcomplete){onajaxcomplete();}},appendOverLaySpinner:function(){$($('body')).append('<div id="overlaySpinnerDiv"  align="center" class="overlay-spinner-sm">'+
'<div><img src="/images/app/loading.gif"><span class="pl10 f14">Working</span></div></div>');},appendSpinner:function(localSpinnerDiv,inlinePopup,isOutside,showSpinnerCenterOfScreen){if(localSpinnerDiv){if(localSpinnerDiv){$(localSpinnerDiv).fadeIn(0);}
if(!(typeof inlinePopup==='undefined')&&inlinePopup&&!isOutside){$(localSpinnerDiv).prepend('<img src="/images/app/spinner_96x96.gif"/>');}else{$(localSpinnerDiv).prepend(this.getOverlaySpinnerHTML(showSpinnerCenterOfScreen));}}},appendOverLaySpiner:function(overlaySpinner,silent,localSpinnerDiv,inlinePopup,isOutside,showSpinnerCenterOfScreen){if(overlaySpinner){this.appendOverLaySpinner();}else if(!silent){this.appendSpinner(localSpinnerDiv,inlinePopup,isOutside,showSpinnerCenterOfScreen);}},ajaxRequest:function(params){var self=this;divID=params.divID;params.url=this.getCSRFTokenURL(params.url);url=params.url;htmlForm=params.htmlForm;evaluateJS=params.evaluateJS;silent=params.silent;overlaySpinner=params.overlaySpinner;spinnerDivID=params.spinnerDivID;showSpinnerCenterOfScreen=params.showSpinnerCenterOfScreen;spinnerDiv=spinnerDivID?document.getElementById(spinnerDivID):null;inlinePopupTitle=params.inlinePopupTitle;inlinePopupTitleDiv=document.getElementById('titlePopupHeader');spinnerImage=params.spinnerImage;var onajaxcomplete=params.onajaxcomplete;inlinePopup=params.inlinePopup;onlyPost=params.isOnlyPost;isOutside=params.isOutside;var targetDivID=params.divID;var localSpinnerDiv=params.spinnerDivID?document.getElementById(params.spinnerDivID):null;var localUrl=params.url;var startTime=new Date().getTime();var isHtmlForm=false;if(htmlForm){isHtmlForm=true;localUrl=this.convertFormToURL(localUrl,htmlForm);url=localUrl;}
var element=document.getElementById(targetDivID);if(localSpinnerDiv===null){localSpinnerDiv=element;}
isGet=(htmlForm?false:(onlyPost?false:true));var client=this.getAjaxRequestFinal(localUrl,element,isGet);client.onreadystatechange=function(){if(client.readyState!=4){self.unbindDocumentReadyState();return;}
if(client.getResponseHeader("AJAX_REDIRECT_LOCATION")){var redirectLocation=decodeURIComponent(client.getResponseHeader("AJAX_REDIRECT_LOCATION"));if(self.isPageLoadedInIframe()&&client.getResponseHeader("FULL_PAGE_AJAX_REDIRECT")==='true'){window.top.location.href=redirectLocation;}else{window.location.href=redirectLocation;}
return;}
var responseText=client.responseText;if(localSpinnerDiv){localSpinnerDiv.innerHTML='';}
if(overlaySpinner){$('#overlaySpinnerDiv').remove()}
if(inlinePopupTitle&&inlinePopupTitleDiv){inlinePopupTitleDiv.innerHTML=inlinePopupTitle;inlinePopupTitleDiv.style.display='block';}
responseText=self.appendPerformanceMonitor(responseText);self.appendTextToDiv(element,responseText);self.sendGADataIfGAPresent(localUrl,isHtmlForm,startTime);self.performAjaxOnComplete(onajaxcomplete);};if(htmlForm){return false;}},isPageLoadedInIframe:function(){try{return window.self!==window.top;}catch(e){return true;}},ajaxInlinePopup:function(id,url,dataId){var container=document.getElementById(id)||document.getElementById('shadowedBox');if(document.getElementById('titlePopupHeader')){document.getElementById('titlePopupHeader').innerHTML='';}
if(!container){alert('Container not found. Please wait for the page to load');return;}
dataContainer=document.getElementById(dataId)||document.getElementById('shadowedBoxBody');dataContainer.innerHTML='';container.style.direction="ltr";this.showModal(container.id);this.appendPopupPageLoader(dataContainer.id);this.ajaxRequest({divID:dataContainer.id,url:url,spinnerDivID:dataContainer.id,autofocus:'true',inlinePopup:true});},confirmDialogFallBack:function(confirmMessage,onSuccessfulConfirmFromUser){if(confirm(confirmMessage)){onSuccessfulConfirmFromUser();}},confirmFromUser:function(confirmMessage,onSuccessfulConfirmFromUser,confirmMsgRenderAsHtml,confirmBoxHeaderTxt){if(!this.isConfirmBoxDisplayable()){confirmDialogFallBack(confirmMessage,onSuccessfulConfirmFromUser);return false;}
if(!confirmBoxHeaderTxt){$('.confirm-modal-header').hide();}else{$('.confirm-title').text(confirmBoxHeaderTxt);}
if(confirmMsgRenderAsHtml){$('.confirm-body-content').html(confirmMessage);}else{$('.confirm-body-content').text(confirmMessage);}
$('.btn-modal-primary').unbind('click');$('.btn-modal-primary').on('click',function(e){e.stopPropagation();$('#confirmDialog').modal('hide');if($('#confirmDialog').data('item-deleted')){return false;}
onSuccessfulConfirmFromUser();$('#confirmDialog').data('item-deleted',true);});$('#confirmDialog').unbind();$('#confirmDialog').modal();$('#confirmDialog').on('shown.bs.modal',function(e){$('body').unbind('click');$('.btn-yes-cancel-container .btn').first().focus();$('#confirmDialog').data('item-deleted',false);$('body').on('click',function(e){e.stopPropagation();$('#confirmDialog .modal-dialog').addClass('an-shake');setTimeout(function(){$('#confirmDialog .modal-dialog').removeClass('an-shake');},1000);});}).on('hidden.bs.modal',function(e){$('body').unbind('click');})},areAnyOfThePopupsVisible:function(){if($('#shadowedBox').hasClass('in')||$('#saveAndContinueDialog').hasClass('in')||$('#confirmDialog').hasClass('in')||$('#requestResponseDialog').hasClass('in')){return true;}
return false;},isConfirmBoxDisplayable:function(){if($('#confirmDialog').length>0&&!this.areAnyOfThePopupsVisible()){return true;}
return false;},isSaveAndContinueBoxDisplayable:function(){if($('#saveAndContinueDialog').length>0&&!this.areAnyOfThePopupsVisible()){return true;}
return false;},saveAndContinueConfirmFromUser:function(confirmMessage,onSuccessfulConfirmFromUser,confirmMsgRenderAsHtml,confirmBoxHeaderTxt){if(!this.isConfirmBoxDisplayable()){confirmDialogFallBack(confirmMessage,onSuccessfulConfirmFromUser);return false;}
$('#saveAndContinueDialog .btn-modal-secondary').html(translatedValidationMessages['systemValidations']['application.takesurvey.save.and.continue.later.cancel']);$('#saveAndContinueDialog .btn-modal-primary').html(translatedValidationMessages['systemValidations']['application.takesurvey.save.and.continue.later.continue']);if(!confirmBoxHeaderTxt){$('.confirm-modal-header').hide();}else{$('.confirm-title').text(confirmBoxHeaderTxt);}
if(confirmMsgRenderAsHtml){$('.confirm-body-content').html(confirmMessage);}else{$('.confirm-body-content').text(confirmMessage);}
$('#saveAndContinueDialog .btn-modal-primary').unbind('click');$('#saveAndContinueDialog .btn-modal-primary').on('click',function(e){e.stopPropagation();$('#saveAndContinueDialog').modal('hide');if($('#saveAndContinueDialog').data('item-deleted')){return false;}
onSuccessfulConfirmFromUser();$('#saveAndContinueDialog').data('item-deleted',true);});$('#saveAndContinueDialog').unbind();$('#saveAndContinueDialog').modal();$('#saveAndContinueDialog').on('shown.bs.modal',function(e){$('body').unbind('click');$('.btn-yes-cancel-container .btn').first().focus();$('#saveAndContinueDialog').data('item-deleted',false);$('body').on('click',function(e){e.stopPropagation();$('#saveAndContinueDialog .modal-dialog').addClass('an-shake');setTimeout(function(){$('#saveAndContinueDialog .modal-dialog').removeClass('an-shake');},1000);});}).on('hidden.bs.modal',function(e){$('body').unbind('click');})},keepDataConfirmFromUser:function(confirmBoxHeaderTxt,confirmMessage,confirmMsgRenderAsHtml,onPrimaryButtonClick,onSecondaryButtonClick){if(!this.isConfirmBoxDisplayable()){confirmDialogFallBack(confirmMessage,onSecondaryButtonClick);return false;}
if(!confirmBoxHeaderTxt){$('.confirm-modal-header').hide();}else{$('.confirm-title').text(confirmBoxHeaderTxt);}
if(confirmMsgRenderAsHtml){$('.confirm-body-content').html(confirmMessage);}else{$('.confirm-body-content').text(confirmMessage);}
$('#keepDataDialog .btn-modal-primary').unbind('click');$('#keepDataDialog .btn-modal-primary').on('click',onPrimaryButtonClick);$('#keepDataDialog .btn-modal-secondary').unbind('click');$('#keepDataDialog .btn-modal-secondary').on('click',onSecondaryButtonClick);$('#keepDataDialog').unbind();$('#keepDataDialog').modal();$('#keepDataDialog').on('shown.bs.modal',function(e){$('body').unbind('click');$('.btn-yes-cancel-container .btn').first().focus();$('body').on('click',function(e){e.stopPropagation();$('#keepDataDialog .modal-dialog').addClass('an-shake');setTimeout(function(){$('#keepDataDialog .modal-dialog').removeClass('an-shake');},1000);});}).on('hidden.bs.modal',function(e){$('body').unbind('click');})},requestResponseFromUser:function(confirmMessage,onSuccessfulConfirmFromUser,confirmMsgRenderAsHtml,confirmBoxHeaderTxt,isFromSaveAndContinue){if(!this.isConfirmBoxDisplayable()){confirmDialogFallBack(confirmMessage,onSuccessfulConfirmFromUser);return false;}
if(isFromSaveAndContinue){var el=document.createElement('input');el.type='hidden';el.name='SAVE_AND_CONTINUE';el.value='true';$('[name=SAVE_AND_CONTINUE]').parents('form').append(el);}
$('#requestResponseDialog .btn-modal-secondary').html(translatedValidationMessages['systemValidations']['application.takesurvey.request.validation.continue.without.answering']);$('#requestResponseDialog .btn-modal-primary').html(translatedValidationMessages['systemValidations']['application.takesurvey.request.validation.answer.button']);if(!confirmBoxHeaderTxt){$('.confirm-modal-header').hide();}else{$('.confirm-title').text(confirmBoxHeaderTxt);}
if(confirmMsgRenderAsHtml){$('.confirm-body-content').html(confirmMessage);}else{$('.confirm-body-content').text(confirmMessage);}
$('#requestResponseDialog .btn-modal-secondary').unbind('click');$('#requestResponseDialog .btn-modal-secondary').on('click',function(e){e.stopPropagation();$('#requestResponseDialog').modal('hide');if($('#requestResponseDialog').data('item-deleted')){return false;}
onSuccessfulConfirmFromUser();$('#requestResponseDialog').data('item-deleted',true);});$('#requestResponseDialog').unbind();$('#requestResponseDialog').modal();$('#requestResponseDialog').on('shown.bs.modal',function(e){$('body').unbind('click');$('.btn-yes-cancel-container .btn').first().focus();$('#requestResponseDialog').data('item-deleted',false);$('body').on('click',function(e){e.stopPropagation();if($("input[name='SAVE_AND_CONTINUE']").length>0){$("input[name='SAVE_AND_CONTINUE']").remove();}
$('#requestResponseDialog .modal-dialog').addClass('an-shake');setTimeout(function(){$('#requestResponseDialog .modal-dialog').removeClass('an-shake');},1000);});}).on('hidden.bs.modal',function(e){$('body').unbind('click');})},closeAllPopups:function(){this.closeModalPopupByObj("#lockPopup");this.closeModalPopupByObj("#shadowedBox");},showModal:function(divID){this.closeAllPopups();$('.modal-backdrop').remove();this.showModalDialog(divID);},showModalDialog:function(divID){$('#'+divID).unbind();qp_sectionDisplayScript.makePopupDraggable(divID);$('#'+divID).on('hidden.bs.modal',function(){$('#'+divID+' .modal-dialog').draggable("destroy");$('#'+divID+' .modal-dialog').css('top','0px');$('#'+divID+' .modal-dialog').css('left','0px');}).modal({backdrop:'static',keyboard:true});},makePopupDraggable:function(divID){$('#'+divID+' .modal-dialog').draggable({handle:"#dragHead"});},closeModalPopupByObj:function(obj){$(obj).modal('hide');},getHeightOfContainer:function(container){var totalLiOuterHeight=0;var totalLiMargin=0;$(container).children().each(function(index,obj){totalLiOuterHeight+=$(obj).outerHeight();totalLiMargin+=parseInt($(obj).css("margin-bottom"));});return totalLiOuterHeight+
totalLiMargin+
parseInt($(container).css("padding-top"))+
parseInt($(container).css("border-width"));},setContainerHeight:function(questionID){var firstContainer=".drag-drop-question .ui-sortable.first-child.dragAndDrop"+questionID;var secondContainer=".drag-drop-question .ui-sortable.second-child.dragAndDrop"+questionID;var heightOfFirstContainer=this.getHeightOfContainer(firstContainer);var heightOfSecondContainer=this.getHeightOfContainer(secondContainer);if(heightOfFirstContainer>=heightOfSecondContainer){$(firstContainer).css('height',heightOfFirstContainer);$(secondContainer).css('height',heightOfFirstContainer);}else{$(secondContainer).css('height',heightOfSecondContainer);$(firstContainer).css('height',heightOfSecondContainer);}},updateDragAndDropListHeight:function(questionID){if($(window).width()>=768){this.setContainerHeight(questionID);var images=$('#QuestionSection_'+questionID).find('.answer-options .ui-sortable img');var imagesLength=images.length;var self=this;images.each(function(){$(this).on('load',function(){if($(this).get(0).complete){imagesLength--;if(imagesLength===0){self.setContainerHeight(questionID);}}});});}},dragAndDrop:function(questionID,source,target){$('.drag-drop-question  .dragAndDrop'+questionID).sortable({connectWith:'.drag-drop-question .dragAndDrop'+questionID,placeholder:"highlight",helper:'clone',start:function(event,ui){ui.item.toggleClass("highlight");ui.placeholder.height(ui.helper[0].scrollHeight);},stop:function(event,ui){dynamicExplodeForDragnDrop(questionID,ui.item.prop('id'));ui.item.toggleClass("highlight");},update:function(event,ui){updateHiddenFields(target,questionID);updateNumber(this,ui);},remove:function(event,ui){var result=$('#'+source+questionID).sortable('toArray');for(i=0;i<result.length;i++){$('#'+result[i]+'ID').val('').trigger('change');}}});updateHiddenFields=function(target,questionID){var result=$('#'+target+questionID).sortable('toArray');for(i=0;i<result.length;i++){$('#'+result[i]+'ID').val(i+1).trigger('change');}};updateNumber=function(list,ui){var index=$(ui.element).children().index(ui.item);var $lis=$(list).children('li');var $count=$(list).parent().find('.first-child > li').length;$lis.each(function(){var $li=$(this);var newVal=$(this).index()+1;$(this).children('.control-number').html(newVal);if($(window).width()<768&&$count>0){$(this).parent('.second-child').css('padding-bottom','100px');}else{$(this).parent('.second-child').css('padding-bottom','0');}});},dynamicExplodeForDragnDrop=function(questionID,answerID){var selected=false;var selectedOptions=$('.drag-drop-question .ui-sortable.drop-box.dragAndDrop'+questionID).prop('children');for(var index=0;index<selectedOptions.length;index++){if(selectedOptions[index].id==answerID){selected=true}}
if(selected){$('#'+'de_'+questionID+'_'+answerID).removeClass("hidden");$('#'+'de_'+questionID+'_'+answerID+' .form-input').focus();$('#'+'de_'+questionID+'_'+answerID+' .form-input').prop('autofocus');}else{$('#'+'de_'+questionID+'_'+answerID).addClass("hidden");}}},detectMatrixScroll:function(){var previousWidth=$(window).width();function isWindowExpanded(){var currentWidth=$(window).width();var isExpanded=currentWidth>previousWidth;return isExpanded;}
function changeToMobileViewIfHasScroll(e){var isIEBrowser=/Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent);var clientWidth=e.clientWidth;var isPrintPDF=false;if(isIEBrowser){clientWidth=addToleranceInClientWidth(clientWidth);}
if(document.querySelector(".survey-body-wrapper.print-pdf")){isPrintPDF=true;}
if($(window).width()<650||(e.scrollWidth>clientWidth+5&&!$(e).parent().hasClass('has-mobile-rendering'))||($("input[name=ext_ref][value=test_response]").length>0&&$('.smartphone',window.parent.document).length>0)){$(e).parent().addClass('has-mobile-rendering');attachAccordionClickEvent(isPrintPDF);}}
function addToleranceInClientWidth(clientWidth){return clientWidth+2;}
function changeToScrollViewIfHasScroll(e){if(e.scrollWidth>e.clientWidth){$(e).parent().find('.matrix-mobile-scroll').show();renderMatrixMobileFriendly();}else{$(e).parent().find('.matrix-mobile-scroll').hide();}}
$.fn.hasScrollBar=function(){var isChangedToMobile=false;for(i=0;i<this.length;i++){var e=this.get(i);if(!$(e).parent().hasClass('is-bipolar')&&$(e).parent().hasClass('has-mobile-on')){if($(e).parent().hasClass('has-mobile-rendering')){$(e).parent().removeClass('has-mobile-rendering');}
changeToMobileViewIfHasScroll(e);isChangedToMobile=true;}else{changeToScrollViewIfHasScroll(e);}}
previousWidth=$(window).width();if(isChangedToMobile){setToggleForOptionsChanged();}};callScrollCheck();var windowWidth=$(window).width();$(window).on('resize',function(){if(windowWidth!=$(window).width()){windowWidth=$(window).width();callScrollCheck();}});function callScrollCheck(){$('.matrix-multipoint-question, '+
'.matrix-spreadsheet-question, '+
'.matrix-sidebyside-question, '+
'.flex-matrix-question').find('.table-responsive').hasScrollBar();}
function getScrollValue(target){if(!$('.survey-inside-wrapper').is('.has-interactive-mode')){return target.offset().top-20;}else{return target.offset().top
-(parseInt($(window).height())/2)
+target.parents('tr').outerHeight()/2;}}
function getScrollValueForMatrixInFocusMode(target){return target.position().top;}
function attachAccordionClickEvent(isPrintPDF){if(isPrintPDF){$('.has-mobile-rendering .this-accordion').parent().addClass('this-height');$('.has-mobile-rendering .this-accordion').find('.answer-options').addClass('rotate')}
$('.has-mobile-rendering .this-accordion').unbind('click');$('.has-mobile-rendering .this-accordion').on('click',function(){if($(this).hasClass('option-clicked')){if(!$(this).parent().hasClass('this-height')){$(this).parent().addClass('this-height');$(this).find('.answer-options').addClass('rotate');}}else{$(this).parent().toggleClass('this-height');$(this).find('.answer-options').toggleClass('rotate');}
var self=this;setTimeout(function(){if($('body').hasClass('ts-sqpp')){$(self).parents('.survey-question-wrapper').animate({scrollTop:(getScrollValueForMatrixInFocusMode($(self)))},500);}else{$('html, body').animate({scrollTop:(getScrollValue($(self)))},500);}},500);setToggleForOptionsChanged();});}
attachAccordionClickEvent();function renderMatrixMobileFriendly(){$('.matrix-mobile-scroll').unbind('click');$('.matrix-mobile-scroll').unbind('scroll');$('.matrix-mobile-scroll').on('click',function(e){e.preventDefault();if($('body').hasClass('language-rtl')){$(this).siblings('.table-responsive').animate({scrollLeft:'-=100'},200);}else{$(this).siblings('.table-responsive').animate({scrollLeft:'+=100'},200);}
$(this).fadeOut();});$('.table-responsive').scroll(function(){if($(this).scrollLeft()>=10){$(this).siblings('.matrix-mobile-scroll').fadeOut();}});}
function setToggleForOptionsChanged(){$('.has-mobile-rendering .this-height [type=radio]').unbind('click');$('.has-mobile-rendering .this-height [type=radio]').on('click',function(){if($(this).parents('tr').nextAll('tr[id^=questionRow]').first().find('.this-accordion').length>0){$(this).parents('tr').nextAll('tr[id^=questionRow]').first().find('.this-accordion').addClass('option-clicked').click().removeClass('option-clicked');}else if($(this).parents('tbody').nextAll('tbody').first().find('tr[id^=questionRow]').first().find('.this-accordion').length>0){$(this).parents('tbody').nextAll('tbody').first().find('tr[id^=questionRow]').first().find('.this-accordion').addClass('option-clicked').click().removeClass('option-clicked');}});}
function resetActiveAccordion(elem){resetAccordion($(elem).parents('table').find('[id^=questionRow].this-height'));}
function resetAccordion(elem){$(elem).find('.this-accordion').find('.answer-options').toggleClass('rotate');$(elem).removeClass('this-height');}},setDateBasedOnRespondentsTimezone:function(answerId,is24HourFormat,canInitDateTimeValues){var tz=jstz.determine();var tzName=tz&&tz.name();$('[name=respondentTimezone]')&&tzName&&$('[name=respondentTimezone]').val(tzName);if(!canInitDateTimeValues){return;}
var localeDate=this.getLocaleDate(tzName);if(!localeDate){return;}
this.setCurrentMonthToDate(localeDate,answerId);$('#dt_day_'+answerId+'ID')&&$('#dt_day_'+answerId+'ID').selectpicker('val',this.getValueInStringFormat(localeDate.getDate()));$('#dt_year_'+answerId+'ID')&&$('#dt_year_'+answerId+'ID').selectpicker('val',localeDate.getFullYear());this.setCurrentHourToDate(localeDate,is24HourFormat,answerId);$('#dt_min_'+answerId+'ID')&&$('#dt_min_'+answerId+'ID').selectpicker('val',this.getValueInStringFormat(localeDate.getMinutes()));!is24HourFormat&&$('#dt_ampm_'+answerId+'ID')&&$('#dt_ampm_'+answerId+'ID').selectpicker('val',this.getAMPM(localeDate,is24HourFormat));},setCurrentHourToDate:function(localeDate,is24HourFormat,answerId){var currentHour=this.getValueInStringFormat(qp_sectionDisplayScript.getCurrentHour(localeDate,is24HourFormat));$('#dt_hr_'+answerId+'ID')&&$('#dt_hr_'+answerId+'ID').selectpicker('val',currentHour);},setCurrentMonthToDate:function(localeDate,answerId){var currentMonth=this.getValueInStringFormat(localeDate.getMonth()+1);$('#dt_month_'+answerId+'ID')&&$('#dt_month_'+answerId+'ID').selectpicker('val',currentMonth);},getLocaleDate:function(tzName){try{var localeDateString=new Date().toLocaleString("en-US",{timeZone:tzName});var localeDate=new Date(localeDateString);}catch(e){localeDate=new Date();}
return localeDate;},getCurrentHour:function(localeDate,is24HourFormat){if(localeDate.getHours()===0&&!is24HourFormat){return 12;}
return!is24HourFormat&&localeDate.getHours()>12?localeDate.getHours()-12:localeDate.getHours();},getAMPM:function(localeDate,is24HourFormat){return!is24HourFormat&&localeDate.getHours()>=12?"p":"a";},getValueInStringFormat:function(value){return(value).toLocaleString('en-US',{minimumIntegerDigits:2,useGrouping:false});},rangeSlider:function(paramArray){$("#"+paramArray.divID).slider({isRTL:paramArray.isRightToLeft,animate:true,value:paramArray.selectedValue,range:'min',step:paramArray.step,min:paramArray.min,max:paramArray.max,slide:paramArray.slideEvent,create:paramArray.createEvent,change:paramArray.changeEvent,stop:paramArray.stopEvent,start:paramArray.startEvent});function moveHeadersToCenter(paramArray){var parentContainerID=paramArray.sectionDivID;var questionClass=getParentContainerClass(parentContainerID);if(questionClass!==''){parentContainerID+=' .'+questionClass;var textSliderColV=paramArray.max;var textSliderW=$("#"+paramArray.divID).width();var singleColW=textSliderW/(textSliderColV-1);var sumOfW=parseInt(textSliderW)+parseInt(singleColW);var rightColW=$("#"+parentContainerID).find('.answer-options').width();var naColW=singleColW+parseInt(singleColW/2)-10;if(textSliderColV>=1){if($("body").hasClass("language-rtl")){$("#"+parentContainerID+" .table-heading-wrapper .sh-inner").css({"width":""+sumOfW+"","padding-right":"0","margin-left":parseInt(-((singleColW/2)-16)),"float":"left"});$("#"+parentContainerID+".text-slider-question.is-bipolar .table-heading-wrapper .sh-inner").css({"width":""+sumOfW+"","padding-right":"0","margin-left":parseInt(rightColW-((singleColW/2)-16)),"float":"left"});$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:first-child").css({"padding-right":parseInt(singleColW/2)-10,"text-align":"right"});$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:last-child").css({"padding-left":parseInt(singleColW/2)-10,"text-align":"left"});$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label .error").css("text-align","center");$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:first-child .error").css("text-align","right");$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:last-child .error").css("text-align","left");adjustSliderColumnsWithNA("padding-left","left",parentContainerID,naColW,singleColW);}else{$("#"+parentContainerID+" .table-heading-wrapper .sh-inner").css({"width":""+sumOfW+"","padding-left":"0","margin-right":parseInt(-((singleColW/2)-16))});$("#"+parentContainerID+".text-slider-question.is-bipolar .table-heading-wrapper .sh-inner").css({"width":""+sumOfW+"","padding-left":"0","margin-right":parseInt(rightColW-((singleColW/2)-16))});$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:first-child").css("padding-left",parseInt(singleColW/2)-10);$("#"+parentContainerID+" .table-heading-wrapper .sh-inner .control-label:last-child").css("padding-right",parseInt(singleColW/2)-10);adjustSliderColumnsWithNA("padding-right","right",parentContainerID,naColW,singleColW)}
if($("#"+parentContainerID+'.visual-scale-on').length==0){$("#"+parentContainerID+" .table-heading-wrapper .sh-inner:last-child .control-label").css("width",singleColW);}}}}
function adjustSliderColumnsWithNA(paddingProperty,textAlignValue,parentContainerID,naColW,singleColW){if($("#"+parentContainerID+'.visual-scale-on .table-heading-wrapper .sh-inner .is-na').length>0){$("#"+parentContainerID+' .table-heading-wrapper .sh-inner .control-label.is-na').css({"width":""+naColW+"",paddingProperty:parseInt(((singleColW/2)-10))});$("#"+parentContainerID+' .table-heading-wrapper .sh-inner:last-child .control-label:nth-last-child(2)').css("text-align",textAlignValue);}
if($("#"+parentContainerID+' .table-heading-wrapper .sh-inner .is-na').length>0){$("#"+parentContainerID+" .table-heading-wrapper .sh-inner:first-child .control-label:last-child").css("padding-left",naColW);}}
function getParentContainerClass(parentContainerID){if($("#"+parentContainerID+" .answer-container").hasClass("van-westendorp-slider-question")){return 'van-westendorp-slider-question';}else if($("#"+parentContainerID+" .answer-container").hasClass("text-slider-question")){return 'text-slider-question';}
return '';}
moveHeadersToCenter(paramArray);this.preventSlideOnScrollMobile(paramArray.divID);$(window).on('resize',function(){moveHeadersToCenter(paramArray);});},onToggleSliderWithNA:function(questionID,answerID,naAnswerText,isMobile){var naElement=$("input[name=\"u_"+questionID+"\"]:visible");var slider=$("#slider_"+questionID);naElement.on('change',function(){if(naElement.prop('checked')){var hiddenElement=$("input[name=\"u_"+questionID+"\"]:hidden");hiddenElement.val(answerID);hiddenElement.trigger('change');slider.slider({value:""});slider.find('.ui-slider-handle').removeClass('is-mid is-positive is-negative');slider.find('.ui-slider-handle').removeClass('is-handle-active');if(isMobile=="true"){$("#sliderDisplayValue_"+questionID).html('');}else{$("#sliderDisplayValue_"+questionID).html(naAnswerText);}
slider.find('.ui-slider-range, .bipolar-bar span').css('width','0');}});},bipolarSlider:function(paramArray){$("#"+paramArray.divID).slider({isRTL:paramArray.isRightToLeft,animate:true,value:paramArray.selectedValue,step:paramArray.step,min:paramArray.min,max:paramArray.max,slide:paramArray.slideEvent,create:paramArray.createEvent,start:paramArray.startEvent}).append('<div class="bipolar-bar"><div class="bs-min"><span></span></div><div class="bs-max"><span></span></div></div>');this.initSliderValues(paramArray.selectedValue,paramArray.max,paramArray.divID);$(window).on('resize',function(){qp_sectionDisplayScript.adjustBipolarLabelWidth(paramArray.sectionDivID);});},initSliderValues:function(value,maxValue,divID){var sliderElement=$("#"+divID);var percentage=Math.abs(value)/maxValue*100;if(value==""){return;}
if(value<0){sliderElement.find('.bipolar-bar .bs-min span').css('width',percentage+'%');sliderElement.find('.bipolar-bar .bs-max span').css('width','0%');sliderElement.find('.ui-slider-handle').removeClass('is-positive is-mid').addClass('is-negative');}
if(value>0){sliderElement.find('.bipolar-bar .bs-max span').css('width',percentage+'%');sliderElement.find('.bipolar-bar .bs-min span').css('width','0%');sliderElement.find('.ui-slider-handle').removeClass('is-negative is-mid').addClass('is-positive');}
if(value==0){sliderElement.find('.bipolar-bar .bs-max span').css('width','0%');sliderElement.find('.bipolar-bar .bs-min span').css('width','0%');sliderElement.find('.ui-slider-handle').removeClass('is-negative is-positive').addClass('is-mid');}},adjustBipolarLabelWidth:function(divID){var heading=$("#"+divID).find('.table-heading-wrapper .sh-inner');var rightColW=$("#"+divID).find('.answer-options:first-child').width();var sliderWidth=$("#"+divID).find('.ui-slider').outerWidth();var label=heading.find('.control-label').length;var singleColW=sliderWidth/(label-1);var sumOfW=parseInt(sliderWidth)+parseInt(singleColW);heading.css({"width":""+sumOfW+""});heading.find('.control-label:first-child').css("padding-left",parseInt(singleColW/2));heading.find('.control-label:last-child').css("padding-right",parseInt(singleColW/2));heading.find('.control-label').css("width",parseInt(singleColW));},preventSlideOnScrollMobile:function(divID){$('.ui-slider').on('touchstart',function(e){$(window).scroll(function(){if($(window).scrollTop()>0){$("#"+divID).slider({disabled:true});}});$("#"+divID).slider({disabled:false});});$.fn.scrollEnd=function(callback,timeout){$(this).scroll(function(){var $this=$(this);if($this.data('scrollTimeout')){clearTimeout($this.data('scrollTimeout'));}
$this.data('scrollTimeout',setTimeout(callback,timeout));});};$(window).scrollEnd(function(){$('.ui-slider').each(function(index,item){var divID=$(item).attr("id");$("#"+divID).slider("enable");});},100);},calculateTotal:function(ary,outputDiv){var formObj=document.forms['run'];if(formObj==null){formObj=document.forms[2];}
if(formObj.elements==null){return;}
var total=0;var filledBoxes=0;for(i=0;i<ary.length;i++){if(formObj.elements[ary[i]]){val=formObj.elements[ary[i]].value;if(!isNaN(val)&&val.length>0){total+=parseFloat(val);filledBoxes++;}}}
document.getElementById(outputDiv).innerHTML=""+total;},appendZeros:function(total,validationTotal,ary,formObj){if(total==validationTotal){for(i=0;i<ary.length;i++){if(formObj.elements[ary[i]].value.length==0){formObj.elements[ary[i]].value=0;$(formObj.elements[ary[i]]).trigger('change');}}}},validateConstantSumTextBoxInput:function(isNoSumSet,currentElementId,questionID,allowedSum){var id="s_"+currentElementId;var inputValue=$('#'+id)[0].value;if(inputValue<0){addNegativeValueError();}else if(!isNoSumSet&&inputValue>allowedSum){addOverflowValueError();}else{resetErrorAndTooltip();}
function resetErrorAndTooltip(){$('#'+id).parent().removeClass("has-error");$('#'+id).tooltipster('content',null);$('#'+id).tooltipster('hide');}
function addOverflowValueError(){var validationError={questionID:questionID,messageKey:'application.takesurvey.validation.csum.upperlimit.failure',replacements:[allowedSum]};var msgText=getQuestionErrorMessage(validationError);$('#'+id).parent().addClass("has-error");$('#'+id).tooltipster('content',msgText);$('#'+id).tooltipster('show');}
function addNegativeValueError(){var validationError={questionID:questionID,messageKey:'application.takesurvey.validation.csum.value.negative.failure',replacements:[]};var msgText=getQuestionErrorMessage(validationError);$('#'+id).parent().addClass("has-error");$('#'+id).tooltipster('content',msgText);$('#'+id).tooltipster('show');}
function getQuestionErrorMessage(validationError){var message=getCustomValidationErrorMessage(validationError.questionID,validationError.messageKey,validationError.replacements);if(message===null||message===undefined){message=getTranslatedValidationMessage(validationError.messageKey,validationError.replacements);}
return message;}
function getTranslatedValidationMessage(messageKey,replacements){return replaceValues(translatedValidationMessages['systemValidations'][messageKey],replacements);}
function getCustomValidationErrorMessage(questionID,messageKey,replacements){var questionValidationErrorObj=translatedValidationMessages['customValidations'][questionID];if(questionValidationErrorObj){var message=questionValidationErrorObj[messageKey];if(message!==null||typeof message!=='undefined'){return replaceValues(message,replacements);}}
return null;}},runningTotal:function(ary,outputDiv,questionID,validationTotal){var formObj=document.forms['run'];if(formObj==null){formObj=document.forms[2];}
if(formObj.elements==null){return;}
var total=0;var filledBoxes=0;for(i=0;i<ary.length;i++){if(formObj.elements[ary[i]]){val=formObj.elements[ary[i]].value;if(!isNaN(val)&&val.length>0){total+=parseFloat(val);filledBoxes++;}}}
this.appendZeros(total,validationTotal,ary,formObj);if(filledBoxes==ary.length-1){for(i=0;i<ary.length;i++){if(formObj.elements[ary[i]]){val=formObj.elements[ary[i]].value;if(isNaN(val)||val.length==0){if(validationTotal-total<0){formObj.elements[ary[i]].value=(0)+"";}else{formObj.elements[ary[i]].value=(validationTotal-total)+"";}
total=validationTotal;$(formObj.elements[ary[i]]).trigger('change');break;}}}}
if(validationTotal<total){var validationError={questionID:questionID,messageKey:'application.takesurvey.validation.csum.total.failure',replacements:[validationTotal]};var msgText=getQuestionErrorMessage(validationError);showErrorForConstantSumNumericInput(msgText,questionID);}else{var self=$('#errorSpan_'+questionID);self.html('').addClass('hidden vhidden');}
document.getElementById(outputDiv).innerHTML=""+total;function getQuestionErrorMessage(validationError){var message=getCustomValidationErrorMessage(validationError.questionID,validationError.messageKey,validationError.replacements);if(message===null||message===undefined){message=getTranslatedValidationMessage(validationError.messageKey,validationError.replacements);}
return message;}
function getTranslatedValidationMessage(messageKey,replacements){return replaceValues(translatedValidationMessages['systemValidations'][messageKey],replacements);}
function getCustomValidationErrorMessage(questionID,messageKey,replacements){var questionValidationErrorObj=translatedValidationMessages['customValidations'][questionID];if(questionValidationErrorObj){var message=questionValidationErrorObj[messageKey];if(message!==null||typeof message!=='undefined'){return replaceValues(message,replacements);}}
return null;}
function showErrorForConstantSumNumericInput(message,questionId){var self=$('#errorSpan_'+questionId);self.html(message).removeClass('hidden vhidden');}},appendZerosWithoutRunningTotal:function(ary,validationTotal){var formObj=document.forms['run'];if(formObj==null){formObj=document.forms[2];}
if(formObj.elements==null){return;}
var total=0;var filledBoxes=0;for(i=0;i<ary.length;i++){if(formObj.elements[ary[i]]){val=formObj.elements[ary[i]].value;if(!isNaN(val)&&val.length>0){total+=parseFloat(val);filledBoxes++;}}}
this.appendZeros(total,validationTotal,ary,formObj);},loadCalendar:function(params){$("#"+params.divID).bootstrapMaterialDatePicker({format:params.format,minDate:params.minDate,maxDate:params.maxDate,weekStart:params.weekStart,time:params.time,lang:params.lang,okText:params.okText,cancelText:params.cancelText});},reverseYearsListIfDescending:function(params){$('#'+params.inputFieldID+"_display").on('focus',function(){if($(this).hasClass('descending')){var el=$('select.ui-datepicker-year');var ops=$(el).children().get();if(ops.length>0&&$(ops).first().val()<$(ops).last().val()){$(el).empty();$(el).html(ops.reverse());}}});},getStartEndDatesBasedOnTimezone:function(params,isStartDate,date){if(params.dateTimeValidationType==5&&params.dateType==0){date=new Date();if(isStartDate){date.setDate(date.getDate()-params.daysWithin)}else{date.setDate(date.getDate()+params.daysWithin);}}
return date;},getDateForCalendar:function(validationType,date){if(typeof validationType==='undefined'||validationType===null||typeof date==='undefined'||date===null||validationType===-1||date===''){return '';}
return moment(date,'MM/DD/YYYY').toDate();},loadOldCalendar:function(params,canSetDateBasedOnTimezone){$('#'+params.inputFieldID+"_display").on("input",function(){var text=$(this).val()||"";text=text.replace(/\D/g,"");text=text.replace(/^(\d{2})(\d+)/g,"$1/$2");text=text.replace(/^(\d{2}\/\d{2})(\d{1,4})$/g,"$1/$2");if(/^[\d]{2}\/[\d]{2}\/[\d]{4}$/g.test(text)){$(this).attr('maxlength',text.length)}
$(this).val(text);});$('#'+params.inputFieldID+"_display").on('focus',function(){$(this).siblings('.ui-datepicker-trigger').addClass('has-focus');$(this).siblings('.ui-datepicker-trigger').attr('aria-label','Open calender widget')});var tz=jstz.determine();var tzName=tz&&tz.name();$('[name=respondentTimezone]')&&tzName&&$('[name=respondentTimezone]').val(tzName);var pickerOptions={changeMonth:true,changeYear:true,minDate:this.getDateForCalendar(params.dateTimeValidationType,this.getStartEndDatesBasedOnTimezone(params,true,params.dateTimeValidationStartDate)),maxDate:this.getDateForCalendar(params.dateTimeValidationType,this.getStartEndDatesBasedOnTimezone(params,false,params.dateTimeValidationEndDate)),yearRange:params.yearRange,defaultDate:params.yearSortOrder===1?new Date(params.yearRange.split(":")[1],0,1):new Date(params.yearRange.split(":")[0],0,1),monthNamesShort:(typeof $.datepicker.regional[params.languageCode]==="undefined")?($.datepicker.regional['en']).monthNames:($.datepicker.regional[params.languageCode]).monthNames,dateFormat:params.dateFormat,altFormat:'MM d yy',showOn:'both',buttonText:'<i class="fa fa-calendar" aria-hidden="true" id="datetimepicker"></i>'+
'<span class="screen-reader">Open calender widget</span>',isRTL:params.isRTL,beforeShow:function(input){$(input).css({"position":"relative","z-index":999999});$('.ui-datepicker-modal-bg').show();},onClose:function(){$('.ui-datepicker-modal-bg').hide();}}
$('#'+params.inputFieldID+"_display").datepicker(pickerOptions);if(params.languageCode.length>0){$.datepicker.setDefaults($.datepicker.regional[params.languageCode]);}
$('#'+params.inputFieldID+"_display").change(function(){var dateValue=$('#'+params.inputFieldID+"_display").datepicker('getDate');$('#'+params.inputFieldID).val($.datepicker.setDefaults($.datepicker.regional['en']).formatDate(params.dateFormat,dateValue)).trigger('change');if(params.languageCode.length>0){$.datepicker.setDefaults($.datepicker.regional[params.languageCode]);}});if(canSetDateBasedOnTimezone&&getDateBasedOnTimezone()){var currentDate=getDateBasedOnTimezone();var dateValue=new Date(currentDate.getFullYear(),currentDate.getMonth(),currentDate.getDate());$('#'+params.inputFieldID).val($.datepicker.setDefaults($.datepicker.regional['en']).formatDate(params.dateFormat,dateValue)).trigger('change');if(params.languageCode.length>0){$.datepicker.setDefaults($.datepicker.regional[params.languageCode]);}
$('#'+params.inputFieldID+"_display").val($.datepicker.setDefaults($.datepicker.regional['en']).formatDate(params.dateFormat,dateValue));}
if(params.selectedDate!=undefined&&params.selectedDate.length>0&&params.selectedDate.split(":").length===3){var dateValues=params.selectedDate.split(":");$('#'+params.inputFieldID+"_display").datepicker("setDate",new Date(dateValues[0],dateValues[1],dateValues[2]));$('#'+params.inputFieldID+"_display").change();}
this.reverseYearsListIfDescending(params);function getDateBasedOnTimezone(){try{var localeDateString=new Date().toLocaleString("en-US",{timeZone:tzName});var localeDate=new Date(localeDateString);}catch(e){localeDate=new Date();}
return localeDate;}},loadAreaRating:function(elementID,inputJSON){displayAreaRating(elementID,inputJSON,false);},loadMap:function(params){var seriesData=this.getSeriesDataForMapQuestion(params);$('#'+params.containerID).highcharts('Map',{title:{text:''},subtitle:{text:''},mapNavigation:{enabled:true,enableMouseWheelZoom:false},zoomType:'xy',legend:{enabled:false},exporting:{enabled:false},credits:{enabled:false},tooltip:{formatter:function(){return '<b>'+this.point.text+'</b><br/>';}},colorAxis:{min:0},series:seriesData});this.highlightSelectedRegion(params.selectedID,params.containerID,seriesData);},getSeriesDataForMapQuestion:function(params){return[{data:params.data,allowPointSelect:true,mapData:Highcharts.maps[params.mapType],joinBy:'hc-key',states:{hover:{color:'#BADA55'},select:{color:'#BA6A55'}},point:{events:{click:function(event){var selectedKey='#'+params.containerID+' input[name="selectedKey"]';var selectedValue=$(selectedKey).val();var colorKey='#'+params.containerID+' input[name="selectedColor"]';var colorValue=$(colorKey).val();if($('.'+selectedValue).length>0){$('.'+selectedValue).attr('fill',colorValue);$(selectedKey).remove();$(colorKey).remove();}
$('#'+params.inputID).val(this.id);$('#'+params.showSelectedID).html('You selected: '+this.text);document.getElementById(params.inputID).checked=true;$('#'+params.inputID).trigger('change');},unselect:function(event){event.preventDefault();}}},dataLabels:{enabled:true,format:'{point.code}'}}]},highlightSelectedRegion:function(selectedID,containerID,seriesData){if(selectedID&&selectedID!="null"){seriesData[0].data.forEach(function(key){if(key.id==selectedID){$('#'+containerID).append("<input type='hidden' name='selectedColor' value='"+
$('.highcharts-key-'+key['hc-key']).attr('fill')+"'/>")
$('#'+containerID).append("<input type='hidden' name='selectedKey' value='"+
"highcharts-key-"+key['hc-key']+"'/>");$('.highcharts-key-'+key['hc-key']).attr('fill','#BA6A55')}});}},initDynamicExplode:function(){if(!this.isPreviewSkipLogic()){$('.has-dynamic-explode-radio .radio-check').change(this.dynamicExplodeForRadio);$('.has-dynamic-explode-checkbox .radio-check').change(this.dynamicExplodeForCheckBox);$('.dropdown-question select.has-dynamic-explode-select').change(this.dynamicExplodeForDropDown);$('.matrix-dropdown-question select.has-dynamic-explode-select').change(this.dynamicExplodeForDropDown);$('.rank-order-question  select.has-dynamic-explode-select').change(this.dynamicExplodeForRanOrderDropDown);}},initHideAfterAnsweting:function(){$('.hide-after-answer .radio-check').change(this.hideAfterAnsweringForRadio);$('.hide-after-answer .radio-check').change(this.hideAfterAnsweringForRadioWithDynamicExplode);$('.hide-after-answer .other-option .radio-check').change(this.hideAfterAnsweringForRadioOtherOption);$('.dropdown-question.hide-after-answer select').change(this.hideAfterAnsweringForSelect);$('.dropdown-question.hide-after-answer .has-other select').change(this.hideAfterAnsweringForSelectOtherOption);$('.dropdown-question.hide-after-answer select').change(this.hideAfterAnsweringForSelectWithDynamicExplode);},dynamicExplodeForRadio:function(){var checked=$(this).is(":checked");var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);$("[id^="+"de_"+questionID+"]").addClass("hidden");if(checked){$('#'+'de_'+questionID+'_'+answerID).removeClass("hidden");$('#'+'de_'+questionID+'_'+answerID+' .form-input').focus();$('#'+'de_'+questionID+'_'+answerID+' .form-input').prop('autofocus');}},hideAfterAnsweringForRadio:function(){var checked=$(this).is(":checked");var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasDynamicExplode=$('#'+'de_'+questionID+'_'+answerID).length;var hasOtherOption=$(this).parent().parent().hasClass('other-option');if(!hasDynamicExplode&&!hasOtherOption&&checked){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");}},hideAfterAnsweringForSelect:function(){var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasDynamicExplode=$('#'+'de_'+questionID+'_'+answerID).length;var hasOtherOption=$('#'+'t'+'_'+answerID+'_ID'+' .form-input.other-input').length;if(!hasDynamicExplode&&!hasOtherOption){$(this).find('option:selected').each(function(i,sel){if(sel.value>0){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");}});}},hideAfterAnsweringForRadioWithDynamicExplode:function(){var checked=$(this).is(":checked");var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasDynamicExplode=$('#'+'de_'+questionID+'_'+answerID).length;if(hasDynamicExplode&&checked){$('#'+'de_'+questionID+'_'+answerID+' .form-input').on('blur',function(){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");});}},hideAfterAnsweringForRadioOtherOption:function(){var checked=$(this).is(":checked");var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasOtherOption=$(this).parent().parent().hasClass('other-option');if(hasOtherOption&&checked){$('#'+'t'+'_'+answerID+'_ID'+'.form-input.other-input').on('blur',function(){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");});}},hideAfterAnsweringForSelectOtherOption:function(){var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasOtherOption=$(this).hasClass('has-other');if(hasOtherOption){$(this).find('option:selected').each(function(i,sel){if(sel.value>0){$('#'+'t'+'_'+sel.value+'_ID'+' .form-input.other-input').on('blur',function(){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");});}});}},hideAfterAnsweringForSelectWithDynamicExplode:function(){var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);var hasDynamicExplode=$('#'+'de_'+questionID+'_'+answerID).length;if(hasDynamicExplode){$(this).find('option:selected').each(function(i,sel){if(sel.value>0){$('#'+'de_'+questionID+'_'+sel.value+' .form-input').on('blur',function(){$('#'+'QuestionSection_'+questionID).trigger("hideQuestion");});}});}},dynamicExplodeForCheckBox:function(){var checked=$(this).is(":checked");var answerID=$(this).prop('value');var questionID=$(this).prop('name').substring(2);if(checked){$('#'+'de_'+questionID+'_'+answerID).removeClass("hidden");$('#'+'de_'+questionID+'_'+answerID+' .form-input').focus();$('#'+'de_'+questionID+'_'+answerID+' .form-input').prop('autofocus');}else{$('#'+'de_'+questionID+'_'+answerID).addClass("hidden");}},dynamicExplodeForDropDown:function(){var questionID=$(this).prop('name').substring(2);$("[id^="+"de_"+questionID+"]").addClass("hidden");$(this).find('option:selected').each(function(i,sel){var answerID=$(sel).prop('value');$('#'+'de_'+questionID+'_'+answerID).removeClass("hidden");$('#'+'de_'+questionID+'_'+answerID+' .form-input').focus();$('#'+'de_'+questionID+'_'+answerID+' .form-input').prop('autofocus');});},dynamicExplodeForRanOrderDropDown:function(){var questionID=$(this).closest("div[id^='QuestionSection_']").attr('id').split('_')[1];var id=$(this).prop('id');var answerID=id.substring(0,id.indexOf("ID"));$("[id^="+"de_"+questionID+"]").addClass("hidden");$(this).find('option:selected').each(function(i,sel){var selectedOption=$(sel).prop('value');if(selectedOption!==""){$('#'+'de_'+questionID+'_'+answerID).removeClass("hidden");}else{$('#'+'de_'+questionID+'_'+answerID).addClass("hidden");}
$('#'+'de_'+questionID+'_'+answerID+' .form-input').focus();$('#'+'de_'+questionID+'_'+answerID+' .form-input').prop('autofocus');});},pushToSocial:function(qID,goodRatingID){$('[name=u_'+qID+']').on("change",function(){if($(this).val()>=goodRatingID){showDiv("pushToSocialGoodRatingDiv"+qID);}else{hideDiv("pushToSocialGoodRatingDiv"+qID);}})},pushToSocialForNPS:function(qID,goodRatingIDList){$('[name=u_'+qID+']').on("change",function(){if(goodRatingIDList.indexOf($(this).val())>-1){showDiv("pushToSocialGoodRatingDiv"+qID);}else{hideDiv("pushToSocialGoodRatingDiv"+qID);}})},isJSON:function(str){try{JSON.parse(str);}catch(e){return false;}
return true;},printTubePulseDebug:function(debugDivID,answers){var qid=debugDivID.split("_")[1];var inputBox=document.getElementById('p_'+qid+'_json');var ary=eval("("+inputBox.value+")");var s="";for(i=ary.ratingMap.length-1;i>=0;i--){s+="<div class=\"floatLeft level-table2\">"+
"<div class=\"secs\">"+ary.ratingMap[i].seconds+" <em>secs</em> : "+(answers.length>2?answers[ary.ratingMap[i].rating]:ary.ratingMap[i].rating)+"</div>"+
"<div class=\"comment\">"+ary.ratingMap[i].comment+"</div>"+
"</div>";}
document.getElementById(debugDivID).innerHTML=s;},heatMapPhotoTagger:function(param){$('#'+param.divID).photoTagger({isTagCreationEnabled:true,isTagDeletionEnabled:true,tagsBorderColor:param.tagsBorderColor,dummyzWidth:param.dummyzWidth,dummyzHeight:param.dummyzHeight,confirmationMessage:param.confirmationMessage});},hotSpot:function(param){$('#'+param.divID).hotSpot({isTagCreationEnabled:false,isTagDeletionEnabled:false,isSurveying:true,tagsBorderColor:param.tagsBorderColor});},recordTubePulse:function(params){var inputBox=params['inputBox'];var str=this.isJSON(inputBox.value)?JSON.parse(inputBox.value):{};var ratingArray=this.isJSON(inputBox.value)?JSON.parse(inputBox.value).ratingMap:[];var duration=params['duration'];var comment=(params['commentObj']!=null?params['commentObj'].value:'');var ratingVal=(params['ratingObj']).value;str.duration=duration;str.ratingMap=ratingArray;var ratingArray=str.ratingMap;var addNewPoint=true;if(ratingArray.length>0){ratingArray.forEach(function(el){if(el.seconds==params['seconds']){addNewPoint=false;}});}else{addNewPoint=true;}
if(addNewPoint){ratingArray.push({seconds:params['seconds'],rating:ratingVal,comment:comment});}
$(inputBox).val(JSON.stringify(str)).trigger('change');},loadScript:function(src,callback){if(!loadedScripts[src]){jQuery.ajax({async:false,url:src,dataType:"script",cache:true}).done(function(){loadedScripts[src]=true;if(callback){callback();}}).fail(function(jqxhr,settings,exception){console.log("load script failed for "+src+" and the exception is : "+exception);});}else{if(callback){callback();}}},scrollToTop:function(){$('html, body').animate({scrollTop:0},0);},submitSaveAndContinue:function(elem,ajaxFormToken,encodedSurveyID){if(qp_validateSaveAndContinue()){this.appendLoader(elem);this.submitForm(ajaxFormToken,encodedSurveyID);}
return false;},signupForFree:function(formSelector){if(qp_validateSignupForFree()){$(formSelector).submit();}
return false;},showEmailRewardForm:function(elem,ajaxFormToken){this.appendLoader(elem);this.submitForm(ajaxFormToken);},submitEmailRewardForm:function(elem,ajaxFormToken){if(qp_validateSaveAndContinue()){this.appendLoader(elem);this.submitForm(ajaxFormToken);}},appendLoader:function(elem){if($(elem).length){var loaderElem='<div class="qp-loader">'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'</div>';$(elem).append(loaderElem);$(elem).addClass('has-loader');}},onSuccessfulValidation:function(elem,ajaxFormToken,encodedSurveyID,removeFocusModeClass){this.appendLoader(elem);this.submitForm(ajaxFormToken,encodedSurveyID,removeFocusModeClass?this.removeFocusModeClassCallback:undefined);this.setFormSubmissionHistory($('#runForm'),encodedSurveyID,ajaxFormToken,function(){scrollToTop('body',0);});suspendPageTimerIfPresent();},isSkipValidation:function(){return $('#runForm input[type="hidden"][name="skipJSValidationInput"]').length>0&&$('#runForm input[type="hidden"][name="skipJSValidationInput"]').prop('value')=='true';},isPreviewMode:function(){return $('#runForm input[type="hidden"][name="previewModeActive"]').length>0&&$('#runForm input[type="hidden"][name="previewModeActive"]').prop('value')=='true';},isPreviewSkipValidation:function(){return $('#runForm input[type="hidden"][name="previewSkipValidation"]').length>0&&$('#runForm input[type="hidden"][name="previewSkipValidation"]').prop('value')=='true';},isPreviewSkipLogic:function(){return this.isPreviewMode()&&$('#runForm input[type="hidden"][name="previewSkipLogic"]').length>0&&$('#runForm input[type="hidden"][name="previewSkipLogic"]').prop('value')=='true';},enableActionButtons:function(isBackButton,isSubmitButton,isSaveAndContinueButton){if(isBackButton&&$('.survey-submit-wrapper .btn-back').length>0){$('.survey-submit-wrapper .btn-back').removeClass('is-disabled');}
if(isSubmitButton&&$('#SurveySubmitButtonElement').length>0){$('#SurveySubmitButtonElement').prop('disabled',false);}
if(isSaveAndContinueButton&&$("button[name='SAVE_AND_CONTINUE']").length>0){$("button[name='SAVE_AND_CONTINUE']").prop('disabled',false);}},disableActionButtons:function(isBackButton,isSubmitButton,isSaveAndContinueButton){if(isBackButton&&$('.survey-submit-wrapper .btn-back').length>0){$('.survey-submit-wrapper .btn-back').addClass('is-disabled');}
if(isSubmitButton&&$('#SurveySubmitButtonElement').length>0){$('#SurveySubmitButtonElement').prop('disabled',true);}
if(isSaveAndContinueButton&&$("button[name='SAVE_AND_CONTINUE']").length>0){$("button[name='SAVE_AND_CONTINUE']").prop('disabled',true);}},removeFocusModeClassCallback:function(){$('.ts-sqpp').removeClass('ts-sqpp');},validateAndSubmit:function(elem,ajaxFormToken,encodedSurveyID,qp_sections,isLastPage){switch(qp_validateSurvey(qp_sections,qp_sectionDisplayScript.onSuccessfulValidation.bind(this,elem,ajaxFormToken,encodedSurveyID,false))){case 0:this.onSuccessfulValidation(elem,ajaxFormToken,encodedSurveyID,isFocusMode()&&isLastPage);break;case 1:this.updateValidationErrorCountService(encodedSurveyID,ajaxFormToken);this.enableActionButtons(true,true,true);break;case 2:this.enableActionButtons(true,true,true);break;}},submitSurvey:function(elem,ajaxFormToken,encodedSurveyID,isFocusMode,isLastPage){this.disableActionButtons(true,true,true);if(this.isSkipValidation()||(this.isPreviewMode()&&this.isPreviewSkipValidation())){this.onSuccessfulValidation(elem,ajaxFormToken,encodedSurveyID,isFocusMode&&isLastPage);}else{if(isFocusMode){this.validateAndSubmit(elem,ajaxFormToken,encodedSurveyID,this.getSectionsToValidate(),isLastPage);}else{this.validateAndSubmit(elem,ajaxFormToken,encodedSurveyID,qp_sections);}}
return false;},getSectionsToValidate:function(){var sections=[];var lastSection=qp_sections.slice(-1)[0];sections.push(lastSection);return sections;},processAndSubmitFileUploadData:function(elem,firstQuestionId,encodedSurveyID,ajaxFormToken,removeFocusModeClass){this.appendLoader(elem);var self=this;this.submitFileUploadData(self,firstQuestionId,removeFocusModeClass?this.removeFocusModeClassCallback:undefined);this.setFormSubmissionHistory($('#runForm'),encodedSurveyID,ajaxFormToken,function(){scrollToTop('body',0);});suspendPageTimerIfPresent();},submitFileUploadSurvey:function(elem,ajaxFormToken,encodedSurveyID,isSaveAndContinue,firstQuestionId,isFocusMode,isLastPage){this.disableActionButtons(true,true,true);if(this.isSkipValidation()){this.processAndSubmitFileUploadData(elem,firstQuestionId,encodedSurveyID,ajaxFormToken,isFocusMode()&&isLastPage);}else{if(isFocusMode){this.validateAndSubmitFileUploadData(elem,firstQuestionId,ajaxFormToken,encodedSurveyID,this.getSectionsToValidate(),isLastPage);}else{this.validateAndSubmitFileUploadData(elem,firstQuestionId,ajaxFormToken,encodedSurveyID,qp_sections,isLastPage);}}
return isSaveAndContinue;},validateAndSubmitFileUploadData:function(elem,firstQuestionId,ajaxFormToken,encodedSurveyID,qp_sections,isLastPage){switch(qp_validateSurvey(qp_sections,qp_sectionDisplayScript.onSuccessfulValidation.bind(this,elem,ajaxFormToken,encodedSurveyID,isFocusMode()&&isLastPage))){case 0:this.processAndSubmitFileUploadData(elem,firstQuestionId,encodedSurveyID,ajaxFormToken,isFocusMode()&&isLastPage);break;case 1:this.updateValidationErrorCountService(encodedSurveyID,ajaxFormToken);this.enableActionButtons(true,true,true);break;case 2:this.enableActionButtons(true,true,true);break;}},updateValidationErrorCountService:function(encodedSurveyID,ajaxFormToken){$.ajax({url:'/a/TakeSurveyStats'+'?tt='+encodedSurveyID+'&'+ajaxFormToken+'=false',type:'get',htmlForm:document.getElementById('runForm'),dataType:'html',success:function(response){console.log("Validation Error count updated")},failure:function(response){console.error("Validation Error count update failed");}});},goBackToSurveyPreviousPage:function(ajaxURL,callback){this.disableActionButtons(true,true,true);var ajaxURLWithAjax=ajaxURL+"&ajax=true";this.appendLoader($('.survey-submit-wrapper .btn-back'));this.ajaxSubmitFormObject('ajaxContainerDiv',ajaxURLWithAjax,$('#runForm')[0],false,null,callback);this.setBrowserHistory($('#runForm').serialize(),ajaxURL);this.resetFilesDataObject();},resetFilesDataObject:function(){var fileUploadIframes=window.frames.document.getElementsByClassName('file-upload-iframe');if(fileUploadIframes.length){for(var i=0;i<fileUploadIframes.length;i++){if(fileUploadIframes[i].contentWindow)
fileUploadIframes[i].contentWindow.filesData=null;}}},submitFileUploadData:function(self,firstQuestionId,removeFocusModeClass){var fileUploadIframe=window.frames.document.getElementById(this.ID_PREFIX_FILE_UPLOAD_IFRAME+firstQuestionId);if(fileUploadIframe&&fileUploadIframe.contentWindow.filesData&&fileUploadIframe.contentWindow.filesData.files.length!=0){fileUploadIframe.contentWindow.submitFileUploadData(this.callAjaxRequest,self,removeFocusModeClass);}else{this.callAjaxRequest(self,removeFocusModeClass);}},callAjaxRequest:function(self,onajaxcomplete){$('#SurveySubmitButtonElement').prop('disabled',true);self.ajaxRequest({divID:'ajaxContainerDiv',url:$('#runForm').attr('action'),spinnerDivID:'spinnerDiv',inlinePopup:true,htmlForm:document.getElementById('runForm'),onajaxcomplete:function(){self.scrollToTop('ajaxContainerDiv');$("#spinnerDiv").css("display","none");if(onajaxcomplete){onajaxcomplete();}}});},submitForm:function(ajaxFormToken,encodedSurveyID,onajaxcomplete){var self=this;this.callAjaxRequest(self,onajaxcomplete);},skipAndSubmitPage:function(ajaxFormToken,encodedSurveyID){var skipParam=$("<input>").attr("type","hidden").attr("name","skip").val("true");$('#runForm').append(skipParam);return this.submitStartPages(ajaxFormToken,encodedSurveyID);},appendPageLoader:function(){var loaderElem='<div class="qp-loader fixed">'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'</div>';$("#ajaxContainerDiv").append(loaderElem);},appendPopupPageLoader:function(id){var loaderElem='<div class="qp-loader">'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'<span></span>'+
'</div>';$('#'+id).html(loaderElem);},confirmedToDelete:function(rowID,url,identifierValue){var r=this.getAjaxRequestFinal(url,$('#'+rowID),true);r.onreadystatechange=function(){if(r.readyState!=4){return;}
$('#'+rowID).remove();var responseText=r.responseText;if(responseText.indexOf("ajax-performance-monitor")>0){var originalResponseText=responseText;try{var ary=responseText.split("<ajax-performance-monitor>");responseText=ary[0];$('#performanceMonitorID').html(ary[1].split("</ajax-performance-monitor>")[0]);}catch(e){responseText=originalResponseText;}}
if(responseText.indexOf("ajax-eval-code")>0){var ary=responseText.split("<ajax-eval-code>");$('#'+rowID).html(ary[0]);eval(ary[1].split("</ajax-eval-code>")[0]);}else if(responseText.indexOf("//JavaScript")>0){eval(responseText);}}
statusSpan=document.getElementById("status_"+identifierValue);if(statusSpan){statusSpan.innerHTML='<div style="padding:10px;" align="center"><img src="/images/waiting.gif"></div>';}},submitLanguagePage:function(ajaxFormToken,encodedSurveyID){this.appendPageLoader();this.submitForm(ajaxFormToken,encodedSurveyID);this.setFormSubmissionHistory($('#runForm'),encodedSurveyID,ajaxFormToken);return false;},submitAuthStartPages:function(ajaxFormToken,encodedSurveyID){if($('#SurveySubmitButtonElement').length>0){this.appendLoader($('#SurveySubmitButtonElement'));}
return this.submitStartPages(ajaxFormToken,encodedSurveyID);},submitStartPages:function(ajaxFormToken,encodedSurveyID){this.submitForm(ajaxFormToken,encodedSurveyID);this.setFormSubmissionHistory($('#runForm'),encodedSurveyID,ajaxFormToken);return false;},setFormSubmissionHistory:function(htmlForm,encodedSurveyID,ajaxFormToken){var url=$(htmlForm).attr('action')+"?tt="+encodedSurveyID+"&"+ajaxFormToken+"=false";this.setBrowserHistory($(htmlForm).serialize(),url);},setBrowserHistory:function(data,url){History.replaceState(data,document.title,url);},signaturePad:function(param){var canvas=document.getElementById("smoothed"+param.qID);function resizeCanvas(){canvas.width=canvas.offsetWidth;canvas.height=canvas.offsetHeight;}
window.addEventListener("orientationchange",function(event){signaturePad.clear();resizeCanvas();});resizeCanvas();var signaturePad=new SignaturePad(document.getElementById("smoothed"+param.qID),{minWidth:1,maxWidth:2,penColor:"rgb(84, 94, 107)"});$("#"+param.divID).on('mouseup touchend',function(){$("#"+param.hiddenFieldID).val(signaturePad.toDataURL()).trigger('change');$("#"+param.hiddenFieldID).trigger("upload");});$("#"+param.clearLinkID).on('click',function(){signaturePad.clear();$("#"+param.hiddenFieldID).val("").trigger("upload");});},maxDiff:function(radioElementID,targetCheckboxName,targetCheckboxID,attributesPerTask){$('#'+radioElementID).change(function(){$('[name="'+targetCheckboxName+'"]').attr("disabled",false);if($('#element_'+targetCheckboxID).length){if(attributesPerTask>2){$('#element_'+targetCheckboxID).attr("disabled",true);}else{$('#element_'+targetCheckboxID).prop("checked",false);}}});$('.ctrl-left').on({mouseenter:function(){$(this).addClass('mhoverl');$(this).next('td').addClass('mhoverr');},click:function(){$('td').removeClass('active sl');$(this).addClass('active');$(this).next('td').removeClass('active sr');$(this).next('td').addClass('active sl');},mouseleave:function(){$(this).removeClass('mhoverl');$(this).next('td').removeClass('mhoverr');}});$('.ctrl-right').on({mouseenter:function(){$(this).addClass('mhoverr');$(this).prev('td').addClass('mhoverl');},click:function(){$('td').removeClass('active sr');$(this).addClass('active');$(this).prev('td').removeClass('active sl');$(this).prev('td').addClass('active sr');},mouseleave:function(){$(this).removeClass('mhoverr');$(this).prev('td').removeClass('mhoverl');}});},hideVisibility:function(divID){obj=$('#'+divID);if(obj.length>0&&!obj.hasClass("hidden")){obj.addClass("hidden");}},showVisibility:function(divID){obj=$('#'+divID);if(obj.length>0&&obj.hasClass("hidden")){obj.removeClass("hidden");}},initSurveyTimer:function(surveyTimerParams){this.isToSuspend=false;if(loadedTimers.length>0){loadedTimers[0].suspend();loadedTimers=[];}
function addAlertClass(t){var surveyTimer=$('.ts-survey-timer');if(!surveyTimer.hasClass('is-alert')&&t<=30000){surveyTimer.addClass('is-alert');}}
this.countDown=function(t){var i=0;if(!this.isToSuspend){if(t>=0){setTimeDisplay(getTimeStr(t,false),false);addAlertClass(t);var tmpcd=this;if(loadedTimers.length===0){loadedTimers[0]=tmpcd;}
var func=function(){if(!qp_sectionDisplayScript.areAnyOfThePopupsVisible()){tmpcd.countDown((t-1000));}else{tmpcd.countDown(t);}};if(this.oncountdown){this.oncountdown(t);}
setTimeout(func,1000);}else{setTimeDisplay("00 00 00 00",false);if(this.onfinish){this.onfinish();}}}};this.suspend=function(){this.isToSuspend=true;};this.onfinish=function(){var frm=document.forms['runForm'];if(surveyTimerParams.isTerminateSurveyOnTimeOut){frm.elements[surveyTimerParams.actionHookRequestName].value=surveyTimerParams.actionHookGoToThankYou;}
addSkipJSValidationInput(frm);};this.oncountdown=function(t){document.cookie="Survey_countdown_ms="+t+";path=/;";};},initPageTimer:function(pageTimerParams){this.isToSuspend=false;suspendPageTimerIfPresent();this.getCountDownFunction=function(tmpcd,t){return function(){if(!qp_sectionDisplayScript.areAnyOfThePopupsVisible()){var extendTimer=$('#pt-extend-timer-value');if(extendTimer.length&&parseInt(extendTimer.val())>0){tmpcd.countDown((t+parseInt(extendTimer.val())-1));extendTimer.remove();}else{tmpcd.countDown((t-1));}}else{tmpcd.countDown(t);}};};this.getCountUpFunction=function(pageTimer,t){return function(){if(!qp_sectionDisplayScript.areAnyOfThePopupsVisible()){pageTimer.countUp((t+1));$('#currentPageTimer').val(t+1)}else{pageTimer.countUp(t);}};};function addAlertClassAndShowExtendTimerLink(t){if(t<=30){var extendTimerLink=$('#pt-extend-timer');if(extendTimerLink.length){extendTimerLink.removeClass('hidden');$('#pt-title').addClass('hidden');}}}
this.countDown=function(t){var i=0;if(!this.isToSuspend){if(t>=0){setTimeDisplay(getTimeStr(t,true),true);addAlertClassAndShowExtendTimerLink(t);var tmpcd=this;if(loadedPageTimers.length===0){loadedPageTimers[0]=tmpcd;}
var func=this.getCountDownFunction(tmpcd,t);if(this.oncountdown){this.oncountdown(t);}
setTimeout(func,1000);}else{setTimeDisplay("00 00 00 00",true);if(this.onfinish){this.onfinish();}}}};this.countUp=function(t){var i=0;if(!this.isToSuspend&&t>=0){var pageTimer=this;var func=this.getCountUpFunction(pageTimer,t);setTimeout(func,1000);}};this.suspend=function(){this.isToSuspend=true;};this.onfinish=function(){var frm=document.forms['runForm'];if(pageTimerParams.isTerminateSurveyOnTimeOut){frm.elements[pageTimerParams.actionHookRequestName].value=pageTimerParams.actionHookGoToThankYou;}
if(!pageTimerParams.doNothingEnabled){addSkipJSValidationInput(frm);}};this.oncountdown=function(t){document.cookie="page_timer_"+pageTimerParams.timerQuestionID+"="+t+";path=/;";$('#countDownTimer').val(pageTimerParams.maxTime-t);if(document.getElementsByName(pageTimerParams.answerElementName)[0]){document.getElementsByName(pageTimerParams.answerElementName)[0].value=$('input[name=pageFirstClick]').val()+'_'+$('input[name=pageLastClick]').val()
+'_'+$('input[name=countDownTimer]').val()+'_'+$('input[name=pageNumClicks]').val()}
if(pageTimerParams.timeLeft-t>pageTimerParams.minTime){$('#SurveySubmitButtonElement').attr('disabled',false);}};if(pageTimerParams.minTime>0){$('#SurveySubmitButtonElement').attr('disabled',true);}},handlePageTimerWithFocusMode:function(){if(typeof(pageTimerParams)!="undefined"){$('.survey-timer-wrapper').addClass("this-fixed");var pageTimer=new this.initPageTimer(pageTimerParams);pageTimer.countUp(0);pageTimer.countDown(pageTimerParams.timeLeft);updatePageTimerInputs();}},handleSurveyTimerWithFocusMode:function(){if(typeof(surveyTimerParams)!="undefined"){$('.survey-timer-wrapper').addClass("this-fixed");var surveyTimer=new this.initSurveyTimer(surveyTimerParams);surveyTimer.countDown(surveyTimerParams.surveyTimerCurrentTime);}},initFocusModeStartBtn:function(skipProgressBarOnFirstPage){var self=this;$(".btn-start").on('click',function(){self.handlePageTimerWithFocusMode();self.handleSurveyTimerWithFocusMode();window.sessionStorage.setItem(InteractiveMode.KEY_FOCUS_MODE_STATE,InteractiveMode.FOCUS_MODE_STATE_STARTED);if(!skipProgressBarOnFirstPage){$('.survey-progressbar').show();$('.modern-progressbar').show();}
$('html, body').animate({scrollTop:$("#SurveyBodyWrapper").offset().top},500);setTimeout(function(){$('.survey-progressbar').removeClass('hidden');},550);});},initOnWindowScrollFixTimer:function(){var test=$('.survey-timer-wrapper').position().top;var $this=$(window);$this.on("scroll",function(e){if($this.scrollTop()>test&&$this.find('.survey-timer-wrapper')){$('.survey-timer-wrapper').addClass("this-fixed");$('.survey-body-wrapper').removeClass("has-timer");if($('.survey-progressbar').hasClass('at-top stickybar')){$('.survey-timer-wrapper').addClass("has-classic-progressbar");}}else{$('.survey-timer-wrapper').removeClass("this-fixed");$('.survey-body-wrapper').addClass("has-timer");$('.survey-timer-wrapper').removeClass("has-classic-progressbar");}});},getCookie:function(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;},initTextBoxPlaceholders:function(){$('.form-type-question .form-input, .matrix-spreadsheet-question .form-input').each(function(){checkForInputPlaceholder(this);});$('.form-type-question .form-input, .matrix-spreadsheet-question .form-input').on('change keyup',function(){checkForInputPlaceholder(this);});},clearOTPFieldByName:function(inputName){$(".els-verify-code .input-wrapper input[name="+inputName+"]").val("");},clearAllOTPFields:function(){this.clearOTPFieldByName("digit1");this.clearOTPFieldByName("digit2");this.clearOTPFieldByName("digit3");this.clearOTPFieldByName("digit4");},initTextBoxPlaceholdersElectronicSignature:function(q_id,survey_id){$(".survey-submit-wrapper").toggle();$(".els-verify-code .input-wrapper input").on("change keyup",function(event){key=event.which||event.keyCode||event.charCode;if(key==13){verifyCodeOnEnter(q_id,survey_id,event);}else if(event.target.attributes['name'].value!="digit1"&&(key==8||key==37)){var prevOne=$("input").index(this)-1,prev=$("input").eq(prevOne);prev.focus();}else if(key==39){var nextOne=$("input").index(this)+1,next=$("input").eq(nextOne);next.focus();}else if(event.target.value===''){showHideVerifyCodeBtn();return;}else{$("#errorSpan").html("");if(key!=37&&key!=38&&key!=40){var nextOne=$("input").index(this)+1,next=$("input").eq(nextOne);next.focus();}}
showHideVerifyCodeBtn();});function verifyCodeOnEnter(q_id,survey_id,event){if(isAllOTPFieldsNonEmpty()){var values="";$("input[name^='digit']").each(function(){values+=""+$(this).val();});qp_sectionDisplayScript.verifyCode(q_id,survey_id,values);}else{event.preventDefault();event.stopPropagation();}}
function collectData(){var values="";$("input[name^='digit']").each(function(){values+=""+$(this).val();});qp_sectionDisplayScript.verifyEmail('<%=questionID%>','<%=surveyID%>','<%=answerID%>',values);}
$(".els-signature-sec .agree-option .radio-check").click(function(){$(".survey-submit-wrapper").toggle();});function checkForInput(element){if($(element).val().length>0){$(element).addClass('used');}else{$(element).removeClass('used');}}
$('.form-type-question .form-input').each(function(){checkForInput(this);});$('.form-type-question .form-input').on('change keyup',function(){checkForInput(this);});var emailElement=null;$(".els-verify-email .input-wrapper input").on("change keyup",function(){var isEmpty=false;$(".els-verify-email .input-wrapper input[name^='t_']").each(function(){var element=$(this);if(element.val()==""){isEmpty=true;}
emailElement=element;});if(!isEmpty){if(validateEmail(emailElement.val())){$(".els-verify-email .verify-btn").css("visibility","visible");}else{$(".els-verify-email .verify-btn").css("visibility","hidden");}}else{$(".els-verify-email .verify-btn").css("visibility","hidden");}});function isOTPFieldNonEmpty(inputName){return $(".els-verify-code .input-wrapper input[name="+inputName+"]").val()!="";}
function isAllOTPFieldsNonEmpty(){return(isOTPFieldNonEmpty("digit1")&&isOTPFieldNonEmpty("digit2")&&isOTPFieldNonEmpty("digit3")&&isOTPFieldNonEmpty("digit4"))}
function showHideVerifyCodeBtn(){if(isAllOTPFieldsNonEmpty()){$(".els-verify-code .verify-btn").css("visibility","visible");}else{$(".els-verify-code .verify-btn").css("visibility","hidden");}}},stopEnterSubmit:function(element){$(element).keydown(function(event){if(event.keyCode===13){event.preventDefault();event.stopPropagation();return false;}});},validateTextAgainstPattern:function(element,pattern,questionID){$(element).blur(function(){var regEx=new RegExp(pattern);var valid=regEx.test(this.value);var validationError={questionID:questionID,messageKey:'application.takesurvey.validation.contact.info.custom.field.regex.validation.failure',replacements:[]};var msgText=getQuestionErrorMessage(validationError);if(this.value.trim().length!==0&&!valid){var errorSpan=$('[id^=errorSpan_'+questionID+']');errorSpan.html(msgText).removeClass('hidden vhidden');return false;}
var errorSpan=$('[id^=errorSpan_'+questionID+']');errorSpan.html("").addClass('hidden vhidden');return true;});function getQuestionErrorMessage(validationError){var message=getCustomValidationErrorMessage(validationError.questionID,validationError.messageKey,validationError.replacements);if(message===null||message===undefined){message=getTranslatedValidationMessage(validationError.messageKey,validationError.replacements);}
return message;}
function getTranslatedValidationMessage(messageKey,replacements){return replaceValues(translatedValidationMessages['systemValidations'][messageKey],replacements);}
function getCustomValidationErrorMessage(questionID,messageKey,replacements){var questionValidationErrorObj=translatedValidationMessages['customValidations'][questionID];if(questionValidationErrorObj){var message=questionValidationErrorObj[messageKey];if(message!==null||typeof message!=='undefined'){return replaceValues(message,replacements);}}
return null;}},initBootStrapDropDown:function(element){$('.qp-list-container#'+$(element).attr('id')+'-list').remove();if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){$(element).selectpicker('mobile');}else{$(element).selectpicker({noneSelectedText:translatedValidationMessages['systemValidations']['application.takesurvey.multi.select.none.selected']});}
if($(element).prop('multiple')){$(element).parent().addClass('multi-select');}else{$(element).parent().addClass('single-select');}
var $element=$(element).parent().find('.bs-searchbox');var $root=$element.closest('.bootstrap-select');var $input=$element.find('input');var $btn=$root.find('.btn-default');var $text=$btn.find('.filter-option');$root.prepend($element);$element.css({'padding':'0px'});$element.hide();$input.attr('placeholder',$text.text());$root.on({'hide.bs.dropdown':function(e){$btn.show();$element.hide();},'show.bs.dropdown':function(e){$btn.hide();$element.show();$input.attr('placeholder',$text.text());}});function addOption(){var $new_option=$("li.no-results .bs-add-option-val").text();if($new_option!=''){$element.parent().find('select.custom-form-select').append('<option value="'+$new_option+'">'+$new_option+'</option>').val($new_option).selectpicker('refresh').selectpicker('toggle');}}
$input.unbind('blur');$input.on('blur',function(){addOption();});$input.unbind('keyup');$input.on('keyup',function(e){if(e.keyCode===13||e.keyCode===9){addOption();}});var $labelledById=$(element).attr('aria-labelledby');var $describedById=$(element).attr('aria-describedby');$(element).prevAll('.btn-default').attr('aria-labelledby',$labelledById);$(element).prevAll('.btn-default').attr('aria-describedby',$describedById);},verifyMobile:function(params){var mobileNumber=$('#'+params.countryCodeFieldID).val()
+'-'
+$('#'+params.phoneFieldID).val();var emailAddress=$('#'+params.emailFieldID).val();var errorSpanID='errorSpan_'+params.phoneQuestionID;var verifyLink='/a/takeSurveyVerifyMobile.do?mobileNumber='+mobileNumber
+'&emailAddress='+emailAddress
+'&panelID='+params.panelID
+'&phoneQuestionID='+params.phoneQuestionID;this.ajaxLink(errorSpanID,verifyLink);},getUSPhoneNoInputValidation:function(id){$('#'+id).usPhoneFormat();},refreshSession:function(){qp_sectionDisplayScript.ajaxRequest({divID:'refreshSessionDiv',url:'/a/RefreshSession',silent:true});},resetDateIfMonthChanged:function(answerID,value){$('#dt_month_'+answerID+'ID').on('change',function(){$('#dt_day_'+answerID+'ID').val(value);})},showHideForNPSPlusSubQuestion:function(){$(".nps-plus-question > .answer-options:first-child .control-label-nps").each(function(){$(this).position({my:"bottom",at:"bottom",of:".nps-plus-question"});});setTimeout(function(){$('.word-cloud-question').siblings('.ok-wrapper').unbind('click');$('.word-cloud-question').siblings('.ok-wrapper').on('click',function(){$('.answer-container.voting-question').parents('.survey-question-wrapper').removeClass('hidden');});},1);function getOtherInputDetails(){var obj={};if($('.answer-container.word-cloud-question').find(".word-cloud-wrapper:not('.hidden')").length==0){obj.id=$('.answer-container.word-cloud-question').find(".word-cloud-wrapper").find(".answer-options.other-option .other-input").attr('id');obj.name=$('.answer-container.word-cloud-question').find(".word-cloud-wrapper").find(".answer-options.other-option .other-input").attr('name');}else{obj.id=$('.answer-container.word-cloud-question').find(".word-cloud-wrapper:not('.hidden') .answer-options.other-option .other-input").attr('id');obj.name=$('.answer-container.word-cloud-question').find(".word-cloud-wrapper:not('.hidden') .answer-options.other-option .other-input").attr('name');}
return obj;}
function showTagQuestion(labelData,otherInput){$('.answer-container.word-cloud-question').parent().find('.question-container, .word-cloud-wrapper').filter("[data-score='"+labelData+"']").removeClass('hidden');$('.answer-container.word-cloud-question').parent().find('.question-container, .word-cloud-wrapper').filter("[data-score='"+labelData+"']").find('.answer-options.other-option .other-input').attr('name',otherInput.name);$('.answer-container.word-cloud-question').parent().find('.question-container, .word-cloud-wrapper').filter("[data-score='"+labelData+"']").find('.answer-options.other-option .other-input').attr('id',otherInput.id);$('.answer-container.word-cloud-question').parent().find('[name^=answerCategory]').val(getAnswerCategoryValue(labelData));}
function getAnswerCategoryValue(labelData){if(labelData==='npsPlusDetractor'){return 11;}else if(labelData==='npsPlusPassive'){return 12;}else if(labelData==='npsPlusPromoter'){return 13;}}
$('.nps-plus-question > .answer-options:first-child .control-selection').on('click',function(){var $labelData=$(this).attr('data-score');$('.answer-container.word-cloud-question').parent().removeClass('has-separator');var otherInput=getOtherInputDetails();if($('.answer-container.word-cloud-question').parent().find('.question-container, .word-cloud-wrapper').filter("[data-score='"+$labelData+"'].hidden").length>0){$('.answer-container.word-cloud-question').find(".word-cloud-wrapper").find(".answer-options.other-option .other-input").removeAttr("id").removeAttr("name");$('.answer-container.word-cloud-question').parent().find('.question-container').addClass('hidden');$('.answer-container.word-cloud-question').find('.word-cloud-wrapper').addClass('hidden');$('.answer-container.word-cloud-question').find('.word-cloud-wrapper input.radio-check').prop('checked',false);showTagQuestion($labelData,otherInput);}
showDelightQuestion(this);$('.answer-container.word-cloud-question').parents('.survey-question-wrapper').removeClass('hidden');});function showDelightQuestion(element){var $labelData=$(element).attr('data-score');if($labelData==='npsPlusPromoter'){$('.answer-container.delight-question').parents('.survey-question-wrapper').removeClass('hidden');$('.answer-container.delight-question').siblings('.QuestionSectionVisibility').val('visible');}else{$('.answer-container.delight-question').parents('.survey-question-wrapper').addClass('hidden');$('.answer-container.delight-question textarea').val('');$('.answer-container.delight-question').siblings('.QuestionSectionVisibility').val('hidden');}}
$('.word-cloud-question .control-selection').on('click',function(){$('.answer-container.voting-question').parents('.survey-question-wrapper').removeClass('hidden');});},closedCardSorting:function(questionID,source,target){$('.card-sorting-question.is-close-ended .closedCardSorting'+questionID).sortable({connectWith:'.card-sorting-question.is-close-ended .closedCardSorting'+questionID,placeholder:"highlight",helper:'clone',delay:100,appendTo:'.card-sorting-question .answer-options .closedCardSorting'+questionID,start:function(event,ui){ui.item.toggleClass("highlight");ui.placeholder.height(ui.helper[0].scrollHeight);},stop:function(event,ui){ui.item.toggleClass("highlight");},update:function(event,ui){var id=event.target.id;updateHiddenFields(id,questionID);updateNumber(this,ui);var index=$(ui.element).children().index(ui.item);$lis=$(this).children('li');$count=$(this).children('li').length;$lis.each(function(){var newVal=$(this).index()+1;$(this).children('.control-number').html(newVal);$(this).parents('.sortable-loop-wrapper').find('.this-head-count').html(newVal);});$lis.length<1&&($(this).parents(".sortable-loop-wrapper").find(".remove-sortable").show(),$(this).parents(".sortable-loop-wrapper").find(".this-head-count").hide()),0<$lis.length&&($(this).parents(".sortable-loop-wrapper").find(".remove-sortable").hide(),$(this).parents(".sortable-loop-wrapper").find(".this-head-count").show());},remove:function(event,ui){var result=$('#'+source+questionID).sortable('toArray');for(i=0;i<result.length;i++){$('#'+result[i]+'ID').val('').trigger('change');}},over:function(event,ui){$(event.target).parent().addClass('temp-highlight');},out:function(event,ui){$(event.target).parent().removeClass('temp-highlight');}});var updateHiddenFields=function(id,questionID){var result=$('#'+id).sortable('toArray');for(i=0;i<result.length;i++){var hiddenVal=id!=questionID?((i+1)+"-"+id):'';if($('#'+result[i]+'ID').val()!=hiddenVal){$('#'+result[i]+'ID').val(hiddenVal).trigger('change');}}};var updateNumber=function(list,ui){var index=$(ui.element).children().index(ui.item);var $lis=$(list).children('li');var $count=$(list).parent().find('.first-child > li').length;$lis.each(function(){var $li=$(this);var newVal=$(this).index()+1;$(this).children('.control-number').html(newVal);if($(window).width()<768&&$count>0){$(this).parent('.second-child').css('padding-bottom','100px');}else{$(this).parent('.second-child').css('padding-bottom','0');}});}},initUiSortable:function(sortableBox,parent,element,questionID){sortableBox.sortable({connectWith:$(element).find('.openCardSorting'+questionID),placeholder:"highlight",helper:'clone',delay:100,appendTo:parent,start:function(event,ui){ui.item.toggleClass("highlight");ui.placeholder.height(ui.helper[0].scrollHeight);},stop:function(event,ui){ui.item.toggleClass("highlight");},update:function(event,ui){var id=event.target.id;updateOpenHiddenFields(this,id,questionID);$lis=$(this).children('li');$count=$(this).children('li').length;$lis.each(function(){var newVal=$(this).index()+1;$(this).children('.control-number').html(newVal);$(this).parents('.sortable-loop-wrapper').find('.this-head-count').html(newVal);});$lis.length<1&&($(this).parents(".sortable-loop-wrapper").find(".remove-sortable").show(),$(this).parents(".sortable-loop-wrapper").find(".this-head-count, .is-accordion").hide()),0<$lis.length&&($(this).parents(".sortable-loop-wrapper").find(".remove-sortable").hide(),$(this).parents(".sortable-loop-wrapper").find(".this-head-count, .is-accordion").show());},remove:function(event,ui){var result=$('#'+questionID).sortable('toArray');for(i=0;i<result.length;i++){$('#'+result[i]+'ID').val('').trigger('change');}},over:function(event,ui){$(event.target).parent().addClass('temp-highlight');},out:function(event,ui){$(event.target).parent().removeClass('temp-highlight');}});var updateOpenHiddenFields=function(sortableDiv,id,questionID){var result=$(sortableDiv).sortable('toArray');for(i=0;i<result.length;i++){var categoryName=sortableDiv.parentElement.getElementsByTagName("input")[0].value;var hiddenVal=questionID!=id?((i+1)+"-"+categoryName):'';$('#'+result[i]+'ID').val(hiddenVal).trigger('change');}}},textHighlighter:function(questionID,existingData){$('.text-highlighter-question-'+questionID).each(function(){var $element=$(this)
var $popUp=$('#textHighlighterPopOver_'+questionID);var $li=$popUp.find('li');var $cancel=$popUp.find('.secondary-btn');var $done=$popUp.find('.primary-btn');var $txtArea=$element.parent().find('.input-wrapper > .form-input');var $reset=$element.parent().find('.qp-ts-reset-highlight > a');var $undo=$element.parent().find('.th-undo');var $redo=$element.parent().find('.th-redo');var $hiddenContainer=$("#color-option-popup-hidden-question-"+questionID);var $questionSection=$("#QuestionSection_"+questionID);var $mainDiv=$("#ajaxContainerDiv");var EMPTY_STRING="";var BOLD="<b>";var STRONG="<strong>";var ITALIC="<i>";var EM="<em>";var UNDERLINE="<u>";const SINGLE_FORMATTED_TEXT_COUNT=1;const DOUBLE_FORMATTED_TEXT_COUNT=2;const FULLY_FORMATTED_TEXT_COUNT=3;const MIN_WIDTH_FOR_POPUP=992;var selectionEndTimer=null;var undoRedoArrays={startIndexUndo:[],endIndexUndo:[],selectionColorUndo:[],answerIDsUndo:[],commentsUndo:[],startIndexRedo:[],endIndexRedo:[],selectionColorRedo:[],answerIDsRedo:[],commentsRedo:[]};var hiddenSelectionIndexTrack=[];var text=getCleanTextForSpan();for(var i=0,len=text.length;i<len;i++){if(containsFormatting(text[i])){text[i]=createSpanForFormattedText(text[i],i);}else if(text[i]=='<br>'||text[i]=='<br/>'){text[i]=text[i];}else{text[i]='<span class="qp-th-node th-n-'+i+'" data-index="'+i+'">'+text[i]+'</span>';}}
$element.html(text.join(EMPTY_STRING));highlightExistingData();function highlightExistingData(){if(!existingData||Object.keys(existingData).length===0){return;}
$reset.removeClass('hidden');$undo.removeClass('hidden');existingData.sort(function(a,b){return(a.orderID-b.orderID);});for(x=0;x<existingData.length;x++){var e=existingData[x];var index=getNewHiddenAnswersIndex();createHiddenSelectionContainer(index,e);var $bgColor=$popUp.find('li[data-answer="'+e.answerID+'"] > .color-circle').css('background-color');undoRedoArrays.startIndexUndo.push(e.startIndex);undoRedoArrays.endIndexUndo.push(e.endIndex);undoRedoArrays.selectionColorUndo.push($bgColor);undoRedoArrays.answerIDsUndo.push(e.answerID);undoRedoArrays.commentsUndo.push(e.comment);highlightTextFromIndex($bgColor,e.startIndex,e.endIndex);}}
function getCleanTextForSpan(){var text=$element.html().replace(/\s*<\s*br\s*(\/?)\s*>\s*/gi,' <br/> ');text=text.replace(new RegExp("</div><div><br/>","g"),' <br/> <br/>');text=text.replace(new RegExp("</div><div>","g"),' <br/> ');text=text.replace(/<\/div([^>]*)>/gi,'');text=text.replace(/<div([^>]*)>/gi,'');text=text.replace(/&nbsp;/gi," ").trim();text=text.split(/(\.+)|(\s+)/);text=text.filter(function(x){return x!==undefined;});return text;}
function clearDetails(){$($hiddenContainer).html("");$hiddenContainer.trigger("change");}
function containsFormatting(text){return text.includes(BOLD)||text.includes(ITALIC)||text.includes(UNDERLINE)||text.includes(STRONG)||text.includes(EM);}
function createSpanForFormattedText(text,i){var bold=EMPTY_STRING;var italic=EMPTY_STRING;var underline=EMPTY_STRING;if(text.includes(BOLD)){text=text.replace(BOLD,EMPTY_STRING);bold=BOLD;}
if(text.includes(STRONG)){text=text.replace(STRONG,EMPTY_STRING);bold=BOLD;}
if(text.includes(EM)){text=text.replace(EM,EMPTY_STRING);italic=EM;}
if(text.includes(ITALIC)){text=text.replace(ITALIC,EMPTY_STRING);italic=ITALIC;}
if(text.includes(UNDERLINE)){text=text.replace(UNDERLINE,EMPTY_STRING);underline=UNDERLINE;}
return bold+italic+underline+'<span class="qp-th-node th-n-'+i+'" data-index="'+i+'">'+text+' '+'</span>';}
function saveDetails(){var index=getNewHiddenAnswersIndex();var selection=$element.find('.th-highlight.is-temp');var answerID=$li.find('.color-circle.is-active').parent().attr('data-answer');var comment=$txtArea.val()||'';var startIndex=getDataIndex(selection[0]);var endIndex=getDataIndex(selection[selection.length-1]);createHiddenSelectionContainer(index,{answerID:answerID,comment:comment,startIndex:startIndex,endIndex:endIndex})
undoRedoArrays.startIndexUndo.push(parseInt(startIndex));undoRedoArrays.endIndexUndo.push(parseInt(endIndex));undoRedoArrays.selectionColorUndo.push(selection[0].style.backgroundColor);undoRedoArrays.answerIDsUndo.push(answerID);undoRedoArrays.commentsUndo.push(comment);}
function getNewHiddenAnswersIndex(){hiddenSelectionIndexTrack.push((($hiddenContainer.find("input[type='hidden']").length/4)>>0)+1);return(($hiddenContainer.find("input[type='hidden']").length/4)>>0)+1;}
function createHiddenSelectionContainer(index,textHighligtedObject){$($hiddenContainer).append(getHiddenField(index,"answerID",textHighligtedObject.answerID));$($hiddenContainer).append(getHiddenField(index,"comment",textHighligtedObject.comment));$($hiddenContainer).append(getHiddenField(index,"startIndex",textHighligtedObject.startIndex));$($hiddenContainer).append(getHiddenField(index,"endIndex",textHighligtedObject.endIndex))
$($hiddenContainer).trigger("change");}
function getHiddenField(index,key,value){return '<input type="hidden" name="'
+getHiddenName(index,key)+'" value="'+value+'">'}
function getHiddenName(index,key){return "th_"+questionID+"_"+index+"_"+key;}
function setChildrenFromPosition(selectedChildNodes,children,index){var selection=selectedChildNodes[index];var nodeString=getNodeString(selection);if($(selection).hasClass('answer-container')&&selection.textContent!=" "){for(var j=0;j<selection.childNodes.length;j++){children.push(selection.childNodes[j]);}}else if($(selection).hasClass('qp-th-node')){children.push(selection);}else if(countToDetectFormattedText(nodeString)>0){addNodesforFormattedText(countToDetectFormattedText(nodeString),children,selection);}}
function setSingleChild(selection,children){var parentNode=selection.parentNode;if($(parentNode).hasClass('qp-th-node')||$(parentNode).hasClass('th-highlight')){children.push(parentNode);}else if($(selection).hasClass('qp-th-node')){children.push(selection);}}
function getSelectedChildren(selection){var children=[];var selectedChildNodes=selection.getRangeAt(0).cloneContents().childNodes;if(selectedChildNodes.length==1){setSingleChild(selection.focusNode,children);}else if(selectedChildNodes.length>1){setChildrenFromPosition(selectedChildNodes,children,0);setChildrenFromPosition(selectedChildNodes,children,selectedChildNodes.length-1);}else{children.push(selection.getRangeAt(0).commonAncestorContainer.parentElement);}
return children;}
function getSelectionHtml(){var html="";var selection=window.getSelection();if(typeof window.getSelection!="undefined"&&selection.toString()!==""&&selection.rangeCount){return getSelectedChildren(selection);}else if(typeof document.selection!="undefined"&&document.selection.type=="Text"&&document.selection.createRange().htmlText!==""){html=document.selection.createRange().htmlText;}
return html;}
function getNodeString(selection){if(selection.outerHTML!=undefined){return selection.outerHTML.toString();}}
function countToDetectFormattedText(str){var singleFormatting=["<b>","<i>","<u>"];var doubleFormatting=["<b><i>","<b><u>","<b><i>","<i><u>"];var fullyFormatted=["<b><i><u>"];var count=0;if(str==undefined){return count;}
else if(containsPattern(str,singleFormatting)){return count+1;}else if(containsPattern(str,doubleFormatting)){return count+2;}else if(containsPattern(str,fullyFormatted)){return count+3;}}
function containsPattern(target,pattern){var value=0;pattern.forEach(function(word){value=value+target.includes(word);});return(value===1)}
function addNodesforFormattedText(count,children,selectedNode){if(count==SINGLE_FORMATTED_TEXT_COUNT){for(var j=0;j<selectedNode.childNodes.length;j++){children.push(selectedNode.childNodes[j]);}}else if(count==DOUBLE_FORMATTED_TEXT_COUNT){for(var j=0;j<selectedNode.childNodes[0].childNodes.length;j++){children.push(selectedNode.childNodes[0].childNodes[j]);}}else if(count==FULLY_FORMATTED_TEXT_COUNT){for(var j=0;j<selectedNode.childNodes[0].childNodes[0].childNodes.length;j++){children.push(selectedNode.childNodes[0].childNodes[0].childNodes[j]);}}}
function popOverClose(){if(!$popUp.is('.hidden')){$popUp.addClass('hidden').removeAttr('style');$element.data("temp-selection-start","");$element.data("temp-selection-end","");$('#errorSpan_textHighlighterComments_'+questionID).addClass('hidden');}}
function rgb2hex(rgb){rgb=rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return(rgb&&rgb.length===4)?"#"+
("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[2],10).toString(16)).slice(-2)+
("0"+parseInt(rgb[3],10).toString(16)).slice(-2):'';}
function getContrast(hexcolor){if(hexcolor.slice(0,1)==='#'){hexcolor=hexcolor.slice(1);}
if(hexcolor.length===3){hexcolor=hexcolor.split('').map(function(hex){return hex+hex;}).join('');}
var r=parseInt(hexcolor.substr(0,2),16);var g=parseInt(hexcolor.substr(2,2),16);var b=parseInt(hexcolor.substr(4,2),16);var yiq=((r*299)+(g*587)+(b*114))/1000;return(yiq>=128)?'#252525':'#EFEFEF';}
function getElement(element){if(element.children(":first.th-highlight").length>0){return getElement(element.children(":first.th-highlight"));}
return element;}
function getDataIndex(selection){if($(selection).hasClass('th-highlight')){return $(selection).parents('.qp-th-node').attr('data-index');}
return $(selection).attr('data-index');}
function highlightTemperorily($bgColor){var startIndex=parseInt($element.data("temp-selection-start"));var endIndex=parseInt($element.data("temp-selection-end"));highlightTextFromIndex($bgColor,startIndex,endIndex,true);}
function highlightTextFromIndex($bgColor,startIndex,endIndex,isTemp){var hex=rgb2hex($bgColor);for(var i=startIndex;i<=endIndex;i++){var element=getElement($element.find("[data-index="+i+"]"));var span="<span class='th-highlight "+(isTemp?"is-temp":"")+"' style='background-color: "+
$bgColor+"; opacity:0.70;"+" color: "+
getContrast(hex)+"'>"+element.html()+"</span>";element.html(span);}}
function isSelectionObjectEmpty(selectionIndex){var selection=$element.find("[data-index="+selectionIndex+"]")[0];return selection.textContent=="";}
function getStartIndexWithText(selectionStartIndex){while(isSelectionObjectEmpty(selectionStartIndex)){selectionStartIndex++;}
return selectionStartIndex;}
function getEndIndexWithText(selectionEndIndex){while(isSelectionObjectEmpty(selectionEndIndex)){selectionEndIndex--;}
return selectionEndIndex;}
function removeSelectionObjectWithNoText(selection){var currentSelectionArray=[];var selectionStartIndex=parseInt(getDataIndex(selection[0]));var selectionEndIndex=parseInt(getDataIndex(selection[selection.length-1]));if(selection[0].textContent==""){selectionStartIndex=getStartIndexWithText(selectionStartIndex+1);}
if(selection[selection.length-1].textContent==""){selectionEndIndex=getEndIndexWithText(selectionEndIndex-1);}
if(selectionStartIndex==selectionEndIndex){currentSelectionArray.push($element.find("[data-index="+selectionStartIndex+"]")[0]);}else{currentSelectionArray.push($element.find("[data-index="+selectionStartIndex+"]")[0]);currentSelectionArray.push($element.find("[data-index="+selectionEndIndex+"]")[0]);}
return currentSelectionArray;}
function isSelectionWithinQuestion(selectionStartTextQuestion,selectionEndTextQuestion){return selectionStartTextQuestion&&selectionStartTextQuestion==selectionEndTextQuestion;}
function isSelectedTextQuestionIDEqualToCurrentQuestionID(wordSelection){var selectionStartTextQuestion=$(wordSelection.anchorNode).closest(".text-highlighter-question")[0];var selectionEndTextQuestion=$(wordSelection.focusNode).closest(".text-highlighter-question")[0];if(isSelectionWithinQuestion(selectionStartTextQuestion,selectionEndTextQuestion)){return selectionStartTextQuestion.className.replace(/\D/g,"")===questionID.toString();}}
function getSelectedQuestionID(wordSelection){if(isSelectedTextQuestionIDEqualToCurrentQuestionID(wordSelection)){return questionID.toString();}}
$li.each(function(){$(this).on('click',function(e){$element.find('.th-highlight.is-temp').contents().unwrap();$li.find('.color-circle.is-active').removeClass('is-active');$(this).find('.color-circle').addClass('is-active');var $bgColor=$(this).find('.color-circle.is-active').css('background-color');highlightTemperorily($bgColor);selectionEndTimer=-1;});});$popUp.on('click keyup keydown touchend touchstart textarea',function(event){event.stopPropagation();selectionEndTimer=-1;});$txtArea.on('click keyup keydown touchend touchstart focus',function(event){event.stopPropagation();selectionEndTimer=-1;});$done.on('click',function(){if($txtArea.val()!=undefined&&$txtArea.val().trim()===''){var $errorMessage=getValidationMessageText(questionID,'application.takesurvey.texthighlighter.comments.validation.failure');$('#errorSpan_textHighlighterComments_'+questionID).html($errorMessage);$('#errorSpan_textHighlighterComments_'+questionID).removeClass('hidden');return;}
if($element.find('.th-highlight').hasClass('is-temp')){saveDetails();popOverClose();$txtArea.val('');$element.find('.th-highlight').removeClass('is-temp');$reset.removeClass('hidden');$undo.removeClass('hidden');}});$cancel.on('click',function(){popOverClose();$txtArea.val('');$element.find('.th-highlight.is-temp').contents().unwrap();window.getSelection().removeAllRanges();});$questionSection.on('click',function(){if(window.getSelection().toString()==""&&!$popUp.is('.hidden')){popOverClose();$txtArea.val('');$element.find('.th-highlight.is-temp').contents().unwrap();}});function undoButtonClick(){var popStartIndex=undoRedoArrays.startIndexUndo.pop();var popEndIndex=undoRedoArrays.endIndexUndo.pop();var popColor=undoRedoArrays.selectionColorUndo.pop();var popAnswerIDs=undoRedoArrays.answerIDsUndo.pop();var popComments=undoRedoArrays.commentsUndo.pop();undoRedoArrays.startIndexRedo.push(popStartIndex);undoRedoArrays.endIndexRedo.push(popEndIndex);undoRedoArrays.selectionColorRedo.push(popColor);undoRedoArrays.answerIDsRedo.push(popAnswerIDs);undoRedoArrays.commentsRedo.push(popComments);for(var count=popStartIndex;count<=popEndIndex;count++){var childSpan=getElement($element.find('[data-index='+count+']'));var dataIndex='[data-index='+count+']';if($(dataIndex+' > .th-highlight').text()==''){continue;}
var textData=$(childSpan).text();$(childSpan).parent().text(textData);$(childSpan).remove();}}
function clearUndoDetails(){var question_id=questionID;var index=hiddenSelectionIndexTrack.pop();const inputElement_answerID=document.querySelector('input[name="th_'+question_id+'_'+index+'_answerID"]');const inputElement_comment=document.querySelector('input[name="th_'+question_id+'_'+index+'_comment"]');const inputElement_startIndex=document.querySelector('input[name="th_'+question_id+'_'+index+'_startIndex"]');const inputElement_endIndex=document.querySelector('input[name="th_'+question_id+'_'+index+'_endIndex"]');inputElement_answerID.remove();inputElement_comment.remove();inputElement_startIndex.remove();inputElement_endIndex.remove();$($hiddenContainer).trigger("change");}
function addRedoDetails(){var index=getNewHiddenAnswersIndex();var length=undoRedoArrays.startIndexRedo.length-1;var startIndex=undoRedoArrays.startIndexRedo[length];var endIndex=undoRedoArrays.endIndexRedo[length];var comments=undoRedoArrays.commentsRedo[length];var answerIDs=undoRedoArrays.answerIDsRedo[length];$($hiddenContainer).append(getHiddenField(index,"answerID",answerIDs));$($hiddenContainer).append(getHiddenField(index,"comment",comments));$($hiddenContainer).append(getHiddenField(index,"startIndex",startIndex));$($hiddenContainer).append(getHiddenField(index,"endIndex",endIndex))
$($hiddenContainer).trigger("change");}
function redoButtonClick(){var popStartIndex=undoRedoArrays.startIndexRedo.pop();var popEndIndex=undoRedoArrays.endIndexRedo.pop();var $bgColor=undoRedoArrays.selectionColorRedo.pop();var popAnswerIDs=undoRedoArrays.answerIDsRedo.pop();var popComments=undoRedoArrays.commentsRedo.pop();undoRedoArrays.startIndexUndo.push(popStartIndex);undoRedoArrays.endIndexUndo.push(popEndIndex);undoRedoArrays.selectionColorUndo.push($bgColor);undoRedoArrays.answerIDsUndo.push(popAnswerIDs);undoRedoArrays.commentsUndo.push(popComments);var hex=rgb2hex($bgColor);for(var i=popStartIndex;i<=popEndIndex;i++){var element=getElement($element.find("[data-index="+i+"]"));var span="<span class='th-highlight' style='background-color: "+
$bgColor+"; opacity:0.70; color: "+
getContrast(hex)+"'>"+element.html()+"</span>";element.html(span);}}
function getValidationMessageText(questionID,messageKey){var message=getCustomValidationErrorMessage(questionID,messageKey);if(message===null||message===undefined){return getTranslatedValidationMessage(messageKey);}
return message;}
function setSelectionIndex(selection){if(selection.length){$element.data("temp-selection-start",getDataIndex(selection[0]));$element.data("temp-selection-end",getDataIndex(selection[selection.length-1]));}}
function setPopupPositionCss(selection){if($(window).width()>=MIN_WIDTH_FOR_POPUP){var target=getElement($element.find('[data-index='+getDataIndex(selection[0])+']'));$popUp.css({top:0,left:0});var calculator=new $.PositionCalculator({item:$popUp,target:target,itemAt:"top left",itemOffset:{y:3,x:0,mirror:true},targetAt:"bottom left",flip:"both"});var posResult=calculator.calculate();$popUp.css({top:posResult.moveBy.y+'px',left:posResult.moveBy.x+'px'});}}
function mainTxtHiglighter(){var selection=getSelectionHtml();if(selection.length>1){selection=removeSelectionObjectWithNoText(selection);}
if(selection.length){$li.find('.color-circle').removeClass('is-active');$popUp.removeClass('hidden');setSelectionIndex(selection);setPopupPositionCss(selection);}}
$mainDiv.on("mouseup",function(){var wordSelection=window.getSelection();var selectedQuestionID=getSelectedQuestionID(wordSelection);if(questionID==selectedQuestionID){mainTxtHiglighter();}});function onSelectionChange(){selectionEndTimer&&clearTimeout(selectionEndTimer);selectionEndTimer=selectionEndTimer!=-1&&setTimeout(function(){$($element).trigger("selectionEnd")},1000);}
$element.off("touchstart").on("touchstart",function(){selectionEndTimer=null;document.onselectionchange=onSelectionChange;});$($element).on("selectionEnd",function(e){mainTxtHiglighter();});$reset.on('click',function(){$element.find('.th-highlight').contents().unwrap();$(this).addClass('hidden');$undo.addClass('hidden');$redo.addClass('hidden');undoRedoArrays.startIndexUndo=[];undoRedoArrays.endIndexUndo=[];undoRedoArrays.selectionColorUndo=[];undoRedoArrays.commentsUndo=[];undoRedoArrays.answerIDsUndo=[];undoRedoArrays.startIndexRedo=[];undoRedoArrays.endIndexRedo=[];undoRedoArrays.selectionColorRedo=[];undoRedoArrays.commentsRedo=[];undoRedoArrays.answerIDsRedo=[];clearDetails();});$undo.on('click',function(){if(undoRedoArrays.startIndexUndo.length>1){undoButtonClick();}else if(undoRedoArrays.startIndexUndo.length==1){undoButtonClick();$undo.addClass('hidden');}
if(undoRedoArrays.startIndexRedo.length>=1){$redo.removeClass('hidden');}
clearUndoDetails();});$redo.on('click',function(){addRedoDetails();if(undoRedoArrays.startIndexRedo.length>1){redoButtonClick();$reset.removeClass('hidden');$undo.removeClass('hidden');}else if(undoRedoArrays.startIndexRedo.length==1){redoButtonClick();$redo.addClass('hidden');$reset.removeClass('hidden');$undo.removeClass('hidden');}});$txtArea.on("keyup",function(){if($txtArea.val().trim()!==''){$('#errorSpan_textHighlighterComments_'+questionID).addClass('hidden');}});});},gaborGranger:function(){$('.gabor-granger-question .answer-price-option').css('transform','scale(1.1)');setTimeout(function(){$('.gabor-granger-question .answer-price-option').css('transform','scale(1)');},500);},openCardSorting:function(questionID,existingDivCount,surveyID){touchPunchDelay=100;$(document).on('click','.is-accordion',function(){var $this=$(this);if($this.parent().next().hasClass('this-active')){$this.parent().next().removeClass('this-active');$this.parent().next().slideDown(350);}else{$this.parent().parent().find('ul').removeClass('this-active');$this.parent().parent().find('ul').slideUp(350);$this.parent().next().toggleClass('this-active');$this.parent().next().slideToggle(350);}
$this.text(($this.text()=='unfold_more'?'unfold_less':'unfold_more'));}).on('click','.remove-sortable',function(){$(this).parents(".sortable-loop-wrapper").remove()});var $element=$('#QuestionSection_'+questionID+' .card-sorting-question');var $uiParent=$element.find('.answer-options');var $uiSortable=$element.find('.openCardSorting'+questionID);var $h2=$element.find('h2');var rowIndex=existingDivCount;qp_sectionDisplayScript.initUiSortable($uiSortable,$uiParent,$element,questionID);if($(window).width()<768&&$element.hasClass('is-close-ended')){$h2.next().addClass('this-active');}
if($element.hasClass('is-open-ended')){var $thisClone=$element.find('.clone-div-'+questionID);var $thisDrop=$element.find('.add-sortable-wrapper');function $uswAppend(){var $parentClone=$thisClone.clone().removeClass("this-sortable-clone").addClass("cont-"+rowIndex).show();var $uiSoWrapper=$element.find('.ui-sortable-main');$parentClone.appendTo($uiSoWrapper).find('.form-input').focus();};$thisDrop.unbind('click');$thisDrop.droppable({accept:'#'+$element.parents('.survey-question-wrapper').attr('id')+' .ui-sortable-handle',drop:function(ev,ui){$uswAppend();ui.helper.attr('style','');var $item=$(ui.helper).clone();$item.appendTo('#'+$element.parents('.survey-question-wrapper').attr('id')+' .is-open-ended .ui-sortable-container .sortable-loop-wrapper.cont-'+rowIndex+' .ui-sortable');$item.removeClass("ui-sortable-helper")
$item.parents('.sortable-loop-wrapper').find('.this-head-count').show();$item.parents('.sortable-loop-wrapper').find('.remove-sortable').hide();$(ui.draggable).remove();qp_sectionDisplayScript.initUiSortable($element.find('.openCardSorting'+questionID),$uiParent,$element,questionID);var $inputElement=$item.parents('.sortable-loop-wrapper').find('input')[0];$item.find('.control-number').html(1);qp_sectionDisplayScript.openCardSortingLookUp($inputElement,questionID,surveyID);rowIndex=rowIndex+1;qp_sectionDisplayScript.triggerContainerNameChange($inputElement,questionID);},}).on('click',function(){$uswAppend();qp_sectionDisplayScript.initUiSortable($element.find('.openCardSorting'+questionID),$uiParent,$element,questionID);var inputEle=$("#QuestionSection_"+questionID+" .cont-"+rowIndex+" input");qp_sectionDisplayScript.openCardSortingLookUp(inputEle,questionID,surveyID);rowIndex=rowIndex+1;});}},triggerContainerNameChange:function(inputElement,questionID){var liList=$(inputElement.parentNode.parentNode.getElementsByTagName("ul")[0]).children('li');var liCount=liList.length;for(var listIndex=0;listIndex<liCount;listIndex++){var containerName=inputElement.value;var rank=listIndex+1;var hiddenVal=rank+"-"+containerName;$('#'+liList[listIndex].id+'ID').val(hiddenVal);}
$(inputElement).attr('aria-label',inputElement.value?inputElement.value:translatedValidationMessages['systemValidations']['application.takesurvey.cardsorting.open.placeholder.instruction']);return false;},openCardSortingLookUp:function(inputElement,questionID,surveyID){var availableTags=[];$(inputElement).autoComplete({minChars:2,delay:400,cache:false,source:function(term,suggest){availableTags=[];qp_sectionDisplayScript.showVisibility('spinnerm_'+questionID);$.ajax({url:'/a/AjaxProcessor?id='+surveyID+'&questionID='+questionID+'&mode=update&value='
+$(inputElement).val(),type:'POST',dataType:'html',success:function(options){var html=$.parseHTML(options);nodeNames=[];$.each(html,function(i,element){if(element.nodeName=="OPTION"){var choice=[element.value,element.textContent];availableTags.push(choice);}});if(availableTags.length>0){qp_sectionDisplayScript.hideVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("");}else{qp_sectionDisplayScript.showVisibility("errorDIV_"+questionID);$("#errorDIV_"+questionID).html("No suggestions found");}
qp_sectionDisplayScript.hideVisibility('spinnerm_'+questionID);suggest(availableTags);}});},renderItem:function(item,search){search=search.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&');var re=new RegExp("("+search.split(' ').join('|')+")","gi");var itemVal=item[1].replace(/"/g,'&quot;');return '<div class="autocomplete-suggestion" data-langname="'+itemVal+'" data-lang="'
+item[0]+'" data-val="'+search+'">'+item[1].replace(re,"<b>$1</b>")+'</div>';},onSelect:function(event,term,item){$(inputElement).parent('.input-wrapper').before("<span class='tag' value="+item.data('lang')+">"+item.data('langname')+"</span>");$(inputElement).val(item.data('lang'));}});},initMatrixAutoFocus:function(firstQuestionID){var sectionContainer=$('#QuestionSection_'+firstQuestionID);var matrixContainer=sectionContainer.children('.matrix-multipoint-question');var headElement=matrixContainer.find(".table-wrapper .parent-table thead");var headHeight=headElement.outerHeight();var bodyElement=matrixContainer.find(".table-wrapper .parent-table tbody");var rowElement=bodyElement.find("tr");rowElement.first().addClass('active');var errorElement=bodyElement.find("tr.error-tr");var currentElement=rowElement.filter(".active");var rowHeight=0,rowSingleHeight=0;var rowFirst=rowElement.not('.error-tr').first();var rowLast=rowElement.not('.error-tr').last();bodyElement.append('<tr class="dummy-tr"> &nbsp; </tr>');if(!$(currentElement).next().hasClass('error-tr')){$('.dummy-tr').css('height',currentElement.outerHeight()+'px');}else{$('.dummy-tr').css('height',currentElement.outerHeight()+errorElement.outerHeight()+'px');}
var activeElement=rowElement.not('.error-tr, .dummy-tr').length;var countScore=matrixContainer.find('.count-score');var countRows=1;var countCircleVal=2*3.14*13;var countProgress=countCircleVal/activeElement;var countProgBar=matrixContainer.find('.scroll-count svg .count-prog-bar');var scrollNext=matrixContainer.find('.scroll-next');var scrollPrev=matrixContainer.find('.scroll-prev');var leftScroll=matrixContainer.find(".matrix-inner-scroll");var section,matrixValidationType;$(scrollNext).addClass('active');$(scrollPrev).css('visibility','hidden');countProgBar.css("stroke-dashoffset",countCircleVal-countProgress);leftScroll.css('padding-top',headHeight+16);sectionContainer.find('.scroll-count svg .count-prog-bar').css('stroke','#A9A9A9');for(var i=0;i<qp_sections.length;i++){if(qp_sections[i].firstQuestionID===firstQuestionID){section=qp_sections[i];matrixValidationType=section.matrixValidationType?section.matrixValidationType:0;break;}}
function addOrRemoveAutoFocusClass(){var mobileRenderingContainer=sectionContainer.find(".has-mobile-rendering");if(mobileRenderingContainer.length>0&&mobileRenderingContainer.hasClass("is-automatrix")){mobileRenderingContainer.removeClass("is-automatrix");sectionContainer.find('.parent-table').removeAttr("style");}else if(mobileRenderingContainer.length==0&&!sectionContainer.find(".matrix-multipoint-question").hasClass("is-automatrix")){sectionContainer.find(".matrix-multipoint-question").addClass("is-automatrix");rowElement.removeClass('active');rowElement.first().addClass('active');rowElement.find("td input[type='radio']").unbind('click');rowElement.find("td input[type='radio']").bind('click',function(){scrollToNextRow();});}}
$(window).on('resize',function(){addOrRemoveAutoFocusClass();});addOrRemoveAutoFocusClass();function scrollToNextRow(){var mobileRenderingContainer=sectionContainer.find(".has-mobile-rendering");if(mobileRenderingContainer.length>0){return;}
if($(currentElement).find("td input[type='radio']:checked").length===0&&section&&section.requiredValidationType===0&&matrixValidationType!==1){$(currentElement).next('.error-tr').find('.error').html(getValidationMessageText(currentElement,getValidationMessageKeyForMatrixAutoFocus(matrixValidationType))).removeClass('hidden vhidden');}else{$(currentElement).next('.error-tr').find('.error').addClass('hidden vhidden');if(countRows<activeElement){var $nextElement=currentElement.next();currentElement.removeClass("active");$(currentElement).each(function(){countRows++;$(countScore).text(countRows);countProgBar.css("stroke-dashoffset",countCircleVal-(countProgress*countRows));if(!$($nextElement).hasClass('error-tr')){currentElement=$nextElement.addClass("active");rowSingleHeight=$(this).outerHeight();rowHeight+=rowSingleHeight;}else{currentElement=$nextElement.next().addClass("active");rowSingleHeight=$(this).outerHeight()+errorElement.outerHeight();rowHeight+=rowSingleHeight;}
scrollTop(rowHeight);if(!rowFirst.hasClass('active')){scrollPrev.addClass('active');$(scrollPrev).css('visibility','visible');}
if(rowLast.hasClass('active')){scrollNext.removeClass('active');$(scrollNext).css('visibility','hidden');}});}
if(sectionContainer.find("td input[type='radio']:checked").length===activeElement&&countRows===activeElement){if(rowLast.find('.radio-check').is(':checked')){countProgBar.css('stroke','#3FCA5A');}}}}
function scrollToPreviousRow(){var mobileRenderingContainer=sectionContainer.find(".has-mobile-rendering");if(mobileRenderingContainer.length>0){return;}
if(countRows>1){var $prevElement=currentElement.prev();currentElement.removeClass("active");currentElement.next('.error-tr').find('.error').addClass('hidden vhidden');$(currentElement).each(function(){countRows--;$(countScore).text(countRows);countProgBar.css("stroke-dashoffset",countCircleVal-(countProgress*countRows));if(!$($prevElement).hasClass('error-tr')){currentElement=$prevElement.addClass("active");rowSingleHeight=$(this).outerHeight();rowHeight-=rowSingleHeight}else{currentElement=$prevElement.prev().addClass("active");rowSingleHeight=$(this).outerHeight()+errorElement.outerHeight();rowHeight-=rowSingleHeight;}
scrollTop(rowHeight);if(!rowLast.hasClass('active')){scrollNext.addClass('active');$(scrollNext).css('visibility','visible');}
if(rowFirst.hasClass('active')){scrollPrev.removeClass('active');$(scrollPrev).css('visibility','hidden');}});}
countProgBar.css('stroke','#A9A9A9');}
$(scrollNext).on('click',function(){scrollToNextRow();});$(scrollPrev).on('click',function(){scrollToPreviousRow();});rowElement.find("td input[type='radio']").on('click',function(){scrollToNextRow();});rowLast.find('.radio-check').on('click',function(){rowLast.parents('.survey-question-wrapper').find('.ok-wrapper .ok-btn').trigger('click');$(this).closest('[id^="QuestionSection_"]').find('.scroll-prev').css('visibility','visible');$(this).closest('[id^="QuestionSection_"]').find('.scroll-next').css('visibility','hidden');});function scrollTop(rowHeight){$(bodyElement).stop(true).animate({scrollTop:rowHeight},500);}
matrixContainer.find('.table-wrapper .parent-table tr .answer-options .control-label').each(function(){if((this.offsetHeight<this.scrollHeight)||(this.offsetWidth<this.scrollWidth)){var $tooltipText=$(this).text();$(this).attr({"data-qptooltip":"tooltip","data-qptitle":$tooltipText}).tooltipster({arrow:false,debug:false,delay:50,interactive:true,maxWidth:350,side:['bottom','top','right','left'],speed:300});}});},sendCode:function(questionId,surveyId,ans_id){$(".els-verify-email").attr("style","opacity:0.2; pointer-events:none;");$('#emailAddress').text($('#'+ans_id+"ID").val());$(".els-verify-code").show();$(".els-verify-code").attr("style","");$('html,body').animate({scrollTop:$(".els-verify-code").offset().top},'slow');var divId='mainDIV_'+questionId;qp_sectionDisplayScript.ajaxPostLink('errorSpan','/a/AjaxProcessor?id='+surveyId+
'&questionID='+questionId+
'&divID='+divId+
'&mode=update'+
'&action=sendCode'+
'&email='+$('#'+ans_id+"ID").val(),function(){});},resendCode:function(questionId,surveyId,ans_id){qp_sectionDisplayScript.clearAllOTPFields();$(".els-verify-code .verify-btn").css("visibility","hidden");$("#errorSpan").html("");$("#error").html("Code re-send successfully");var divId='mainDIV_'+questionId;qp_sectionDisplayScript.ajaxPostLink('errorSpan','/a/AjaxProcessor?id='+surveyId+
'&questionID='+questionId+
'&divID='+divId+
'&mode=update'+
'&action=resendCode'+
'&email='+$('#'+ans_id+"ID").val(),function(){});},changeMail:function(){qp_sectionDisplayScript.clearAllOTPFields();$(".els-verify-code .verify-btn").css("visibility","hidden");$("#errorSpan").html("");$("#error").html("");$(".els-verify-code").attr("style","opacity:0.2; pointer-events:none;");$(".els-verify-email").attr("style","");$(".els-verify-email").show();$('html,body').animate({scrollTop:$(".els-verify-email").offset().top},'slow');},verifyCode:function(questionId,surveyId,values){var divId='mainDIV_'+questionId;qp_sectionDisplayScript.ajaxPostLink('errorSpan','/a/AjaxProcessor?id='+surveyId+
'&questionID='+questionId+
'&divID='+divId+
'&mode=validate'+'&action=verifyCode'+
'&values='+values,function(){if($("#errorSpan").children().length==0){$(".els-verify-code").hide();$(".els-signature-sec").show();}else{qp_sectionDisplayScript.clearAllOTPFields();$(".els-verify-code").show();}});},onVerification:function(resp){},initEditMode:function(sectionID){$('#review_form_'+sectionID+' .survey-question-wrapper').removeClass('is-review-mode');},onReviewSuccessValidation:function(sectionID){var divID="section_"+sectionID;var form=$('#review_form_'+sectionID)[0];this.ajaxSubmitFormObject(divID,'/a/UpdateResponse',form);},submitReviewQuestionForm:function(section){var review_section=[];review_section.push(section)
if(qp_validateSurvey(review_section,qp_sectionDisplayScript.onReviewSuccessValidation.bind(this,section.sectionID))==0){this.onReviewSuccessValidation(section.sectionID);}},setRadioButtonValue:function(elementID){$('#'+elementID).val($('#'+elementID).closest('table').find('thead').find('.is-na').first().text());},clearTextOnRadioButtonClick:function(elementID){$(document).on('click','#'+elementID,function(){$(this).closest('tr').find('input:not(.radio-check)').val('');});},clearRadioPropertyOnTextChange:function(elementID){$('#'+elementID).change(function(){$(this).closest('tr').find('input').prop('checked',false);});}};function getValidationMessageKeyForMatrixAutoFocus(matrixValidationType){switch(matrixValidationType){case 0:return 'application.takesurvey.batteryunichoice.required';case 2:return 'application.takesurvey.batteryunichoice.row.column.required';}}
function ajaxLinkConfirm(divID,url,confirmMessage){if(confirm(confirmMessage)){qp_sectionDisplayScript.ajaxLink(divID,url);}}
function ajaxDeleteRow1(rowID,url,identifierValue,confirmationMessage,identifierName,confirmMsgRenderAsHtml,confirmBoxHeaderTxt){if(!identifierName){identifierName="id";}
url=url+(url.indexOf("?")>=0?"&":"?")+identifierName+"="+identifierValue;if($('#'+rowID).length){qp_sectionDisplayScript.confirmedToDelete(rowID,url,identifierValue);}}
function ajaxLink(divID,ajaxProcessorURL){qp_sectionDisplayScript.ajaxLink(divID,ajaxProcessorURL);}
function modifyText(id,text){if(document.getElementById&&text!=''){obj=document.getElementById(id);if(obj){obj.innerHTML=text;}}}
function updateLanguageAttribute(languageCode){if(languageCode!=null&&languageCode!=undefined&&languageCode!=''&&languageCode!='null'){document.getElementsByTagName('html')[0].lang=languageCode;}}
function getTimeStr(timeValue,isPageTimer){var timeValueInSecs=isPageTimer?timeValue:timeValue/1000;var d=Math.floor(timeValueInSecs/86400);var h=Math.floor(timeValueInSecs/3600)-(d*24);var m=Math.floor(timeValueInSecs/60)-((d>0&&h===0?24:h)*60);var s=timeValueInSecs-(d*86400)-(h*3600)-(m*60);var timerDisplayParams=getTimerDisplayParams(d,h,m,s,isPageTimer);setSingularPluralDisplay(timerDisplayParams);return(d>=10?d:"0"+d)+" "+(h>=10?h:"0"+h)+" "+(m>=10?m:"0"+m)
+" "+(s>=10?s:"0"+s);};function getTimerDisplayParams(day,hour,minute,second,isPageTimer){var timerDisplayParams={};timerDisplayParams.day=day;timerDisplayParams.hour=hour;timerDisplayParams.minute=minute;timerDisplayParams.second=second;timerDisplayParams.daySingularDisplayID='#dayDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.dayPluralDisplayID='#daysDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.hourSingularDisplayID='#hourDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.hourPluralDisplayID='#hoursDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.minuteSingularDisplayID='#minuteDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.minutePluralDisplayID='#minutesDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.secondSingularDisplayID='#secondDisplay'+getTimerDisplaSuffix(isPageTimer);timerDisplayParams.secondPluralDisplayID='#secondsDisplay'+getTimerDisplaSuffix(isPageTimer);return timerDisplayParams;}
function getTimerDisplaSuffix(isPageTimer){return isPageTimer?'PT':'';}
function setTimeUnitDisplay(timeUnit,timeUnitSingularDisplayID,timeUnitPluralDisplayID){if(timeUnit===1&&$(timeUnitSingularDisplayID).is('.hidden')){$(timeUnitPluralDisplayID).addClass('hidden');$(timeUnitSingularDisplayID).removeClass('hidden');}else if(timeUnit!==1&&$(timeUnitPluralDisplayID).is('.hidden')){$(timeUnitSingularDisplayID).addClass('hidden');$(timeUnitPluralDisplayID).removeClass('hidden');}}
function setSingularPluralDisplay(displayParams){setTimeUnitDisplay(displayParams.day,displayParams.daySingularDisplayID,displayParams.dayPluralDisplayID);setTimeUnitDisplay(displayParams.hour,displayParams.hourSingularDisplayID,displayParams.hourPluralDisplayID);setTimeUnitDisplay(displayParams.minute,displayParams.minuteSingularDisplayID,displayParams.minutePluralDisplayID);setTimeUnitDisplay(displayParams.second,displayParams.secondSingularDisplayID,displayParams.secondPluralDisplayID);}
function setTimeDisplay(str,isPageTimer){var idPrefix=isPageTimer?"pt":"st";var hourDiv=document.getElementById(idPrefix+"-hour");var minDiv=document.getElementById(idPrefix+"-min");var secDiv=document.getElementById(idPrefix+"-sec");if(hourDiv){hourDiv.innerHTML=str.split(" ")[1];}
if(minDiv){minDiv.innerHTML=str.split(" ")[2];}
if(secDiv){secDiv.innerHTML=str.split(" ")[3];}}
function setExtendTimerOn(){$('#pt-extend-timer').remove();$('#pt-title').removeClass('hidden');$('#pt-extend-timer-value').val(pageTimerParams.extendTime);document.cookie="page_timer_extended_"+pageTimerParams.timerQuestionID+"=true;path=/;";pageTimerParams.timeLeft+=pageTimerParams.extendTime;pageTimerParams.maxTime+=pageTimerParams.extendTime;}
function suspendPageTimerIfPresent(){if(loadedPageTimers.length>0){loadedPageTimers[0].suspend();loadedPageTimers=[];}}
function addSkipJSValidationInput(frm){var skipJSValidationInput=document.createElement("input");skipJSValidationInput.setAttribute("type","hidden");skipJSValidationInput.setAttribute("name","skipJSValidationInput");skipJSValidationInput.setAttribute("value","true");frm.appendChild(skipJSValidationInput);frm.onsubmit();}
function recaptchaCallback(){var lastSectionQuestionId=qp_sections.slice(-1)[0].firstQuestionID;$('#errorSpan_'+lastSectionQuestionId).html('');showSubmitButtonWhenFocusMode();}
function showSubmitButtonWhenFocusMode(){if(isFocusMode()){$('.survey-submit-wrapper .btn-submit').removeClass('hidden').addClass('is-active');}}
function isFocusMode(){return $('.survey-body-wrapper').hasClass(qp_sectionDisplayScript.FOCUS_MODE_MAIN_CLASS);}