var KEY_CODE_MINUS=45;var MESSAGE_DISPLAY_TIME=3000;var defaultInteractiveBinding={init:function(){this.otherOptionEdit();this.dropDownOtherOption();this.dropDownOtherOptionWithNaOption();this.headingClone();this.iconFocusInput();this.fileDragdrop();this.exclusiveOptionToggle();this.numericKeyPressHandler();this.setDefaultDateForCalendar();this.clearCalendarPopup();this.initTubePulseMedia();this.initCommentBoxCopyPasteDetection();},initTubePulseMedia:function(){let $hasInteractiveMode=$('.survey-inside-wrapper').is('.has-interactive-mode');let $tubePulseContainer=$('.answer-container.video-rating-question');if(!$hasInteractiveMode&&$tubePulseContainer){this.initTubePulseAutoplayEvent($tubePulseContainer);}},initTubePulseAutoplayEvent:function($tubePulseContainer){var $mediaHasAutoplay=$tubePulseContainer.find('.autoplay');if($mediaHasAutoplay.length>0){$mediaHasAutoplay[0].play();}else if($tubePulseContainer.find('iframe')&&$tubePulseContainer.find('iframe').length){this.initYTPlayer();}},initYTPlayer:function(){let self=this;setTimeout(function(){if(typeof window.myPlayer==='undefined'||typeof window.myPlayer.playVideo!='function'){self.initYTPlayer();}else{window.myPlayer.playVideo();}},50);},clearCalendarPopup:function(){if($('#ui-datepicker-div').length>0&&$('#ui-datepicker-div').html().length>0){$('#ui-datepicker-div').html('');}},numericKeyPressHandler:function(){$('input.form-input.number-input').on('keypress input',function(event){event=event||window.event;var allowedKeyCodeArr=[0,8,9,13,35,36,37,39,43,44,45,46];if(isSpecialCharactersNotAllowed(this)){allowedKeyCodeArr=[13];}
var msgText=getValidationMessageText($(this),"application.takesurvey.validation.text.numeric.failure");var character=this.value;var code=event.which||event.keyCode||character.charCodeAt(character.length-1);handleNegativeValueForConstantSum(code,event.target.id);if(jQuery.inArray(code,allowedKeyCodeArr)==-1&&(code<48||code>57)){if($(this).parents('.loop-wrapper').find('[id^=errorSpan].error').length>0){showErrorForNumericInput.call(this,msgText);}else if($(this).parents('.flex-matrix-question').find('[id^=errorSpan].error').length>0){msgText=getValidationMessageText($(this),"application.takesurvey.flexmatrix.js.numeric.failure");showErrorForFlexMatrixNumericInput.call(this,msgText);}else if($(this).parents('.van-westendorp-text-question').find('[id^=errorSpan].error').length>0||$(this).parents('.form-type-question').find('[id^=errorSpan].error').length>0){showErrorForVanWestendorpNumericInput.call(this,msgText);}else if($(this).parents('.csum').find('[id^=errorSpan].error').length>0){showErrorForConstantSumNumericInput.call(this,msgText);}else if($(this).parents('.matrix-spreadsheet-question').find('[id^=errorSpan].error').length>0){showErrorForNumericInputInSpreadSheetType.call(this,msgText);}
if(event.type=='input'){$(this).val($(this).val().replace(character.charAt(character.length-1),''));}
event.preventDefault();return false;}
var parsedText=removeExtraSpecialCharacters($(this).val());if($(this).val()!=parsedText){$(this).parents('.loop-wrapper').find('[id^=errorSpan].error').html(msgText).removeClass('hidden').delay(MESSAGE_DISPLAY_TIME).queue(function(){if(getValidationMessageText($(this),"application.takesurvey.validation.text.numeric.failure")===$(this).html()){$(this).addClass("hidden");}
$(this).dequeue();});$(this).val(parsedText);}
return true;});function showErrorForNumericInput(msgText){var $this=$(this);var self=$(this).parents('.loop-wrapper').find('[id^=errorSpan].error');self.html(msgText).removeClass('hidden vhidden');setTimeout(function(){if(getValidationMessageText($this,"application.takesurvey.validation.text.numeric.failure")===self.html()){self.addClass("vhidden");}},MESSAGE_DISPLAY_TIME);}
function showErrorForNumericInputInSpreadSheetType(msgText){var self=$(this).parent().parent().parent().next().children().children();self.html(msgText).removeClass('hidden vhidden');setTimeout(function(){if(translatedValidationMessages['systemValidations']["application.takesurvey.validation.text.numeric.failure"]===self.html()){self.addClass("vhidden");}},MESSAGE_DISPLAY_TIME);}
function showErrorForFlexMatrixNumericInput(message){var numericInputColumnIndex=$(this).parent().parent().index()-1;var questionTitle=$(this).parents('.parent-table').find('.control-label')[numericInputColumnIndex].innerHTML;var errorSpanId=$(this).parents('.flex-matrix-question').find('[id^=errorSpan].error')[numericInputColumnIndex].id;var msgText=replaceValues(message,[questionTitle]);var self=$('#'+errorSpanId);self.html(msgText).removeClass('hidden vhidden');setTimeout(function(){if(self.html().includes(questionTitle)&&self.siblings('[id^=errorSpan_]').hasClass("hidden")){self.addClass("vhidden");}},MESSAGE_DISPLAY_TIME);}
function showErrorForVanWestendorpNumericInput(message){var $this=$(this);var self=$(this).parents('.answer-options').find('[id^=errorSpan].error');self.html(message).removeClass('hidden vhidden');setTimeout(function(){if(getValidationMessageText($this,"application.takesurvey.validation.text.numeric.failure")===self.html()){self.addClass("vhidden");}},MESSAGE_DISPLAY_TIME);}
function showErrorForConstantSumNumericInput(message){var $this=$(this);var self=$(this).parents('.csum').find('[id^=errorSpan].error');self.html(message).removeClass('hidden vhidden');setTimeout(function(){if(getValidationMessageText($this,"application.takesurvey.validation.text.numeric.failure")===self.html()){self.addClass("vhidden");}},MESSAGE_DISPLAY_TIME);}
function isSpecialCharactersNotAllowed(element){return $(element).closest('.answer-container').hasClass('special-characters-not-allowed');}
function removeExtraSpecialCharacters(textValue){textValue=textValue.replace(/[^0-9$#%+\-,'.]/g,'');var specialCharacters=['$','#','%','+','-','.','\''];var length=specialCharacters.length;for(var i=0;i<length;i++){var firstHalf="";var secondHalf="";if(textValue.indexOf(specialCharacters[i])>=0){firstHalf=textValue.substring(0,((textValue.indexOf(specialCharacters[i]))+1));secondHalf=textValue.substring((textValue.indexOf(specialCharacters[i]))+1);var secondIndex=secondHalf.indexOf(specialCharacters[i]);var hasSpecChar=(secondIndex>=0);while(hasSpecChar){secondHalf=secondHalf.substring(0,secondIndex)+secondHalf.substring(secondIndex+1);secondIndex=secondHalf.indexOf(specialCharacters[i]);hasSpecChar=(secondIndex>=0);}
textValue=firstHalf+secondHalf;}}
return textValue;}
function handleNegativeValueForConstantSum(code,id){if($('.constant-sum-question .sum-wrapper .input-wrapper')){if(code==KEY_CODE_MINUS){$('#'+id).val('');return;}}}},exclusiveOptionToggle:function(){$('.has-exclusive-option .answer-options [type=checkbox]').change(function(){var currentSelectedName=$(this).prop('name');var currentSelectedValue=$(this).prop('value');var questionID=currentSelectedName.split("_").length=2?currentSelectedName.split("_")[1]:0;var isCurrentCheckedItemAnExclusiveOption=$(this).parents('.answer-options').is('.exclusive-option')&&$(this).is(':checked');var allCheckedExclusiveOptions=$(this).parents('.answer-container').find('.exclusive-option .radio-check[name="'+currentSelectedName+'"]:checked');if(isCurrentCheckedItemAnExclusiveOption){unselectOtherChoices.call(this,currentSelectedName,currentSelectedValue,questionID);}else if($(this).prop('checked')&&allCheckedExclusiveOptions.length>0){allCheckedExclusiveOptions.prop('checked',false).change();}});$('.has-matrix-exclusive-option .control-selection [type=checkbox], input[type=radio]').change(function(){var currentSelectedName=$(this).prop('name');var currentSelectedValue=$(this).prop('value');var questionID=currentSelectedName.split("_").length=2?currentSelectedName.split("_")[1]:0;var isCurrentCheckedItemAnExclusiveOption=$(this).parents('.control-selection').is('.matrix-exclusive-option')&&$(this).is(':checked');var allCheckedExclusiveOptions=$(this).parent().parent().parent().find('.matrix-exclusive-option .radio-check[name="'+currentSelectedName+'"]:checked');if(isCurrentCheckedItemAnExclusiveOption){unselectOtherMatrixChoices.call(this,currentSelectedName,currentSelectedValue,questionID);}else if($(this).prop('checked')&&allCheckedExclusiveOptions.length>0){allCheckedExclusiveOptions.prop('checked',false).change();}});$('.dropdown-question .multi-select li').click(function(e){if(isExclusiveOptionInSelectList()){var currentSelectedIndex=e.currentTarget.dataset.originalIndex;var isCurrentSelectedItemAnExclusiveOption=$(this).find('a').hasClass('exclusive-option');var selectBox=$('.dropdown-question .multi-select.open select')[0];var hasExclusiveOptionSelected=getHasExclusiveOptionSelected(selectBox);if(isCurrentSelectedItemAnExclusiveOption){unselectOtherSelectedOptions.call(this,currentSelectedIndex,selectBox);}else if(hasExclusiveOptionSelected){$('#'+selectBox.id+'').selectpicker('deselectAll').change();}}});function getHasExclusiveOptionSelected(selectBox){return selectBox.value!==''&&($('#'+selectBox.id+' option[value='+selectBox.value+'].exclusive-option').length>0);}
function isExclusiveOptionInSelectList(){return $('.dropdown-question .has-exclusive-option.multi-select.open').length>0;}
$('.matrix-dropdown-question .multi-select li').click(function(e){if($('.matrix-dropdown-question .has-exclusive-option.multi-select.open').length>0){var currentSelectedIndex=e.currentTarget.dataset.originalIndex;var isCurrentSelectedItemAnExclusiveOption=$(this).find('a').hasClass('exclusive-option');var selectBox=$('.matrix-dropdown-question .multi-select.open select')[0];var hasExclusiveOptionSelected=getHasExclusiveOptionSelected(selectBox);if(isCurrentSelectedItemAnExclusiveOption){unselectOtherSelectedOptions.call(this,currentSelectedIndex,selectBox);}else if(hasExclusiveOptionSelected){$('#'+selectBox.id+'').selectpicker('deselectAll').change();}}});function isDynamicExplodeOpenForTheChoice(questionID,answerID){return $('#'+'de_'+questionID+'_'+answerID).length>0;}
function hideDynamicExplodeForChoice(questionID,answerID){$('#'+'de_'+questionID+'_'+answerID).addClass("hidden");}
function isOtherOptionEditEnabledForChoice(){return $(this).parent().is(".edit-other")&&$(this).parents('.answer-options').find('.other-input').length>0;}
function isChoiceAnOtherOption(){return $(this).parents('.answer-options').is('.other-option')&&$(this).parents('.answer-options').find('.other-input').length>0;}
function unselectOtherChoices(currentSelectedName,currentSelectedValue,questionID){var allSelectedItemsForSameQuestion=$(this).parents('.answer-container').find('.radio-check[name="'+currentSelectedName+'"]:checked');allSelectedItemsForSameQuestion.each(function(){if($(this).prop('value')!=currentSelectedValue){if(isDynamicExplodeOpenForTheChoice(questionID,$(this).prop('value'))){hideDynamicExplodeForChoice(questionID,$(this).prop('value'));}else if(isOtherOptionEditEnabledForChoice.call(this)){$(this).parent().find('input.other-input').trigger('focusout');}
$(this).prop('checked',false).change();}});}
function unselectOtherMatrixChoices(currentSelectedName,currentSelectedValue,questionID){var allSelectedItemsForSameQuestion=$(this).parent().parent().parent().find('.radio-check[name="'+currentSelectedName+'"]:checked');allSelectedItemsForSameQuestion.each(function(){if($(this).prop('value')!=currentSelectedValue){if(isDynamicExplodeOpenForTheChoice(questionID,$(this).prop('value'))){hideDynamicExplodeForChoice(questionID,$(this).prop('value'));}
$(this).prop('checked',false).change();}});}
function unselectOtherSelectedOptions(currentSelectedIndex,selectBox){var currentSelectedOptionValue=$(selectBox).find('option')[currentSelectedIndex].value;if(selectBox.value===currentSelectedOptionValue){return;}
$('#'+selectBox.id+'').selectpicker('deselectAll').change();}},initCommentBoxCopyPasteDetection:function(){$('.comments-suggestions-question .answer-options textarea').bind("paste",function(e){var pastedData=e.originalEvent.clipboardData.getData('text');var copyPastedText=$(e.currentTarget).closest('.answer-container').find(".hidden-text");copyPastedText.val().length>0?copyPastedText.text(copyPastedText.val()+","+pastedData):copyPastedText.text(pastedData);});},otherOptionEdit:function(){$('.other-option .control-label').each(function(){var label=$(this);var defaultLabelText=label.html();var value=$(this).parents('.other-option').find('.radio-check').val();var textbox=$(this).parents('.other-option').find('#t_'+value+"_ID");var radiobuttons=$(this).parents('.answer-container').find('input:radio.radio-check');if(textbox.val()){updateOtherText(textbox);}
label.parents('.control-selection').unbind();label.parents('.control-selection').click(function(){$(this).addClass('edit-other');if(!$(this).find('.radio-check').is(':checked')){$(this).find('.control-label').html(defaultLabelText);$(this).find('.control-label').show();$(this).find('.other-input').val('');$(this).find('.other-input').addClass('hidden');$(this).parents('.answer-options').find('[id^=errorSpan].error').html('');$(this).parents('.answer-options').find('[id^=errorSpan].error').addClass('hidden');}else{$(this).find('.control-label').hide();$(this).find('.other-input').removeClass('hidden').focus();showNPSPlusCommentQuestion(this);}
if($(this).parent().find('.radio-check').is('input[type="radio"]')){$(this).parent().parent().find('.dynamic-explode').addClass("hidden");}});function getCommentQuestion(elem){var question=elem.next('.survey-question-wrapper.hidden');if(question&&question.length>0&&question.find('.answer-container.voting-question').length==0){return getCommentQuestion(question);}}
function showNPSPlusCommentQuestion(elem){if($(elem).parents('.word-cloud-question')&&$(elem).parents('.word-cloud-question').length>0){var commentQuestion=getCommentQuestion($(elem).parents('.survey-question-wrapper'));if(commentQuestion&&commentQuestion.length>0){commentQuestion.removeClass('hidden');}}}
function updateOtherText(elem){if(elem.parent().find('.radio-check').is(':checked')&&!elem.val()&&elem.parents('.survey-question-wrapper').find('.question-container').is('.required')){elem.parents('.answer-options').find('.other-input').addClass('error-line');elem.parents('.answer-options').find('[id^=errorSpan].error').removeClass('hidden');elem.parents('.answer-options').find('[id^=errorSpan].error').html(getValidationMessageText(elem,"application.takesurvey.other.required"));return;}
if(elem.parent().find('.radio-check').is(':checked')&&elem.val()){elem.prev().html(elem.val());}else{elem.prev().html(defaultLabelText);elem.val('');}
elem.addClass('hidden');elem.prev().show();elem.parents('.control-selection').removeClass('edit-other');elem.parents('.answer-options').find('.other-input.error-line').removeClass('error-line');elem.parents('.answer-options').find('[id^=errorSpan].error').addClass('hidden');elem.parents('.answer-options').find('[id^=errorSpan].error').html('');}
if(radiobuttons.length>0){radiobuttons.change(function(){var otherRadioButton=$(this).parents('.answer-container').find('.answer-options.other-option input:radio');if(otherRadioButton.length>0&&!otherRadioButton.is(':checked')){updateOtherText(textbox);}});}
textbox.focusout(function(e){updateOtherText($(this));});textbox.keydown(function(e){if(e.which==13){e.preventDefault();updateOtherText($(this));$(this).parents('.control-selection').trigger('change');}});});},dropDownOtherOption:function(){var self=this;$('.dropdown-question select.has-other').on('change',function(){var val=$(this).find("option:last").val();if($(this).find("option:last").is(':selected')){if($(this).parents('.answer-container').find(".answer-options.other-option.hidden").length===1){$(this).parents('.answer-container').find('#t_'+val+'_ID').removeClass("hidden");$(this).parents('.answer-container').find('#t_'+val+'_ID .form-input').focus();$(this).parents('.answer-container').find('#t_'+val+'_ID .form-input').prop('autofocus');}}else{$(this).parents('.answer-container').find('#t_'+val+'_ID').addClass("hidden");}}).change();},dropDownOtherOptionWithNaOption:function(){var self=this;$('.dropdown-question select.has-other.has-na').on('change',function(){var val=$(this).find("option:nth-last-child(2)").val();if($(this).find("option:nth-last-child(2)").is(':selected')){if($(this).parents('.answer-container').find(".answer-options.other-option.hidden").length===1){$(this).parents('.answer-container').find('#t_'+val+'_ID').removeClass("hidden");$(this).parents('.answer-container').find('#t_'+val+'_ID .form-input').focus();$(this).parents('.answer-container').find('#t_'+val+'_ID .form-input').prop('autofocus');}}else{$(this).parents('.answer-container').find('#t_'+val+'_ID').addClass("hidden");}}).change();},headingClone:function(){function updateBudgetScale(){$('.budget-scale-question').each(function(){var cloneThis=$(this).find('.table-heading-wrapper');if($(window).width()<768){if($(this).find('.loop-wrapper .table-heading-wrapper').length<=0){$(cloneThis).clone().insertBefore($(this).find('.loop-wrapper .needed-value'));}}else{$(this).find('.loop-wrapper .table-heading-wrapper').remove();}});}
function updateNumericSlider(){$('.numeric-slider-question').each(function(){var cloneThis=$(this).find('.table-heading-wrapper');if($(window).width()<768){if($(this).find('.loop-wrapper .table-heading-wrapper').length<=0){$(cloneThis).clone().insertBefore($(this).find('.loop-wrapper .text-slide-value'));}}else{$(this).find('.loop-wrapper .table-heading-wrapper').remove();}});}
function updateTextSlider(){$('.text-slider-question').each(function(){var cloneThis=$(this).find('.table-heading-wrapper');if($(window).width()<768){if($(this).find('.loop-wrapper .table-heading-wrapper').length<=0){$(cloneThis).clone().insertBefore($(this).find('.loop-wrapper .text-slide-value'));}}else{$(this).find('.loop-wrapper .table-heading-wrapper').remove();}});}
$(window).on('resize',function(){updateBudgetScale();updateNumericSlider();updateTextSlider();});updateBudgetScale();updateNumericSlider();updateTextSlider();},iconFocusInput:function(){$('.icon-wrapper .fa').on('click',function(){$(this).parent().find('.form-input').focus();});$('.form-input').on('focus',function(){$(this).parent('.input-wrapper').addClass('show-line');}).on('blur',function(){$(this).parent('.input-wrapper').removeClass('show-line');})},fileDragdrop:function(){$('.upload-file-wrapper').on('dragover dragenter',function(){$(this).addClass('is-dragover');}).on('dragleave dragend drop change',function(){$(this).removeClass('is-dragover');})},setDefaultDateForCalendar:function(){$('input.form-input.hasDatepicker').each(function(){if($(this).closest(".answer-container").hasClass('calendar-default-today')){if(!$.trim($(this).val())){$(this).datepicker('setDate',new Date());var hiddenFieldID=$(this).attr('id').replace('_display','');$("#"+hiddenFieldID).val($(this).val());}}});}};function getValidationMessageText(element,key){var questionID=parseInt(element.closest('[id^=QuestionSection]').attr('id').split('_')[1]);var message=getCustomValidationErrorMessage(questionID,key);if(message===null||message===undefined){return getTranslatedValidationMessage(key);}
return message;}
function getCustomValidationErrorMessage(questionID,messageKey){var questionValidationErrorObj=translatedValidationMessages['customValidations'][questionID];if(questionValidationErrorObj){return questionValidationErrorObj[messageKey];}
return null;}
function getTranslatedValidationMessage(key){return translatedValidationMessages['systemValidations'][key];}