$(function(){var a=$("body");if(a.hasClass("jsMyAccount")){$(".jsSearchFilter a").click(function(){return false});$("#doSearch").click(doOwnAccountSearch);$("#search").submit(doOwnAccountSearch)}else{if(Config.is4Sync){$(".searchbox").remove()}else{if(!a.hasClass("search-page")||a.hasClass("search-index")){$("#doSearch").click(doHeaderSearch);$("#search").submit(doHeaderSearch)}}}});function doOwnAccountSearch(b){var d=$("#searchQuery");if(isUsedSuggestionSearch(b)){d.val(b)}if(!Config.is4Sync){AjaxSuggestion.hidePopup()}AccountFacade.showLoadingDiv();d.val(d.val().substr(0,200));currentDirId=AccountFacade.SEARCH_RESULT_DIR_ID;$("#pathString").find(".pathItem.last").attr("href","javascript:void(0)");var e={};e.view="web";var c=~~$(".jsDefSearchCategory").val();if(c>0&&c<9){e.category=c}if(d.val()){e.query=d.val()}function a(f,g,h){$.ajax({url:"//"+Config.searchDomain+f,method:"get",dataType:"json",data:g,xhrFields:{withCredentials:true},crossDomain:true,success:h})}$.get("/web/rest/v1_2/user/files",e,function(f){var g=convertNewFieldsToOld(f,true);if(Config.is4Sync){printFiles(g,g.length)}else{function h(j){var i=convertNewFieldsToOld(j,false);printFiles(g.concat(i),g.length,i.length)}a("/web/rest/v1_2/files",e,h)}});return false}function prepareSlideshowIds(c){var b=$("#slideshowAnchors");b.html("");for(var a in c){if(Utils.isImage(c[a].name)||Utils.isVideo(c[a].name)){b.append($('<input type="hidden" value="'+c[a].id+'"/>'))}}}function printFiles(e,f,a){var h=AccountFacade.getVirtualRights(currentDirId);h.commands.SlideShow=false;var g=0;for(var d=0;d<e.length;d++){if(Utils.isImage(e[d].name)||Utils.isVideo(e[d].name)){g++}}if(g){h.commands.SlideShow=true}AccountFacade.setCurrentRights(h);var c=AccountFacade.PathObject([],[]);var b=Utils.escapeXSS($("#searchQuery").val());c.ids.push(AccountFacade.updateBreadCrumbs.rootId);c.path.push(AccountFacade.updateBreadCrumbs.rootPath);c.ids.push(AccountFacade.SEARCH_RESULT_DIR_ID);c.path.push($("#sBreadcrumbsPhrase").val()+(b.length?" '"+$("<div/>").text(b).text()+"'":""));AccountFacade.updateBreadCrumbs(c);if(webFXTreeHandler.selected){webFXTreeHandler.selected.deSelect()}AccountFacade.info.dirs=[];AccountFacade.info.files=e;AccountFacade.sort.ownLength=f;Events.removeListener("account.items.loaded");Events.addListener("account.items.loaded",function(){if(currentDirId!=AccountFacade.SEARCH_RESULT_DIR_ID){Events.removeListener("account.items.loaded");return}var q=$(".jsIsThumbnail").length;var p=q?$('<div class="searchDivider"></div>'):$('<tr class="searchDivider"><td class="TfilesCheck"></td><td class="TfilesName"></td><td class="TfilesSize"></td><td class="TfilesModify"></td></tr>');var l=p.clone().addClass("ownFiles");var i=$("#sNoResults").val();var n=q?$('<div class="searchNoResults halfBlock">'+i+"</div>"):$('<tr class="searchNoResults halfBlock"><td colspan="4">'+i+"</td></tr>");var m=$("#jsFilesTable");if(!e.length){$("#files").append($('<div class="searchNoResults fullBlock">'+i+"</div>"))}else{var k=Utils.escapeXSS($("#searchQuery").val());var j=k?$("#sOwnFilesWithQuery").val()+' "'+$("<div/>").text(k).text()+'"':$("#sOwnFiles").val();q?l.html(j):l.find(".TfilesName").html(j);m.prepend(l);if(!f){n.clone().insertAfter($(".searchDivider.ownFiles:first"))}if(!Config.is4Sync){j=$("#sFullFiles").val();var o=q?m.children().not(".searchDivider,.searchNoResults")[f?f-1:0]:m.find("tr:not(.searchDivider,.searchNoResults)")[f?f-1:0];q?p.html(j):p.find(".TfilesName").html(j);f?p.insertAfter(o):p.insertBefore(o);if(a===0){n.clone().insertAfter(p)}else{if(a>=100){$("#files").append($('<div class="searchMoreResults"><div class="moreResultsButton inline" onclick="doHeaderSearch()">'+$("#sMoreResults").val()+"</div></div>"))}}}}AccountFacade.hideLoadingDiv()});prepareSlideshowIds(e);if(g*2>=e.length){AccountFacade.fillFileListThumbnails()}else{AccountFacade.fillFileListDetails()}}function convertNewFieldsToOld(f,j){var b=[];for(var g=0;g<f.items.length;g++){var k={};var a=f.items[g].thumbnailUrl;var e=a&&a.indexOf("/images/censored100.jpg")!=-1;k.canEdit=false;k.canPreview=!e&&hasPreview(f.items[g].fileName,a);k.fileCss=Utils.getExtension(f.items[g].fileName)+"FileExt";k.ftype="";k.id=f.items[g].fileId;k.parentId=f.items[g].dirId;k.name=f.items[g].fileName;k.prStyle=a;k.size=f.items[g].fileSize;var d=new Date(f.items[g].uploadTime);k.time=h(d.getMonth()+1)+"-"+h(d.getDate())+"-"+d.getFullYear();var c=getCategoryName(f.items[g].fileName);k.typeCss=c+(k.canPreview?" hasPreview":"");if(c=="audio"&&!e){k.canPlay=true}k.isOwn=j;b.push(k)}function h(l){return(l<10)?"0"+l:l}return b}function doHeaderSearch(e){var d=["0","1","2","3","4","5","8"];var f=$(".jsDefSearchCategory").val();f=$.inArray(f,d)>-1?f:"0";var c=f>0?(Config.searchSeparator+"category="+f):"";var a=isUsedSuggestionSearch(e);var h=$("#searchQuery");if(a){h.val(e)}var b=h.val();var g="";if(b){g=(c.length?"&":Config.searchSeparator)+"query="+Utils.encodeSearchParam(b)}document.location.href=Config.mainSiteSecure+"/web/q"+c+g;return false}function isUsedSuggestionSearch(a){return !Config.is4Sync&&a&&a.length}function hasPreview(e,d){var b=Utils.getExtension(e);var c=getCategoryName(e);var a=$.inArray(b,["apk","fb2","epub","doc","docx","xls","xlsx","rtf","ppt","pptx","pps","cbr","cb7","cba","cbz","cbt","djvu"])!=-1;return !a&&c!="audio"&&($.inArray(b,["html","htm","jsp","asp","sql","js","css","xml","dtd","properties","tld","txt"])!=-1||!!d||(b=="zip"&&AccountFacade.hasFeatures("hasFeatureZipPreview"))||(((c=="video"&&b!="mkv")||$.inArray(b,["midi","aiff","au"])!=-1)&&AccountFacade.hasFeatures("hasFeaturePlayMusicFiles")))}function getCategoryName(b){var a=Utils.getExtension(b);switch(true){case ($.inArray(a,["wav","mp3","ra","rm","ram","wma","ape","ogg","m4a","mpc","flac"])!=-1):return"audio";case ($.inArray(a,Utils.vidExtensions)!=-1):return"video";case ($.inArray(a,Utils.imgExtensions)!=-1):return"image";case ($.inArray(a,["kmz","package","rar","zip","gz","7z","tar","cso","iso","img"])!=-1):return"compressed";case ($.inArray(a,["doc","docx","lit","mdb","pdf","pps","ppt","rtf","txt","wps","xls","xlsx","srt","epub","cb7","cba","cbr","cbt","cbz","fb2","djvu"])!=-1):return"office";case ($.inArray(a,["exe","jar","cod","alx"])!=-1):return"program";case ($.inArray(a,["htm","swf","html"])!=-1):return"web";case ($.inArray(a,["apk","nth","prc","sis","ipa"])!=-1):return"mobile";default:return"other"}};