"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[396],{5763:function(e,t,r){r.d(t,{D:function(){return s}});var n=r(59499),o=r(85893),i=r(67294),l=r(47281);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let s=(0,i.memo)(e=>(0,o.jsx)(l.J,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"Checkmark",_src:"assets/glyph/Checkmark.svg",_viewBox:"0 0 24 24"},e)))},80221:function(e,t,r){r.d(t,{N:function(){return s}});var n=r(59499),o=r(85893),i=r(67294),l=r(47281);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let s=(0,i.memo)(e=>(0,o.jsx)(l.J,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"QuantityAdd",_src:"assets/glyph/QuantityAdd.svg",_viewBox:"0 0 24 24"},e)))},60396:function(e,t,r){r.d(t,{x:function(){return o},Q:function(){return el}});var n,o,i=r(59499),l=r(85893),a=r(67294),s=r(96333),c=r(17619),f=r(19521),u=r(56947),d=r.n(u),p=r(20041),O=r(47052),v=r(4730),m=r(5763),y=r(80221),g=r(50667);let b=["className","data-test","hasWarning","isConfirmed","isFullWidth","isPending","onClick","size"];function h(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?h(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let E=(0,a.forwardRef)((e,t)=>{let{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,size:f}=e,u=(0,v.Z)(e,b),p=Number.parseInt("sm"===f?d().font.size.text.medium:d().font.size.text.base,10);return(0,l.jsx)(g.i,_(_({confirmedText:"Offer saved",initialText:"Save offer",warningText:"Offer not saved. Try again"},u),{},{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,ref:t,renderLeadingConfirmed:(0,l.jsx)(m.D,{color:d().colors.palette.green.light,width:p}),renderLeadingInitial:(0,l.jsx)(y.N,{color:d().colors.palette.white,width:p}),size:f}))});E.displayName="ButtonOffer";let w=(0,f.ZP)(E).withConfig({displayName:"ButtonOfferSecondary",componentId:"sc-272k6x-0"})(["button{","}"],({isConfirmed:e})=>e?`
      ${O.QJ}

      &:hover {
        ${O.Ky}
      }

      &:active {
        ${O.BH}
      }
      svg stop {
        stop-color: ${u.colors.palette.green.light};
      }
  `:`
      font-weight: normal;
      ${p._f}

      &:hover {
        ${p.ID}
      }

      &:active {
        ${p.h5}
        svg stop {
          stop-color: ${u.colors.palette.white};
        }
      }
      svg {
        color: inherit;
      }
      svg stop {
        stop-color: ${u.colors.palette.gray.medium};
      }
    `);w.displayName="ButtonOfferSecondary";var j=r(55139),R=r(77110),F=r(44281),P=r(35216),D=r(44350),k=r(23451);let I=async e=>{let{apis:{loyaltyGuestOfferLists:t},baseUrl:r,circleOfferLoyaltyKeys:n}=(0,D.config)().services.apiPlatform,o=`${r}/${t.endpointPaths.postOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,k.v_)(o,{headers:{Authorization:n.loyaltyClientKey,"x-api-key":n.loyaltyApiKey},parameters:{location_id:null==e?void 0:e.storeId},errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:S}=(0,P.F)({name:"@web/domain-circle-offers/post-offer-v1",mutationFn:e=>I(e)}),A=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],x=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,D.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.postOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,k.v_)(n,{errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:C}=(0,P.F)({name:"@web/domain-circle-offers/post-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,A),o=(0,D.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?I(n):x(n)}}),N=async e=>{let{apis:{loyaltyGuestOfferLists:t},circleOfferLoyaltyKeys:r,baseUrl:n}=(0,D.config)().services.apiPlatform,o=`${n}/${t.endpointPaths.deleteOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,k.IV)(o,{headers:{Authorization:r.loyaltyClientKey,"x-api-key":r.loyaltyApiKey},errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:$}=(0,P.F)({name:"@web/domain-circle-offers/delete-offer-v1",mutationFn:e=>N(e)}),T=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],L=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,D.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.deleteOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,k.IV)(n,{errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:M}=(0,P.F)({name:"@web/domain-circle-offers/delete-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,T),o=(0,D.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?N(n):L(n)}});var V=r(26797),B=r(32657),z=r(6153),Z=r(43430);function K(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?K(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let J=(e,t)=>{var r,n,o;let i=null!==(r=null==e?void 0:null===(n=e.components)||void 0===n?void 0:n[0])&&void 0!==r?r:{};return{name:null!==(o=null==i?void 0:i.title)&&void 0!==o?o:null==i?void 0:i.id,position:String(t),component:null!=i&&i.title?`${null==i?void 0:i.id} || ${null==i?void 0:i.title}`:null==i?void 0:i.id,componentType:null==i?void 0:i.type_name,contentType:null==i?void 0:i.content_type}},G=(e,t,r)=>{let{trackEvent:n}=(0,Z.rS)(),i=(0,z.Kk)(),l=(0,B.ew)(i),a=null==e?void 0:e.strategyId,s=J(t,r);return t=>{let r,c;let{offerId:f,action:u,offerAriaLabel:d}=null!=t?t:{};f&&(u===o.ADDED_OFFER?r=!0:u===o.ADD_OFFER_ERROR&&(r=!1),u===o.REMOVED_OFFER?c=!0:u===o.REMOVE_OFFER_ERROR&&(c=!1),n({appState:{url:i,cmsPageId:l},guest:{eventType:"click"},offerInfo:Y(Y(Y({},r?{addOffer:r}:{}),c?{removeOffer:c}:{}),{},{offers:[{offerId:f,offerSelected:void 0!==r||void 0!==c,offerType:"cartwheel"}]}),promotionInfo:{promos:[{id:f,omtOfferId:f,added:r,removed:c,longTagSpecialOffer:d}]}}),a&&(0,Z.OK)({recClick:{type:"promo",offerId:f,position:null==e?void 0:e.position,strategyId:null==e?void 0:e.strategyId,strategyName:null==e?void 0:e.strategyName},contentClick:s}))}};var W=r(86235);let H=()=>{let{openJoinCircleModal:e,closeJoinCircleModal:t,isCircleEnrolled:r,isGuestLoggedIn:n}=(0,a.useContext)(W.j);return{closeJoinCircleModal:t,openJoinCircleModal:e,isCircleEnrolled:r,isGuestLoggedIn:n}};var Q=r(78503),U=r(36679),q=r(13347);let X=({isPopoverOpen:e,offerButtonRef:t,setIsPopoverOpenToggle:r,isErrorState:n,errorMessage:o=V._r,isIconOnly:i})=>{let s=(0,a.useRef)(null),c=(0,a.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.focus()},[]),f=(0,a.useCallback)(e=>{null==e||e.preventDefault(),(0,q.zB)(window.location.href)},[]);return(0,l.jsx)(j.J,{isOpen:e,onOpen:c,renderInline:!0,role:n?"alert":"tooltip",tailPosition:i?"end":void 0,target:t,toggle:r,variant:n?"warning":"primary",zIndex:1100,children:n?(0,l.jsx)("span",{"data-test":"save-offer-popover-error",ref:s,tabIndex:-1,children:o}):(0,l.jsx)(U.F,{className:"h-margin-a-tiny",color:"onDark","data-test":"save-offer-popover-sign-in-link",onClick:f,ref:s,underline:"always",children:V.IY})})};X.displayName="SaveCircleOfferPopover";let ee=f.ZP.svg.withConfig({displayName:"AnimatedIcon__AnimatedSvg",componentId:"sc-x6qm3h-0"})([".plus{clip-path:",";transition:clip-path 300ms;transition-delay:100ms;",";}.checkmark{clip-path:inset(0 100% 0 0);transition:clip-path 100ms;transition-delay:0;","}@media (prefers-reduced-motion){.plus,.checkmark{transition:none;transition-delay:0;}}"],"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%)",e=>e.isOfferAdded?`
    clip-path: polygon(0% 0%, 0% 100%, 0 100%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%, 100% 100%, 100% 0%);
    transition: clip-path 100ms;
    transition-delay: 0;
    `:"",e=>e.isOfferAdded?`
    clip-path: inset(0);
    transition: clip-path 300ms;
    transition-delay: 100ms;
    `:""),et=({isOfferAdded:e=!1,size:t=24})=>(0,l.jsxs)(ee,{focusable:"false",height:t,isOfferAdded:e,role:"presentation",viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:[(0,l.jsx)("path",{className:"plus",d:"M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z",fill:u.colors.palette.red.default}),(0,l.jsx)("path",{className:"checkmark",d:"M8.923 16.443l-4.395-4.364-1.056 1.064 5.451 5.414L20.528 7.032l-1.056-1.064z",fill:u.colors.palette.green.light})]});et.displayName="AnimatedIcon";let er=f.ZP.a.withConfig({displayName:"styles__PreLineLink",componentId:"sc-122dvwh-0"})(["white-space:pre-line;"]);function en(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eo(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?en(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):en(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(n=o||(o={})).ADDED_OFFER="ADDED_OFFER",n.ADD_OFFER_ERROR="ADD_OFFER_ERROR",n.REMOVED_OFFER="REMOVED_OFFER",n.REMOVE_OFFER_ERROR="REMOVE_OFFER_ERROR";let ei=e=>e===V.a0?V.rL:e===V.mF?V.b0:void 0,el=({buttonSize:e,confirmedText:t,initialText:r,isOfferAddedDefault:n,offerId:i,offerAriaLabel:f,onAddOffer:u,onRemoveOffer:d,variation:p,trackingDetails:O,shouldTrack:v=!0,metadata:m,order:y})=>{var g;let[b,h]=(0,Q.H)(),{openJoinCircleModal:_,isGuestLoggedIn:P,isCircleEnrolled:D}=H(),k=(0,F.l)(),{pricingStoreId:I}=(0,s.K)(),{screenSmMax:S}=(0,c.l)(),{0:A,1:x}=(0,a.useState)(void 0),{0:N,1:$}=(0,a.useState)(!1),{0:T,1:L}=(0,a.useState)(!1),B=G(O,m,y),z=n?V.mF:V.KL,{0:Z,1:K}=(0,a.useState)(z),{0:Y,1:J}=(0,a.useState)(!1),W=i?null==b?void 0:null===(g=b[i])||void 0===g?void 0:g.added:void 0,{0:U,1:q}=(0,a.useState)("");(0,a.useEffect)(()=>{if(!0===W){if(Z===V.mF)return;return K(V.mF)}if(!1===W){if(Z===V.a0)return;return K(V.a0)}K(z)},[W,z,Z,i]);let ee=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==u||u(t),v&&B(t)},[i,f,u,v,B]),en=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==d||d(t),v&&B(t)},[i,f,d,v,B]),el=(0,a.useCallback)(e=>{if((null==e?void 0:e.status)===409){var t,r,n;x(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:null===(n=r.errors)||void 0===n?void 0:n.NOT_ENOUGH_SLOTS)}J(!0),ee(o.ADD_OFFER_ERROR),K(V.a0)},[ee]),ea=(0,a.useCallback)(()=>{Y&&J(!1),ee(o.ADDED_OFFER),K(V.mF),q("Offer saved"),h&&h({type:V.NE.ADD_OFFER,value:{offerId:i}})},[ee,Y,i,h]),[es]=C({onError:el,onSuccess:ea}),ec=(0,a.useCallback)(()=>{var e;L(!1),null===(e=eO.current)||void 0===e||e.focus()},[]),ef=(0,a.useCallback)(()=>{Y&&J(!1),en(o.REMOVED_OFFER),K(V.a0),q("Offer removed"),h&&h({type:V.NE.REMOVE_OFFER,value:{offerId:i}})},[en,Y,i,h]),eu=(0,a.useCallback)(()=>{J(!0),en(o.REMOVE_OFFER_ERROR),K(V.mF)},[en]),[ed]=M({onError:eu,onSuccess:ef});(0,a.useEffect)(()=>{Y&&$(e=>!e||e)},[Y]);let ep=(0,a.useCallback)(async()=>{if(!Y){if(!P)return $(!0);if(P&&!D)return _();switch(K(V.rR),Z){case V.KL:case V.a0:if(i)return L(!0),es({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:k,storeId:I});break;case V.mF:if(i)return ed({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:k})}}},[es,Y,ed,D,P,i,Z,_,$,I,k]),eO=(0,a.useRef)(null),ev=(0,a.useCallback)(()=>{$(e=>(e&&(x(void 0),J(!1)),!e))},[]),em="secondary"===p?w:E,ey="iconOnly"===p,eg=(0,a.useRef)(null),eb=(0,a.useCallback)(()=>{var e;null===(e=eg.current)||void 0===e||e.focus()},[]);return i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(X,{errorMessage:null!=A?A:ei(Z),isErrorState:Y,isIconOnly:ey,isPopoverOpen:N,offerButtonRef:eO,setIsPopoverOpenToggle:ev}),i===V.U4&&(0,l.jsx)(j.J,{isDismissible:!0,isOpen:T,onDismiss:ec,onOpen:eb,renderInline:!0,role:"tooltip",target:eO,variant:"primary",children:(0,l.jsx)(er,{ref:eg,tabIndex:-1,children:V.YJ})}),ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"h-sr-only",role:"alert",children:U}),(0,l.jsx)(R.H,{"aria-label":Z===V.mF?`Remove offer: ${f}`:`Save offer: ${f}`,className:"h-padding-a-tiny",onClick:ep,ref:eO,renderIcon:(0,l.jsx)(et,{isOfferAdded:Z===V.mF,size:36}),type:"button"})]}):(0,l.jsx)(em,eo(eo({"aria-label":Z===V.mF?`Remove offer: ${f}`:`Save offer: ${f}`,"data-test":"save-circle-offer-button",isConfirmed:Z===V.mF,isFullWidth:!0,isPending:Z===V.rR,onClick:ep,ref:eO,size:null!=e?e:S?"sm":"lg"},t?{confirmedText:t}:{}),r?{initialText:r}:{}))]}):null};el.displayName="SaveCircleOfferButton"}}]);