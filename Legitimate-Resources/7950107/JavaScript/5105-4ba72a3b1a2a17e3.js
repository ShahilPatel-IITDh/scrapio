"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5105],{5763:function(e,t,r){r.d(t,{D:function(){return s}});var n=r(59499),o=r(85893),i=r(67294),l=r(47281);function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let s=(0,i.memo)(e=>(0,o.jsx)(l.J,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach(function(t){(0,n.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"Checkmark",_src:"assets/glyph/Checkmark.svg",_viewBox:"0 0 24 24"},e)))},65105:function(e,t,r){r.d(t,{x:function(){return o},Q:function(){return es}});var n,o,i=r(59499),l=r(85893),a=r(67294),s=r(96333),c=r(17619),f=r(19521),u=r(56947),p=r.n(u),d=r(20041),O=r(47052),v=r(4730),m=r(5763),y=r(47281);function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}let b=(0,a.memo)(e=>(0,l.jsx)(y.J,function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({_name:"QuantityAdd",_src:"assets/glyph/QuantityAdd.svg",_viewBox:"0 0 24 24"},e)));var h=r(50667);let _=["className","data-test","hasWarning","isConfirmed","isFullWidth","isPending","onClick","size"];function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function w(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let j=(0,a.forwardRef)((e,t)=>{let{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,size:f}=e,u=(0,v.Z)(e,_),d=Number.parseInt("sm"===f?p().font.size.text.medium:p().font.size.text.base,10);return(0,l.jsx)(h.i,w(w({confirmedText:"Offer saved",initialText:"Save offer",warningText:"Offer not saved. Try again"},u),{},{className:r,"data-test":n,hasWarning:o,isConfirmed:i,isFullWidth:a,isPending:s,onClick:c,ref:t,renderLeadingConfirmed:(0,l.jsx)(m.D,{color:p().colors.palette.green.light,width:d}),renderLeadingInitial:(0,l.jsx)(b,{color:p().colors.palette.white,width:d}),size:f}))});j.displayName="ButtonOffer";let R=(0,f.ZP)(j).withConfig({displayName:"ButtonOfferSecondary",componentId:"sc-272k6x-0"})(["button{","}"],({isConfirmed:e})=>e?`
      ${O.QJ}

      &:hover {
        ${O.Ky}
      }

      &:active {
        ${O.BH}
      }
      svg stop {
        stop-color: ${u.colors.palette.green.light};
      }
  `:`
      font-weight: normal;
      ${d._f}

      &:hover {
        ${d.ID}
      }

      &:active {
        ${d.h5}
        svg stop {
          stop-color: ${u.colors.palette.white};
        }
      }
      svg {
        color: inherit;
      }
      svg stop {
        stop-color: ${u.colors.palette.gray.medium};
      }
    `);R.displayName="ButtonOfferSecondary";var F=r(55139),P=r(77110),D=r(44281),k=r(35216),I=r(44350),S=r(23451);let A=async e=>{let{apis:{loyaltyGuestOfferLists:t},baseUrl:r,circleOfferLoyaltyKeys:n}=(0,I.config)().services.apiPlatform,o=`${r}/${t.endpointPaths.postOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,S.v_)(o,{headers:{Authorization:n.loyaltyClientKey,"x-api-key":n.loyaltyApiKey},parameters:{location_id:null==e?void 0:e.storeId},errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:x}=(0,k.F)({name:"@web/domain-circle-offers/post-offer-v1",mutationFn:e=>A(e)}),C=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],N=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,I.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.postOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,S.v_)(n,{errorTag:"circle_post_offer_error",timerTag:"circle_post_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:$}=(0,k.F)({name:"@web/domain-circle-offers/post-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,C),o=(0,I.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?A(n):N(n)}}),T=async e=>{let{apis:{loyaltyGuestOfferLists:t},circleOfferLoyaltyKeys:r,baseUrl:n}=(0,I.config)().services.apiPlatform,o=`${n}/${t.endpointPaths.deleteOfferV1}/${null==e?void 0:e.offerId}`,{data:i,ok:l,statusText:a}=await (0,S.IV)(o,{headers:{Authorization:r.loyaltyClientKey,"x-api-key":r.loyaltyApiKey},errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(l)return i;throw Error(`${a}`)},{useMutation:L}=(0,k.F)({name:"@web/domain-circle-offers/delete-offer-v1",mutationFn:e=>T(e)}),M=["LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED"],V=async e=>{let{apis:{offersV16:t},baseUrl:r}=(0,I.config)().services.circle,n=new URL(`${r}/${t.endpointPaths.deleteOfferV16}/${null==e?void 0:e.offerId}`).toString(),{data:o,ok:i,statusText:l}=await (0,S.IV)(n,{errorTag:"circle_delete_offer_error",timerTag:"circle_delete_offer_call",credentials:"include"});if(i)return o;throw Error(`${l}`)},{useMutation:B}=(0,k.F)({name:"@web/domain-circle-offers/delete-offer-v16",mutationFn:e=>{let t=null!=e?e:{},{LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:r=!1}=t,n=(0,v.Z)(t,M),o=(0,I.flags)("LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED")||r;return o?T(n):V(n)}});var z=r(26797),Z=r(32657),K=r(6153),Y=r(43430);function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let W=(e,t)=>{var r,n,o;let i=null!==(r=null==e?void 0:null===(n=e.components)||void 0===n?void 0:n[0])&&void 0!==r?r:{};return{name:null!==(o=null==i?void 0:i.title)&&void 0!==o?o:null==i?void 0:i.id,position:String(t),component:null!=i&&i.title?`${null==i?void 0:i.id} || ${null==i?void 0:i.title}`:null==i?void 0:i.id,componentType:null==i?void 0:i.type_name,contentType:null==i?void 0:i.content_type}},H=(e,t,r)=>{let{trackEvent:n}=(0,Y.rS)(),i=(0,K.Kk)(),l=(0,Z.ew)(i),a=null==e?void 0:e.strategyId,s=W(t,r);return t=>{let r,c;let{offerId:f,action:u,offerAriaLabel:p}=null!=t?t:{};f&&(u===o.ADDED_OFFER?r=!0:u===o.ADD_OFFER_ERROR&&(r=!1),u===o.REMOVED_OFFER?c=!0:u===o.REMOVE_OFFER_ERROR&&(c=!1),n({appState:{url:i,cmsPageId:l},guest:{eventType:"click"},offerInfo:G(G(G({},r?{addOffer:r}:{}),c?{removeOffer:c}:{}),{},{offers:[{offerId:f,offerSelected:void 0!==r||void 0!==c,offerType:"cartwheel"}]}),promotionInfo:{promos:[{id:f,omtOfferId:f,added:r,removed:c,longTagSpecialOffer:p}]}}),a&&(0,Y.OK)({recClick:{type:"promo",offerId:f,position:null==e?void 0:e.position,strategyId:null==e?void 0:e.strategyId,strategyName:null==e?void 0:e.strategyName},contentClick:s}))}};var Q=r(86235);let U=()=>{let{openJoinCircleModal:e,closeJoinCircleModal:t,isCircleEnrolled:r,isGuestLoggedIn:n}=(0,a.useContext)(Q.j);return{closeJoinCircleModal:t,openJoinCircleModal:e,isCircleEnrolled:r,isGuestLoggedIn:n}};var q=r(78503),X=r(36679),ee=r(13347);let et=({isPopoverOpen:e,offerButtonRef:t,setIsPopoverOpenToggle:r,isErrorState:n,errorMessage:o=z._r,isIconOnly:i})=>{let s=(0,a.useRef)(null),c=(0,a.useCallback)(()=>{var e;null===(e=s.current)||void 0===e||e.focus()},[]),f=(0,a.useCallback)(e=>{null==e||e.preventDefault(),(0,ee.zB)(window.location.href)},[]);return(0,l.jsx)(F.J,{isOpen:e,onOpen:c,renderInline:!0,role:n?"alert":"tooltip",tailPosition:i?"end":void 0,target:t,toggle:r,variant:n?"warning":"primary",zIndex:1100,children:n?(0,l.jsx)("span",{"data-test":"save-offer-popover-error",ref:s,tabIndex:-1,children:o}):(0,l.jsx)(X.F,{className:"h-margin-a-tiny",color:"onDark","data-test":"save-offer-popover-sign-in-link",onClick:f,ref:s,underline:"always",children:z.IY})})};et.displayName="SaveCircleOfferPopover";let er=f.ZP.svg.withConfig({displayName:"AnimatedIcon__AnimatedSvg",componentId:"sc-x6qm3h-0"})([".plus{clip-path:",";transition:clip-path 300ms;transition-delay:100ms;",";}.checkmark{clip-path:inset(0 100% 0 0);transition:clip-path 100ms;transition-delay:0;","}@media (prefers-reduced-motion){.plus,.checkmark{transition:none;transition-delay:0;}}"],"polygon(0% 0%, 0% 100%, 50% 100%, 50% 50%, 50% 50%, 50% 50%, 50% 50%, 50% 100%, 100% 100%, 100% 0%)",e=>e.isOfferAdded?`
    clip-path: polygon(0% 0%, 0% 100%, 0 100%, 0 0, 100% 0, 100% 100%, 0 100%, 0 100%, 100% 100%, 100% 0%);
    transition: clip-path 100ms;
    transition-delay: 0;
    `:"",e=>e.isOfferAdded?`
    clip-path: inset(0);
    transition: clip-path 300ms;
    transition-delay: 100ms;
    `:""),en=({isOfferAdded:e=!1,size:t=24})=>(0,l.jsxs)(er,{focusable:"false",height:t,isOfferAdded:e,role:"presentation",viewBox:"0 0 24 24",width:t,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",children:[(0,l.jsx)("path",{className:"plus",d:"M12.75 3.25v8h8v1.5h-8v8h-1.5v-8h-8v-1.5h8v-8z",fill:u.colors.palette.red.default}),(0,l.jsx)("path",{className:"checkmark",d:"M8.923 16.443l-4.395-4.364-1.056 1.064 5.451 5.414L20.528 7.032l-1.056-1.064z",fill:u.colors.palette.green.light})]});en.displayName="AnimatedIcon";let eo=f.ZP.a.withConfig({displayName:"styles__PreLineLink",componentId:"sc-122dvwh-0"})(["white-space:pre-line;"]);function ei(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function el(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ei(Object(r),!0).forEach(function(t){(0,i.Z)(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}(n=o||(o={})).ADDED_OFFER="ADDED_OFFER",n.ADD_OFFER_ERROR="ADD_OFFER_ERROR",n.REMOVED_OFFER="REMOVED_OFFER",n.REMOVE_OFFER_ERROR="REMOVE_OFFER_ERROR";let ea=e=>e===z.a0?z.rL:e===z.mF?z.b0:void 0,es=({buttonSize:e,confirmedText:t,initialText:r,isOfferAddedDefault:n,offerId:i,offerAriaLabel:f,onAddOffer:u,onRemoveOffer:p,variation:d,trackingDetails:O,shouldTrack:v=!0,metadata:m,order:y})=>{var g;let[b,h]=(0,q.H)(),{openJoinCircleModal:_,isGuestLoggedIn:E,isCircleEnrolled:w}=U(),k=(0,D.l)(),{pricingStoreId:I}=(0,s.K)(),{screenSmMax:S}=(0,c.l)(),{0:A,1:x}=(0,a.useState)(void 0),{0:C,1:N}=(0,a.useState)(!1),{0:T,1:L}=(0,a.useState)(!1),M=H(O,m,y),V=n?z.mF:z.KL,{0:Z,1:K}=(0,a.useState)(V),{0:Y,1:J}=(0,a.useState)(!1),G=i?null==b?void 0:null===(g=b[i])||void 0===g?void 0:g.added:void 0,{0:W,1:Q}=(0,a.useState)("");(0,a.useEffect)(()=>{if(!0===G){if(Z===z.mF)return;return K(z.mF)}if(!1===G){if(Z===z.a0)return;return K(z.a0)}K(V)},[G,V,Z,i]);let X=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==u||u(t),v&&M(t)},[i,f,u,v,M]),ee=(0,a.useCallback)(e=>{let t={action:e,offerId:i,offerAriaLabel:f};null==p||p(t),v&&M(t)},[i,f,p,v,M]),er=(0,a.useCallback)(e=>{if((null==e?void 0:e.status)===409){var t,r,n;x(null==e?void 0:null===(t=e.response)||void 0===t?void 0:null===(r=t.data)||void 0===r?void 0:null===(n=r.errors)||void 0===n?void 0:n.NOT_ENOUGH_SLOTS)}J(!0),X(o.ADD_OFFER_ERROR),K(z.a0)},[X]),ei=(0,a.useCallback)(()=>{Y&&J(!1),X(o.ADDED_OFFER),K(z.mF),Q("Offer saved"),h&&h({type:z.NE.ADD_OFFER,value:{offerId:i}})},[X,Y,i,h]),[es]=$({onError:er,onSuccess:ei}),ec=(0,a.useCallback)(()=>{var e;L(!1),null===(e=eO.current)||void 0===e||e.focus()},[]),ef=(0,a.useCallback)(()=>{Y&&J(!1),ee(o.REMOVED_OFFER),K(z.a0),Q("Offer removed"),h&&h({type:z.NE.REMOVE_OFFER,value:{offerId:i}})},[ee,Y,i,h]),eu=(0,a.useCallback)(()=>{J(!0),ee(o.REMOVE_OFFER_ERROR),K(z.mF)},[ee]),[ep]=B({onError:eu,onSuccess:ef});(0,a.useEffect)(()=>{Y&&N(e=>!e||e)},[Y]);let ed=(0,a.useCallback)(async()=>{if(!Y){if(!E)return N(!0);if(E&&!w)return _();switch(K(z.rR),Z){case z.KL:case z.a0:if(i)return L(!0),es({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:k,storeId:I});break;case z.mF:if(i)return ep({offerId:i,LOYALTY_PROFILE_SAVED_OFFERS_API_MIGRATION_ENABLED:k})}}},[es,Y,ep,w,E,i,Z,_,N,I,k]),eO=(0,a.useRef)(null),ev=(0,a.useCallback)(()=>{N(e=>(e&&(x(void 0),J(!1)),!e))},[]),em="secondary"===d?R:j,ey="iconOnly"===d,eg=(0,a.useRef)(null),eb=(0,a.useCallback)(()=>{var e;null===(e=eg.current)||void 0===e||e.focus()},[]);return i?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(et,{errorMessage:null!=A?A:ea(Z),isErrorState:Y,isIconOnly:ey,isPopoverOpen:C,offerButtonRef:eO,setIsPopoverOpenToggle:ev}),i===z.U4&&(0,l.jsx)(F.J,{isDismissible:!0,isOpen:T,onDismiss:ec,onOpen:eb,renderInline:!0,role:"tooltip",target:eO,variant:"primary",children:(0,l.jsx)(eo,{ref:eg,tabIndex:-1,children:z.YJ})}),ey?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"h-sr-only",role:"alert",children:W}),(0,l.jsx)(P.H,{"aria-label":Z===z.mF?`Remove offer: ${f}`:`Save offer: ${f}`,className:"h-padding-a-tiny",onClick:ed,ref:eO,renderIcon:(0,l.jsx)(en,{isOfferAdded:Z===z.mF,size:36}),type:"button"})]}):(0,l.jsx)(em,el(el({"aria-label":Z===z.mF?`Remove offer: ${f}`:`Save offer: ${f}`,"data-test":"save-circle-offer-button",isConfirmed:Z===z.mF,isFullWidth:!0,isPending:Z===z.rR,onClick:ed,ref:eO,size:null!=e?e:S?"sm":"lg"},t?{confirmedText:t}:{}),r?{initialText:r}:{}))]}):null};es.displayName="SaveCircleOfferButton"}}]);