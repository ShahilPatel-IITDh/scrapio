$(function(){var currentStep=0;var $formStep=$('.js-form-step');var $formStepControls=$('.js-form-steps_control');var totalFormSteps=$formStep.length;var $btnNextStep=$('.js-btn-next');var $registerForm=$('#register');var firstStepData={'email':'StepByStepRegistrationForm[email]','password':'StepByStepRegistrationForm[password]','terms':'StepByStepRegistrationForm[terms]','privacy':'StepByStepRegistrationForm[privacy]','userToken':'StepByStepRegistrationForm[userToken]',};var secondStepData={'gender':'StepByStepRegistrationForm[gender]','age':'StepByStepRegistrationForm[age]','city':'StepByStepRegistrationForm[city]','terms':'StepByStepRegistrationForm[terms]','privacy':'StepByStepRegistrationForm[privacy]','userToken':'StepByStepRegistrationForm[userToken]',};$loginSignUpButton.on('click',function(){$('div.field_error').html('');$('form').trigger("reset");resetSteps()});function resetSteps(){$('.form-step').removeClass('is-active');currentStep=0;$('.form-step__1').addClass('is-active')}
var registerStepData={'regFormStep-0':firstStepData,'regFormStep-1':secondStepData,};var loginStepData={'loginForm':loginFormData,};function makeStepName(currentStep){return'regFormStep-'+currentStep}
function changeSteps(){if(currentStep<totalFormSteps-1){checkStepData(currentStep,registerStepData[makeStepName(currentStep)])}}
$registerForm.submit(function(event){if(!1===formSubmitAllowed){event.preventDefault()}else{return!0}
checkStepData(currentStep,registerStepData[makeStepName(currentStep)])});$loginForm.submit(function(event){if(!1===formSubmitAllowed){event.preventDefault()}else{return!0}
checkStepData('loginForm',loginStepData.loginForm)});$btnNextStep.on('click',changeSteps);$formStepControls.on('click',changeSteps);function nextStep(){currentStep++;if(currentStep===totalFormSteps){formSubmitAllowed=!0;$registerForm.submit()}
$formStep.removeClass('is-active').eq(currentStep).addClass('is-active');$formStepControls.removeClass('is-active').eq(currentStep).addClass('is-active')}
function clearPreviousStepErrors(){$('.'+getErrorClassName()).removeClass(getErrorClassName())}
function checkStepData(step,stepData){var data=fillStepData(stepData,step);var formType=data.formType||'';$.ajax({type:'post',data,dataType:'json',success:function(data){if(data.isSuccess===!0){if(step!=='loginForm'){nextStep();clearPreviousStepErrors()}else{formSubmitAllowed=!0;$loginForm.submit()}}else{var arrayLength=data.length;for(var i=0;i<arrayLength;i++){showErrors(data[i],formType)}}}})}});var $loginForm=$('#login');var $loginSignUpButton=$('.js-login-widget_btn');var loginFormData={'email':'LoginForm[email]','password':'LoginForm[password]','userToken':'LoginForm[userToken]',};$('[data-js-field-name="email"]').on('input',function(e){$(this).val(e.target.value.trimRight())});var formSubmitAllowed=!1;function showErrors(data,formType){var selector=$('.js-field__'+data.field+'');if(formType!==''){selector=$('[data-js-form="'+formType+'"] .js-field__'+data.field+'')}
if(data.success&&data.errors.length){selector.addClass(getErrorClassName());selector.find('div.field_error').html(data.errors)}else{selector.removeClass(getErrorClassName());selector.find('div.field_error').html('')}}
function getErrorClassName(){return'is-error'}
function onChangeValidate(event){var $target=$(event.target);var targetForm=$target.closest('form').data('js-form');var field=$target.data('js-field-name');var value=$target.val();validateField({oneFieldValidation:!0,formType:targetForm,field:field,value:value})}
function validateField(data){var formType=data.formType||'';$.ajax({data:data,method:'POST',dataType:'json',context:this,success:function(data){showErrors(data,formType)},})}
$('.js-authorization_form').change(onChangeValidate);function fillStepData(stepData,step=0){var key;var data={};var nameSelector='';var $fullSelector='';for(key in stepData){nameSelector=stepData[key];$fullSelector=$("[name='"+nameSelector+"']");if($fullSelector.prop("type")&&$fullSelector.prop("type")==='checkbox'){data[key]=$fullSelector.is(":checked")?1:0}else{data[key]=$fullSelector.val()}}
data.step=step;data.formType=$fullSelector.closest('form').data('js-form');return data}