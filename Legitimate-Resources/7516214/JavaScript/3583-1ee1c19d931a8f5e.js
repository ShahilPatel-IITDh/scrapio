(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3583],{83583:function(e,t,n){"use strict";n.d(t,{lj:function(){return z},Pz:function(){return Z}});var a=n(59499),i=(n(56859),n(67294)),o=n(56292),s=(n(2870),n(85893));var r=n(35741),c=n.n(r),l=n(30690),p=n.n(l),d=n(23240),u=n(40594),y=n(28665),m=n.n(y),h=n(55545),g=n.n(h),f=n(65954),b=n.n(f),S=n(80155),P=n(85290);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const O=n(35105),k=m()("reporting:ClientSplunkHandler"),w=b().getInstance();let E;class A extends(g()){constructor(e){const{config:{cpVersion:t,portal:n,ssrtid:a,dockerTag:i},auth:o,insight:{offeringId:s,token:r,domainId:c,merchantId:l},sale:{type:p,subType:d,subscriptionPaymentsSetting:u},companyInfo:y={}}=e.getState();super({reportOrigin:"client",cpVersion:t});const{entityId:m,realmId:h,ticket:g,isUserSignedIn:f,syncToken:b,isSalesCheckoutInvoice:v,authToken:I}=o;this.NAME="SplunkClient",this.store=e,this.cpVersion=t,this.portal=n,this.endpoint=`/${n}/rest/reporting`,this.imageName=i,this.transactionType=`${p}`,this.offeringId=s||"",this.merchantId=l,this.locale=P.L.localeSelector(y),d&&(this.subType=d),u&&(this.subscriptionPaymentsSetting=u),this.token=r,this.ssrtid=a,this.headers={"Content-Type":"application/json","Intuit-DomainId":c,"Intuit-IntuitId":m,"Intuit-RealmId":h,"Intuit-ACSToken":r,sessionTicket:g,"user-signed-in":"boolean"===typeof f?f.toString():"false",syncToken:b,"ssr-session-id":a},v&&(this.headers.Authorization=`Bearer ${I}`),this.endpoint=`/${n}/rest/reporting/batch`,this.logBatcher=new O({invokedCallback:e=>{w({url:this.endpoint,method:"POST",headers:this.headers,endpoint:this.endpoint,ssrtid:this.ssrtid,token:this.token,ignoreErrorInterceptor:!0,ignoreProfilingInterceptor:!0,event:"splunkReporting",data:{messages:e}}).then((e=>{const{data:{auth:t}}=e;t&&this.store.dispatch(S.YV.refreshAuthenticationSuccessful({auth:t}))}))}}),E=e=>this.logBatcher.push(e),k(`Name: ${this.NAME}`),k(`Endpoint: ${this.endpoint}`),k(`token: ${this.token}`),k(`ssrtid: ${this.ssrtid}`),this.report=this.report.bind(this)}enrich(e,t){let n=Object.assign({},t,{ssrtid:this.ssrtid,token:this.token,transactionType:this.transactionType,merchantId:this.merchantId,locale:this.locale});return super.enrich(e,n,!1)}report(e,t){if(localStorage&&"1"===localStorage.getItem("log")){const n=this.enrich(e,t);console.info(n)}k(`ssrtid=${this.ssrtid}, token=${this.token}, transactionType=${this.transactionType}`),E({data:this.enrich(e,t),opts:I({userLogLevel:t.logLevel},t)})}}var x=A,C=n(86813),M=n(20023),T=n(37004),D=n(43621),j=n(54080),_=n(91278),N=n(33359),L=n(74268),R=n(93031);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const $=u.SplunkReporter.getInstance(),F=c().getInstance(),W=()=>!0===window.isServer;function U(e){return W()?(0,L.initializeStore)(e):(window.__NEXT_REDUX_STORE__||(window.__NEXT_REDUX_STORE__=(0,L.initializeStore)(e)),window.__NEXT_REDUX_STORE__)}const Z=e=>{var t;return t=class extends i.Component{constructor(e){var t;super(e),t=this,(0,a.Z)(this,"getIUS_SESSIONCookie",(()=>document&&document.cookie.slice(document.cookie.indexOf("ius_session"),document.cookie.indexOf(";",document.cookie.indexOf("ius_session"))))),(0,a.Z)(this,"runAfterRSSReady",(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3;if(!W()){let a=(0,T.mark)("runAfterRSSReady");$.contextual({logInfo:{logLevel:"info",logger:"apps/CPApp"},event:"risk",action:"threatMatrixProfiling",activityInfo:{status:"inProgress",resource:"treatMatrix",value:t.getIUS_SESSIONCookie()}}),window.addEventListener("message",(i=>{"xdrIframeLoaded"===i.data&&($.contextual({logInfo:{logLevel:"info",logger:"apps/CPApp"},event:"risk",action:"threatMatrixProfiling",activityInfo:{status:"success",activityObject:"treatMatrix",value:t.getIUS_SESSIONCookie()}}),setTimeout(e,n),a.finish())}))}})),(0,a.Z)(this,"startRiskAction",(async e=>{let{dispatch:t,featureFlags:n}=e;n&&n["use-riskjs"]?t((0,D.ZV)()):this.runAfterRSSReady((()=>{t((0,D.Sz)())}),n&&n["bfs-assessment-timeout"]||2e3)})),(0,a.Z)(this,"startInitializationActions",(async e=>{let{dispatch:t,pageName:n,error:a,featureFlags:i,companyLocale:o,onDocumentStateCompleteHandler:s}=e;s({companyLocale:o,pageName:n,usedCache:i["ssr-payload-cache"]}),(0,T.loadGdpr)(this.reduxStore.getState()),(0,T.mark)("startRiskAction"),this.startRiskAction({dispatch:t,featureFlags:i}),t((0,D.Uw)()),t((0,D.bN)()),t((0,D.qZ)()),t((0,j.ve)()),t((0,N.$x)()),await t((0,j.nq)()),await t((0,j.$t)()),i["import-invoices"]&&t((0,D.eL)()),t((0,_.Q$)());const{config:r,auth:c,companyInfo:l,insight:p,sale:u,ixp:y}=this.reduxStore.getState();d.Z.init(V(V(V(V(V(V({},r),c),l),p),u),{},{ixp:y})),await d.Z.initTaxonomyV2(this.reduxStore.getState()),t((0,D.Hy)({pageName:n,error:a}))})),this.reduxStore=U(e.initialReduxState),W()||(p().addNamespace(new x(this.reduxStore)),(0,T.initLogger)(e.initialReduxState),this.setBioCatchContext(),this.initializeFlowReporterAgent(e))}initializeFlowReporterAgent(e){try{const{initialReduxState:{config:t,auth:n,insight:a,sale:i,companyInfo:o,pageName:s}}=e;F.init(V(V(V(V(V(V({},t),n),a),i),o),{},{pageName:s}))}catch(t){return}}setBioCatchContext(){const{pageName:e}=this.props;!W()&&e&&(window.cdApi?(window.cdApi.changeContext(e),window.cdApi.currentContext=e):setTimeout((()=>{this.setBioCatchContext()}),1e3))}static async getInitialProps(t){if(t.initialState={},W()){const{ctx:{req:e}}=t,{headers:n,model:a,paypalPayment:i,transactionType:s,sale:r,companyInfo:c,featureFlags:l,isSubscription:p,isPreview:d=!1}=e,u=e=>{const t=e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'");return t===e?t:u(t)},y=e.cookies?e.cookies.ivid:null;if(r&&c&&(t.initialState.sale=r,t.initialState.companyInfo=c),a){const{summary:{companyName:c,invoiceNumber:m,dueDate:h,invoiceAmount:g,currency:f,isFullyPaid:b,isPartiallyPaid:S,allowOverPay:P,paymentDueStatus:v,productName:I,payPalProcessor:O,isPayPalCommerceInvoice:k,nonPayEnableExpClicked:w},profileResponse:{contextData:E},paymentAccountsResponse:{merchantId:A,depositDisabled:x,offerId:D,paymentProcessor:j,walletServiceEnabled:_,paypalMerchantId:N,debitCardEnabled:L},authenticateResponse:{countryCode:R,regionIsoCode:B,ticket:$,realmId:F,recipientEmail:U,isUserSignedIn:Z,isEntityPromoted:z,authToken:G,authLevel:q,entityId:J,syncToken:X,username:H},enabledCCTypes:Q,token:K,isSalesCheckoutInvoice:Y,isQBDTInvoiceRollBack:ee,view2pay:te,openInvoices:ne,ixp:ae}=a;let{balanceAmount:ie,companyEmail:oe,companyPhone:se,companyWebAddr:re,companyAddress:ce,companyLogoUrl:le,companyLogoType:pe,companyLogoLength:de,domainId:ue,companyId:ye,companyLocale:me,lineItems:he,txnDate:ge,subscriptionStatus:fe,appSourceOffering:be,invoiceId:Se,customerJobId:Pe,customerJobName:ve,customerName:Ie,freightAmount:Oe,discountAmount:ke,shippingAmount:we,taxAmount:Ee,dutyAmount:Ae,partialPaymentEnabled:xe,customerJobReferenceNumber:Ce,paymentDetailsMessage:Me=null,description:Te}=E;ke||(ke=0),we&&(Oe=we),Oe||(Oe=0),Ae||(Ae=0),Ee||(Ee=0);const De=e.discovery&&e.discovery.externalPaymentMethods&&e.discovery.externalPaymentMethods.paypalCommerce;let je;t.initialState.invoice={isPayable:e.isPayable,isPayEnabled:e.isPayEnabled,companyName:u(c),view2pay:te,companyEmail:oe,companyPhone:se,companyWebAddr:re,companyAddress:ce,domainId:ue,companyId:ye,companyLocale:me,companyLogoUrl:le,companyLogoType:pe,companyLogoLength:de,lineItems:he,txnDate:ge,merchantId:A,paypalMerchantId:N,customerName:Ie,invoiceNumber:m,invoiceDueDate:h,paymentDueStatus:v,invoiceAmount:g,balanceAmount:ie,convenienceFee:null,isFullyPaid:b,isPartiallyPaid:S,depositDisabled:x,offerId:D,paymentProcessor:j,walletServiceEnabled:_,debitCardEnabled:L,subscriptionStatus:fe,appSourceOffering:be,invoiceId:Se,customerJobId:Pe,customerJobName:ve,freightAmount:Oe,discountAmount:ke,taxAmount:Ee,customerJobReferenceNumber:Ce,dutyAmount:Ae,transactionType:s,description:Te,currency:f,token:K,ivid:y,productName:I,openInvoices:[],bfsAssessmentToken:null,razorpayPublicToken:null,paymentDetailsMessage:Me},t.initialState.insight={offeringId:e.discovery&&e.discovery.offeringId,payorSegmentation:e.discovery&&e.discovery.payorSegmentation,merchantId:A,isPartiallyPaid:S,isFullyPaid:b,domainId:ue,appSourceOffering:be,token:K,offerId:D,view2pay:te,paymentProcessor:j,debitCardEnabled:L,companyId:ye,bfsAssessmentToken:null,isPayable:e.isPayable,isPayEnabled:e.isPayEnabled,shouldShowSchedulePay:!1,shouldShowAutopay:!1,canCancelSchedule:!1,paymentDueStatus:v,depositDisabled:x,nonPayEnableExpClicked:w,isAmexDisabled:De&&"false"===De.amexEnabled,isPreview:d},t.initialState.auth={countryCode:R,regionIsoCode:B,ticket:$,authLevel:q,realmId:F,recipientEmail:U,isUserSignedIn:Z,isSalesCheckoutInvoice:Y,isQBDTInvoiceRollBack:ee,authToken:G,isEntityPromoted:z,entityId:J,syncToken:X,username:H,userAgent:n&&n["user-agent"]||""},t.initialState.ixp=ae,t.initialState.companyInfo&&(t.initialState.companyInfo.paypalMerchantId=N),W()&&e.headers&&e.headers["user-agent"]?je=e.headers["user-agent"].toLowerCase():W()||(je=navigator.userAgent.toLowerCase()),e.enabledPaymentMethods=(0,T.testForConsolidateCards)({paymentMethods:e.enabledPaymentMethods,featureFlags:l,ixp:ae});const _e=(0,T.getEnabledPaymentMethod)(e.enabledPaymentMethods);if(e.isPayable&&e.enabledPaymentMethods){const{enabledPaymentMethods:n}=e;let a=(0,T.getInitialSelectedPaymentMethod)({enabledPaymentMethods:n,enabledPaymentOptions:_e,userAgent:je,isUserSignedIn:Z,featureFlags:l,isPartiallyPaid:S,userWallets:[],saleType:r&&r.type,ixp:ae,url:`${e.protocol}://${e.host}${e.url}`});t.initialState.insight.canBeFullyPaid=M.PaymentAmountValidator.getCanBeFullyPaid(ie,e.enabledPaymentMethods);const c=M.PaymentAmountValidator.getMaxPaymentAmount(ie,a,P);let d;if(i&&"error"===i.paymentStatus){const{paymentStatus:e,paymentError:t,paymentMethodType:n}=i;d={paymentStatus:e,paymentError:t,paymentMethodType:n}}else d={paymentStatus:null,paymentError:null,paymentMethodType:a};let u=ie;u="en_IN"===me?ie:Math.min(ie,c);const y={amount:u,balanceAmount:ie,paymentMethod:a,allowOverPay:P,transactionType:s,gratuityValue:0};t.initialState.payment=V({balanceAmount:ie,inputAmount:u,defaultInputAmount:u,convenienceFeeValue:0,gratuityValue:0,amount:u,isAmountValid:M.PaymentAmountValidator.validate(y),allowOverPay:P,partialPaymentEnabled:xe,requestIdInProgress:null,paymentSessionCounter:0,isPaymentSessionDirty:!1,successfulPaymentCounter:0,payPalProcessor:O,lastSuccessfulPaymentResponse:null,paidInvoices:null,isPayPalCommerceInvoice:k,isSavePaymentMethodChecked:!p&&Z,country:e.discovery&&e.discovery.countryData},d),r&&(0,o.isOneToManyPaymentRequest)(r.type,r.subType)&&(t.initialState.payment=V(V({},t.initialState.payment),{},{isContactDetailsNameValid:!0,isContactDetailsEmailValid:!0})),ne&&(t.initialState.invoice=V(V({},t.initialState.invoice),{},{openInvoices:ne.compatibleOpenInvoices.map((e=>({invoiceNumber:e.invoiceNumber,dueDate:e.dueDate,id:e.id,totalAmt:e.totalAmt,balance:e.balance,selected:!0})))}),t.initialState.payment=V(V({},t.initialState.payment),{},{amount:c})),t.initialState.wallet={fetchWalletStatus:null,createWalletStatus:null,updateWalletStatus:null,deleteWalletStatus:null,userWallets:null,selectedWalletId:null,currentlyUpdatingWalletId:null,currentlyDeletingWalletId:null,walletError:null,selectedCardCvv:"",enabledPaymentMethods:e.enabledPaymentMethods,enabledCCTypes:Q,isDetectingPayPalStatus:k||e.enabledPaymentMethods.indexOf("paypal_ppaam")>-1||e.enabledPaymentMethods.indexOf("venmo")>-1,isDetectingApplePayStatus:e.enabledPaymentMethods.indexOf("cc")>-1&&(0,C.isAppleProduct)(je)&&(0,C.isSafari)(je)};const m=De&&"false"===De.paypalWalletEnabled;e.enabledPaymentMethods&&e.enabledPaymentMethods.includes("paypal")&&m&&(t.initialState.wallet.enabledPaymentMethods=e.enabledPaymentMethods.filter((e=>"paypal"!==e))),t.initialState.wallet.enabledPaymentMethods=(0,o.enabledPaymentMethodsForCABankPayments)(e.enabledPaymentMethods,e.config,!0,S,r&&r.amount)}}}let{pageMessages:n,pageProps:a}=await e.getInitialProps(t);return{pageProps:a,pageMessages:n,initialState:t.initialState}}componentDidMount(){if(!W())try{const{companyInfo:e,featureFlags:t=V({},t),error:n={},ixp:a}=this.reduxStore.getState(),i=P.L.localeSelector(e),{pageName:o="n/a"}=this.props,{dispatch:s}=this.reduxStore;this.startInitializationActions({dispatch:s,error:n,pageName:o,ixp:a,featureFlags:t,companyLocale:i,onDocumentStateCompleteHandler:R.K})}catch(e){$.contextual({logInfo:{logLevel:"error",logger:"apps/CPApp"},event:"view",action:"render",activityInfo:{status:"error"},error:{stack:e.stack,message:e.message,where:"componentDidMount"}})}}render(){const{pageProps:t={}}=this.props;return(0,s.jsx)(e,V({},t))}},(0,a.Z)(t,"PAGE_MESSAGES",e.PAGE_MESSAGES),t},z=e=>{var t;return t=class extends i.Component{constructor(e){super(e),this.reduxStore=U(e.initialReduxState),W()||(p().addNamespace(new x(this.reduxStore)),(0,T.initLogger)(e.initialReduxState))}static async getInitialProps(t){const n={};let a={};if(W()){const{ctx:{req:e}}=t;if(e){const{error:t,cookies:i}=e;if(t){const{token:o}=t;a=t;const s=i?i.ivid:null,r={isPayable:e.isPayable&&e.enabledPaymentMethods,token:o,ivid:s};n.invoice=r}}}let{pageMessages:i,pageProps:o}=await e.getInitialProps(t);return o.error=a,{pageProps:o,pageMessages:i,initialState:n}}componentDidMount(){try{const{dispatch:e}=this.reduxStore;e((0,D.Hy)({pageName:"error",error:this.props.error}))}catch(e){}}render(){const{pageProps:t={}}=this.props;return(0,s.jsx)(e,V({},t))}},(0,a.Z)(t,"PAGE_MESSAGES",e.PAGE_MESSAGES),t}},55545:function(e,t,n){var a=n(930);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class s{static _convertObjectToSplunkString(e){const t=e=>{if("object"!==typeof e||null===e)return e;try{JSON.stringify(e)}catch(n){throw new Error("Circular Dependency in report!")}return 0===Object.keys(e).length?"":Object.keys(e).map((n=>`${n}="${t(e[n])}"`)).join(", ")};if("object"!==typeof e||null===e||0===Object.keys(e).length)throw Error("_convertObjectToSplunkString can not be called directly. It should come from the Logger.");const{timestamp:n}=e;if(!n||"string"!==typeof n)throw Error("Logger should normalize the raw message with a key=timestamp and value=string");return delete e.timestamp,`timestamp=${n}, ${t(e)}`}constructor(e){let{reportOrigin:t,cpVersion:n}=e;this.reportOrigin=t,this.cpVersion=n}enrich(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=!1;"string"===typeof e?e={message:e}:a=!0===e.newSyntax;let i=o({},e);if(!a){const{timestamp:e}=i;(e||"string"===typeof e)&&(delete i.timestamp,i=o({timestamp:e},i)),i.hasOwnProperty("CPVersion")||(i.CPVersion=this.cpVersion),i.hasOwnProperty("EventSender")||(i.EventSender="ssr_server",i.EventOrigin=this.reportOrigin),!i.hasOwnProperty("LogType")&&t&&t.logType&&(i.LogType=t.logType);["ssrtid","token","transactionType","merchantId","locale"].forEach((e=>{!i.hasOwnProperty(e)&&t&&t[e]&&(i[e]=t[e])}))}return n?s._convertObjectToSplunkString(i):i}}e.exports=s},35105:function(e){e.exports=class{constructor(e){let{batchWindowLengthMillisecond:t=350,invokedCallback:n}=e;if("function"!==typeof n)throw new Error("invokedCallback must be passed to Batcher constructor");this.batchWindowLengthMillisecond=t,this.invokedCallback=n,this._setBatchDefaultValues(),this._closeBatch=this._closeBatch.bind(this)}push(e){this.isActiveBatch||this._activateBatch(),this.buffer.push(e)}_activateBatch(){this.isActiveBatch=!0,setTimeout(this._closeBatch,this.batchWindowLengthMillisecond)}_closeBatch(){this.invokedCallback(this.buffer),this._setBatchDefaultValues()}_setBatchDefaultValues(){this.buffer=[],this.isActiveBatch=!1}}}}]);
//# sourceMappingURL=3583-1ee1c19d931a8f5e.js.map