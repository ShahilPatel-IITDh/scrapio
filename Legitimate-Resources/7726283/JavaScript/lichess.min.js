(()=>{'use strict';var e={"class":"className",contenteditable:"contentEditable","for":"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};function g(a,b){try{return a(b)}catch(c){return b}}
var m=document,n=window,aa=m.documentElement,p=m.createElement.bind(m),r=Array.isArray,t=Array.prototype,ba=t.concat,u=t.filter,v=t.indexOf,w=t.map,ca=t.push,y=t.slice,A=t.some,da=t.splice,ea=/^#(?:[\w-]|\\.|[^\x00-\xa0])*$/,fa=/^\.(?:[\w-]|\\.|[^\x00-\xa0])*$/,ha=/<.+>/,ia=/^\w+$/;function B(a,b){return a&&(C(b)||D(b))?fa.test(a)?b.getElementsByClassName(a.slice(1)):ia.test(a)?b.getElementsByTagName(a):b.querySelectorAll(a):[]}
var E=function(){function a(a,c){if(a){if(a instanceof E)return a;var b=a;if(F(a)){if(b=(c instanceof E?c[0]:c)||m,b=ea.test(a)?b.getElementById(a.slice(1)):ha.test(a)?G(a):B(a,b),!b)return}else if(H(a))return this.ready(a);if(b.nodeType||b===n)b=[b];this.length=b.length;a=0;for(c=this.length;a<c;a++)this[a]=b[a]}}a.prototype.init=function(b,c){return new a(b,c)};return a}(),I=E.prototype,J=I.init;J.fn=J.prototype=I;I.length=0;I.splice=da;"function"===typeof Symbol&&(I[Symbol.iterator]=t[Symbol.iterator]);
I.map=function(a){return J(ba.apply([],w.call(this,function(b,c){return a.call(b,c,b)})))};I.slice=function(a,b){return J(y.call(this,a,b))};var ja=/-([a-z])/g;function K(a){return a.replace(ja,function(a,c){return c.toUpperCase()})}function L(a,b,c){if(c)for(c=a.length;c--&&!1!==b.call(a[c],c,a[c]););else{c=0;for(var d=a.length;c<d&&!1!==b.call(a[c],c,a[c]);c++);}return a}J.each=L;I.each=function(a){return L(this,a)};I.removeProp=function(a){return this.each(function(b,c){delete c[e[a]||a]})};
J.guid=1;function ka(a,b){var c=a&&(a.matches||a.webkitMatchesSelector||a.msMatchesSelector);return!!c&&!!b&&c.call(a,b)}function M(a){return!!a&&a===a.window}function C(a){return!!a&&9===a.nodeType}function D(a){return!!a&&1===a.nodeType}function H(a){return"function"===typeof a}function F(a){return"string"===typeof a}function la(a){return!isNaN(parseFloat(a))&&isFinite(a)}J.isWindow=M;J.isFunction=H;J.isNumeric=la;J.isArray=r;
I.prop=function(a,b){if(a){if(F(a))return a=e[a]||a,2>arguments.length?this[0]&&this[0][a]:this.each(function(c,h){h[a]=b});for(var c in a)this.prop(c,a[c]);return this}};I.get=function(a){if(void 0===a)return y.call(this);a=Number(a);return this[0>a?a+this.length:a]};I.eq=function(a){return J(this.get(a))};I.first=function(){return this.eq(0)};I.last=function(){return this.eq(-1)};
function N(a){return F(a)?function(b,c){return ka(c,a)}:H(a)?a:a instanceof E?function(b,c){return a.is(c)}:a?function(b,c){return c===a}:function(){return!1}}I.filter=function(a){var b=N(a);return J(u.call(this,function(a,d){return b.call(a,d,a)}))};function O(a,b){return b?a.filter(b):a}var ma=/\S+/g;function P(a){return F(a)?a.match(ma)||[]:[]}I.hasClass=function(a){return!!a&&A.call(this,function(b){return D(b)&&b.classList.contains(a)})};
I.removeAttr=function(a){var b=P(a);return this.each(function(a,d){D(d)&&L(b,function(a,b){d.removeAttribute(b)})})};I.attr=function(a,b){if(a){if(F(a)){if(2>arguments.length){if(!this[0]||!D(this[0]))return;var c=this[0].getAttribute(a);return null===c?void 0:c}return void 0===b?this:null===b?this.removeAttr(a):this.each(function(c,h){D(h)&&h.setAttribute(a,b)})}for(c in a)this.attr(c,a[c]);return this}};
I.toggleClass=function(a,b){var c=P(a),d=void 0!==b;return this.each(function(a,f){D(f)&&L(c,function(a,c){d?b?f.classList.add(c):f.classList.remove(c):f.classList.toggle(c)})})};I.addClass=function(a){return this.toggleClass(a,!0)};I.removeClass=function(a){return arguments.length?this.toggleClass(a,!1):this.attr("class","")};
function Q(a,b,c,d){for(var h=[],f=H(b),l=d&&N(d),x=0,k=a.length;x<k;x++)if(f){var q=b(a[x]);q.length&&ca.apply(h,q)}else for(q=a[x][b];!(null==q||d&&l(-1,q));)h.push(q),q=c?q[b]:null;return h}function R(a){return 1<a.length?u.call(a,function(a,c,d){return v.call(d,a)===c}):a}J.unique=R;I.add=function(a,b){return J(R(this.get().concat(J(a,b).get())))};function S(a,b,c){if(D(a)){var d=n.getComputedStyle(a,null);return c?d.getPropertyValue(b)||void 0:d[b]||a.style[b]}}
function T(a,b){return parseInt(S(a,b),10)||0}var na=/^--/,oa={opacity:!0,order:!0,zIndex:!0};function pa(a,b,c){void 0===c&&(c=na.test(a));return c||oa[a]||!la(b)?b:b+"px"}I.css=function(a,b){if(F(a)){var c=na.test(a);if(2>arguments.length)return this[0]&&S(this[0],a,c);if(!a)return this;b=pa(a,b,c);return this.each(function(d,f){D(f)&&(c?f.style.setProperty(a,b):f.style[a]=b)})}for(var d in a)this.css(d,a[d]);return this};var qa=/^\s+|\s+$/;
function ra(a,b){a=a.dataset[b]||a.dataset[K(b)];return qa.test(a)?a:g(JSON.parse,a)}I.data=function(a,b){if(!a){if(!this[0])return;var c={},d;for(d in this[0].dataset)c[d]=ra(this[0],d);return c}if(F(a))return 2>arguments.length?this[0]&&ra(this[0],a):void 0===b?this:this.each(function(c,d){c=b;c=F(c)?c:g(JSON.stringify,c);d.dataset[K(a)]=c});for(d in a)this.data(d,a[d]);return this};
function sa(a,b){var c=a.documentElement;return Math.max(a.body["scroll"+b],c["scroll"+b],a.body["offset"+b],c["offset"+b],c["client"+b])}function ta(a,b){return T(a,"border"+(b?"Left":"Top")+"Width")+T(a,"padding"+(b?"Left":"Top"))+T(a,"padding"+(b?"Right":"Bottom"))+T(a,"border"+(b?"Right":"Bottom")+"Width")}
L([!0,!1],function(a,b){L(["Width","Height"],function(a,d){I[(b?"outer":"inner")+d]=function(c){if(this[0])return M(this[0])?b?this[0]["inner"+d]:this[0].document.documentElement["client"+d]:C(this[0])?sa(this[0],d):this[0][(b?"offset":"client")+d]+(c&&b?T(this[0],"margin"+(a?"Top":"Left"))+T(this[0],"margin"+(a?"Bottom":"Right")):0)}})});
L(["Width","Height"],function(a,b){var c=b.toLowerCase();I[c]=function(d){if(!this[0])return void 0===d?void 0:this;if(!arguments.length)return M(this[0])?this[0].document.documentElement["client"+b]:C(this[0])?sa(this[0],b):this[0].getBoundingClientRect()[c]-ta(this[0],!a);var h=parseInt(d,10);return this.each(function(b,d){D(d)&&(b=S(d,"boxSizing"),d.style[c]=pa(c,h+("border-box"===b?ta(d,!a):0)))})}});var U={};
I.toggle=function(a){return this.each(function(b,c){if(D(c))if(void 0===a?"none"===S(c,"display"):a){if(c.style.display=c.___cd||"","none"===S(c,"display")){b=c.style;c=c.tagName;if(U[c])c=U[c];else{var d=p(c);m.body.insertBefore(d,null);var h=S(d,"display");m.body.removeChild(d);c=U[c]="none"!==h?h:"block"}b.display=c}}else c.___cd=S(c,"display"),c.style.display="none"})};I.hide=function(){return this.toggle(!1)};I.show=function(){return this.toggle(!0)};
function ua(a,b){return!b||!A.call(b,function(b){return 0>a.indexOf(b)})}var V={focus:"focusin",blur:"focusout"},W={mouseenter:"mouseover",mouseleave:"mouseout"},va=/^(mouse|pointer|contextmenu|drag|drop|click|dblclick)/i;function wa(a,b,c,d,h){var f=a.___ce=a.___ce||{};f[b]=f[b]||[];f[b].push([c,d,h]);a.addEventListener(b,h)}function X(a){a=a.split(".");return[a[0],a.slice(1).sort()]}
function Y(a,b,c,d,h){var f=a.___ce=a.___ce||{};if(b)f[b]&&(f[b]=f[b].filter(function(f){var l=f[0],k=f[1];f=f[2];if(h&&f.guid!==h.guid||!ua(l,c)||d&&d!==k)return!0;a.removeEventListener(b,f)}));else for(b in f)Y(a,b,c,d,h)}
I.off=function(a,b,c){var d=this;if(void 0===a)this.each(function(a,b){(D(b)||C(b)||M(b))&&Y(b)});else if(F(a))H(b)&&(c=b,b=""),L(P(a),function(a,h){a=X(h);h=a[0];var f=a[1],k=W[h]||V[h]||h;d.each(function(a,d){(D(d)||C(d)||M(d))&&Y(d,k,f,b,c)})});else for(var h in a)this.off(h,a[h]);return this};
I.on=function(a,b,c,d,h){var f=this;if(!F(a)){for(var l in a)this.on(l,b,c,a[l],h);return this}F(b)||(void 0!==b&&null!==b&&(void 0!==c&&(d=c),c=b),b="");H(d)||(d=c,c=void 0);if(!d)return this;L(P(a),function(a,k){a=X(k);k=a[0];var q=a[1],l=W[k]||V[k]||k,x=k in W,xa=k in V;l&&f.each(function(a,f){if(D(f)||C(f)||M(f))a=function ya(a){if(a.target["___i"+a.type])return a.stopImmediatePropagation();if(!a.namespace||ua(q,a.namespace.split(".")))if(b||!(xa&&(a.target!==f||a.___ot===l)||x&&a.relatedTarget&&
f.contains(a.relatedTarget))){var k=f;if(b){for(var z=a.target;!ka(z,b);){if(z===f)return;z=z.parentNode;if(!z)return}k=z;a.___cd=!0}a.___cd&&Object.defineProperty(a,"currentTarget",{configurable:!0,get:function(){return k}});Object.defineProperty(a,"data",{configurable:!0,get:function(){return c}});z=d.call(k,a,a.___td);h&&Y(f,l,q,b,ya);!1===z&&(a.preventDefault(),a.stopPropagation())}},a.guid=d.guid=d.guid||J.guid++,wa(f,l,q,b,a)})});return this};I.one=function(a,b,c,d){return this.on(a,b,c,d,!0)};
I.ready=function(a){function b(){return setTimeout(a,0,J)}"loading"!==m.readyState?b():m.addEventListener("DOMContentLoaded",b);return this};I.trigger=function(a,b){if(F(a)){var c=X(a),d=c[0];c=c[1];var h=W[d]||V[d]||d;if(!h)return this;var f=va.test(h)?"MouseEvents":"HTMLEvents";a=m.createEvent(f);a.initEvent(h,!0,!0);a.namespace=c.join(".");a.___ot=d}a.___td=b;var l=a.___ot in V;return this.each(function(b,c){l&&H(c[a.___ot])&&(c["___i"+a.type]=!0,c[a.___ot](),c["___i"+a.type]=!1);c.dispatchEvent(a)})};
function za(a){return a.multiple&&a.options?Q(u.call(a.options,function(a){return a.selected&&!a.disabled&&!a.parentNode.disabled}),"value"):a.value||""}var Aa=/radio|checkbox/i;I.val=function(a){return arguments.length?this.each(function(b,c){if((b=c.multiple&&c.options)||Aa.test(c.type)){var d=r(a)?w.call(a,String):null===a?[]:[String(a)];b?L(c.options,function(a,b){b.selected=0<=d.indexOf(b.value)},!0):c.checked=0<=d.indexOf(c.value)}else c.value=void 0===a||null===a?"":a}):this[0]&&za(this[0])};
I.clone=function(){return this.map(function(a,b){return b.cloneNode(!0)})};I.detach=function(a){O(this,a).each(function(a,c){c.parentNode&&c.parentNode.removeChild(c)});return this};var Ba=/^\s*<(\w+)[^>]*>/,Ca=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;function G(a){if(!F(a))return[];if(Ca.test(a))return[p(RegExp.$1)];var b=Ba.test(a)&&RegExp.$1;b=p("tr"==b?"tbody":"div");b.innerHTML=a;return J(b.childNodes).detach().get()}J.parseHTML=G;I.empty=function(){return this.each(function(a,b){for(;b.firstChild;)b.removeChild(b.firstChild)})};
function Z(a,b,c,d,h,f,l,x){L(a,function(a,f){L(J(f),function(a,f){L(J(b),function(b,k){var l=c?k:f;k=c?f:k;b=(c?a:b)?l.cloneNode(!0):l;h?k.insertBefore(b,d?k.firstChild:null):k.parentNode.insertBefore(b,d?k:k.nextSibling)},x)},l)},f);return b}I.after=function(){return Z(arguments,this,!1,!1,!1,!0,!0)};I.append=function(){return Z(arguments,this,!1,!1,!0)};I.appendTo=function(a){return Z(arguments,this,!0,!1,!0)};I.before=function(){return Z(arguments,this,!1,!0)};
I.html=function(a){return arguments.length?void 0===a?this:this.each(function(b,c){D(c)&&(c.innerHTML=a)}):this[0]&&this[0].innerHTML};I.insertAfter=function(a){return Z(arguments,this,!0,!1,!1,!1,!1,!0)};I.insertBefore=function(a){return Z(arguments,this,!0,!0)};I.prepend=function(){return Z(arguments,this,!1,!0,!0,!0,!0)};I.prependTo=function(a){return Z(arguments,this,!0,!0,!0,!1,!1,!0)};I.remove=function(a){O(this,a).detach().off();return this};I.replaceWith=function(a){return this.before(a).remove()};
I.replaceAll=function(a){J(a).replaceWith(this);return this};I.text=function(a){return void 0===a?this[0]?this[0].textContent:"":this.each(function(b,c){D(c)&&(c.textContent=a)})};I.unwrap=function(){this.parent().each(function(a,b){"BODY"!==b.tagName&&(a=J(b),a.replaceWith(a.children()))});return this};I.wrapAll=function(a){a=J(a);for(var b=a[0];b.children.length;)b=b.firstElementChild;this.first().before(a);return this.appendTo(b)};
I.wrap=function(a){return this.each(function(b,c){var d=J(a)[0];J(c).wrapAll(b?d.cloneNode(!0):d)})};I.wrapInner=function(a){return this.each(function(b,c){b=J(c);c=b.contents();c.length?c.wrapAll(a):b.append(a)})};I.offset=function(){var a=this[0];if(a)return a=a.getBoundingClientRect(),{top:a.top+n.pageYOffset,left:a.left+n.pageXOffset}};I.offsetParent=function(){return this.map(function(a,b){for(a=b.offsetParent;a&&"static"===S(a,"position");)a=a.offsetParent;return a||aa})};
I.children=function(a){return O(J(R(Q(this,function(a){return a.children}))),a)};I.contents=function(){return J(R(Q(this,function(a){return"IFRAME"===a.tagName?[a.contentDocument]:"TEMPLATE"===a.tagName?a.content.childNodes:a.childNodes})))};I.find=function(a){return J(R(Q(this,function(b){return B(a,b)})))};I.has=function(a){var b=F(a)?function(b,d){return B(a,d).length}:function(b,d){return d.contains(a)};return this.filter(b)};
I.is=function(a){var b=N(a);return A.call(this,function(a,d){return b.call(a,d,a)})};I.next=function(a,b,c){return O(J(R(Q(this,"nextElementSibling",b,c))),a)};I.nextAll=function(a){return this.next(a,!0)};I.nextUntil=function(a,b){return this.next(b,!0,a)};I.not=function(a){var b=N(a);return this.filter(function(c,d){return(!F(a)||D(d))&&!b.call(d,c,d)})};I.parent=function(a){return O(J(R(Q(this,"parentNode"))),a)};
I.index=function(a){var b=a?J(a)[0]:this[0];a=a?this:J(b).parent().children();return v.call(a,b)};I.closest=function(a){var b=this.filter(a);if(b.length)return b;var c=this.parent();return c.length?c.closest(a):b};I.parents=function(a,b){return O(J(R(Q(this,"parentElement",!0,b))),a)};I.parentsUntil=function(a,b){return this.parents(b,a)};I.prev=function(a,b,c){return O(J(R(Q(this,"previousElementSibling",b,c))),a)};I.prevAll=function(a){return this.prev(a,!0)};
I.prevUntil=function(a,b){return this.prev(b,!0,a)};I.siblings=function(a){return O(J(R(Q(this,function(a){return J(a).parent().children().not(a)}))),a)};"undefined"!==typeof exports?module.exports=J:n.cash=n.$=J;
})();!function(){var u="displayController",l="hasActiveHover",f="forcedOpen",w={scoped:{},currentX:0,currentY:0,previousX:0,previousY:0,mouseTrackingActive:!1,windowWidth:0,windowHeight:0,scrollTop:0,scrollLeft:0},h={none:0,top:1,bottom:2,left:4,right:8};function d(){var o=this;o.top="auto",o.left="auto",o.right="auto",o.bottom="auto",o.set=function(e,t){$.isNumeric(t)&&(o[e]=Math.round(t))}}function i(o,i,n){var s=null,r=w.scoped[i.popupId];function c(e,t){p(),o[0][l]||(e?(t&&(o[0][f]=!0),n.showTip(o)):(r.tipOpenImminent=!0,s=setTimeout(function(){var e,t;s=null,e=Math.abs(w.previousX-w.currentX),t=Math.abs(w.previousY-w.currentY),e+t<i.intentSensitivity?n.showTip(o):(w.previousX=w.currentX,w.previousY=w.currentY,c())},i.intentPollInterval)))}function p(){s=clearTimeout(s),r.delayInProgress=!1}this.show=c,this.hide=function(e){p(),r.tipOpenImminent=!1,o[0][l]&&(o[0][f]=!1,e?n.hideTip(o):(r.delayInProgress=!0,s=setTimeout(function(){s=null,n.hideTip(o),w.delayInProgress=!1},i.closeDelay)))},this.cancel=p,this.resetPosition=function(){n.resetPosition(o)}}function e(){this.compute=function(e,t,o,i,n){var s=t.split("-")[0],r=new d,c=function(e,t){var o,i,n=e.offset(),s=e.outerWidth(),r=e.outerHeight();switch(t){case"n":o=n.left+s/2,i=n.top;break;case"e":o=n.left+s,i=n.top+r/2;break;case"s":o=n.left+s/2,i=n.top+r;break;case"w":o=n.left,i=n.top+r/2;break;case"nw":o=n.left,i=n.top;break;case"ne":o=n.left+s,i=n.top;break;case"sw":o=n.left,i=n.top+r;break;case"se":o=n.left+s,i=n.top+r}return{top:i,left:o}}(e,s);switch(t){case"n":r.set("left",c.left-o/2),r.set("bottom",w.windowHeight-c.top+n);break;case"e":r.set("left",c.left+n),r.set("top",c.top-i/2);break;case"s":r.set("left",c.left-o/2),r.set("top",c.top+n);break;case"w":r.set("top",c.top-i/2),r.set("right",w.windowWidth-c.left+n);break;case"nw":r.set("bottom",w.windowHeight-c.top+n),r.set("right",w.windowWidth-c.left-20);break;case"ne":r.set("left",c.left-20),r.set("bottom",w.windowHeight-c.top+n);break;case"sw":r.set("top",c.top+n),r.set("right",w.windowWidth-c.left-20);break;case"se":r.set("left",c.left-20),r.set("top",c.top+n)}return r}}function n(r){var c=new e,p=$("#"+r.popupId),o=w.scoped[r.popupId];function i(e){o.isClosing=!0,o.activeHover=null,o.isTipOpen=!1,o.desyncTimeout=clearInterval(o.desyncTimeout),e[0][l]=!1,e[0][f]=!1,p.hide();e=new d;o.isClosing=!1,p.removeClass(),e.set("top",w.currentY+r.offset),e.set("left",w.currentX+r.offset),p.css(e)}function n(i){var e;r.smartPlacement?(e=$.fn.powerTip.smartPlacementLists[r.placement],$.each(e,function(e,t){var o=function(e,t,o){var i=w.scrollTop,n=w.scrollLeft,s=i+w.windowHeight,r=n+w.windowWidth,c=h.none;(e.top<i||Math.abs(e.bottom-w.windowHeight)-o<i)&&(c|=h.top);(e.top+o>s||Math.abs(e.bottom-w.windowHeight)>s)&&(c|=h.bottom);(e.left<n||e.right+t>r)&&(c|=h.left);(e.left+t>r||e.right<n)&&(c|=h.right);return c}(s(i,t),p.outerWidth()||r.defaultSize[0],p.outerHeight()||r.defaultSize[1]);if(o===h.none)return!1})):(s(i,r.placement),r.placement)}function s(e,t){var o,i,n=0,s=new d;for(s.set("top",0),s.set("left",0),p.css(s);o=p.outerWidth()||r.defaultSize[0],i=p.outerHeight()||r.defaultSize[1],s=c.compute(e,t,o,i,r.offset),p.css(s),++n<=5&&(o!==p.outerWidth()||i!==p.outerHeight()););return s}function a(){var e=!1;!o.isTipOpen||o.isClosing||o.delayInProgress||(e=!1===o.activeHover[0][l]||o.activeHover.is(":disabled")||!(t(o.activeHover)||o.activeHover.is(":focus")||o.activeHover[0][f]||t(p))?!0:e)&&i(o.activeHover)}o||(w.scoped[r.popupId]=o={}),0===p.length&&(p=$('<div id="'+r.popupId+'"/>'),$("body").append(p)),p.on({mouseenter:function(){o.activeHover&&o.activeHover[0][u].cancel()},mouseleave:function(){o.activeHover&&o.activeHover[0][u].hide()}}),this.showTip=function(e){e[0][l]=!0,function e(t){if(!t[0][l])return;if(o.isTipOpen)return o.isClosing||i(o.activeHover),void setTimeout(function(){e(t)},100);p.empty();r.preRender&&r.preRender(t[0]);o.activeHover=t;o.isTipOpen=!0;n(t);p.show();o.desyncTimeout||(o.desyncTimeout=setInterval(a,500))}(e)},this.hideTip=i,this.resetPosition=n}function s(e){w.currentX=e.pageX,w.currentY=e.pageY}function t(e){var t=e.offset();return w.currentX>=t.left&&w.currentX<=t.left+e.width()&&w.currentY>=t.top&&w.currentY<=t.top+e.height()}$.fn.powerTip=function(e){if(!this.length)return this;var t=Object.assign({},$.fn.powerTip.defaults,e),o=new n(t);return function(){{var e;w.mouseTrackingActive||(w.mouseTrackingActive=!0,e=$(window),w.scrollLeft=window.scrollX,w.scrollTop=window.scrollY,w.windowWidth=e.width(),w.windowHeight=e.height(),document.addEventListener("mousemove",s),window.addEventListener("resize",function(){w.windowWidth=e.width(),w.windowHeight=e.height()},{passive:!0}),window.addEventListener("scroll",function(){var e=window.scrollX,t=window.scrollY;e!==w.scrollLeft&&(w.currentX+=e-w.scrollLeft,w.scrollLeft=e),t!==w.scrollTop&&(w.currentY+=t-w.scrollTop,w.scrollTop=t)},{passive:!0}))}}(),this.each(function(){var e=$(this);this[u]&&$.powerTip.destroy(e),this[u]=new i(e,t,o)}),this.on({mouseenter:function(e){$.powerTip.show(this,e)},mouseleave:function(){$.powerTip.hide(this)}}),this},$.fn.powerTip.defaults={popupId:"powerTip",intentSensitivity:7,intentPollInterval:150,closeDelay:150,placement:"n",smartPlacement:!0,defaultSize:[260,120],offset:10},$.fn.powerTip.smartPlacementLists={n:["n","ne","nw","s"],e:["e","ne","se","w","nw","sw","n","s","e"],s:["s","se","sw","n"],w:["w","nw","sw","e","ne","se","n","s","w"],nw:["nw","w","sw","n","s","se","nw"],ne:["ne","e","se","n","s","sw","ne"],sw:["sw","w","nw","s","n","ne","sw"],se:["se","e","ne","s","n","nw","se"]},$.powerTip={show:function(e,t){return t?(s(t),w.previousX=t.pageX,w.previousY=t.pageY,$(e)[0][u].show()):$(e).first()[0][u].show(!0,!0),e},reposition:function(e){return $(e).first()[0][u].resetPosition(),e},hide:function(e,t){return $(e).first()[0][u].hide(t),e},destroy:function(e){return $(e).off(".powertip").each(function(){delete this[u],delete this[l],delete this[f]}),e}},$.powerTip.showTip=$.powerTip.show,$.powerTip.closeTip=$.powerTip.hide}();
// https://github.com/ornicar/howler.js/tree/2.0-lila-trim2
!function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var e=this||n;return e._codecs={},e._howls=[],e._canPlayEvent="canplaythrough",e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.mobileAutoEnable=!0,e._setup(),e},unload:function(){for(var e=this||n,t=e._howls.length-1;t>=0;t--)e._howls[t].unload();return e.usingWebAudio&&e.ctx&&void 0!==e.ctx.close&&(e.ctx.close(),e.ctx=null,d()),e},codecs:function(e){return(this||n)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||n;if(e.state=e.ctx&&e.ctx.state||"running",e._autoSuspend(),!e.usingWebAudio)if("undefined"!=typeof Audio)try{void 0===(t=new Audio).oncanplaythrough&&(e._canPlayEvent="canplay")}catch(o){e.noAudio=!0}else e.noAudio=!0;try{var t;(t=new Audio).muted?e.noAudio=!0:e._codecs={mp3:!(!t.canPlayType("audio/mpeg;").replace(/^no$/,"")&&!t.canPlayType("audio/mp3;").replace(/^no$/,"")),ogg:!!t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")}}catch(o){}return e},_enableMobileAudio:function(){var e=this||n;if(e._mobileEnabled||!e.ctx||!/iPhone|iPad|iPod|Android|BlackBerry|BB10|Silk|Mobi/i.test(navigator.userAgent)&&!("ontouchend"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0))return;e._mobileEnabled=!1,e._mobileUnloaded||44100===e.ctx.sampleRate||(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);const t=["touchstart","touchend","click"];var o=function(){var n=e.ctx.createBufferSource();n.buffer=e._scratchBuffer,n.connect(e.ctx.destination),void 0===n.start?n.noteOn(0):n.start(0),n.onended=function(){n.disconnect(0),e._mobileEnabled=!0,e.mobileAutoEnable=!1,t.forEach(e=>document.removeEventListener(e,o,!0))}};return t.forEach(e=>document.addEventListener(e,o,!0)),e},_autoSuspend:function(){var e=this;if(e.autoSuspend&&e.ctx&&void 0!==e.ctx.suspend&&n.usingWebAudio){for(var t=0;t<e._howls.length;t++)if(e._howls[t]._webAudio)return e._howls[t]._sounds.length>0;return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout((function(){e.autoSuspend&&(e._suspendTimer=null,e.state="suspending",e.ctx.suspend().then((function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())})))}),9e4),e}},_autoResume:function(){var e=this;if(e.ctx&&void 0!==e.ctx.resume&&n.usingWebAudio)return"running"===e.state&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):"suspended"===e.state?(e.state="resuming",e.ctx.resume().then((function(){e.state="running",e._howls.forEach(e=>e._emit("resume"))})),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):"suspending"===e.state&&(e._resumeAfterSuspend=!0),e}};var n=new e,t=function(e){e.src&&0!==e.src.length?this.init(e):console.error("An array of source files must be passed with any new Howl.")};t.prototype={init:function(e){var t=this;return n.ctx||d(),t._html5=!1,t._pool=5,t._preload=!0,t._src="string"!=typeof e.src?e.src:[e.src],t._volume=void 0!==e.volume?e.volume:1,t._duration=0,t._state="unloaded",t._sounds=[],t._endTimers={},t._queue=[],t._onload=t._onpause=t._onplay=t._onstop=t._onvolume=t._onresume=t._onend=[],t._webAudio=n.usingWebAudio&&!t._html5,void 0!==n.ctx&&n.ctx&&n.mobileAutoEnable&&n._enableMobileAudio(),n._howls.push(t),t._preload&&t.load(),t},load:function(){var e=this,t=null;if(!n.noAudio){"string"==typeof e._src&&(e._src=[e._src]);for(var u=0;u<e._src.length;u++){var i=e._src[u],d=/\.([^.]+)$/.exec(i.split("?",1)[0]);if(d&&(d=d[1].toLowerCase()),n.codecs(d)){t=e._src[u];break}}if(t)return e._src=t,e._state="loading",new o(e),e._webAudio&&r(e),e}},play:function(){var e=this,t=e._inactiveSound();if("loaded"!==e._state)return e._queue.push({event:"play",action(){e.play()}}),t._id;e._webAudio&&n._autoResume(),t._ended=!1;var o=t._node;if(e._webAudio){var u=function(){e._refreshBuffer(t),o.gain.setValueAtTime(t._volume,n.ctx.currentTime),t._playStart=n.ctx.currentTime,void 0===o.bufferSource.start?o.bufferSource.noteGrainOn(0,0,e._duration):o.bufferSource.start(0,0,e._duration),e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),1e3*e._duration),setTimeout((function(){e._emit("play",t._id)}),0)},r="running"===n.state;"loaded"===e._state&&r?u():(e.on(r?"load":"resume",u,r?t._id:null,1),e._clearTimer(t._id))}else{var i=function(){o.currentTime=0,o.volume=t._volume,setTimeout((function(){o.play(),e._endTimers[t._id]=setTimeout(e._ended.bind(e,t),1e3*e._duration),e._emit("play",t._id)}),0)},d="loaded"===e._state;if(4===o.readyState||d)i();else{var s=function(){i(),o.removeEventListener(n._canPlayEvent,s,!1)};o.addEventListener(n._canPlayEvent,s,!1),e._clearTimer(t._id)}}return t._id},stop:function(e){var n=this;if("loaded"!==n._state)return n._queue.push({event:"stop",action(){n.stop(e)}}),n;for(var t=n._getSoundIds(e),o=0;o<t.length;o++){n._clearTimer(t[o]);var u=n._soundById(t[o]);if(u&&(u._ended=!0,u._node))if(n._webAudio){if(!u._node.bufferSource)return n._emit("stop",u._id),n;void 0===u._node.bufferSource.stop?u._node.bufferSource.noteOff(0):u._node.bufferSource.stop(0),n._cleanBuffer(u._node)}else isNaN(u._node.duration)&&u._node.duration!==1/0||(u._node.currentTime=u._start||0,u._node.pause());u&&n._emit("stop",u._id)}return n},volume:function(e){var t=this;return"loaded"!==t._state?(t._queue.push({event:"volume",action(){t.volume.apply(t,[e])}}),t):(t._volume=e,t._sounds.forEach((function(o){o._volume=e,t._webAudio&&o._node?o._node.gain.setValueAtTime(e,n.ctx.currentTime):o._node&&(o._node.volume=e),t._emit("volume",o._id)})),t)},playing:function(e){return"number"==typeof e?!!this._soundById(e):this._sounds.length>0},state:function(){return this._state},on:function(e,n,t,o){this["_on"+e].push({id:t,fn:n,once:!!o})},_emit:function(e,n,t){for(var o=this["_on"+e],u=o.length-1;u>=0;u--)o[u].id&&o[u].id!==n&&"load"!==e||(setTimeout(function(e){e.call(this,n,t)}.bind(this,o[u].fn),0),o[u].once&&o.splice(u,1))},_loadQueue:function(){var e=this;if(e._queue.length>0){var n=e._queue[0];e.on(n.event,(function(){e._queue.shift(),e._loadQueue()}),null,1),n.action()}return e},_ended:function(e){var t=this;return t._emit("end",e._id),t._webAudio&&(e._ended=!0,t._clearTimer(e._id),t._cleanBuffer(e._node),n._autoSuspend()),t._webAudio||t.stop(e._id),t},_clearTimer:function(e){var n=this;return n._endTimers[e]&&(clearTimeout(n._endTimers[e]),delete n._endTimers[e]),n},_soundById:function(e){for(var n=this,t=0;t<n._sounds.length;t++)if(e===n._sounds[t]._id)return n._sounds[t];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new o(e)},_drain:function(){var e=this,n=e._pool,t=0;if(!(e._sounds.length<n)){var o=e._sounds.reduce((e,n)=>e+(n._ended?1:0),0);for(t=e._sounds.length-1;t>=0;t--){if(o<=n)return;e._sounds[t]._ended&&(e._webAudio&&e._sounds[t]._node&&e._sounds[t]._node.disconnect(0),e._sounds.splice(t,1),o--)}}},_getSoundIds:function(e){if(void 0===e){for(var n=[],t=0;t<this._sounds.length;t++)n.push(this._sounds[t]._id);return n}return[e]},_refreshBuffer:function(e){return e._node.bufferSource=n.ctx.createBufferSource(),e._node.bufferSource.buffer=u[this._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),this},_cleanBuffer:function(e){var n=this;if(n._scratchBuffer){e.bufferSource.onended=null,e.bufferSource.disconnect(0);try{e.bufferSource.buffer=n._scratchBuffer}catch(t){}}return e.bufferSource=null,n}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,n=e._parent;return e._volume=n._volume,e._ended=!0,e._id=Math.round(Date.now()*Math.random()),n._sounds.push(e),e.create(),e},create:function(){var e=this,t=e._parent,o=e._volume;return t._webAudio?(e._node=n.ctx.createGain?n.ctx.createGain():n.ctx.createGainNode(),e._node.gain.setValueAtTime(o,n.ctx.currentTime),e._node.connect(n.ctx.destination)):(e._node=new Audio,e._loadFn=e._loadListener.bind(e),e._node.addEventListener(n._canPlayEvent,e._loadFn,!1),e._node.src=t._src,e._node.preload="auto",e._node.volume=o,e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._volume=n._volume,e._ended=!0,e._id=Math.round(Date.now()*Math.random()),e},_loadListener:function(){var e=this,t=e._parent;t._duration=Math.ceil(10*e._node.duration)/10,"loaded"!==t._state&&(t._state="loaded",t._emit("load"),t._loadQueue()),e._node.removeEventListener(n._canPlayEvent,e._loadFn,!1)}};var u={},r=function(e){var t=e._src;u[t]?(e._duration=u[t].duration,i(e)):fetch(t,{}).then(t=>{t.ok?t.arrayBuffer().then(t=>n.ctx.decodeAudioData(t,n=>{n&&e._sounds.length>0&&(u[e._src]=n,i(e,n))})):Promise.reject()}).catch(()=>{e._html5=!0,e._webAudio=!1,e._sounds=[],delete u[t],e.load()})},i=function(e,n){n&&!e._duration&&(e._duration=n.duration),"loaded"!==e._state&&(e._state="loaded",e._emit("load"),e._loadQueue())},d=function(){try{"undefined"!=typeof AudioContext?n.ctx=new AudioContext:"undefined"!=typeof webkitAudioContext?n.ctx=new webkitAudioContext:n.usingWebAudio=!1}catch(t){n.usingWebAudio=!1}var e=/iP(hone|od|ad)/.test(navigator)&&navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/)?parseInt(appVersion[1],10):null;e&&e<9&&!/safari/.test(navigator.userAgent.toLowerCase())&&(n.usingWebAudio=!1),n._setup()};window.Howler=n,window.Howl=t}();
var Tt=Object.defineProperty;var Me=(t,e)=>{for(var o in e)Tt(t,o,{get:e[o],enumerable:!0})};var a={date:"2023-07-10T03:44:24+00:00",commit:"4fafa9a44b1b81fb897f446772adbff9823985e3",message:'Revert "hotfix claim win button without a clock - revert me"'};var B="\uE025";var Ee="\uE038";var $e="\uE03A";var Ae="\uE03F";var Le="\uE048";var Pe="\uE04D";var Ie="\uE056";var Oe="\uE05A";var De="\uE065";var K={};Me(K,{init:()=>ne,initAll:()=>q,initWith:()=>Ne});var He=t=>`lichess-${t}`,F=(t,e)=>t[He(e)],C=(t,e,o)=>t[He(e)]=o;var _e=["a","b","c","d","e","f","g","h"],oe=["1","2","3","4","5","6","7","8"];var po=[...oe].reverse(),Mt=Array.prototype.concat(..._e.map(t=>oe.map(e=>t+e)));var Et=t=>[t.charCodeAt(0)-97,t.charCodeAt(1)-49],L=t=>{if(t)return t[1]==="@"?[t.slice(2,4)]:[t.slice(0,2),t.slice(2,4)]},ho=Mt.map(Et);var ne=t=>{let[e,o,n]=t.getAttribute("data-state").split(",");Ne(t,e,o,n)},Ne=(t,e,o,n)=>{window.Chessground?C(t,"chessground",window.Chessground(t,{orientation:o,coordinates:!1,viewOnly:!t.getAttribute("data-playable"),fen:e,lastMove:L(n),drawable:{enabled:!1,visible:!1}})):setTimeout(()=>ne(t),500)},q=t=>Array.from((t||document).getElementsByClassName("mini-board--init")).forEach(e=>{e.classList.remove("mini-board--init"),ne(e)});var W={};Me(W,{finish:()=>ue,init:()=>le,initAll:()=>z,update:()=>de});var se=t=>t.includes(" w")?"white":"black";function P(t,e){let o=F(t,"clock");o?o.set(e):C(t,"clock",new ie(t,e))}var ie=class{constructor(e,o){this.el=e;this.opts=o;this.set=e=>{this.opts=e,this.target=e.time*1e3+Date.now(),this.render(),clearInterval(this.interval),e.pause||(this.interval=setInterval(this.render,1e3))};this.render=()=>{document.body.contains(this.el)?(this.el.textContent=$t(this.target-Date.now()),this.el.classList.toggle("clock--run",!this.opts.pause)):clearInterval(this.interval)};this.target=o.time*1e3+Date.now(),o.pause||(this.interval=setInterval(this.render,1e3)),this.render()}},$t=t=>{let e=new Date(Math.max(0,t+500)),o=e.getUTCHours(),n=e.getUTCMinutes(),s=e.getUTCSeconds();return o>0?o+":"+re(n)+":"+re(s):n+":"+re(s)},re=t=>(t<10?"0":"")+t;var M=t=>t!==void 0,I=t=>t!=null;var Re=t=>{let e;return()=>(e===void 0&&(e=t()),e)};var At={cache:"no-cache",credentials:"same-origin"},Lt={"X-Requested-With":"XMLHttpRequest"},Pt=t=>{if(t.ok)return t;throw t.status==429?new Error("Too many requests"):t.status==413?new Error("The uploaded file is too large"):new Error(`Error ${t.status}`)};var v=(t,e={})=>It(t,e).then(o=>Pt(o).text()),It=(t,e={})=>fetch(t,{...At,headers:{...Lt},...e}),Ue=t=>new Promise((e,o)=>{let n=document.body.getAttribute("data-nonce"),s=document.createElement("script");n&&s.setAttribute("nonce",n),s.onload=e,s.onerror=o,s.src=t,document.head.append(s)}),Be=t=>{let e=new FormData;for(let o of Object.keys(t))M(t[o])&&e.append(o,t[o]);return e},Fe=(t,e)=>{let o=new URLSearchParams;for(let s of Object.keys(e))M(e[s])&&o.append(s,e[s]);let n=o.toString();return n?`${t}?${n}`:t},qe=(t,e)=>{let o=t.getAttribute("action"),n=new FormData(t);return e!=null&&e.name&&(e!=null&&e.value)&&n.set(e.name,e.value),o?v(o,{method:t.method,body:n}):Promise.reject(`Form has no action: ${t}`)};function O(t,e,o){let n=["mousemove","touchstart"],s=!1,r=!0,i=performance.now(),c=()=>{r||o(),r=!0,i=performance.now(),d()},l=()=>{s||(n.forEach(p=>document.addEventListener(p,c)),s=!0)},d=()=>{s&&(n.forEach(p=>document.removeEventListener(p,c)),s=!1)};setInterval(()=>{r&&performance.now()-i>t&&(e(),r=!1),l()},1e4)}var Ke=()=>{try{let t=window.crypto.getRandomValues(new Uint8Array(9));return btoa(String.fromCharCode(...t)).replace(/[/+]/g,"_")}catch(t){return Math.random().toString(36).slice(2,12)}};var Ot=Ke(),w=Ot;var je=!1,ze=t=>{let e;if(typeof t=="string")e=t;else if(e=t.url,t.cookie){let n=[encodeURIComponent(t.cookie.name)+"="+t.cookie.value,"; max-age="+t.cookie.maxAge,"; path=/","; domain="+location.hostname].join("");document.cookie=n}let o="//"+location.host+"/"+e.replace(/^\//,"");je=o,location.href=o},ae={expected:!1},y=()=>{je||(ae.expected=!0,lichess.socket.disconnect(),location.hash?location.reload():location.assign(location.href))};var We=t=>{let e={get:o=>t.getItem(o),set:(o,n)=>t.setItem(o,n),fire:(o,n)=>t.setItem(o,JSON.stringify({sri:w,nonce:Math.random(),value:n})),remove:o=>t.removeItem(o),make:o=>({get:()=>e.get(o),set:n=>e.set(o,n),fire:n=>e.fire(o,n),remove:()=>e.remove(o),listen:n=>window.addEventListener("storage",s=>{if(s.key!==o||s.storageArea!==t||s.newValue===null)return;let r;try{r=JSON.parse(s.newValue)}catch(i){return}r!=null&&r.sri&&r.sri!==w&&n(r)})}),boolean:o=>({get:()=>e.get(o)=="1",getOrDefault:n=>{let s=e.get(o);return s===null?n:s=="1"},set:n=>e.set(o,n?"1":"0"),toggle:()=>e.set(o,e.get(o)=="1"?"0":"1")})};return e},h=We(window.localStorage),Ve=We(window.sessionStorage);function D(t,e){return e==="always"?!0:h.get(t)?!1:(h.set(t,"1"),!0)}var Dt=WebSocket.prototype.send,f=class f{constructor(e,o,n={}){this.url=e;this.pubsub=lichess.pubsub;this.ackable=new ce((e,o,n)=>this.send(e,o,n));this.lastPingTime=performance.now();this.pongCount=0;this.averageLag=0;this.tryOtherUrl=!1;this.autoReconnect=!0;this.nbConnects=0;this.storage=h.make("surl17");this.resendWhenOpen=[];this.sign=e=>{this._sign=e,this.ackable.sign(e)};this.connect=()=>{this.destroy(),this.autoReconnect=!0;let e=Fe(this.options.protocol+"//"+this.baseUrl()+this.url,{...this.settings.params,v:this.version===!1?void 0:this.version});this.debug("connection attempt to "+e);try{let o=this.ws=new WebSocket(e);o.onerror=n=>this.onError(n),o.onclose=()=>{this.pubsub.emit("socket.close"),this.autoReconnect&&(this.debug("Will autoreconnect in "+this.options.autoReconnectDelay),this.scheduleConnect(this.options.autoReconnectDelay))},o.onopen=()=>{this.debug("connected to "+e),this.onSuccess();let n=document.body.classList;n.remove("offline"),n.add("online"),n.toggle("reconnected",this.nbConnects>1),this.pingNow(),this.resendWhenOpen.forEach(([s,r,i])=>this.send(s,r,i)),this.resendWhenOpen=[],this.pubsub.emit("socket.open"),this.ackable.resend()},o.onmessage=n=>{if(n.data==0)return this.pong();let s=JSON.parse(n.data);s.t==="n"&&this.pong(),this.handle(s)}}catch(o){this.onError(o)}this.scheduleConnect(this.options.pingMaxLag)};this.send=(e,o,n={},s=!1)=>{let r={t:e};o!==void 0&&(n.withLag&&(o.l=Math.round(this.averageLag)),n.millis>=0&&(o.s=Math.round(n.millis*.1).toString(36)),r.d=o),n.ackable&&(r.d=r.d||{},this.ackable.register(e,r.d));let i=JSON.stringify(r);if(!(e=="racerScore"&&n.sign!=this._sign)){if(e=="move"&&n.sign!=this._sign){let c;try{c=new Error().stack.split(`
`).join(" / ").replace(/\s+/g," ")}catch(l){c=`${l.message} ${navigator.userAgent}`}c.includes("round.nvui")||setTimeout(()=>{D(`socket.rep.${Math.round(Date.now()/1e3/3600/3)}`)?this.send("rep",{n:`soc: ${i} ${c}`}):lichess.socket.destroy()},1e4)}this.debug("send "+i),!this.ws||this.ws.readyState===WebSocket.CONNECTING?s||this.resendWhenOpen.push([e,r.d,n]):Dt.apply(this.ws,[i])}};this.scheduleConnect=e=>{this.options.idle&&(e=10*1e3+Math.random()*10*1e3),clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule),this.connectSchedule=setTimeout(()=>{document.body.classList.add("offline"),document.body.classList.remove("online"),this.tryOtherUrl=!0,this.connect()},e)};this.schedulePing=e=>{clearTimeout(this.pingSchedule),this.pingSchedule=setTimeout(this.pingNow,e)};this.pingNow=()=>{clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule);let e=this.options.isAuth&&this.pongCount%10==2?JSON.stringify({t:"p",l:Math.round(.1*this.averageLag)}):"null";try{this.ws.send(e),this.lastPingTime=performance.now()}catch(o){this.debug(o,!0)}this.scheduleConnect(this.options.pingMaxLag)};this.computePingDelay=()=>this.options.pingDelay+(this.options.idle?1e3:0);this.pong=()=>{clearTimeout(this.connectSchedule),this.schedulePing(this.computePingDelay());let e=Math.min(performance.now()-this.lastPingTime,1e4);this.pongCount++;let o=this.pongCount>4?.1:1/this.pongCount;this.averageLag+=o*(e-this.averageLag),this.pubsub.emit("socket.lag",this.averageLag)};this.handle=e=>{if(e.v&&this.version!==!1){if(e.v<=this.version){this.debug("already has event "+e.v);return}if(e.v>this.version+1)return y();this.version=e.v}switch(e.t||!1){case!1:break;case"resync":y();break;case"ack":this.ackable.onServerAck(e.d);break;default:this.settings.receive&&this.settings.receive(e.t,e.d)||(this.pubsub.emit("socket.in."+e.t,e.d,e),this.settings.events[e.t]&&this.settings.events[e.t](e.d||null,e))}};this.debug=(e,o=!1)=>{(o||this.options.debug)&&console.debug(e)};this.destroy=()=>{clearTimeout(this.pingSchedule),clearTimeout(this.connectSchedule),this.disconnect(),this.ws=void 0};this.disconnect=()=>{let e=this.ws;e&&(this.debug("Disconnect"),this.autoReconnect=!1,e.onerror=e.onclose=e.onopen=e.onmessage=()=>{},e.close())};this.onError=e=>{this.options.debug=!0,this.debug(`error: ${e} ${JSON.stringify(e)}`),this.tryOtherUrl=!0,clearTimeout(this.pingSchedule)};this.onSuccess=()=>{if(this.nbConnects++,this.nbConnects==1){f.resolveFirstConnect(this.send);let e;O(10*60*1e3,()=>{this.options.idle=!0,e=setTimeout(this.destroy,2*60*60*1e3)},()=>{this.options.idle=!1,this.ws?clearTimeout(e):location.reload()})}};this.baseUrl=()=>{let e=document.body.dataset.socketDomains.split(","),o=this.storage.get();return(!o||this.tryOtherUrl)&&(o=e[Math.floor(Math.random()*e.length)],this.storage.set(o)),o};this.pingInterval=()=>this.computePingDelay()+this.averageLag;this.getVersion=()=>this.version;this.settings={receive:n.receive,events:n.events||{},params:{...f.defaultParams,...n.params||{}}},this.options={...f.defaultOptions,...n.options||{}},this.version=o,this.pubsub.on("socket.send",this.send),this.connect()}};f.defaultOptions={idle:!1,pingMaxLag:9e3,pingDelay:2500,autoReconnectDelay:3500,protocol:location.protocol==="https:"?"wss:":"ws:",isAuth:document.body.hasAttribute("data-user")},f.defaultParams={sri:w},f.firstConnect=new Promise(e=>{f.resolveFirstConnect=e});var g=f,ce=class{constructor(e){this.send=e;this.currentId=1;this.messages=[];this.sign=e=>this._sign=e;this.resend=()=>{let e=performance.now()-2500;this.messages.forEach(o=>{o.at<e&&this.send(o.t,o.d,{sign:this._sign})})};this.register=(e,o)=>{o.a=this.currentId++,this.messages.push({t:e,d:o,at:performance.now()})};this.onServerAck=e=>{this.messages=this.messages.filter(o=>o.d.a!==e)};setInterval(this.resend,1200)}};var le=t=>{if(!window.Chessground)setTimeout(()=>le(t),200);else{let[e,o,n]=t.getAttribute("data-state").split(","),s={coordinates:!1,viewOnly:!0,fen:e,orientation:o,lastMove:L(n),drawable:{enabled:!1,visible:!1}},r=$(t).removeClass("mini-game--init"),i=r.find(".cg-wrap"),c=se(e);C(i[0],"chessground",window.Chessground(i[0],s)),["white","black"].forEach(l=>r.find(".mini-game__clock--"+l).each(function(){P(this,{time:parseInt(this.getAttribute("data-time")),pause:l!=c||!Ge(e,l)})}))}return t.getAttribute("data-live")},Ge=(t,e)=>e=="white"?!t.includes("PPPPPPPP/RNBQKBNR"):!t.startsWith("rnbqkbnr/pppppppp"),z=t=>{let e=Array.from((t||document).getElementsByClassName("mini-game--init")),o=e.map(le).filter(n=>n);o.length&&g.firstConnect.then(n=>n("startWatching",o.join(" ")))},de=(t,e)=>{let o=$(t),n=e.lm,s=F(t.querySelector(".cg-wrap"),"chessground");s&&s.set({fen:e.fen,lastMove:L(n)});let r=se(e.fen),i=(c,l)=>{var d;isNaN(c)||P((d=o[0])==null?void 0:d.querySelector(".mini-game__clock--"+l),{time:c,pause:l!=r||!Ge(e.fen,l)})};i(e.wc,"white"),i(e.bc,"black")},ue=(t,e)=>["white","black"].forEach(o=>{let n=$(t).find(".mini-game__clock--"+o);n.data("managed")||n.replaceWith(`<span class="mini-game__result">${e?e===o[0]?1:0:"\xBD"}</span>`)});function Je(t,e){if(e.length)if(t.includes("%s"))t=t.replace("%s",e[0]);else for(let o=0;o<e.length;o++)t=t.replace("%"+(o+1)+"$s",e[o]);return t}function Xe(t,e){let o=t.split(/(%(?:\d\$)?s)/g);if(e.length){let n=o.indexOf("%s");if(n!==-1)o[n]=e[0];else for(let s=0;s<e.length;s++){let r=o.indexOf("%"+(s+1)+"$s");r!==-1&&(o[r]=e[s])}}return o}var pe=t=>{let e=(o,...n)=>{let s=t[o];return s?Je(s,n):o};return e.pluralSame=(o,n,...s)=>e.plural(o,n,n,...s),e.plural=function(o,n,...s){let r=`${o}:${lichess.quantity(n)}`,i=t[r]||t[o];return i?Je(i,s):o},e.noarg=o=>t[o]||o,e.vdom=(o,...n)=>{let s=t[o];return s?Xe(s,n):[o]},e.vdomPlural=(o,n,...s)=>{let r=`${o}:${lichess.quantity(n)}`,i=t[r]||t[o];return i?Xe(i,s):[o]},e},k=pe(lichess.siteI18n);var Ht=[["nbYearsAgo","inNbYears",60*60*24*365,1],["nbMonthsAgo","inNbMonths",60*60*24*365/12,1],["nbWeeksAgo","inNbWeeks",60*60*24*7,1],["nbDaysAgo","inNbDays",60*60*24,2],["nbHoursAgo","inNbHours",60*60,1],["nbMinutesAgo","inNbMinutes",60,1],["nbSecondsAgo","inNbSeconds",1,9],["rightNow","justNow",1,0]],Ye=t=>t instanceof Date?t:new Date(isNaN(t)?t:parseInt(t)),Ze=t=>{let e=Math.abs(t),o=Ht.find(n=>e>=n[2]*n[3]);return k.pluralSame(o[t<0?1:0],Math.floor(e/o[2]))},Qe,he=()=>Qe=Qe||(window.Intl&&Intl.DateTimeFormat?new Intl.DateTimeFormat(document.documentElement.lang,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format:t=>t.toLocaleString()),et=t=>Ze((Date.now()-Ye(t).getTime())/1e3),me=t=>requestAnimationFrame(()=>{let e=Date.now();[].slice.call((t||document).getElementsByClassName("timeago"),0,99).forEach(o=>{let n=o.classList,s=n.contains("abs"),r=n.contains("set");if(o.lichessDate=o.lichessDate||Ye(o.getAttribute("datetime")),!r){let i=he()(o.lichessDate);s?o.textContent=i:o.setAttribute("title",i),n.add("set"),(s||n.contains("once"))&&n.remove("timeago")}if(!s){let i=(e-o.lichessDate.getTime())/1e3;o.textContent=Ze(i),Math.abs(i)>9999&&n.remove("timeago")}})}),fe=t=>{me(),setTimeout(()=>fe(t*1.1),t)};var T=(t,e)=>{window.requestIdleCallback?window.requestIdleCallback(t,e?{timeout:e}:void 0):requestAnimationFrame(t)},V=t=>/[&<>"']/.test(t)?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&quot;"):t;var G,ge=()=>{G&&clearTimeout(G),G=void 0,$("#announce").remove()},Nt=t=>{ge(),t.msg&&($("body").append('<div id="announce" class="announce">'+V(t.msg)+(t.date?'<time class="timeago" datetime="'+t.date+'"></time>':"")+'<div class="actions"><a class="close">\xD7</a></div></div>').find("#announce .close").on("click",ge),G=setTimeout(ge,t.date?new Date(t.date).getTime()-Date.now():5e3),t.date&&lichess.contentLoaded())},H=Nt;function tt(){$("#agreement form").on("submit",t=>{let e=t.target;return qe(e),e.parentNode.remove(),!1})}var E={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"};for(let t=1;t<20;++t)E[111+t]="f"+t;for(let t=0;t<=9;++t)E[t+96]=t.toString();var Rt={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Ut={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},Bt=t=>{if(t.type=="keypress"){let e=String.fromCharCode(t.which);return t.shiftKey?e:e.toLowerCase()}return E[t.which]||Rt[t.which]||String.fromCharCode(t.which).toLowerCase()},Ft=(t,e)=>t.sort().join(",")===e.sort().join(","),qt=t=>{let e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e},ot=t=>t=="shift"||t=="ctrl"||t=="alt"||t=="meta",Kt=(()=>{let t;return()=>{if(!t){t={};for(let e in E)parseInt(e,10)>95&&parseInt(e,10)<112||Object.prototype.hasOwnProperty.call(E,e)&&(t[E[e]]=e)}return t}})(),jt=(t,e,o)=>(o=o||(Kt()[t]?"keydown":"keypress"),o=="keypress"&&e.length?"keydown":o),zt=t=>t==="+"?["+"]:t.replace(/\+{2}/g,"+plus").split("+"),Wt=(t,e)=>{let o,n=[];for(o of zt(t))o=Ut[o]||o,ot(o)&&n.push(o);return{key:o,modifiers:n,action:jt(o,n,e)}},_=class{constructor(e){this.bindings={};this.bind=(e,o,n)=>(this.bindMultiple(e instanceof Array?e:[e],o,n),this);this.bindMultiple=(e,o,n)=>{for(let s of e)this.bindSingle(s,o,n)};this.bindSingle=(e,o,n)=>{let s=Wt(e,n);(this.bindings[s.key]=this.bindings[s.key]||[]).push({combination:e,callback:o,modifiers:s.modifiers,action:s.action})};this.handleKeyEvent=e=>{typeof e.which!="number"&&(e.which=e.keyCode);let o=e.target;for(let n of this.getMatches(e))(n.combination=="esc"||o.tagName!="INPUT"&&o.tagName!="SELECT"&&o.tagName!="TEXTAREA"&&!o.isContentEditable)&&(n.callback(e),e.preventDefault(),e.stopPropagation())};this.getMatches=e=>{let o=Bt(e),n=e.type,s=n=="keyup"&&ot(o)?[o]:qt(e);return(this.bindings[o]||[]).filter(r=>n==r.action&&(n=="keypress"&&!e.metaKey&&!e.ctrlKey||Ft(s,r.modifiers)))};e=e||document,e.addEventListener("keypress",o=>this.handleKeyEvent(o)),e.addEventListener("keydown",o=>this.handleKeyEvent(o)),e.addEventListener("keyup",o=>this.handleKeyEvent(o))}};var nt='<div class="spinner" aria-label="loading"><svg viewBox="-2 -2 54 54"><g mask="url(#mask)" fill="none"><path id="a" stroke-width="3.779" d="m21.78 12.64c-1.284 8.436 8.943 12.7 14.54 17.61 3 2.632 4.412 4.442 5.684 7.93"/><path id="b" stroke-width="4.157" d="m43.19 36.32c2.817-1.203 6.659-5.482 5.441-7.623-2.251-3.957-8.883-14.69-11.89-19.73-0.4217-0.7079-0.2431-1.835 0.5931-3.3 1.358-2.38 1.956-5.628 1.956-5.628"/><path id="c" stroke-width="4.535" d="m37.45 2.178s-3.946 0.6463-6.237 2.234c-0.5998 0.4156-2.696 0.7984-3.896 0.6388-17.64-2.345-29.61 14.08-25.23 27.34 4.377 13.26 22.54 25.36 39.74 8.666"/></g></svg></div>';var it=t=>{var e;return(e=document.querySelector(".crosstable"))==null?void 0:e.contains(t)},at=(t,e)=>o=>{let n=($(o).data("href")||o.href).replace(/\?.+$/,"");e&&e(n),v(n+"/mini").then(s=>{let r=document.getElementById(t);r.innerHTML=s,lichess.contentLoaded(r)})},be=(t,e)=>`<a class="btn-rack__btn" href="${t}" data-icon="${e}"></a>`,ve=(t,e)=>$(t).removeClass("ulpt").powerTip({preRender:at("powerTip",o=>{let n=o.slice(3),s=$(t).data("name")||$(t).html();$("#powerTip").html('<div class="upt__info"><div class="upt__info__top"><span class="user-link offline">'+s+'</span></div></div><div class="upt__actions btn-rack">'+be("/@/"+n+"/tv",B)+be("/inbox/new?user="+n,Ie)+be("/?user="+n+"#friend",Le)+'<a class="btn-rack__btn relation-button" disabled></a></div>')}),placement:e||t.getAttribute("data-pt-pos")||(it(t)?"n":"s")}),xe=t=>$(t).removeClass("glpt").powerTip({preRender:at("miniGame",()=>lichess.spinnerHtml),placement:it(t)?"n":"w",popupId:"miniGame"});function st(t,e,o){"ontouchstart"in window||(o(t),$.powerTip.show(t,e))}function rt(t,e,o){T(()=>Array.prototype.forEach.call(t.querySelectorAll(e),n=>o(n)),800)}var Vt={watchMouse(){document.body.addEventListener("mouseover",t=>{let e=t.target;e.classList.contains("ulpt")?st(e,t,ve):e.classList.contains("glpt")&&st(e,t,xe)})},manualGameIn(t){rt(t,".glpt",xe)},manualGame:xe,manualUser:ve,manualUserIn(t){rt(t,".ulpt",ve)}},J=Vt;var ct=()=>window.matchMedia("(prefers-color-scheme: light)").media!=="not all";var b=(t,e={})=>{e=e||{};let o=e.sameDomain?"":document.body.getAttribute("data-asset-url"),n=e.version||document.body.getAttribute("data-asset-version");return o+"/assets"+(e.noVersion?"":"/_"+n)+"/"+t},we=new Map,X=(t,e)=>{if(!we.has(t)){let o=document.createElement("link");o.rel="stylesheet",o.href=b(t),e&&(o.media=`(prefers-color-scheme: ${e})`),we.set(t,new Promise(n=>{o.onload=()=>n()})),document.head.append(o)}return we.get(t)},S=async t=>{let e=$("body").data("theme"),o=(n,s)=>X(`css/${t}.${document.dir||"ltr"}.${n}.${$("body").data("dev")?"dev":"min"}.css`,s);e==="system"?ct()?(await o("dark","dark"),await o("light","light")):await o("dark"):await o(e)},N=t=>`compiled/${t}${$("body").data("dev")?"":".min"}.js`,ye=new Map,ke=(t,e={})=>(ye.has(t)||ye.set(t,Ue(b(t,e))),ye.get(t));async function x(t,e){let o=await import(b(N(t),e==null?void 0:e.url));return o.initModule?o.initModule(e==null?void 0:e.init):o.default(e==null?void 0:e.init)}var Q=async t=>(S("complete"),x("userComplete",{init:t})),lt=()=>(X("vendor/hopscotch/dist/css/hopscotch.min.css"),ke("vendor/hopscotch/dist/js/hopscotch.min.js",{noVersion:!0}));var Y=Object.create(null),Gt={on(t,e){(Y[t]=Y[t]||[]).push(e)},off(t,e){let o=Y[t];if(o){for(let n in o)if(o[n]===e){o.splice(+n);break}}},emit(t,...e){for(let o of Y[t]||[])o.apply(null,e)}},u=Gt;var Z=()=>/iPhone|iPod/.test(navigator.userAgent)||Xt(),Xt=()=>(navigator==null?void 0:navigator.maxTouchPoints)>2&&/iPad|Macintosh/.test(navigator.userAgent),Ln=Re(()=>window.matchMedia("(hover: hover) and (pointer: fine)").matches);var Qt=[8,1,-8,-1],Yt=[9,-9,7,-7],Hn=Qt.concat(Yt);var dt=t=>({P:"pawn",N:"knight",B:"bishop",R:"rook",Q:"queen",K:"king"})[t];var ut=new class{constructor(){this.soundSetSounds=new Map;this.standaloneSounds=new Map;this.soundSet=$("body").data("sound-set");this.speechStorage=h.boolean("speech.enabled");this.volumeStorage=h.make("sound-volume");this.baseUrl=b("sound",{version:"_____1"});this.loadOggOrMp3=(t,e,o=!1)=>(o?this.standaloneSounds:this.soundSetSounds).set(t,new Howl({src:["ogg","mp3"].map(n=>`${e}.${n}`)}));this.loadStandard=(t,e)=>{if(!this.enabled())return;let o=t[0].toUpperCase()+t.slice(1);this.loadOggOrMp3(t,`${this.baseUrl}/${e||this.soundSet}/${o}`)};this.getOrLoadSound=(t,e)=>{var n;let o=(n=this.soundSetSounds.get(t))!=null?n:this.standaloneSounds.get(t);return o||(this.loadStandard(t,e),o=this.soundSetSounds.get(t)),o};this.setVolume=this.volumeStorage.set;this.getVolume=()=>{let t=parseFloat(this.volumeStorage.get()||"");return t>=0?t:.7};this.enabled=()=>this.soundSet!=="silent";this.speech=t=>(t!==void 0&&this.speechStorage.set(t),this.speechStorage.get());this.say=(t,e=!1,o=!1,n=!1)=>{try{if(e&&speechSynthesis.cancel(),!this.speechStorage.get()&&!o)return!1;let s=new SpeechSynthesisUtterance(t);return s.volume=this.getVolume(),s.lang=n?document.documentElement.lang:"en-US",Z()||(s.onstart=r=>lichess.mic.pause(),s.onend=s.onerror=r=>lichess.mic.resume()),speechSynthesis.speak(s),!0}catch(s){return console.error(s),!1}};this.sayOrPlay=(t,e)=>this.say(e)||this.play(t);this.publish=()=>u.emit("sound_set",this.soundSet);this.changeSet=t=>{this.soundSet=t,this.soundSetSounds.clear(),this.publish()};this.set=()=>this.soundSet;this.soundSet=="music"&&setTimeout(this.publish,500)}preloadBoardSounds(){this.soundSet!=="music"&&["move","capture","check","genericNotify"].forEach(t=>this.loadStandard(t))}play(t,e){var r;if(!this.enabled())return;let o=this.soundSet;if(o==="music"||this.speechStorage.get()){if(["move","capture","check"].includes(t))return;o="standard"}let n=this.getOrLoadSound(t,o),s=()=>n.volume(this.getVolume()*(e||1)).play();((r=Howler.ctx)==null?void 0:r.state)==="suspended"?Howler.ctx.resume().then(s):s()}playOnce(t){let e=()=>{let o=lichess.storage.make("just-played");Date.now()-parseInt(o.get(),10)<2e3||(o.set(""+Date.now()),this.play(t))};document.hasFocus()?e():setTimeout(e,10+Math.random()*500)}saySan(t,e){let o=t?t.includes("O-O-O#")?"long castle checkmate":t.includes("O-O-O+")?"long castle check":t.includes("O-O-O")?"long castle":t.includes("O-O#")?"short castle checkmate":t.includes("O-O+")?"short castle check":t.includes("O-O")?"short castle":t.split("").map(n=>{if(n=="x")return"takes";if(n=="+")return"check";if(n=="#")return"checkmate";if(n=="=")return"promotes to";if(n=="@")return"at";let s=n.charCodeAt(0);return s>48&&s<58?n:s>96&&s<105?n.toUpperCase():dt(n)||n}).join(" ").replace(/^A /,"A, ").replace(/(\d) E (\d)/,"$1,E $2").replace(/C /,"c ").replace(/F /,"f ").replace(/(\d) H (\d)/,"$1H$2"):"Game start";this.say(o,e)}};async function pt(t){let e=t.store,o=await Zt(t);function n(s){return new Promise((r,i)=>{let c=s();c.onsuccess=l=>r(l.target.result),c.onerror=l=>i(l.target.result)})}return{get(s){let r=o.transaction(e,"readonly").objectStore(e);return n(r.get.bind(r,s))},put(s,r){let i=o.transaction(e,"readwrite").objectStore(e);return n(i.put.bind(i,r,s))},count(s){let r=o.transaction(e,"readonly").objectStore(e);return n(r.count.bind(r,s))},remove(s){let r=o.transaction(e,"readwrite").objectStore(e);return n(r.delete.bind(r,s))},clear(){let s=o.transaction(e,"readwrite").objectStore(e);return n(s.clear.bind(s))},txn(s){return o.transaction(e,s)}}}async function Zt(t){let e=(t==null?void 0:t.db)||`${t.store}--db`;return new Promise((o,n)=>{var s;let r=window.indexedDB.open(e,(s=t==null?void 0:t.version)!==null&&s!==void 0?s:1);r.onsuccess=i=>o(i.target.result),r.onerror=i=>{var c;return n((c=i.target.result)!==null&&c!==void 0?c:"IndexedDB Unavailable")},r.onupgradeneeded=i=>{var c;let l=i.target.result,d=i.target.transaction,p=l.objectStoreNames.contains(t.store)?d.objectStore(t.store):l.createObjectStore(t.store);(c=t.upgrade)===null||c===void 0||c.call(t,i,p)}})}var ee=class{constructor(){this.group=new Map,this.key=!1}set ctx(e){var o,n,s,r;this.context!==e&&((n=(o=this.selected)===null||o===void 0?void 0:o.deselect)===null||n===void 0||n.call(o,this.context),this.context=e,(r=(s=this.selected)===null||s===void 0?void 0:s.select)===null||r===void 0||r.call(s,this.context))}get selected(){return this.key?this.group.get(this.key):void 0}select(e){var o,n,s,r;if(this.key){if(this.key===e)return;(n=(o=this.selected)===null||o===void 0?void 0:o.deselect)===null||n===void 0||n.call(o,this.context)}this.key=e,(r=(s=this.selected)===null||s===void 0?void 0:s.select)===null||r===void 0||r.call(s,this.context)}get(e){return this.group.get(e)}set(e,o){let n=this.key===e;this.close(e),this.group.set(e,o),n&&this.select(e)}close(e){var o,n,s,r;if(e===void 0){for(let i of this.group.keys())this.close(i);return}e===this.key&&((n=(o=this.group.get(e))===null||o===void 0?void 0:o.deselect)===null||n===void 0||n.call(o,this.context),this.key=!1),(r=(s=this.group.get(e))===null||s===void 0?void 0:s.close)===null||r===void 0||r.call(s,this.context)}delete(e){this.close(e),e?this.group.delete(e):this.group.clear()}};function eo(t,e,o,n){let s="analyse."+t,r;return function(i){if(M(i)&&i!=r)r=i,lichess.storage.set(t,n(i));else if(!M(r)){let c=lichess.storage.get(s);I(c)&&(lichess.storage.set(t,c),lichess.storage.remove(s));let l=lichess.storage.get(t);r=l===null?e:o(l)}return r}}var ht=(t,e)=>eo(t,e,o=>o,o=>o);var Te=class{constructor(e,o){this.listenerMap=new Map;this.words=e,this.partial=o}select(e){!(e!=null&&e.source)||!this.node||(e.source.connect(this.node),this.node.connect(e.ctx.destination))}deselect(){var e;(e=this.node)==null||e.disconnect()}close(){this.node=void 0}get listeners(){return[...this.listenerMap.values()].reverse()}},ft=new class{constructor(){this.language="en";this.deviceId=ht("voice.micDeviceId","default");this.recs=new ee;this.recId="default";this.voskStatus="";this.busy=!1;this.interrupt=!1;this.paused=0}get lang(){return this.language}setLang(t){t!==this.language&&(this.stop(),this.language=t)}async getMics(){return navigator.mediaDevices.enumerateDevices().then(t=>t.filter(e=>e.kind=="audioinput"))}get micId(){return this.deviceId()}setMic(t){var o;let e=this.isListening;lichess.mic.stop(),this.deviceId(t),this.recs.close(),(o=this.audioCtx)==null||o.close(),this.audioCtx=void 0,e&&this.start()}setController(t){this.ctrl=t,this.ctrl("","status")}addListener(t,e={}){var n,s;let o=(n=e.recId)!=null?n:"default";if(!this.recs.group.has(o))throw`No recognizer for '${o}'`;this.recs.group.get(o).listenerMap.set((s=e.listenerId)!=null?s:o,t)}removeListener(t){this.recs.group.forEach(e=>e.listenerMap.delete(t))}initRecognizer(t,e={}){var s,r;if(t.length===0){this.recs.delete(e.recId);return}let o=(s=e.recId)!=null?s:"default",n=new Te(t.slice(),e.partial===!0);(r=this.vosk)!=null&&r.isLoaded(this.lang)&&this.initKaldi(o,n),this.recs.set(o,n),e.listener&&this.addListener(e.listener,{recId:o,listenerId:e.listenerId})}setRecognizer(t="default"){var e;this.recId=t,this.isListening&&(this.recs.select(t),(e=this.vosk)==null||e.select(t))}async start(t=!0){var e;try{if(t&&this.isListening&&this.recId===this.recs.key)return;this.busy=!0,await this.initModel();for(let[o,n]of this.recs.group)this.initKaldi(o,n);this.recs.select(t&&this.recId),(e=this.vosk)==null||e.select(t&&this.recId),this.micTrack.enabled=t,this.busy=!1,this.broadcast(t?"Listening...":"","start")}catch(o){throw this.stop([o.toString(),"error"]),o}}stop(t=["","stop"]){var e,o;this.micTrack&&(this.micTrack.enabled=!1),(e=this.download)==null||e.abort(),this.download=void 0,this.busy=!1,this.recs.select(!1),(o=this.vosk)==null||o.select(!1),this.broadcast(...t)}pause(){var t;++this.paused!==1||!((t=this.micTrack)!=null&&t.enabled)||(this.micTrack.enabled=!1)}resume(){this.paused=Math.min(this.paused-1,0),!(this.paused!==0||this.micTrack===void 0)&&(this.micTrack.enabled=!!this.recs.selected)}get isListening(){var t;return!!this.recs.selected&&!!((t=this.micTrack)!=null&&t.enabled)&&!this.isBusy}get isBusy(){return this.busy}get status(){return this.voskStatus}stopPropagation(){this.interrupt=!0}get micTrack(){var t;return(t=this.mediaStream)==null?void 0:t.getAudioTracks()[0]}initKaldi(t,e){var o;e.node||(e.node=(o=this.vosk)==null?void 0:o.initRecognizer({recId:t,audioCtx:this.audioCtx,partial:e.partial,words:e.words,broadcast:this.broadcast.bind(this)}))}async initModel(){var n,s;if((n=this.vosk)!=null&&n.isLoaded(this.lang)){await this.initAudio();return}this.broadcast("Loading...");let t=lichess.assetUrl(mt.get(this.lang),{noVersion:!0}),e=this.downloadModel(`/vosk/${t.replace(/[\W]/g,"_")}`),o=this.initAudio();(s=this.vosk)!=null||(this.vosk=await lichess.loadEsm("voice.vosk")),await e,await this.vosk.initModel(t,this.lang),await o}async initAudio(){var t,e;if(((t=this.audioCtx)==null?void 0:t.state)==="suspended"&&await this.audioCtx.resume(),((e=this.audioCtx)==null?void 0:e.state)!=="running"){if(this.audioCtx)throw`Error ${this.audioCtx.state}`;this.mediaStream=await navigator.mediaDevices.getUserMedia({video:!1,audio:{sampleRate:{ideal:16e3},echoCancellation:{ideal:!0},noiseSuppression:{ideal:!0},deviceId:this.micId}}),this.audioCtx=new AudioContext({sampleRate:this.mediaStream.getAudioTracks()[0].getSettings().sampleRate}),this.micSource=this.audioCtx.createMediaStreamSource(this.mediaStream),this.recs.ctx={vosk:this.vosk,source:this.micSource,ctx:this.audioCtx}}}broadcast(t,e="status",o=0){var n,s,r;(n=this.ctrl)==null||n.call(this,t,e),(e==="status"||e==="full")&&window.clearTimeout(this.broadcastTimeout),this.voskStatus=t;for(let i of(r=(s=this.recs.get(this.recId))==null?void 0:s.listeners)!=null?r:[])this.interrupt||i(t,e);this.interrupt=!1,this.broadcastTimeout=o>0?window.setTimeout(()=>this.broadcast(""),o):void 0}async downloadModel(t){let e=await pt({db:"/vosk",store:"FILE_DATA",version:21,upgrade:(s,r)=>{r==null||r.createIndex("timestamp","timestamp",{unique:!1})}});if(await e.count(`${t}/extracted.ok`)>0)return;let o=await new Promise((s,r)=>{this.download=new XMLHttpRequest,this.download.open("GET",lichess.assetUrl(mt.get(this.lang),{noVersion:!0}),!0),this.download.responseType="arraybuffer",this.download.onerror=i=>r("Failed. See console"),this.download.onabort=i=>r("Aborted"),this.download.onprogress=i=>{this.broadcast(i.total<=0?"Downloading...":`Downloaded ${Math.round(100*i.loaded/i.total)}% of ${Math.round(i.total/1e6)}MB`)},this.download.onload=i=>{var c,l,d;((c=this.download)==null?void 0:c.status)!==200?r(`${(l=this.download)==null?void 0:l.status} Failed`):s((d=this.download)==null?void 0:d.response)},this.download.send()});this.broadcast("Extracting...");let n=new Date;await e.put(t,{timestamp:n,mode:16877}),await e.put(`${t}/downloaded.ok`,{contents:new Uint8Array([]),timestamp:n,mode:33206}),await e.remove(`${t}/downloaded.tar.gz`),await e.put(`${t}/downloaded.tar.gz`,{contents:new Uint8Array(o),timestamp:n,mode:33188}),e.txn("readwrite").objectStore("FILE_DATA").index("timestamp")}},mt=new Map([["ca","lifat/vosk/model-ca-0.4.tar.gz"],["cn","lifat/vosk/model-cn-0.22.tar.gz"],["cs","lifat/vosk/model-cs-0.4.tar.gz"],["de","lifat/vosk/model-de-0.15.tar.gz"],["en","lifat/vosk/model-en-us-0.15.tar.gz"],["eo","lifat/vosk/model-eo-0.42.tar.gz"],["es","lifat/vosk/model-es-0.42.tar.gz"],["fa","lifat/vosk/model-fa-0.4.tar.gz"],["fr","lifat/vosk/model-fr-0.22.tar.gz"],["hi","lifat/vosk/model-hi-0.22.tar.gz"],["it","lifat/vosk/model-it-0.22.tar.gz"],["ja","lifat/vosk/model-ja-0.22.tar.gz"],["ko","lifat/vosk/model-ko-0.22.tar.gz"],["kz","lifat/vosk/model-kz-0.15.tar.gz"],["nl","lifat/vosk/model-nl-0.22.tar.gz"],["pl","lifat/vosk/model-pl-0.22.tar.gz"],["pt","lifat/vosk/model-pt-0.3.tar.gz"],["ru","lifat/vosk/model-ru-0.22.tar.gz"],["tr","lifat/vosk/model-tr-0.3.tar.gz"],["uk","lifat/vosk/model-uk-v3.tar.gz"],["uz","lifat/vosk/model-uz-0.22.tar.gz"],["vi","lifat/vosk/model-vi-0.4.tar.gz"]]);var Se,to=t=>t.includes(" ")?t.split(" ")[1]:t;function R(t){let e=$(t);if(e.data("watched"))return;e.data("watched",1);let o=$('<div class="chat__members__inner">').appendTo(e),n=$(`<div class="chat__members__number" data-icon="${De}" title="Spectators"></div>`).appendTo(o),s=$("<div>").appendTo(o);lichess.pubsub.on("socket.in.crowd",i=>r(i.watchers||i));let r=i=>{if(Se=i,!i||!i.nb){e.addClass("none");return}if(n.text(""+i.nb),i.users){let c=i.users.map(l=>l||"").join(";");if(s.data("prevUsers")!==c){s.data("prevUsers",c);let l=i.users.map(d=>d?`<a class="user-link ulpt" href="/@/${to(d)}">${d}</a>`:"Anonymous");i.anons===1?l.push("Anonymous"):i.anons&&l.push(`Anonymous (${i.anons})`),s.html(l.join(", "))}}else s.html("");e.removeClass("none")};Se&&r(Se)}var gt=()=>{let t=window.lichess;t.StrongSocket=g,t.mousetrap=new _(document),t.requestIdleCallback=T,t.sri=w,t.storage=h,t.tempStorage=Ve,t.once=D,t.powertip=J,t.clockWidget=P,t.spinnerHtml=nt,t.assetUrl=b,t.loadCss=X,t.loadCssPath=S,t.jsModule=N,t.loadIife=ke,t.loadEsm=x,t.hopscotch=lt,t.userComplete=Q,t.idleTimer=O,t.pubsub=u,t.unload=ae,t.redirect=ze,t.reload=y,t.watchers=R,t.escapeHtml=V,t.announce=H,t.trans=pe,t.sound=ut,t.mic=ft,t.miniBoard=K,t.miniGame=W,t.timeago=et,t.dateFormat=he,t.contentLoaded=e=>u.emit("content-loaded",e),t.blindMode=document.body.classList.contains("blind-mode"),t.makeChat=e=>lichess.loadEsm("chat",{init:{el:document.querySelector(".mchat"),...e}})};console.info("Lichess is open source! https://lichess.org/source");var oo=a,bt=oo;var U=class{constructor(e){this.el=e;this.loaded=!1;this.receive=(e,o)=>{this.users.clear(),e.forEach(this.insert),o.playing.map(n=>this.users.get(n)).filter(I).forEach(n=>n.playing=!0),o.patrons.map(n=>this.users.get(n)).filter(I).forEach(n=>n.patron=!0),this.repaint()};this.repaint=()=>{this.loaded&&requestAnimationFrame(()=>{var o;let e=Array.from(this.users.keys()).sort();this.titleEl.innerHTML=k.pluralSame("nbFriendsOnline",e.length,this.loaded?`<strong>${e.length}</strong>`:"-"),(o=this.el.querySelector(".nobody"))==null||o.classList.toggle("none",!!e[0]),this.el.querySelector(".list").innerHTML=e.map(n=>this.renderFriend(this.users.get(n))).join("")})};this.renderFriend=e=>{let o=`<i class="line${e.patron?" patron":""}"></i>`,n=e.title?`<span class="utitle"${e.title==="BOT"?" data-bot":""}>${e.title}</span>&nbsp;`:"",s="/@/"+e.name,r=e.playing?`<a data-icon="${B}" class="tv ulpt" data-pt-pos="nw" href="${s}/tv" data-href="${s}"></a>`:"";return`<div><a class="user-link ulpt" data-pt-pos="nw" href="${s}">${o}${n}${e.name}</a>${r}</div>`};this.enters=(e,o)=>{let n=this.insert(e);n.playing=o.playing,n.patron=o.patron,this.repaint()};this.leaves=e=>{this.users.delete(this.getId(e)),this.repaint()};this.playing=e=>{this.insert(e).playing=!0,this.repaint()};this.stopped_playing=e=>{this.insert(e).playing=!1,this.repaint()};this.insert=e=>{let o=this.getId(e);return this.users.has(o)||this.users.set(o,this.toFriend(e)),this.users.get(o)};this.getId=e=>e.toLowerCase().replace(/^\w+\s/,"");this.toFriend=e=>{let o=e.split(" ");return{id:o[o.length-1].toLowerCase(),name:o[o.length-1],title:o.length>1?o[0]:void 0,playing:!1,patron:!1}};this.titleEl=this.el.querySelector(".friend_box_title"),this.titleEl.addEventListener("click",()=>{var o;(o=this.el.querySelector(".content_wrap"))==null||o.classList.toggle("none"),this.loaded||(this.loaded=!0,u.emit("socket.send","following_onlines"))}),this.users=new Map,u.on("socket.in.following_onlines",this.receive),["enters","leaves","playing","stopped_playing"].forEach(o=>u.on("socket.in.following_"+o,this[o]))}};async function vt(){var r;if(!("serviceWorker"in navigator&&"Notification"in window&&"PushManager"in window))return;let t=new URL(b(N("serviceWorker"),{sameDomain:!0}),self.location.href);t.searchParams.set("asset-url",document.body.getAttribute("data-asset-url")),document.body.getAttribute("data-dev")&&t.searchParams.set("dev","1");let e=document.body.getAttribute("data-dev")?"none":"all",o=await navigator.serviceWorker.register(t.href,{scope:"/",updateViaCache:e}),n=h.make("push-subscribed"),s=document.body.getAttribute("data-vapid");if(s&&Notification.permission=="granted"){let i=await o.pushManager.getSubscription(),c=parseInt(n.get()||"0",10)+432e5<Date.now(),l=Uint8Array.from(atob(s),d=>d.charCodeAt(0));if(!i||c){let d=await o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l});try{let p=await fetch("/push/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});p.ok&&!p.redirected?n.set(""+Date.now()):d.unsubscribe()}catch(p){console.log("push subscribe failed",p.message),d==null||d.unsubscribe()}}}else n.remove(),(r=await o.pushManager.getSubscription())==null||r.unsubscribe()}function xt(){let t=`<div class="initiating">${lichess.spinnerHtml}</div>`,e=o=>{let n=document.querySelector(o),s=n&&window.getComputedStyle(n).display;return s&&s!="none"};"ontouchstart"in window&&!window.matchMedia("(max-width: 979px)").matches&&$("#topnav > section > a").removeAttr("href"),$("#topnav-toggle").on("change",o=>document.body.classList.toggle("masked",o.target.checked)),$("#top").on("click",".toggle",function(){let o=$(this).parent().toggleClass("shown");return o.siblings(".shown").removeClass("shown"),setTimeout(()=>{let n=s=>{var r;(r=o[0])!=null&&r.contains(s.target)||(o.removeClass("shown"),$("html").off("click",n))};$("html").on("click",n)},10),!1});{let o,n=$("#challenge-toggle"),s=n.find("span");n.one("mouseover click",()=>r());let r=function(i){if(o)return;let c=$("#challenge-app").html(t);S("challenge"),o=x("challenge",{init:{el:c[0],data:i,show(){e("#challenge-app")||n.trigger("click")},setCount(l){let d=s.attr("title").replace(/\d+/,l.toString());s.data("count",l).attr("title",d).attr("aria-label",d)},pulse(){n.addClass("pulse")}}})};u.on("socket.in.challenges",async i=>{o?(await o).update(i):r(i)}),u.on("challenge-app.open",()=>n.trigger("click"))}{let o,n=$("#notify-toggle"),s=n.find("span"),r="#notify-app",i=c=>{if(o)return;let l=$("#notify-app").html(t);S("notify"),o=x("notify",{init:{el:l.empty()[0],data:c,isVisible:()=>e(r),updateUnread(d){let p=s.data("count")||0;d=="increment"&&(d=p+1),this.isVisible()&&(d=0);let Ce=s.attr("title").replace(/\d+/,d.toString());return s.data("count",d).attr("title",Ce).attr("aria-label",Ce),d&&d!=p},show(){e(r)||n.trigger("click")},setNotified(){lichess.socket.send("notified")},pulse(){n.addClass("pulse")}}})};n.one("mouseover click",()=>i()).on("click",()=>{"Notification"in window&&Notification.requestPermission(),setTimeout(async()=>{o&&e(r)&&(await o).onShow()},200)}),u.on("socket.in.notifications",async c=>{o?(await o).update(c):i(c)}),u.on("notify-app.set-read",async c=>{o?(await o).setMsgRead(c):i()})}$("#top .dasher .toggle").one("mouseover click",function(){$(this).removeAttr("href"),S("dasher"),x("dasher")});{let o=$("#clinput");if(!o.length)return;let n=o.find("input"),s=!1,r=()=>{s||(s=!0,x("cli",{init:{input:n[0]}}).catch(()=>s=!1))};n.on({blur(){n.val(""),$("body").removeClass("clinput")},focus(){r(),$("body").addClass("clinput")}}),o.find("a").on({mouseover:r,click(){$("body").hasClass("clinput")?n[0].blur():n[0].focus()}}),lichess.mousetrap.bind("/",()=>{n.val("/"),n[0].focus()}).bind("s",()=>n[0].focus())}}var wt="modal-overlay";function m(t){m.close();let e=$(`<div id="modal-wrap"><span class="close" role="button" aria-label="Close" data-icon="${Ae}" tabindex="0"></span></div>`),o=$(`<div id="${wt}" class="${t.class}">`);return t.noClickAway||o.on("click",m.close),$('<a href="#"></a>').appendTo(o),e.appendTo(o),$('<a href="#"></a>').appendTo(o),t.content.clone().removeClass("none").appendTo(e),t.onInsert&&t.onInsert(e),m.onClose=t.onClose,e.find(".close,.cancel").each(function(){no(this,m.close)}),$("body").addClass("overlayed").prepend(o),so(e),e}m.close=()=>{$("body").removeClass("overlayed"),$(`#${wt}`).each(function(){m.onClose&&m.onClose(),$(this).remove()}),delete m.onClose};m.onClose=void 0;var no=(t,e)=>{t.addEventListener("click",e),t.addEventListener("keydown",o=>o.code==="Enter"||o.code==="Space"?e():!0)},so=t=>{t.on("click",e=>e.stopPropagation()),ro(t)},yt='button:not(:disabled), [href], input:not(:disabled):not([type="hidden"]), select:not(:disabled), textarea:not(:disabled), [tabindex="0"]';function kt(t){var e;let o=$("#modal-wrap")[0];if(!o)return;let n=o.compareDocumentPosition(t.target);if(n&Node.DOCUMENT_POSITION_CONTAINED_BY)return;let s=$(o).find(yt),r=n&Node.DOCUMENT_POSITION_FOLLOWING?0:s.length-1;(e=s.get(r))===null||e===void 0||e.focus(),t.preventDefault()}var ro=t=>{let e=t.find(yt);setTimeout(()=>{var o,n;return(n=(o=e[1])!==null&&o!==void 0?o:e[0])===null||n===void 0?void 0:n.focus()})};gt();lichess.info=bt;lichess.load.then(()=>{$("#user_tag").removeAttr("href"),requestAnimationFrame(()=>{q(),z(),u.on("content-loaded",q),u.on("content-loaded",z),fe(1e3),u.on("content-loaded",me)}),T(()=>{let t=document.getElementById("friend_box");t&&new U(t);let e=document.querySelector(".chat__members");if(e&&R(e),$("#main-wrap").on("click",".autoselect",function(){this.select()}).on("click","button.copy",function(){let n=()=>$(this).attr("data-icon",Ee);return $("#"+$(this).data("rel")).each(function(){try{navigator.clipboard.writeText(this.value).then(n)}catch(s){console.error(s)}}),!1}),$("body").on("click","a.relation-button",function(){let n=$(this).addClass("processing").css("opacity",.3);return v(this.href,{method:"post"}).then(s=>{s.includes("relation-actions")?n.parent().replaceWith(s):n.replaceWith(s)}),!1}),$(".mselect .button").on("click",function(){let n=$(this).parent();n.toggleClass("shown"),T(()=>{let s=r=>{n[0].contains(r.target)||(n.removeClass("shown"),$("html").off("click",s))};$("html").on("click",s)},200)}),J.watchMouse(),setTimeout(()=>{lichess.socket||(lichess.socket=new g("/socket/v5",!1))},300),xt(),window.addEventListener("resize",()=>document.body.dispatchEvent(new Event("chessground.resize"))),$(".user-autocomplete").each(function(){let n=!!this.autofocus,s=()=>Q({input:this,friend:$(this).data("friend"),tag:$(this).data("tag"),focus:n});n?s():$(this).one("focus",s)}),$("input.confirm, button.confirm").on("click",function(){return confirm(this.title||"Confirm this action?")}),$("#main-wrap").on("click","a.bookmark",function(){let n=$(this).toggleClass("bookmarked");v(this.href,{method:"post"});let s=(parseInt(n.text(),10)||0)+(n.hasClass("bookmarked")?1:-1);return n.find("span").html(""+(s>0?s:"")),!1}),$("body").on("focusin",kt),lichess.mousetrap.bind("esc",()=>{let n=$("#modal-wrap .close");if(n.length)n.trigger("click");else{let s=$(":focus");s.length&&s.trigger("blur")}}),navigator.userAgent.includes("Edge/")&&setTimeout(()=>{let n=document.getElementById("piece-sprite");n.href=n.href.replace(".css",".external.css")},1e3),Z()&&!("MSStream"in window)){let n=document.querySelector("meta[name=viewport]");n.setAttribute("content",n.getAttribute("content")+",maximum-scale=1.0")}location.hash==="#blind"&&!lichess.blindMode&&v("/toggle-blind-mode",{method:"post",body:Be({enable:1,redirect:"/"})}).then(y);let o=document.body.getAttribute("data-announce");o&&H(JSON.parse(o)),tt(),vt(),u.on("socket.in.redirect",n=>{lichess.unload.expected=!0,lichess.redirect(n)}),u.on("socket.in.fen",n=>document.querySelectorAll(".mini-game-"+n.id).forEach(s=>de(s,n))),u.on("socket.in.finish",n=>document.querySelectorAll(".mini-game-"+n.id).forEach(s=>ue(s,n.win))),u.on("socket.in.announce",H),u.on("socket.in.tournamentReminder",n=>{if($("#announce").length||$("body").data("tournament-id")==n.id)return;let s="/tournament/"+n.id;$("body").append($('<div id="announce">').append($(`<a data-icon="${Oe}" class="text">`).attr("href",s).text(n.name)).append($('<div class="actions">').append($(`<a class="withdraw text" data-icon="${Pe}">`).attr("href",s+"/withdraw").text(k("pause")).on("click",function(){return v(this.href,{method:"post"}),$("#announce").remove(),!1})).append($(`<a class="text" data-icon="${$e}">`).attr("href",s).text(k("resume")))))})},800)});
