;
(self.AMP=self.AMP||[]).push({m:0,v:"2307212240000",n:"amp-subscriptions",ev:"0.1",l:!0,f:function(t,n){!function(){function n(t,n){(null==n||n>t.length)&&(n=t.length);for(var i=0,r=new Array(n);i<n;i++)r[i]=t[i];return r}function i(t,i){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,i){if(t){if("string"==typeof t)return n(t,i);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,i):void 0}}(t))||i&&t&&"number"==typeof t.length){r&&(t=r);var s=0;return function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r;function s(){return r||(r=Promise.resolve(void 0))}var e=function(){var t=this;this.promise=new Promise((function(n,i){t.resolve=n,t.reject=i}))};function u(t){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var o=Object.prototype,c=o.hasOwnProperty;function h(t){var n=Object.create(null);return t&&Object.assign(n,t),n}function a(t,n){return c.call(t,n)}function f(t,n){if("."==n)return t;for(var r,s=t,e=i(n.split("."),!0);!(r=e()).done;){var o=r.value;if(!(o&&s&&void 0!==s[o]&&"object"==u(s)&&a(s,o))){s=void 0;break}s=s[o]}return s}o.toString;var l,v=Array.isArray;function p(t){return JSON.parse(t)}function d(t,n){try{return p(t)}catch(t){return null==n||n(t),null}}function m(t,n,i,r,s,e,u,o,c,h,a){return t}function b(t){return(t.ownerDocument||t).defaultView}function w(t,n){return t.replace(/^|,/g,"$&".concat(n," "))}function y(t,n){t.insertBefore(n,t.firstChild)}function g(t,n,i){return function(t,n){for(var i in n)t.setAttribute(i,n[i]);return t}(t.createElement(n),i)}var E=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function A(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{return decodeURIComponent(t)}catch(t){return n}}function S(t){var n,i=h();if(!t)return i;for(;n=E.exec(t);){var r=A(n[1],n[1]),s=n[2]?A(n[2].replace(/\+/g," "),n[2]):"";i[r]=s}return i}function _(t){var n=(t||self).location;return S(n.originalHash||n.hash)}var k="";function O(t){var n;return k||(k=(null===(n=t.AMP_CONFIG)||void 0===n?void 0:n.v)||"01".concat("2307212240000")),k}function R(t,n){var i=n||_(t);return["1","actions","amp","amp4ads","amp4email"].includes(i.development)||!!t.AMP_DEV_MODE}function P(t,n,i){return n in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,t}new RegExp("^https://([a-zA-Z0-9_-]+.)?cdn.ampproject.org(/.*)?$"),new RegExp("^([a-zA-Z0-9_-]+.)?localhost$"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var x=self.__AMP_LOG;function I(t,n){throw new Error("failed to call initLogConstructor")}function j(t){return x.user||(x.user=T()),function(t,n){return n&&n.ownerDocument.defaultView!=t}(x.user.win,t)?x.userForEmbed||(x.userForEmbed=T()):x.user}function T(t){return I()}function N(){return x.dev||(x.dev=I())}function U(t,n,i,r,s,e,u,o,c,h,a){return t}function L(t,n,i,r,s,e,u,o,c,h,a){return j().assert(t,n,i,r,s,e,u,o,c,h,a)}function D(t,n){return G(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),n)}function C(t,n){return G(K(F(t)),n)}function M(t,n){return function(t,n){var i=J(t,n);if(i)return i;var r,s,u,o,c=V(t);return c[n]=(s=(r=new e).promise,u=r.reject,o=r.resolve,s.catch((function(){})),{obj:null,promise:s,resolve:o,reject:u,context:null,ctor:null}),c[n].promise}(K(t),n)}function z(t,n){return J(K(t),n)}function F(t){return t.nodeType?(n=b(t),D(n,"ampdoc")).getAmpDoc(t):t;var n}function K(t){var n=F(t);return n.isSingleDoc()?n.win:n}function G(t,n){U($(t,n));var i=V(t)[n];return i.obj||(U(i.ctor),U(i.context),i.obj=new i.ctor(i.context),U(i.obj),i.context=null,i.resolve&&i.resolve(i.obj)),i.obj}function J(t,n){var i=V(t)[n];return i?i.promise?i.promise:(G(t,n),i.promise=Promise.resolve(i.obj)):null}function V(t){var n=t.__AMP_SERVICES;return n||(n=t.__AMP_SERVICES={}),n}function $(t,n){var i=t.__AMP_SERVICES&&t.__AMP_SERVICES[n];return!(!i||!i.ctor)}var B=function(t){return function(t,n,i,r){var s=z(t,n);if(s)return s;var e=F(t);return e.whenExtensionsKnown().then((function(){var t=e.getExtensionVersion(i);return t?D(e.win,"extensions").waitForExtension(i,t):null})).then((function(i){return i?M(t,n):null}))}(t,"amp-analytics-instrumentation","amp-analytics")},Y=function(t){return G(t,"timer")},Q=function(t){return C(t,"viewer")},W=function(t){return C(t,"viewport")};function Z(t){var n=function(t){return t.readyState}(t);return"loading"!=n&&"uninitialized"!=n}var H=function(){function t(t){var n=!!t.document;this.win_=n?t:t.defaultView,this.doc_=n?t.document:t}var n=t.prototype;return n.getWin=function(){return this.win_},n.getRootNode=function(){return this.doc_},n.getRootElement=function(){return this.doc_.documentElement},n.getHead=function(){return this.doc_.head},n.getBody=function(){return this.doc_.body},n.isReady=function(){return Z(this.doc_)},n.whenReady=function(){return t=this.doc_,new Promise((function(n){!function(t,n){!function(t,n,i){if(n(t))i(t);else{var r=!1;t.addEventListener("readystatechange",(function s(){n(t)&&!r&&(i(t),r=!0,t.removeEventListener("readystatechange",s))}))}}(t,Z,n)}(t,n)}));var t},n.addToFixedLayer=function(t){return s()},t}(),X=function(){function t(t,n){var i,r,s,e=t.indexOf(":");-1!=e?(i=(r=t).substring(0,e),s=r.substring(e+1)):(i=t,r=null,s=null),this.publicationId_=i,this.productId_=r,this.label_=s,this.locked_=n}var n=t.prototype;return n.getPublicationId=function(){return this.publicationId_},n.getProductId=function(){return this.productId_},n.getLabel=function(){return this.label_},n.isLocked=function(){return this.locked_},t}();function q(t){console.log.apply(console,arguments)}function tt(t,n){var i=t;do{if(i.nextSibling)return!0}while((i=i.parentNode)&&i!=n);return!1}function nt(t){var n=Object.getOwnPropertyDescriptor(t,"message");if(n&&n.writable)return t;var i=t.message,r=t.stack,s=new Error(i);for(var e in t)s[e]=t[e];return s.stack=r,s}function it(t){for(var n=null,i="",r=0;r<arguments.length;r++){var s=arguments[r];s instanceof Error&&!n?n=nt(s):(i&&(i+=" "),i+=s)}return n?i&&(n.message=i+": "+n.message):n=new Error(i),n}var rt=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.suffix_=t}var n=t.prototype;return n.prepareError_=function(t){this.suffix_&&(t.message?-1===t.message.indexOf(this.suffix_)&&(t.message=this.suffix_):t.message=this.suffix_)},n.createError=function(t){var n=it.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(n),n},n.createExpectedError=function(t){var n=it.apply(null,Array.prototype.slice.call(arguments));return this.prepareError_(n),n.expected=!0,n},n.error=function(t){throw this.createError.apply(this,arguments)},n.expectedError=function(t){throw this.createExpectedError.apply(this,arguments)},t}(),st=new rt(self.__AMP_TOP?"​​​":"");new rt;var et="__SWG-SEEN__",ut=["CreativeWork","Article","NewsArticle","Blog","Comment","Course","HowTo","Message","Review","WebPage"],ot=new RegExp(ut.join("|")),ct=function(){function t(t){var n,i=this;this.doc_=9===(n=t).nodeType||n.document?new H(n):n,this.configResolver_=null,this.configPromise_=new Promise((function(t){i.configResolver_=t})),this.metaParser_=new at(this.doc_),this.ldParser_=new ft(this.doc_),this.microdataParser_=new lt(this.doc_)}var n=t.prototype;return n.resolveConfig=function(){return s().then(this.check.bind(this)),this.doc_.whenReady().then(this.check.bind(this)),this.configPromise_},n.check=function(){if(!this.configResolver_)return null;var t=this.metaParser_.check()||this.ldParser_.check()||this.microdataParser_.check();return t?(this.configResolver_(t),this.configResolver_=null):this.doc_.isReady()&&(this.configResolver_(Promise.reject(st.createError("No config could be discovered in the page"))),this.configResolver_=null),function(t){if(/swg.debug=1/.test(self.location.hash)){var n=Array.prototype.slice.call(arguments,0);n.unshift("[Subscriptions]"),q.apply(q,n)}}(t),t},t}(),ht=function(){function t(){}var n=t.prototype;return n.checkValue=function(t,n){return!!t&&this.checkArray(this.toArray_(t),n)},n.checkString=function(t,n){return!!t&&this.checkArray(t.split(/\s+/),n)},n.checkArray=function(t,n){for(var r,s=i(t,!0);!(r=s()).done;){var e=r.value.replace(/^http:\/\/schema.org\//i,"");if(n.includes(e))return!0}return!1},n.toArray_=function(t){return Array.isArray(t)?t:[t]},t}(),at=function(){function t(t){this.doc_=t}return t.prototype.check=function(){if(!this.doc_.getBody())return null;var t=vt(this.doc_.getRootNode(),"subscriptions-product-id");if(!t)return null;var n=vt(this.doc_.getRootNode(),"subscriptions-accessible-for-free"),i=!(!n||"false"!==n.toLowerCase());return new X(t,i)},t}(),ft=function(){function t(t){this.doc_=t,this.checkType_=new ht}var n=t.prototype;return n.check=function(){if(!this.doc_.getBody())return null;for(var t=this.doc_.isReady(),n=this.doc_.getRootNode().querySelectorAll('script[type="application/ld+json"]'),i=0;i<n.length;i++){var r=n[i];if(!r[et]&&r.textContent&&(t||tt(r))&&(r[et]=!0,ot.test(r.textContent))){var s=this.tryExtractConfig_(r);if(s)return s}}return null},n.tryExtractConfig_=function(t){var n=function(t,n){try{return function(t){return JSON.parse(t)}(t)}catch(t){return}}(t.textContent);if(!n)return null;Array.isArray(n)||(n=[n]);for(var i=n,r=0;r<i.length;r++){var s=i[r];if(s["@graph"]&&Array.isArray(s["@graph"])&&(i=i.concat(s["@graph"])),this.checkType_.checkValue(s["@type"],ut)){var e=null,u=this.valueArray_(s,"isPartOf");if(u)for(var o=0;o<u.length&&!(e=this.discoverProductId_(u[o]));o++);if(e){var c=this.bool_(this.singleValue_(s,"isAccessibleForFree"),!0);return new X(e,!c)}}}return null},n.bool_=function(t,n){if("boolean"==typeof t)return t;if("string"==typeof t){var i=t.toLowerCase();if("false"===i)return!1;if("true"===i)return!0}return n},n.discoverProductId_=function(t){return this.checkType_.checkValue(t["@type"],["Product"])?this.singleValue_(t,"productID"):null},n.valueArray_=function(t,n){var i=t[n];return null==i||""===i?null:Array.isArray(i)?i:[i]},n.singleValue_=function(t,n){var i=this.valueArray_(t,n),r=i&&i[0];return null==r||""===r?null:r},t}(),lt=function(){function t(t){this.doc_=t,this.access_=null,this.productId_=null,this.checkType_=new ht}var n=t.prototype;return n.discoverAccess_=function(t){for(var n=t.querySelectorAll("[itemprop='isAccessibleForFree']"),i=0;n[i];i++){var r=n[i],s=r.getAttribute("content")||r.textContent;if(s&&this.isValidElement_(r,t,"alreadySeenForAccessInfo")){var e=null;return"true"==s.toLowerCase()?e=!0:"false"==s.toLowerCase()&&(e=!1),e}}return null},n.isValidElement_=function(t,n,i){for(var r=t;r&&!r[i];r=r.parentNode)if(r[i]=!0,r.hasAttribute&&r.hasAttribute("itemscope")){var s=r.getAttribute("itemtype");return this.checkType_.checkString(s,ut)}return!1},n.discoverProductId_=function(t){for(var n=t.querySelectorAll('[itemprop="productID"]'),i=0;n[i];i++){var r=n[i],s=r.getAttribute("content")||r.textContent,e=r.closest("[itemtype][itemscope]");if(!(e.getAttribute("itemtype").indexOf("http://schema.org/Product")<=-1)&&this.isValidElement_(e.parentElement,t,"alreadySeenForProductInfo"))return s}return null},n.getPageConfig_=function(){var t=null;return null!=this.access_?t=!this.access_:this.doc_.isReady()&&(t=!1),null!=this.productId_&&null!=t?new X(this.productId_,t):null},n.tryExtractConfig_=function(){var t=this,n=this.getPageConfig_();if(n)return n;for(var i=Array.prototype.slice.call(this.doc_.getRootNode().querySelectorAll("[itemscope][itemtype]")).filter((function(n){return t.checkType_.checkString(n.getAttribute("itemtype"),ut)})),r=0;i[r]&&null==n;r++){var s=i[r];null==this.access_&&(this.access_=this.discoverAccess_(s)),this.productId_||(this.productId_=this.discoverProductId_(s)),n=this.getPageConfig_()}return n},n.check=function(){return this.doc_.getBody()?this.tryExtractConfig_():null},t}();function vt(t,n){var i=t.querySelector('meta[name="'.concat(n,'"]'));return i?i.getAttribute("content"):null}function pt(t,n){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),i.push.apply(i,r)}return i}function dt(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?pt(Object(i),!0).forEach((function(n){P(t,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):pt(Object(i)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))}))}return t}var mt="subscriptions-action-delegated",bt="subscriptions-action",wt="started",yt=function(){function t(t){this.Ml=t,this.rl=[]}var n=t.prototype;return n.registerEventListener=function(t){this.rl.push(t)},n.serviceEvent=function(t,n,i,r){this.event(t,dt({"serviceId":n},i),r)},n.event=function(t,n,i){i=i||{};var r=t!==bt?t:t+"-".concat(i.action,"-").concat(i.status);j().info("amp-subscriptions",r,n||""),n=n||{},function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];B(t).then((function(s){s&&s.triggerEventForTarget(t,n,i,r)}))}(this.Ml,r,n,!1);for(var s=0;s<this.rl.length;s++)this.rl[s](t,n,i)},n.actionEvent=function(t,n,i,r){this.serviceEvent(bt,t,r,{"action":n,"status":i})},t}(),gt={IS_READY_TO_PAY:"isReadyToPay",SUPPORTS_VIEWER:"supportsViewer"},Et={};function At(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);var n=function(t){for(var n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}(new Uint8Array(t.buffer||t));return decodeURIComponent(escape(n))}function St(t){for(var n=new Uint8Array(t.length),i=0;i<t.length;i++){var r=t.charCodeAt(i);m(r<=255),n[i]=r}return n}function _t(t){return"function"==typeof t.then?t:new Promise((function(n,i){t.oncomplete=function(i){n(t.result)},t.onerror=i}))}function kt(t){for(var n=atob(t),i=n.length,r=new Uint8Array(i),s=0;s<i;s++)r[s]=n.charCodeAt(s);return r}var Ot,Rt=function(){function t(t){this.wi=t,this.tbt=null;var n=this.wi.getRootNode().querySelector("script[cryptokeys]");this.nbt=null,n&&n.hasAttribute("sha-256-hash")&&(this.nbt=n.getAttribute("sha-256-hash")),this.ibt=n&&d(n.textContent)||null}var n=t.prototype;return n.isDocumentEncrypted=function(){return!!this.ibt&&Object.keys(this.ibt).length>0},n.getEncryptedKeys=function(){return this.ibt},n.getEncryptedDocumentKey=function(t){var n=this.getEncryptedKeys();return n&&n[t]||null},n.tryToDecryptDocument=function(t){var n=this;if(!this.nbt)return this.rbt(t);var i,r=(i=t,"undefined"!=typeof TextEncoder?(new TextEncoder).encode(i):St(unescape(encodeURIComponent(i))));return crypto.subtle.digest("SHA-256",r).then((function(i){var r;return((r=new Uint8Array(i))?Array.prototype.slice.call(r):[]).map((function(t){return function(t,n,i){if(t.length>=n)return t;n-=t.length;for(var r="0";n>r.length;)r+="0";return r.slice(0,n)+t}(t.toString(16),2)})).join("")!=n.nbt?Promise.reject(new Error("Invalid Document Key")):n.rbt(t)}))},n.rbt=function(t){var n=this;return this.tbt||(this.tbt=this.wi.whenReady().then((function(){var i;return(i=kt(t).buffer,_t((self.msCrypto?self.msCrypto.subtle:self.crypto.subtle).importKey("raw",i,"AES-GCM",!0,["decrypt"]))).then((function(t){var i=n.wi.getRootNode().querySelectorAll("script[ciphertext]"),r=[];return i.forEach((function(n){var i=kt(n.textContent.replace(/\s+/g,"")).buffer,s=i.slice(0,12),e=i.slice(12);r.push(function(t,n,i){var r=!!self.msCrypto;return _t((r?self.msCrypto.subtle:self.crypto.subtle).decrypt({name:"AES-GCM",iv:n,tag:r?i.slice(i.byteLength-16):void 0,tagLength:128},t,r?i.slice(0,i.byteLength-16):i)).then((function(t){return function(t){if("undefined"!=typeof TextDecoder)return new TextDecoder("utf-8").decode(t);for(var n=new Uint8Array(t.buffer||t),i=new Array(n.length),r=0;r<n.length;r++)i[r]=String.fromCharCode(n[r]);var s=i.join("");return decodeURIComponent(escape(s))}(new Uint8Array(t))}))}(t,s,e).then((function(t){n.outerHTML=t})))})),Promise.all(r)}))}))),this.tbt},t}(),Pt=["Webkit","webkit","Moz","moz","ms","O","o"];function xt(t){var n=t.replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}));return Pt.some((function(t){return n.startsWith(t+"-")}))?"-".concat(n):n}function It(t,n,i){if(n.startsWith("--"))return n;Ot||(Ot=h());var r=Ot[n];if(!r||i){if(r=n,void 0===t[n]){var s=function(t){return t.charAt(0).toUpperCase()+t.slice(1)}(n),e=function(t,n){for(var i=0;i<Pt.length;i++){var r=Pt[i]+n;if(void 0!==t[r])return r}return""}(t,s);void 0!==t[e]&&(r=e)}i||(Ot[n]=r)}return r}function jt(t,n){var i=t.style;for(var r in n)i.setProperty(xt(It(i,r)),String(n[r]),"important")}function Tt(t,n){void 0===n&&(n=t.hasAttribute("hidden")),n?t.removeAttribute("hidden"):t.setAttribute("hidden","")}var Nt=function(){function t(t){var n=this;this.wi=t,this.Hs=D(t.win,"vsync"),this.$r=Y(t.win),this.Ls=W(t),this.Ho=!1,this.m$=null,this.sbt=s();var i=this.wi.win.document;this.qa=g(i,"amp-subscriptions-dialog",{"role":"dialog"}),Tt(this.qa,!1),this.yY=g(i,"button",{"class":"i-amphtml-subs-dialog-close-button"}),this.showCloseAction(!1),this.qa.appendChild(this.yY),this.yY.addEventListener("click",(function(){n.close()})),this.wi.getBody().appendChild(this.qa),jt(this.qa,{transform:"translateY(100%)"})}var n=t.prototype;return n.getRoot=function(){return this.qa},n.isVisible=function(){return this.Ho},n.open=function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.oe((function(){return n.SY(t,i)}))},n.close=function(){var t=this;return this.oe((function(){return t.Cx()}))},n.oe=function(t){return this.sbt=this.sbt.then(t)},n.SY=function(t){var n=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.m$?this.qa.replaceChild(t,this.m$):this.qa.appendChild(t),this.m$=t,this.Ho?s():(this.Ho=!0,this.Hs.mutatePromise((function(){Tt(n.qa,!0),n.showCloseAction(i)})).then((function(){return n.Hs.mutatePromise((function(){jt(n.qa,{transform:"translateY(0)"})})).then((function(){return n.$r.promise(300)}))})).then((function(){var t;return n.Hs.runPromise({measure:function(){t=n.qa.offsetHeight},mutate:function(){n.Ls.updatePaddingBottom(t),n.Ls.addToFixedLayer(n.qa,!0)}})})))},n.Cx=function(){var t=this;return this.Ho?this.Hs.mutatePromise((function(){jt(t.qa,{transform:"translateY(100%)"})})).then((function(){return t.$r.promise(300)})).then((function(){return t.Hs.mutatePromise((function(){Tt(t.qa,!1),t.Ls.updatePaddingBottom(0),t.Ho=!1}))})):s()},n.showCloseAction=function(t){Tt(this.yY,t)},t}(),Ut=function(){function t(t){this.wi=t,this.Ls=W(this.wi)}var n=t.prototype;return n.getWin=function(){return this.wi.win},n.getRootNode=function(){return this.wi.getRootNode()},n.getRootElement=function(){var t=this.wi.getRootNode();return t.documentElement||t.body||t},n.getHead=function(){return this.wi.getHeadNode()},n.getBody=function(){return this.wi.isBodyAvailable()?this.wi.getBody():null},n.isReady=function(){return this.wi.isReady()},n.whenReady=function(){return this.wi.whenReady()},n.addToFixedLayer=function(t){return this.Ls.addToFixedLayer(t,!0)},t}(),Lt="SUBSCRIBER",Dt="METERING",Ct="UNLOCKED",Mt=function(){function t(t){var n=t.dataObject,i=t.decryptedDocumentKey,r=t.grantReason,s=void 0===r?"":r,e=t.granted,u=void 0!==e&&e,o=t.raw,c=void 0===o?"":o,h=t.service,a=t.source;this.raw=c,this.source=a,this.service=h,this.granted=u,this.grantReason=s,this.data=n,this.decryptedDocumentKey=i}t.empty=function(n){return new t({source:"",raw:"",service:n,granted:!1})};var n=t.prototype;return n.json=function(){return{"source":this.source,"service":this.service,"granted":this.granted,"grantReason":this.grantReason,"data":this.data}},n.jsonForPingback=function(){return dt({"raw":this.raw},this.json())},t.parseFromJson=function(n){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n||(n={});var r=i||JSON.stringify(n),s=n.source||"",e=n.granted||!1,u=n.grantReason,o=n.data||null,c=n.decryptedDocumentKey||null;return new t({source:s,raw:r,service:"",granted:e,grantReason:u,dataObject:o,decryptedDocumentKey:c})},n.isSubscriber=function(){return this.granted&&this.grantReason===Lt},n.isFree=function(){return this.granted&&this.grantReason===Ct},t}();function zt(t,n){return(zt=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function Ft(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&zt(t,n)}function Kt(t){return(Kt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Gt(t,n){if(n&&("object"===u(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jt(t){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r=Kt(t);if(n){var s=Kt(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return Gt(this,i)}}var Vt,$t,Bt,Yt=function(){function t(t){this.dr=t,this.pr=0,this.mr=0,this.yr=h()}var n=t.prototype;return n.has=function(t){return!!this.yr[t]},n.get=function(t){var n=this.yr[t];if(n)return n.access=++this.mr,n.payload},n.put=function(t,n){this.has(t)||this.pr++,this.yr[t]={payload:n,access:this.mr},this.gr()},n.gr=function(){if(!(this.pr<=this.dr)){var t,n=this.yr,i=this.mr+1;for(var r in n){var s=n[r].access;s<i&&(i=s,t=r)}void 0!==t&&(delete n[t],this.pr--)}},t}(),Qt=function(){return self.AMP.config.urls}(),Wt=new Set(["c","v","a","ad"]),Zt=function(t){return"string"==typeof t?Xt(t):t};function Ht(t){return t.origin||Xt(t.location.href).origin}function Xt(t,n){return Vt||(Vt=self.document.createElement("a"),$t=self.__AMP_URL_CACHE||(self.__AMP_URL_CACHE=new Yt(100))),function(t,n,i){if(i&&i.has(n))return i.get(n);t.href=n,t.protocol||(t.href=t.href);var r,s={href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:"0"==t.port?"":t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:null};"/"!==s.pathname[0]&&(s.pathname="/"+s.pathname),("http:"==s.protocol&&80==s.port||"https:"==s.protocol&&443==s.port)&&(s.port="",s.host=s.hostname),r=t.origin&&"null"!=t.origin?t.origin:"data:"!=s.protocol&&s.host?s.protocol+"//"+s.host:s.href,s.origin=r;var e=s;return i&&i.put(n,e),e}(Vt,t,n?null:$t)}function qt(t,n,i,r){return function(t,n,i){if(!n)return t;var r=t.split("#",2),s=r[0].split("?",2);return s[0]+(s[1]?i?"?".concat(n,"&").concat(s[1]):"?".concat(s[1],"&").concat(n):"?".concat(n))+(r[1]?"#".concat(r[1]):"")}(t,function(t,n){return"".concat(encodeURIComponent(t),"=").concat(encodeURIComponent(n))}(n,i),r)}function tn(t){return"https:"==(t=Zt(t)).protocol||"localhost"==t.hostname||"127.0.0.1"==t.hostname||(i=".localhost",(r=(n=t.hostname).length-i.length)>=0&&n.indexOf(i,r)==r);var n,i,r}function nn(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"source";return L(null!=t,"%s %s must be available",n,i),L(tn(t)||/^\/\//.test(t),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',n,i,t),t}function rn(t,n,i,r){var s=t,e=i,u=function(t){try{return e(t)}catch(t){var n,i;throw null===(n=(i=self).__AMP_REPORT_ERROR)||void 0===n||n.call(i,t),t}},o=function(){if(void 0!==Bt)return Bt;Bt=!1;try{var t={get capture(){return Bt=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return Bt}(),c=!(null==r||!r.capture);return s.addEventListener(n,u,o?r:c),function(){null==s||s.removeEventListener(n,u,o?r:c),e=null,s=null,u=null}}function sn(t){return t.data}function en(t,n,i,r){var s,e,u;try{s=t.open(n,i,r)}catch(t){N().error("DOM","Failed to open url on target: ",i,t)}return!s&&"_top"!=i&&("number"!=typeof u&&(u=0),u+"noopener".length>(e=r||"").length||-1===e.indexOf("noopener",u))&&(s=t.open(n,"_top")),s}var un=function(){return self.AMP.config.urls}(),on="amp-access-login",cn=new RegExp("RETURN_URL");function hn(t,n){return function(t,n){var i=Q(t);return parseInt(t.getParam("dialog"),10)?new an(i,n):new fn(t.win,i,n)}(t,n).open()}var an=function(){function t(t,n){this.viewer=t,this.urlOrPromise=n}var n=t.prototype;return n.getLoginUrl=function(){return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then((function(t){return ln(t,"RETURN_URL")}))},n.open=function(){var t=this;return this.getLoginUrl().then((function(n){return N().fine(on,"Open viewer dialog: ",n),t.viewer.sendMessageAwaitResponse("openDialog",{"url":n})}))},t}(),fn=function(){function t(t,n,i){this.win=t,this.viewer=n,this.urlOrPromise=i,this.Jt=null,this.Ha=null,this.ebt=null,this.ubt=null,this.obt=null,this.cbt=null}var n=t.prototype;return n.open=function(){var t=this;return L(!this.Jt,"Dialog already opened"),new Promise((function(n,i){t.Jt=n,t.Ha=i,t.hbt()})).then((function(n){return t._s(),n}),(function(n){throw t._s(),n}))},n._s=function(){if(this.Jt=null,this.Ha=null,this.ebt){try{this.ebt.close()}catch(t){}this.ebt=null}this.obt&&(this.win.clearInterval(this.obt),this.obt=null),this.cbt&&(this.cbt(),this.cbt=null)},n.getLoginUrl=function(){var t=this;return("string"==typeof this.urlOrPromise?Promise.resolve(this.urlOrPromise):this.urlOrPromise).then((function(n){return ln(n,t.abt())}))},n.hbt=function(){var t=this,n=this.win.screen,i=Math.floor(Math.min(700,.9*n.width)),r=Math.floor(Math.min(450,.9*n.height)),e=Math.floor((n.width-i)/2),u=Math.floor((n.height-r)/2),o="height=".concat(r,",width=").concat(i,",left=").concat(e,",top=").concat(u),c="".concat(o,",resizable=yes,scrollbars=yes"),h=this.abt();if(this.ubt=null,"string"==typeof this.urlOrPromise){var a=ln(this.urlOrPromise,h);N().fine(on,"Open dialog: ",a,h,i,r,e,u),this.ebt=en(this.win,a,"_blank",c),this.ebt&&(this.ubt=s())}else N().fine(on,"Open dialog: ","about:blank",h,i,r,e,u),this.ebt=en(this.win,"","_blank",c),this.ebt&&(this.ubt=this.urlOrPromise.then((function(n){var i=ln(n,h);N().fine(on,"Set dialog url: ",i),t.ebt.location.replace(i)}),(function(t){throw new Error("failed to resolve url: "+t)})));this.ubt?this.ubt.then((function(){t.fbt(h)}),(function(n){t.lbt(null,n)})):this.lbt(null,new Error("failed to open dialog"))},n.fbt=function(t){var n=this,i=Xt(t).origin;this.obt=this.win.setInterval((function(){n.ebt.closed&&(n.win.clearInterval(n.obt),n.obt=null,n.win.setTimeout((function(){n.lbt("")}),3e3))}),500),this.cbt=rn(this.win,"message",(function(t){N().fine(on,"MESSAGE:",t),t.origin==i&&sn(t)&&"amp"==sn(t).sentinel&&(N().fine(on,"Received message from dialog: ",sn(t)),"result"==sn(t).type&&(n.ebt&&n.ebt.postMessage({"sentinel":"amp","type":"result-ack"},i),n.lbt(sn(t).result)))}),void 0)},n.lbt=function(t,n){this.Jt&&(N().fine(on,"Login done: ",t,n),n?this.Ha(n):this.Jt(t),this._s())},n.abt=function(){var t=this.viewer.getResolvedViewerUrl();return"".concat(un.cdn,"/v0/amp-login-done-0.1.html")+"?url="+encodeURIComponent(t)},t}();function ln(t,n){return cn.test(t)?t.replace(cn,encodeURIComponent(n)):t+(-1==t.indexOf("?")?"?":"&")+"return="+encodeURIComponent(n)}var vn="amp-subscriptions",pn="local",dn=function(){function t(t,n,i,r){for(var s in r)nn(r[s],"action ".concat(s));this.vbt=r,this.pbt={},this.det=n,this.lU=i,this.dbt=null,this.mbt=0,this.bbt=hn.bind(null,t),this.build()}var n=t.prototype;return n.build=function(){var t=this;if(0==Object.keys(this.vbt).length)return null;var n=[],i=function(i){n.push(t.det.buildUrl(t.vbt[i],!0).then((function(n){t.pbt[i]=n})))};for(var r in this.vbt)i(r);return Promise.all(n).then((function(){return t.pbt}))},n.execute=function(t){L(this.vbt[t],"Action URL is not configured: %s",t);var n=L(this.pbt[t],"Action URL is not ready: %s",t);return this.Wi(n,t)},n.Wi=function(t,n){var i=this,r=Date.now();if(this.dbt&&r-this.mbt<1e3)return this.dbt;N().fine(vn,"Start action: ",t,n),this.lU.actionEvent(pn,n,wt);var s=this.bbt(t).then((function(t){N().fine(vn,"Action completed: ",n,t),i.dbt=null;var r=S(t).success,s="true"==r||"yes"==r||"1"==r;return s?i.lU.actionEvent(pn,n,"success"):i.lU.actionEvent(pn,n,"rejected"),s||!r})).catch((function(t){throw N().fine(vn,"Action failed: ",n,t),i.lU.actionEvent(pn,n,"failed"),i.dbt==s&&(i.dbt=null),t}));return this.dbt=s,this.mbt=r,this.dbt},t}(),mn=function(){var t=function(t,n,i,r){for(i=i||{},r=t.length;r--;i[t[r]]=n);return i},n=[1,3],i=[1,4],r=[1,18],s=[1,19],e=[1,14],o=[1,15],c=[1,16],h=[1,17],a=[1,21],f=[1,22],l=[5,6,7,10],v=[5,6,7,10,15,16,17,18,19,20,21],p=[5,6,7,10,15,16,17,18,19,20,21,25,27],d={trace:function(){},yy:{},wG:{"error":2,"result":3,"search_condition":4,"EOF":5,"OR":6,"AND":7,"NOT":8,"(":9,")":10,"predicate":11,"comparison_predicate":12,"truthy_predicate":13,"scalar_exp":14,"EQ":15,"DEQ":16,"NEQ":17,"LT":18,"LTE":19,"GT":20,"GTE":21,"atom":22,"field_ref":23,"literal":24,"DOT":25,"field_name":26,"[":27,"string":28,"]":29,"NAME":30,"STRING":31,"NUMERIC":32,"TRUE":33,"FALSE":34,"NULL":35,"$accept":0,"$end":1},mG:{2:"error",5:"EOF",6:"OR",7:"AND",8:"NOT",9:"(",10:")",15:"EQ",16:"DEQ",17:"NEQ",18:"LT",19:"LTE",20:"GT",21:"GTE",25:"DOT",27:"[",29:"]",30:"NAME",31:"STRING",32:"NUMERIC",33:"TRUE",34:"FALSE",35:"NULL"},dG:[0,[3,2],[4,3],[4,3],[4,2],[4,3],[4,1],[11,1],[11,1],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[12,3],[13,1],[14,1],[14,1],[22,1],[23,3],[23,4],[23,1],[26,1],[28,1],[24,1],[24,1],[24,1],[24,1],[24,1]],performAction:function(t,n,i,r,s,e,o){var c=e.length-1;switch(s){case 1:return e[c-1];case 2:this.$=e[c-2]||e[c];break;case 3:this.$=e[c-2]&&e[c];break;case 4:this.$=!e[c];break;case 5:this.$=e[c-1];break;case 6:case 7:case 8:case 17:case 18:case 19:this.$=e[c];break;case 9:this.$=e[c-2]===e[c];break;case 10:throw new Error('"==" is not allowed, use "="');case 11:this.$=e[c-2]!==e[c];break;case 12:this.$=u(e[c-2])==u(e[c])&&e[c-2]<e[c];break;case 13:this.$=u(e[c-2])==u(e[c])&&e[c-2]<=e[c];break;case 14:this.$=u(e[c-2])==u(e[c])&&e[c-2]>e[c];break;case 15:this.$=u(e[c-2])==u(e[c])&&e[c-2]>=e[c];break;case 16:this.$=void 0!==e[c]&&null!==e[c]&&""!==e[c]&&0!==e[c]&&!1!==e[c];break;case 20:this.$="[object Object]"==Object.prototype.toString.call(e[c-2])&&e[c-2].hasOwnProperty(e[c])?e[c-2][e[c]]:null;break;case 21:this.$="[object Object]"==Object.prototype.toString.call(e[c-3])&&e[c-3].hasOwnProperty(e[c-1])?e[c-3][e[c-1]]:null;break;case 22:this.$=void 0!==r[e[c]]?r[e[c]]:null;break;case 23:this.$=t;break;case 24:this.$=t.substring(1,t.length-1);break;case 26:this.$=Number(t);break;case 27:this.$=!0;break;case 28:this.$=!1;break;case 29:this.$=null}},table:[{3:1,4:2,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{1:[3]},{5:[1,20],6:a,7:f},{4:23,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{4:24,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},t(l,[2,6]),t(l,[2,7]),t(l,[2,8]),t(l,[2,16],{15:[1,25],16:[1,26],17:[1,27],18:[1,28],19:[1,29],20:[1,30],21:[1,31]}),t(v,[2,17]),t(v,[2,18],{25:[1,32],27:[1,33]}),t(v,[2,19]),t(p,[2,22]),t(v,[2,25]),t(v,[2,26]),t(v,[2,27]),t(v,[2,28]),t(v,[2,29]),t(p,[2,23]),t([5,6,7,10,15,16,17,18,19,20,21,29],[2,24]),{1:[2,1]},{4:34,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{4:35,8:n,9:i,11:5,12:6,13:7,14:8,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},t(l,[2,4]),{6:a,7:f,10:[1,36]},{14:37,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:38,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:39,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:40,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:41,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:42,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{14:43,22:9,23:10,24:11,26:12,28:13,30:r,31:s,32:e,33:o,34:c,35:h},{26:44,30:r},{28:45,31:s},t([5,6,10],[2,2],{7:f}),t(l,[2,3]),t(l,[2,5]),t(l,[2,9]),t(l,[2,10]),t(l,[2,11]),t(l,[2,12]),t(l,[2,13]),t(l,[2,14]),t(l,[2,15]),t(p,[2,20]),{29:[1,46]},t(p,[2,21])],defaultActions:{20:[2,1]},parseError:function(t,n){if(!n.recoverable){var i=new Error(t);throw i.hash=n,i}this.trace(t)},parse:function(t){var n=this,i=[0],r=[null],s=[],e=this.table,u="",o=0,c=0,h=0,a=2,f=1,l=s.slice.call(arguments,1),v=Object.create(this.lexer),p={yy:{}};for(var d in this.yy)Object.prototype.hasOwnProperty.call(this.yy,d)&&(p.yy[d]=this.yy[d]);v.setInput(t,p.yy),p.yy.lexer=v,p.yy.parser=this,void 0===v.yylloc&&(v.yylloc={});var m=v.yylloc;s.push(m);var b=v.options&&v.options.ranges;"function"==typeof p.yy.parseError?this.parseError=p.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var w,y,g,E,A,S,_,k,O,R=function(){var t;return"number"!=typeof(t=v.lex()||f)&&(t=n.wG[t]||t),t},P={};;){if(g=i[i.length-1],this.defaultActions[g]?E=this.defaultActions[g]:(null==w&&(w=R()),E=e[g]&&e[g][w]),void 0===E||!E.length||!E[0]){var x="";for(S in O=[],e[g])this.mG[S]&&S>a&&O.push("'"+this.mG[S]+"'");x=v.showPosition?"Parse error on line "+(o+1)+":\n"+v.showPosition()+"\nExpecting "+O.join(", ")+", got '"+(this.mG[w]||w)+"'":"Parse error on line "+(o+1)+": Unexpected "+(w==f?"end of input":"'"+(this.mG[w]||w)+"'"),this.parseError(x,{text:v.match,token:this.mG[w]||w,line:v.yylineno,loc:m,expected:O})}if(E[0]instanceof Array&&E.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+w);switch(E[0]){case 1:i.push(w),r.push(v.yytext),s.push(v.yylloc),i.push(E[1]),w=null,y?(w=y,y=null):(c=v.yyleng,u=v.yytext,o=v.yylineno,m=v.yylloc,h>0&&h--);break;case 2:if(_=this.dG[E[1]][1],P.$=r[r.length-_],P._$={first_line:s[s.length-(_||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(_||1)].first_column,last_column:s[s.length-1].last_column},b&&(P._$.range=[s[s.length-(_||1)].range[0],s[s.length-1].range[1]]),void 0!==(A=this.performAction.apply(P,[u,c,o,p.yy,E[1],r,s].concat(l))))return A;_&&(i=i.slice(0,-1*_*2),r=r.slice(0,-1*_),s=s.slice(0,-1*_)),i.push(this.dG[E[1]][0]),r.push(P.$),s.push(P._$),k=e[i[i.length-2]][i[i.length-1]],i.push(k);break;case 3:return!0}}return!0}},m={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(t,n){return this.yy=n||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t,t.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var n=t.length,i=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-n),this.offset-=n;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),i.length-1&&(this.yylineno-=i.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:i?(i.length===r.length?this.yylloc.first_column:0)+r[r.length-i.length].length-i[0].length:this.yylloc.first_column-n},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-n]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),n=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+n+"^"},test_match:function(t,n){var i,r,s;if(this.options.backtrack_lexer&&(s={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(s.yylloc.range=this.yylloc.range.slice(0))),(r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],i=this.performAction.call(this,this.yy,this,n,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),i)return i;if(this._backtrack){for(var e in s)this[e]=s[e];return!1}return!1},next:function(){if(this.done)return this.EOF;var t,n,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),e=0;e<s.length;e++)if((i=this._input.match(this.rules[s[e]]))&&(!n||i[0].length>n[0].length)){if(n=i,r=e,this.options.backtrack_lexer){if(!1!==(t=this.test_match(i,s[e])))return t;if(this._backtrack){n=!1;continue}return!1}if(!this.options.flex)break}return n?!1!==(t=this.test_match(n,s[r]))&&t:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){return this.next()||this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return(t=this.conditionStack.length-1-Math.abs(t||0))>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(t,n,i,r){switch(i){case 0:break;case 1:return 7;case 2:return 6;case 3:return 8;case 4:return 35;case 5:case 6:return 33;case 7:case 8:return 34;case 9:return 9;case 10:return 10;case 11:return 27;case 12:return 29;case 13:return"|";case 14:return 19;case 15:return 18;case 16:return 21;case 17:return 20;case 18:return 17;case 19:return 16;case 20:return 15;case 21:return 32;case 22:return 30;case 23:case 24:return 31;case 25:return 25;case 26:return"INVALID";case 27:return 5}},rules:[/^(?:\s+)/,/^(?:AND\b)/,/^(?:OR\b)/,/^(?:NOT\b)/,/^(?:NULL\b)/,/^(?:TRUE\b)/,/^(?:true\b)/,/^(?:FALSE\b)/,/^(?:false\b)/,/^(?:\()/,/^(?:\))/,/^(?:\[)/,/^(?:\])/,/^(?:\|)/,/^(?:<=)/,/^(?:<)/,/^(?:>=)/,/^(?:>)/,/^(?:!=)/,/^(?:==)/,/^(?:=)/,/^(?:-?[0-9]+(\.[0-9]+)?\b)/,/^(?:[a-zA-Z_][a-zA-Z0-9_]*)/,/^(?:'[^\']*')/,/^(?:"[^\"]*")/,/^(?:\.)/,/^(?:.)/,/^(?:$)/],conditions:{"INITIAL":{"rules":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27],"inclusive":!0}}};function b(){this.yy={}}return d.lexer=m,b.prototype=d,d.Parser=b,new b}(),bn=mn;function wn(t,n){return function(t,n){try{return bn.yy=n,!!bn.parse(t)}finally{bn.yy=null}}(t,n)}var yn=function(){function t(t,n,i){this.wi=t,this.Ws=t.getRootNode(),this.ebt=n,this.ty=C(t,"templates"),this.cet=i}var n=t.prototype;return n.render=function(t){return Promise.all([this.wbt(t),this.ybt(t)])},n.reset=function(){return this.ebt.close(),this.gbt({},this.Ws,(function(){return!1}))},n.wbt=function(t){this.gbt(t,this.Ws,wn)},n.ybt=function(t){var n=this;return this.wi.whenReady().then((function(){for(var i=n.wi.getRootNode().querySelectorAll("[subscriptions-dialog][subscriptions-display]"),r=0;r<i.length;r++){var s=i[r],e=s.getAttribute("subscriptions-display");if(e&&wn(e,t))return s}})).then((function(i){if(i){if("TEMPLATE"==i.tagName)return n.ty.renderTemplate(i,t).then((function(i){var r=t;return n.gbt(r,i,wn)}));var r=i.cloneNode(!0);return r.removeAttribute("subscriptions-dialog"),r.removeAttribute("subscriptions-display"),r}})).then((function(t){if(t)return n.ebt.open(t,!0)}))},n.gbt=function(t,n,i){var r=this;return this.wi.whenReady().then((function(){for(var s=n.querySelectorAll('[subscriptions-action], [subscriptions-section="actions"], [subscriptions-actions]'),e=0;e<s.length;e++){var u=s[e],o=u.getAttribute("subscriptions-display");o&&i(o,t)?(u.classList.add("i-amphtml-subs-display"),u.getAttribute("subscriptions-service")&&u.getAttribute("subscriptions-action")&&"false"!==u.getAttribute("subscriptions-decorate")&&!u.hasAttribute("i-amphtml-subs-decorated")&&(r.cet.decorateServiceAction(u,u.getAttribute("subscriptions-service"),u.getAttribute("subscriptions-action"),null),u.setAttribute("i-amphtml-subs-decorated",!0))):u.classList.remove("i-amphtml-subs-display")}return n}))},t}(),gn=function(){function t(t,n){var i,r,s=t.getHeadNode();this.zw=(i="url-replace",$(r=K(F(s)),i)?G(r,i):null),this.iet=n,this.oet=null}var n=t.prototype;return n.setAuthResponse=function(t){this.oet=t},n.buildUrl=function(t,n){var i=this;return this.uet(n).then((function(n){return i.zw.expandUrlAsync(t,n)}))},n.collectUrlVars=function(t,n){var i=this;return this.uet(n).then((function(n){return i.zw.collectVars(t,n)}))},n.uet=function(t){var n=this;return this.iet.then((function(i){var r={"READER_ID":i,"ACCESS_READER_ID":i};return t&&(r.AUTHDATA=function(t){if(n.oet)return f(n.oet,t)}),r}))},t}(),En="_AMP_SUBSCRIPTIONS_CLICK_HANDLED",An=function(){function t(t,n,i){this.wi=t,this.Ws=t.getRootNode(),this.Net=n,this.Ebt=!!this.Net.pingbackAllEntitlements,this.cet=i,this.det=new gn(this.wi,this.cet.getReaderId("local")),this.let=i.getAnalytics(),L(this.Net.actions,"Actions have not been defined in the service config"),this.Xy=new dn(this.wi,this.det,this.let,this.validateActionMap(this.Net.actions)),this.kd=new yn(this.wi,i.getDialog(),this.cet)}var n=t.prototype;return n.getPlatformKey=function(){return"local"},n.validateActionMap=function(t){return L(t.login,'Action "login" is not present in action map'),L(t.subscribe,'Action "subscribe" is not present in action map'),t},n.mx=function(){var t=this,n=function(n){if(!n[En]){n[En]=!0;var i=function(t,n){return t.closest?t.closest("[subscriptions-action]"):function(t,n,i){var r;for(r=t;r&&void 0!==r;r=r.parentElement)if(n(r))return r;return null}(t,(function(t){return function(t,n){var i=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!i&&i.call(t,"[subscriptions-action]")}(t)}))}(n.target);t.fo(i)}};this.Ws.addEventListener("click",n),this.Ws.body&&this.Ws.body.addEventListener("click",n)},n.fo=function(t){if(t){var n=t.getAttribute("subscriptions-action"),i=t.getAttribute("subscriptions-service");if("local"==i)this.executeAction(n,t.id);else if("auto"==(i||"auto"))if("login"==n){var r=this.cet.selectPlatformForLogin();this.cet.delegateActionToService(n,r.getPlatformKey(),t.id)}else this.executeAction(n,t.id);else i&&this.cet.delegateActionToService(n,i,t.id)}},n.activate=function(t){var n=this;this.Abt(t).then((function(t){n.kd.render(t)}))},n.Abt=function(t){var n=this,i=t.json();return this.cet.getScoreFactorStates().then((function(t){return i.factors=t,n.det.setAuthResponse(i)})).then((function(){return n.Xy.build()})).then((function(){return i}))},n.reset=function(){this.kd.reset()},n.executeAction=function(t){var n=this;return this.Xy.execute(t).then((function(t){return t&&n.cet.resetPlatforms(),!!t}))},n.isPrerenderSafe=function(){return!1},n.getSupportedScoreFactor=function(t){return 0},n.getBaseScore=function(){return this.Net.baseScore||0},n.getEntitlements=function(){},n.pingback=function(t){},n.pingbackReturnsAllEntitlements=function(){return this.Ebt},n.isPingbackEnabled=function(){return!1},n.decorateUI=function(t,n,i){},t}(),Sn="__AMP__",_n=function(){function t(t,n,i){this.t=t,this.Sbt=n,this.gg=i,this.h=null,this._bt=null,this.kbt=this.Wy.bind(this),this.Obt=0,this.Rbt={}}var n=t.prototype;return n.connect=function(t){if(this._bt)throw new Error("already connected");this._bt=t,this.t.addEventListener("message",this.kbt)},n.disconnect=function(){this._bt&&(this._bt=null,this.t.removeEventListener("message",this.kbt))},n.isConnected=function(){return null!=this.gg},n.getTarget=function(){var t=this.Pbt();if(!t)throw new Error("not connected");return t},n.Pbt=function(){return this._bt&&!this.h&&("function"==typeof this.Sbt?this.h=this.Sbt():this.h=this.Sbt),this.h},n.getTargetOrigin=function(){if(null==this.gg)throw new Error("not connected");return this.gg},n.sendCommand=function(t,n){this.cb(void 0,t,n)},n.sendCommandRsvp=function(t,n){var i=String(++this.Obt),r=null,s=new Promise((function(t){r=t}));return this.Rbt[i]={promise:s,resolver:r},this.cb(i,t,n),s},n.cb=function(t,n,i){var r=this.getTarget(),s="connect"==n?null!=this.gg?this.gg:"*":this.getTargetOrigin();r.postMessage({"sentinel":Sn,"_rsvp":t,"cmd":n,"payload":i||null},s)},n.Wy=function(t){var n=this,i=t,r=i.data;if(r&&r.sentinel==Sn){var s=i.origin,e=r.cmd,u=r.payload||null;if(null==this.gg&&"start"==e&&(this.gg=s),null==this.gg&&i.source&&this.Pbt()==i.source&&(this.gg=s),s==this.gg){var o=r._rsvp,c=!!o&&"rsvp"!=e,h=this.xbt(o,e,u);c&&Promise.resolve(h).then((function(t){n.cb(o,"rsvp",{"result":t})}),(function(t){n.cb(o,"rsvp",{"error":String(t)})}))}}},n.xbt=function(t,n,i){if("rsvp"!=n)return this._bt(n,i);var r=t&&this.Rbt[t];r&&("error"in i?r.resolver(Promise.reject(new Error(i.error))):r.resolver(i.result),delete this.Rbt[t])},t}(),kn=function(t){Ft(i,t);var n=Jt(i);function i(t,i,r){var s;return U("iframe"==(s=n.call(this,t,i,r)).Net.type),s.QC=L(s.Net.iframeSrc,'"iframeSrc" URL must be specified'),nn(s.QC,"iframe Url"),s.Ibt=s.Net.iframeVars||null,s.Ibt&&L(v(s.Ibt),'"iframeVars" must be an array'),s.gg=Xt(s.QC).origin,s.jbt=null,s.Tbt=null,s.ib=t.win.document.createElement("iframe"),Tt(s.ib,!1),s.Nbt=new _n(s.wi.win,(function(){return s.ib.contentWindow}),s.gg),s._C=null,s.mx(),s}var r=i.prototype;return r.getEntitlements=function(){var t=this;return this.connect().then((function(){return t.Nbt.sendCommandRsvp("authorize",{}).then((function(t){return t.source="local-iframe",t})).then((function(t){return Mt.parseFromJson(t)}))}))},r.isPingbackEnabled=function(){return!0},r.pingback=function(t){var n=this;return this.connect().then((function(){return n.Nbt.sendCommandRsvp("pingback",{entitlement:t})}))},r.connect=function(){if(!this.Tbt){var t=new e;this.Tbt=t.promise,this.jbt=t.resolve,this._C=this.Ubt(),this.Nbt.connect(this.xbt.bind(this)),this.wi.getBody().appendChild(this.ib),this.ib.src=this.QC}return this.Tbt},r.Ubt=function(){var t=this;return new Promise((function(n){var i=p(JSON.stringify(t.Net)),r=t.cet.getPageConfig();if(i.pageConfig={publicationId:r.getPublicationId(),productId:r.getProductId(),encryptedDocumentKey:t.cet.getEncryptedDocumentKey("local")||null},t.Ibt){var s=t.Ibt.join("&");t.det.collectUrlVars(s,!1).then((function(t){i.iframeVars=t,n(i)}))}else n(i)}))},r.xbt=function(t,n){var i=this;"connect"===t&&this._C.then((function(t){i.Nbt.sendCommandRsvp("start",{"protocol":"amp-subscriptions","config":t}).then((function(){i.jbt&&(i.jbt(),i.jbt=null)}))}))},i}(An),On=function(t){Ft(i,t);var n=Jt(i);function i(t,i,r){var s;return(s=n.call(this,t,i,r)).qct=nn(L(s.Net.authorizationUrl,"Service config does not have authorization Url"),"Authorization Url"),s.wt=D(s.wi.win,"xhr"),s.Zct=s.Net.pingbackUrl||null,s.mx(),s}var r=i.prototype;return r.getEntitlements=function(){var t=this,n=this.det.buildUrl(this.qct,!1),i=this.cet.loadMeteringState();return Promise.all([n,i]).then((function(n){var i=n[0],r=n[1];r&&(i=qt(i,"meteringState",btoa(JSON.stringify(r))));var s=t.cet.getEncryptedDocumentKey("local");return s&&(i=qt(i,"crypt",s)),t.wt.fetchJson(i,{credentials:"include"}).then((function(t){return t.json()})).then((function(n){var i=[];return n.metering&&n.metering.state&&i.push(t.cet.saveMeteringState(n.metering.state)),Promise.all(i).then((function(){return Mt.parseFromJson(n)}))}))}))},r.isPingbackEnabled=function(){return!!this.Zct},r.Lbt=function(t){if(v(t)){var n=[];return t.forEach((function(t){n.push(t.jsonForPingback())})),JSON.stringify(n)}return JSON.stringify(t.jsonForPingback())},r.pingback=function(t){var n=this;if(this.isPingbackEnabled){var i=U(this.Zct);return this.det.buildUrl(i,!0).then((function(i){return n.wt.sendSignal(i,{method:"POST",credentials:"include",headers:{"Content-Type":"text/plain"},body:n.Lbt(t)})}))}},i}(An);function Rn(t,n,i){return"iframe"===n.type?new kn(t,n,i):new On(t,n,i)}var Pn=function(){function t(t){var n=t.platformKey;this.entitlementsWereFetchedWithCurrentMeteringState=!1,this.platformKey=n,this.Dbt=""}var n=t.prototype;return n.saveMeteringState=function(t){var n=this,i=JSON.stringify(t);return Promise.resolve(this.Dbt).then((function(t){var n=i!==t;return t&&n&&j().info("amp-subscriptions","Meter state changed from ".concat(t," to ").concat(i)),n})).then((function(t){t&&(n.Dbt=i,n.entitlementsWereFetchedWithCurrentMeteringState=!1)}))},n.loadMeteringState=function(){return this.Dbt?Promise.resolve(JSON.parse(this.Dbt)):Promise.resolve(null)},t}(),xn=function(){function t(){this.fn=null}var n=t.prototype;return n.add=function(t){var n=this;return this.fn||(this.fn=[]),this.fn.push(t),function(){n.remove(t)}},n.remove=function(t){var n,i,r;this.fn&&(i=t,-1!=(r=(n=this.fn).indexOf(i))&&n.splice(r,1))},n.removeAll=function(){this.fn&&(this.fn.length=0)},n.fire=function(t){if(this.fn)for(var n,r=i(this.fn.slice(),!0);!(n=r()).done;)(0,n.value)(t)},n.getHandlerCount=function(){var t,n;return null!==(t=null===(n=this.fn)||void 0===n?void 0:n.length)&&void 0!==t?t:0},t}(),In=function(){function t(t,n,i,r,s){var u=this;this.Cbt=r||{},this.Mbt=t,this.zbt={},this.Fbt={},t.forEach((function(t){u.Fbt[t]=new e})),this.Kbt=new xn,this.Gbt=new xn,this.Jbt=null,this.Vbt=null,this.$bt=null,this.Bbt=null,this.Ybt=[],this.Qbt=i,this.Wbt=Object.assign(Et,n),this.Zbt=s||new xn}var n=t.prototype;return n.resolvePlatform=function(t,n){this.Cbt[t]=n,this.Gbt.fire({platformKey:t})},n.resetPlatformStore=function(){for(var n in this.Cbt)this.Cbt[n].reset();return new t(this.Mbt,this.Wbt,this.Qbt,this.Cbt,this.Zbt)},n.resetPlatform=function(t){delete this.zbt[t],this.Fbt[t]=new e,this.Cbt[t].reset(),this.Jbt=null,this.Vbt=null,this.$bt=null,this.Bbt=null},n.onPlatformResolves=function(t,n){var i=this,r=this.Cbt[t];r?n(r):this.Gbt.add((function(r){r.platformKey===t&&n(i.getPlatform(t))}))},n.getPlatform=function(t){var n=this.Cbt[t];return U(n),n},n.Hbt=function(){return this.getPlatform("local")},n.getAvailablePlatforms=function(){var t=[];for(var n in this.Cbt){var i=this.Cbt[n];t.push(i)}return t},n.onChange=function(t){this.Kbt.add(t)},n.addOnEntitlementResolvedCallback=function(t){this.Zbt.add(t)},n.resolveEntitlement=function(t,n){n&&(n.service=t),this.zbt[t]=n;var i=this.Fbt[t];i&&i.resolve(n),-1!==this.Ybt.indexOf(t)&&this.Ybt.splice(this.Ybt.indexOf(t),1),n.granted&&this.Xbt(n),this.Kbt.fire({platformKey:t,entitlement:n}),this.Zbt.fire({platformKey:t,entitlement:n})},n.getResolvedEntitlementFor=function(t){return U(this.zbt[t]),this.zbt[t]},n.getEntitlementPromiseFor=function(t){return U(this.Fbt[t]),this.Fbt[t].promise},n.getScoreFactorStates=function(){var t=this,n={};return Promise.all(this.Mbt.map((function(i){return n[i]={},Promise.all(Object.values(gt).map((function(r){return t.qbt(i,r).then((function(t){n[i][r]=t}))})))}))).then((function(){return n}))},n.qbt=function(t,n){var i=this;return this.getEntitlementPromiseFor(t).then((function(){return i.Cbt[t].getSupportedScoreFactor(n)}))},n.getGrantStatus=function(){var t=this;if(null!==this.Jbt)return this.Jbt.promise;for(var n in this.Jbt=new e,this.zbt){var i=this.zbt[n];i.granted&&(this.Xbt(i),this.Jbt.resolve(!0))}return this.twt()?this.Jbt.resolve(!1):this.onChange((function(n){n.entitlement.granted?t.Jbt.resolve(!0):t.twt()&&t.Jbt.resolve(!1)})),this.Jbt.promise},n.Xbt=function(t){(!this.Vbt&&t.granted||this.Vbt&&!this.Vbt.isSubscriber()&&t.isSubscriber())&&(this.Vbt=t)},n.getGrantEntitlement=function(){var t=this,n=function(){return t.Vbt&&(t.Vbt.isSubscriber()||t.Vbt.isFree())||t.twt()};return this.$bt||(this.$bt=new e,n()?this.$bt.resolve(this.Vbt):this.Kbt.add((function(){n()&&t.$bt.resolve(t.Vbt)}))),this.$bt.promise},n.reset=function(){this.Jbt=null},n.getAllPlatformsEntitlements=function(){var t=this;return this.Bbt||(this.Bbt=new e,this.twt()?this.Bbt.resolve(this.nwt()):this.onChange((function(){t.twt()&&t.Bbt.resolve(t.nwt())}))),this.Bbt.promise},n.nwt=function(){var t=[];for(var n in this.zbt)a(this.zbt,n)&&t.push(this.zbt[n]);return t},n.selectPlatform=function(){var t=this;return this.getAllPlatformsEntitlements().then((function(){return t.iwt()}))},n.twt=function(){return Object.keys(this.zbt).length===this.Mbt.length},n.rwt=function(t,n){var i=n.getSupportedScoreFactor(t);return"number"!=typeof i?0:this.Wbt[t]*Math.min(1,Math.max(-1,i))},n.iwt=function(){U(this.twt());for(var t=this.getAvailablePlatforms();t.length;){var n=t.pop(),i=this.getResolvedEntitlementFor(n.getPlatformKey());if(i.isSubscriber()||i.isFree())return n}return this.swt(this.ewt())},n.ewt=function(){var t=this;return this.getAvailablePlatforms().map((function(n){return{platform:n,weight:t.uwt(n)}}))},n.uwt=function(t){var n=[0],i=t.getBaseScore();for(var r in this.Wbt)a(this.Wbt,r)&&n.push(this.rwt(r,t));return i+n.reduce((function(t,n){return t+n}))},n.swt=function(t){var n=this.Hbt();return t.sort((function(t,i){return i.weight===t.weight&&t.platform===n?-1:i.weight-t.weight})),t[0].platform},n.owt=function(t){var n=this.getAvailablePlatforms().map((function(n){var i=n.getSupportedScoreFactor(t);return{platform:n,weight:"number"==typeof i?i:0}}));return this.swt(n)},n.reportPlatformFailureAndFallback=function(t){if(t===this.Hbt().getPlatformKey()&&this.Qbt)this.resolveEntitlement(this.Hbt().getPlatformKey(),this.Qbt),j().warn("amp-subscriptions","Local platform has failed to resolve,  using fallback entitlement.");else if(-1===this.Ybt.indexOf(t)){var n=Mt.empty(t);this.resolveEntitlement(t,n),this.Ybt.push(t)}},n.selectPlatformForLogin=function(){return this.owt(gt.SUPPORTS_VIEWER)},t}(),jn="i-amphtml-subs",Tn=function(){function t(t){this.wi=t,this.ju=C(t,"mutator"),this.setGrantState(null),this.cwt().classList.add("".concat(jn,"-ready")),this.addLoadingBar()}var n=t.prototype;return n.cwt=function(){return this.wi.getBody()},n.Ix=function(t,n){var i=this;this.ju.mutateElement(this.wi.getBody(),(function(){i.cwt().classList.toggle("".concat(jn,"-").concat(t,"-unk"),null===n),i.cwt().classList.toggle("".concat(jn,"-").concat(t,"-yes"),!0===n),i.cwt().classList.toggle("".concat(jn,"-").concat(t,"-no"),!1===n)}))},n.addLoadingBar=function(){var t=this;return this.wi.whenReady().then((function(){var n,i,r=t.wi.getBody();if(!r.querySelector("[subscriptions-section=loading]")){var s=g(t.wi.win.document,"div",{"class":"i-amphtml-subs-progress","subscriptions-section":"loading"});r.insertBefore(s,(n=r,m(/^[\w-]+$/.test(i="footer")),function(t,n){if(void 0!==l?l:l=function(t){try{var n=t.ownerDocument,i=n.createElement("div"),r=n.createElement("div");return i.appendChild(r),i.querySelector(":scope div")===r}catch(t){return!1}}(t))return t.querySelector(w(n,":scope"));var i=function(t,n){var i=t.classList,r="i-amphtml-scoped";i.add(r);var s=w(n,".".concat(r)),e=t.querySelectorAll(s);return i.remove(r),e}(t,n)[0];return void 0===i?null:i}(n,"> ".concat(i))))}}))},n.hwt=function(t,n){var i=this;this.ju.mutateElement(this.wi.getBody(),(function(){i.cwt().classList.toggle("".concat(jn,"-").concat(t),n)}))},n.setGrantState=function(t){this.Ix("grant",t)},n.toggleLoading=function(t){this.hwt("loading",t)},t}(),Nn=function(){function t(t){this.N2=t}var n=t.prototype;return n.getAnalytics=function(){return this.N2.getAnalytics()},n.getDialog=function(){return this.N2.getDialog()},n.getEncryptedDocumentKey=function(t){return this.N2.getEncryptedDocumentKey(t)},n.getPageConfig=function(){return this.N2.getPageConfig()},n.getReaderId=function(t){return this.N2.getReaderId(t)},n.getScoreFactorStates=function(){return this.N2.getScoreFactorStates()},n.delegateActionToLocal=function(t,n){return this.delegateActionToService(t,"local",n)},n.delegateActionToService=function(t,n,i){return this.N2.delegateActionToService(t,n,i)},n.decorateServiceAction=function(t,n,i,r){this.N2.decorateServiceAction(t,n,i,r)},n.resetPlatforms=function(){this.N2.resetPlatforms()},n.selectPlatformForLogin=function(){return this.N2.selectPlatformForLogin()},n.loadMeteringState=function(){return this.N2.awt?this.N2.awt.loadMeteringState():Promise.resolve(null)},n.saveMeteringState=function(t){return this.N2.awt?this.N2.awt.saveMeteringState(t):s()},n.rememberMeteringEntitlementsWereFetched=function(){this.N2.awt&&(this.N2.awt.entitlementsWereFetchedWithCurrentMeteringState=!0)},t}(),Un={"-":"+","_":"/",".":"="};function Ln(t){return St(atob(t.replace(/[-_.]/g,(function(t){return Un[t]}))))}var Dn=function(){function t(t){this.win=t,this.fwt=t.crypto&&(t.crypto.subtle||t.crypto.webkitSubtle)||null}var n=t.prototype;return n.decode=function(t){return this.lwt(t).payload},n.isVerificationSupported=function(){return!!this.fwt},n.decodeAndVerify=function(t,n){var i=this;if(!this.fwt)throw new Error("Crypto is not supported on this platform");return new Promise((function(n){return n(i.lwt(t))})).then((function(t){var r=t.header.alg;if(!r||"RS256"!=r)throw new Error("Only alg=RS256 is supported");return i.vwt(n).then((function(n){var r=Ln(t.sig);return i.fwt.verify({name:"RSASSA-PKCS1-v1_5"},n,r,St(t.verifiable))})).then((function(n){if(n)return t.payload;throw new Error("Signature verification failed")}))}))},n.lwt=function(t){function n(){throw new Error('Invalid token: "'.concat(t,'"'))}var i=t.split(".");3!=i.length&&n();var r=Ln(i[0]),s=Ln(i[1]);return{header:d(At(r),n),payload:d(At(s),n),verifiable:"".concat(i[0],".").concat(i[1]),sig:i[2]}},n.vwt=function(t){var n=this;return t.then((function(t){return n.fwt.importKey("spki",function(t){var n=t.trim().replace(/^-+BEGIN[^-]*-+/,"").replace(/-+END[^-]*-+$/,"").replace(/[\r\n]/g,"").trim();return St(atob(n))}(t),{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"])}))},t}(),Cn=function(){function t(t,n,i,r){this.wi=t,this.cet=i,this.pwt=i.getPageConfig(),this.Ks=Rn(t,n,i),this.Ae=Q(this.wi),this.Ae.onMessage("subscriptionchange",this.dwt.bind(this)),this.mwt=new Dn(t.win),this.bwt=this.pwt.getPublicationId(),this.wwt=this.pwt.getProductId(),this.i=r,this.$r=Y(t.win)}var n=t.prototype;return n.isPrerenderSafe=function(){return!0},n.getEntitlements=function(){var t=this;U(this.wwt);var n,i={"publicationId":this.bwt,"productId":this.wwt,"origin":this.i},r=this.Ae.getParam("cryptokeys")||"google.com";if(r)for(var s=r.split(","),e=0;e!=s.length&&!(n=this.cet.getEncryptedDocumentKey(s[e]));e++);return n&&(i.encryptedDocumentKey=n),this.$r.timeoutPromise(3e3,this.Ae.sendMessageAwaitResponse("auth",i)).then((function(n){var i=(n=n||{}).error,r=n.authorization,s=n.decryptedDocumentKey;if(i)throw new Error(i.message);return r?t.ywt(r,s).catch((function(n){throw t.gwt(n.message),n})):Mt.empty("local")}))},n.ywt=function(t,n){var i=this;return new Promise((function(r){var s=Ht(i.wi.win),e=Xt(function(t){if(!function(t){return Qt.cdnProxyRegex.test(Zt(t).origin)}(t=Zt(t)))return t.href;var n=t.pathname.split("/"),i=n[1];L(Wt.has(i),"Unknown path prefix in url %s",t.href);var r=n[2],s="s"==r?"https://"+decodeURIComponent(n[3]):"http://"+decodeURIComponent(r);return L(s.indexOf(".")>0,"Expected a . in origin %s",s),n.splice(1,"s"==r?3:2),s+n.join("/")+function(t,n){if(!t||"?"==t)return"";var i=new RegExp("[?&]".concat("(amp_(js[^&=]*|gsa|r|kit)|usqp)","\\b[^&]*"),"g"),r=t.replace(i,"").replace(/^[?&]/,"");return r?"?"+r:""}(t.search)+(t.hash||"")}(i.wi.win.location)).origin,u=i.mwt.decode(t),o=L(i.pwt.getProductId(),"Product id is null");if(u.aud!=s&&u.aud!=e)throw j().createError('The mismatching "aud" field: '.concat(u.aud));if(u.exp<Math.floor(Date.now()/1e3))throw j().createError("Payload is expired");var c,h=u.entitlements,a=Mt.empty("local");if(h){if(Array.isArray(h)){for(var f=0;f<h.length;f++)if(-1!==h[f].products.indexOf(o)){c=h[f];break}}else-1!==h.products.indexOf(o)&&(c=h);c&&(a=new Mt({source:"viewer",raw:t,granted:!0,grantReason:c.subscriptionToken?Lt:"",dataObject:c,decryptedDocumentKey:n}))}u.metering&&!a.granted&&(a=new Mt({source:u.iss||"",raw:t,granted:!0,grantReason:Dt,dataObject:u.metering,decryptedDocumentKey:n})),a.service="local",r(a)}))},n.gwt=function(t){this.Ae.sendMessage("auth-rejected",{"reason":t})},n.getPlatformKey=function(){return this.Ks.getPlatformKey()},n.activate=function(){},n.reset=function(){},n.isPingbackEnabled=function(){return this.Ks.isPingbackEnabled()},n.pingbackReturnsAllEntitlements=function(){return this.Ks.pingbackReturnsAllEntitlements()},n.pingback=function(t){this.Ks.pingback(t)},n.getSupportedScoreFactor=function(t){return this.Ks.getSupportedScoreFactor(t)},n.getBaseScore=function(){return 0},n.executeAction=function(t,n){return this.Ks.executeAction(t,n)},n.decorateUI=function(t,n,i){return this.Ks.decorateUI(t,n,i)},n.dwt=function(){this.cet.resetPlatforms()},t}();function Mn(t,n,i){if(n[i])return n[i];var r=t.querySelector("style[".concat(i,"], link[").concat(i,"]"));return r?(n[i]=r,r):null}function zn(t,n){for(var i=t.styleSheets,r=0;r<i.length;r++)if(i[r].ownerNode==n)return!0;return!1}var Fn=self.__AMP_ERRORS||[];self.__AMP_ERRORS=Fn;var Kn="local-viewer",Gn=function(){function t(t){this.wi=t,this.Ewt=null,this.$r=Y(t.win),this.Ls=W(t)}var n=t.prototype;return n.scheduleView=function(t){var n=this;return this.Ewt=null,this.wi.whenReady().then((function(){return new Promise((function(t){n.wi.isVisible()&&t(),n.wi.onVisibilityChanged((function(){n.wi.isVisible()&&t()}))})).then((function(){return n.Awt(t)}))}))},n.Awt=function(t){var n=this;return this.Ewt||(N().fine(Kn,"start view monitoring"),this.Ewt=this.Swt(t).catch((function(t){throw N().fine(Kn,"view cancelled:",t),n.Ewt=null,t}))),this.Ewt},n.Swt=function(t){var n=this;if(0==t)return s();var i=[];return new Promise((function(r,s){i.push(n.wi.onVisibilityChanged((function(){n.wi.isVisible()||s(new Error("CANCELLED"))})));var e,u,o,c=n.$r.delay(r,t);i.push((function(){return n.$r.cancel(c)})),i.push(n.Ls.onScroll(r)),i.push((e=n.wi.getRootNode(),u=r,o=rn(e,"click",(function(t){try{u(t)}finally{u=null,o()}}),void 0)))})).then((function(){i.forEach((function(t){return t()}))}),(function(t){throw i.forEach((function(t){return t()})),t}))},t}(),Jn="amp-subscriptions",Vn=function(){function t(t){var n=t.getElementById(Jn);this.wi=t,function(t,n,i,r,s){var e=t.getHeadNode(),u=function(t,n,i,r){var s=t.__AMP_CSS_SM;s||(s=t.__AMP_CSS_SM=h());var e="amp-extension=".concat(r);if(e){var u=Mn(t,s,e);if(u)return"STYLE"==u.tagName&&u.textContent!==n&&(u.textContent=n),u}var o=(t.ownerDocument||t).createElement("style");o.textContent=n;return o.setAttribute("amp-extension",r),function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(i){var r=i.nextSibling;t.insertBefore(n,r)}else y(t,n)}(t,o,Mn(t,s,"amp-runtime")),e&&(s[e]=o),o}(e,function(t,n){var i=t.__AMP_CSS_TR;return i?i(n):n}(e,'[subscriptions-action]:not(.i-amphtml-subs-display),[subscriptions-actions]:not(.i-amphtml-subs-display),[subscriptions-section=actions]:not(.i-amphtml-subs-display),body.i-amphtml-subs-delegated [subscriptions-section=actions],body.i-amphtml-subs-grant-unk [subscriptions-action],body.i-amphtml-subs-grant-unk [subscriptions-section=actions],body:not(.i-amphtml-subs-grant-no) [subscriptions-section=content-not-granted],body:not(.i-amphtml-subs-grant-yes) [subscriptions-section=content],body:not(.i-amphtml-subs-loading) [subscriptions-section=loading]{display:none!important}amp-subscriptions-dialog{display:block!important;position:fixed!important;bottom:0!important;left:0!important;margin-left:0!important;width:100%!important;z-index:2147483641!important;max-height:90vh;box-sizing:border-box;opacity:1;background-image:none;background-color:#fff;box-shadow:0 0 5px 0 rgba(0,0,0,0.2);margin-bottom:0;transition:transform 0.3s ease-in}.i-amphtml-subs-dialog-close-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\'data:image/svg+xml;charset=utf-8,<svg width="13" height="13" viewBox="341 8 13 13" xmlns="http://www.w3.org/2000/svg"><path fill="%234F4F4F" d="M354 9.31 352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z" fill-rule="evenodd"/></svg>\');background-size:13px 13px;background-position:9px;background-color:#fff;background-repeat:no-repeat;box-shadow:0 -1px 1px 0 rgba(0,0,0,0.2);border:none;border-radius:12px 0 0 0;cursor:pointer}body:not(.i-amphtml-subs-grant-yes) .i-amphtml-subs-dialog-close-button{display:none}.i-amphtml-subs-progress{height:2px;background-color:#ccc;position:relative;margin:8px;overflow:hidden}.i-amphtml-subs-progress:after{content:"";background-color:#2196f3;height:2px;position:absolute;left:0;top:0;width:20%;animation:i-amphtml-subs-loading-progress 1500ms ease-in-out infinite}@keyframes i-amphtml-subs-loading-progress{0%{transform:translateX(-100%)}to{transform:translateX(500%)}}@media (min-width:480px){amp-subscriptions-dialog{width:480px!important;left:-240px!important;margin-left:50vw!important}}\n/*# sourceURL=/extensions/amp-subscriptions/0.1/amp-subscriptions.css*/'),0,"amp-subscriptions");if(i){var o=t.getRootNode();if(zn(o,u))return u;var c=setInterval((function(){zn(o,u)&&clearInterval(c)}),4)}}(t,0,(function(){})),this.Jh=null,this.kd=new Tn(t),this.pwt=null,this._wt=null,this.kwt=null,this.Owt=j().assertElement(n),this.let=new yt(this.Owt),this.cet=new Nn(this),this.ebt=new Nt(t),this.Rwt=new Gn(t),this.Ae=Q(t),this.Pwt=null,this.$r=Y(t.win),this.xwt=this.Ae.hasCapability("auth"),this.Iwt=this.xwt&&this.Ae.hasCapability("paywall"),this.jwt=M(t,"cid"),this.Twt={},this.Nwt=new Rt(t),this.awt=null}var n=t.prototype;return n.start=function(){var t=this;return this.Ur().then((function(){if(t.let.event("subscriptions-started"),t.kd.toggleLoading(!0),L(t.pwt,"Page config is null"),t.xwt)return t.Uwt(),void t.Lwt(!1);L(t._wt.services,"Services not configured in service config");var n,i=t._wt.services.map((function(t){return t.serviceId||"local"}));t.Dwt(i),t._wt.services.forEach((function(n){t.Cwt(n)})),t.kwt.getAvailablePlatforms().forEach((function(n){t.Mwt(n)})),(n=t.wi,n.waitForBodyOpen().then((function(){var t,i,r=n.getBody(),s=(t=r,i=function(){return!!r.firstElementChild},new Promise((function(n){!function(t,n,i){if(n(t))i();else{var r=b(t);if(r.MutationObserver){var s=new r.MutationObserver((function(){n(t)&&(s.disconnect(),i())}));s.observe(t,{childList:!0})}else var e=r.setInterval((function(){n(t)&&(r.clearInterval(e),i())}),5)}}(t,i,n)})));return Y(n.win).timeoutPromise(2e3,s).then((function(){return"AMP-STORY"===r.firstElementChild.tagName}),(function(){return!1}))}))).then((function(n){n&&t.ebt.getRoot().classList.add("i-amphtml-story-subscriptions-dialog-wrapper"),t.Lwt(!n)}))})),this},n.getAccessReaderId=function(){var t=this;return this.Ur().then((function(){return t.getReaderId("local")}))},n.getAnalytics=function(){return this.let},n.getAuthdataField=function(t){var n=this;return this.Ur().then((function(){return n.kwt.getEntitlementPromiseFor("local")})).then((function(n){return f(n.json(),t)}))},n.getDialog=function(){return this.ebt},n.maybeRenderDialogForSelectedPlatform=function(){var t=this;return this.Ur().then((function(){if(!t.xwt&&!t._wt.alwaysGrant)return t.zwt()}))},n.getGrantStatus=function(){return this.kwt.getGrantStatus()},n.addOnEntitlementResolvedCallback=function(t){this.kwt.addOnEntitlementResolvedCallback(t)},n.getEncryptedDocumentKey=function(t){return this.Nwt.getEncryptedDocumentKey(t)},n.getPageConfig=function(){return U(this.pwt)},n.getReaderId=function(t){var n=this.Twt[t];if(!n){var i=s(),r="amp-access"+("local"==t?"":"-"+t);n=this.jwt.then((function(t){return t.get({scope:r,createCookieIfNotPresent:!0},i)})),this.Twt[t]=n}return n},n.getScoreFactorStates=function(){return this.kwt.getScoreFactorStates()},n.registerPlatform=function(t,n){var i=this;return this.Ur().then((function(){if(!i.xwt){var r=L(i._wt.services.filter((function(n){return(n.serviceId||"local")===t}))[0],"No matching services for the ID found"),s=n(r,i.cet);i.kwt.resolvePlatform(s.getPlatformKey(),s),i.let.serviceEvent("subscriptions-service-registered",s.getPlatformKey()),i.let.serviceEvent("subscriptions-platform-registered",s.getPlatformKey()),i.Mwt(s)}}))},n.selectPlatformForLogin=function(){return this.kwt.selectPlatformForLogin()},n.Ur=function(){var t=this;if(!this.Jh){var n=new Ut(this.wi),i=new ct(n);this.Jh=Promise.all([this.Fwt(),i.resolveConfig()]).then((function(n){t._wt=n[0],t.pwt=n[1]})).then((function(){t.Kwt()}))}return this.Jh},n.Cwt=function(t){"local"==(t.serviceId||"local")&&this.kwt.resolvePlatform("local",Rn(this.wi,t,this.cet))},n.Fwt=function(){var t=this;return new Promise((function(n){n(d(t.Owt.textContent,(function(t){throw j().createError('Failed to parse "amp-subscriptions" JSON: ',t)})))}))},n.Gwt=function(t){this.kd.toggleLoading(!1),this.Pwt=this.Rwt.scheduleView(2e3),this.Iwt&&!t||this.kd.setGrantState(t)},n.Jwt=function(t,n){this.kwt.resolveEntitlement(t,n),n.decryptedDocumentKey&&this.Nwt.tryToDecryptDocument(n.decryptedDocumentKey),this.let.serviceEvent("subscriptions-entitlement-resolved",t)},n.Vwt=function(t){var n=this;return t.getEntitlements().then((function(i){return i&&i.granted&&n.Nwt.isDocumentEncrypted()&&!i.decryptedDocumentKey?(("local"==t.getPlatformKey()?j():N()).error(Jn,"".concat(t.getPlatformKey(),": Subscription granted and encryption enabled, ")+"but no decrypted document key returned."),null):i}))},n.Mwt=function(t){var n=this;if(this.$wt())return s();var i,r=3e3;return(i=self,i.__AMP_MODE?i.__AMP_MODE:i.__AMP_MODE=function(t){return{localDev:!1,development:R(t,_(t)),esm:!1,test:!1,rtvVersion:O(t),ssrReady:!1}}(i)).development&&(r=6e3),(t.isPrerenderSafe()?s():this.wi.whenFirstVisible()).then((function(){return n.$r.timeoutPromise(r,n.Vwt(t)).then((function(i){return i=i||Mt.empty(t.getPlatformKey()),n.Jwt(t.getPlatformKey(),i),i})).catch((function(i){var r=t.getPlatformKey();throw n.kwt.reportPlatformFailureAndFallback(r),j().createError("fetch entitlements failed for ".concat(r),i)}))}))},n.Dwt=function(t){var n=this._wt.fallbackEntitlement?Mt.parseFromJson(this._wt.fallbackEntitlement):Mt.empty("local");this.kwt=new In(t,this._wt.score,n),this.Bwt(this.kwt)},n.Uwt=function(){var t=this,n=Ht(this.wi.win);this.Dwt(["local"]),this._wt.services.forEach((function(i){if("local"==(i.serviceId||"local")){var r=new Cn(t.wi,i,t.cet,n);t.kwt.resolvePlatform("local",r),t.Vwt(r).then((function(n){U(n),t.Jwt("local",n)})).catch((function(n){t.kwt.reportPlatformFailureAndFallback("local"),N().error(Jn,"Viewer auth failed:",n)}))}}))},n.Lwt=function(){var t=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=this.kwt.getGrantStatus(),r=this.kwt.getGrantEntitlement(),s=Promise.all([i,r]);return s.then((function(i){var r=i[0],s=i[1],e=function(){return t.Ywt({granted:r,shouldActivatePlatform:n})};if(t.awt){var u=t.kwt.getPlatform(t.awt.platformKey);if(r){if(!s||s.grantReason!==Dt||s.service!==t.awt.platformKey)return void e();u.activate(s,s,(function(){t.Ywt({granted:!0,shouldActivatePlatform:!1})}))}else t.awt.entitlementsWereFetchedWithCurrentMeteringState?e():t.awt.loadMeteringState().then((function(n){if(n)t.resetPlatform(t.awt.platformKey);else{var i=Mt.empty("local");u.activate(i,i,(function(){return t.Lwt()}))}}))}else e()}))},n.Ywt=function(t){var n=t.granted,i=t.shouldActivatePlatform;this.Gwt(n),this.Qwt(),i&&this.zwt()},n.zwt=function(){var t=this;return Promise.all([this.kwt.getGrantStatus(),this.kwt.selectPlatform(),this.kwt.getGrantEntitlement()]).then((function(n){var i=n[1],r=n[2],s=t.kwt.getResolvedEntitlementFor(i.getPlatformKey()),e=r||s;i.activate(s,r),t.let.serviceEvent("subscriptions-service-activated",i.getPlatformKey()),t.let.serviceEvent("subscriptions-platform-activated",i.getPlatformKey()),e.granted?t.let.serviceEvent("subscriptions-access-granted",e.service):(t.let.serviceEvent("subscriptions-paywall-activated",i.getPlatformKey()),t.let.serviceEvent("subscriptions-access-denied",i.getPlatformKey()))}))},n.Qwt=function(){var t=this;return this.Pwt?this.Pwt.then((function(){t.kwt.getAvailablePlatforms().forEach((function(n){n.isPingbackEnabled()&&(n.pingbackReturnsAllEntitlements()?t.kwt.getAllPlatformsEntitlements().then((function(t){return n.pingback(t)})):t.kwt.getGrantEntitlement().then((function(t){return n.pingback(t||Mt.empty("local"))})))}))})):null},n.resetPlatforms=function(){var t=this;this.kwt=this.kwt.resetPlatformStore(),this.kd.toggleLoading(!0),this.awt&&(this.awt.entitlementsWereFetchedWithCurrentMeteringState=!1),this.kwt.getAvailablePlatforms().forEach((function(n){t.Mwt(n)})),this.let.serviceEvent("subscriptions-service-re-authorized",""),this.let.serviceEvent("subscriptions-platform-re-authorized",""),this.Lwt()},n.resetPlatform=function(t){this.kd.toggleLoading(!0),this.kwt.resetPlatform(t);var n=this.kwt.getPlatform(t);this.Mwt(n),this.Lwt()},n.delegateActionToLocal=function(t,n){return this.delegateActionToService(t,"local",n)},n.delegateActionToService=function(t,n){var i=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(s){i.kwt.onPlatformResolves(n,(function(e){U(e),i.let.event(mt,{"action":t,"serviceId":n},{"action":t,"status":wt}),s(e.executeAction(t,r))}))}))},n.decorateServiceAction=function(t,n,i,r){this.kwt.onPlatformResolves(n,(function(n){U(n),n.decorateUI(t,i,r)}))},n.Bwt=function(t){this.$wt()&&t.resolveEntitlement("local",new Mt({source:"",raw:"",granted:!0,grantReason:Ct,dataObject:{}}))},n.$wt=function(){return!this.pwt.isLocked()||this._wt.alwaysGrant},n.Kwt=function(){var t=this._wt.services.find((function(t){return t.enableMetering}));t&&(this.awt=new Pn({platformKey:t.serviceId}))},t}();t.registerServiceForDoc("subscriptions",(function(t){return new Vn(t).start()}))}();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-subscriptions-0.1.js.map