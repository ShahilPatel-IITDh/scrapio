class InfiniteScroll{constructor(){this.container=null,this.id=null,this.lastItemId=null,this.isFetching=!1,this.isLastPageAppended=!1,this.boxName=null,this.itemCount=0,this.scrollEventHandler=this.scrollEventHandler.bind(this),this.getContainer(),this.getLastItemId(),this.getBoxName(),this.registerEventListener()}getContainer(){this.container=document.querySelector(".infinite-scroll-container"),this.id=this.container.getAttribute("id").split("-")[2]}getLastItemId(){if(null!==this.container){const t=this.container.querySelectorAll(".infinite-scroll-item");this.lastItemId=t[t.length-1].getAttribute("id").split("-")[3]}}getBoxName(){if(null!==this.container){let t=this.container.parentNode;for(;-1===t.className.split(" ").indexOf("box");)t=t.parentNode;this.boxName=t.getAttribute("box-name")}}registerEventListener(){null!==this.lastItemId&&window.addEventListener("scroll",this.scrollEventHandler)}unregisterEventListener(){window.removeEventListener("scroll",this.scrollEventHandler)}scrollEventHandler(t){document.documentElement.offsetHeight-50<=window.innerHeight+window.scrollY&&!1===this.isFetching&&!1===this.isLastPageAppended&&this.getNextPage()}async getNextPage(){this.isFetching=!0,(await fetch("/is/"+this.id+"/"+this.lastItemId,{method:"GET",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"}})).json().then(t=>{this.appendNextPage(t)})}appendNextPage(t){if(!t.hasOwnProperty("status")||t.hasOwnProperty("status")&&200===t.status){if(""===t.build)return this.isLastPageAppended=!0,void this.unregisterEventListener();this.container.innerHTML+=t.build;const e=this.container.querySelector(".js-async-cts");if(e){let t=e.dataset.ctsId;e.classList.remove("js-async-cts"),this.setCTS(t)}this.itemCount+=t.itemCount,document.dispatchEvent(new CustomEvent("ajaxEvent",{detail:{boxName:this.boxName,elemCount:this.itemCount}})),this.getLastItemId(),setLazyLoad(),this.isFetching=!1}}setCTS(t){try{tagging.renderAsync("list-content-dynamic",`#cts-infinite-scroll-item-${t}`)}catch(t){tagging&&tagging.log(t)}}}new InfiniteScroll;
