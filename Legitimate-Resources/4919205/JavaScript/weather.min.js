var Weather=function(e,t){this.element=e,this.data=t,this.setActiveCity(decodeURIComponent(this.getCity()))};function setWeather(){"object"==typeof Helpers?Weather.create(weatherData):window.setTimeout(function(){setWeather()},1e3)}Weather.prototype.getCity=function(){var e=Helpers.getCookieValue("city");return e||(e="Budapest"),e},Weather.prototype.save=function(e){Helpers.createCookie("city",encodeURIComponent(e),"10:y"),this.setActiveCity(e)},Weather.prototype.setActiveCity=function(e){var t=this.data[e],r=this.element.querySelector(".city-name"),i=this.element.querySelector(".temperature.current"),n=this.element.querySelector(".temperature.max.value"),s=this.element.querySelector(".temperature.min.value"),a=this.element.querySelector(".wind.value"),o=this.element.querySelector(".rain.value");r.innerHTML=e,i.innerHTML=t.temperature,n.innerHTML=t.maximumTemperature,s.min=t.minimumTemperature,a.wind=t.wind,o.rain=t.rain},Weather.prototype.init=function(){this.setListeners(),this.setRefresh()},Weather.prototype.setListeners=function(){this.setCityNameListener(),this.setCityButtonListener()},Weather.prototype.setRefresh=function(){var e=this;window.setInterval(function(){new Promise(function(e,t){var r=new XMLHttpRequest;r.open("get","/weather"),r.onload=function(){this.status>=200&&this.status<300?e(r.response):t({status:this.status,statusText:r.statusText})},r.onerror=function(){t({status:this.status,statusText:r.statusText})},r.send()}).then(function(t){var r=JSON.parse(t);e.data=r.weather.cities,e.setActiveCity(e.getCity())})},9e5)},Weather.prototype.setCityNameListener=function(){var e=this.element.querySelector(".selected-city");if(e){var t=this;e.addEventListener("click",function(){var e=t.element.querySelector(".line-weather-city-selector");e&&(-1!==e.className.indexOf(" active")?e.className=e.className.replace(" active",""):e.className+=" active")})}},Weather.prototype.setCityButtonListener=function(){var e=this.element.querySelector(".city-selector-button");if(e){var t=this;e.addEventListener("click",function(){var e=t.element.querySelector(".line-weather-city-selector");e&&(e.className=e.className.replace(" active",""),t.save(e.querySelector("option:checked").value))})}},Weather.create=function(e){for(var t=document.getElementsByClassName("line-weather"),r=0;r<t.length;r++)new Weather(t[r],e).init()},setWeather();
