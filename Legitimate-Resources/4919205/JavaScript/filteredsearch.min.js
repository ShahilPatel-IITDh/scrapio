var fsShowEvent=new Event("fsShow"),fsBlock=document.querySelector(".block.filteredsearch");function Filteredsearch(){this.form=document.querySelector(".search-content form"),this.overlay=document.querySelector(".filteredsearch-overlay"),this.searchInput=this.form.querySelector(".search-input"),this.block=fsBlock,this.contentContainer=this.block.querySelector(".container"),this.content=this.block.querySelector(".block-content"),this.closeBtn=this.contentContainer.querySelector(".btn-filteredsearch-close"),this.searchLink=this.contentContainer.querySelector(".filteredsearch-footer a"),this.filteredsearchData=JSON.parse(filteredsearchData),this.searchTerm=null,this.boxes=[],this.isClosable=!0,this.defaultBlockTop=0,this.defaultOverlayTop=0,this.baseWindowTop=0,this.baseOverlayTop=0,this.baseBlockTop=0,this.start=function(){var e=this;this.scrollBlock=this.scrollBlock.bind(this),this.searchInput.addEventListener("keyup",function(t){var s=t.target.value.trim();(s=e.replaceAllAccents(s.toLowerCase())).length>=3?(e.searchTerm=s,e.search()):(Helpers.removeClass(e.overlay,"active"),Helpers.removeClass(e.block,"visible"))}),this.closeBtn.addEventListener("click",function(t){t.preventDefault(),e.close()}),this.contentContainer.addEventListener("mouseover",function(){e.isClosable=!1}),this.contentContainer.addEventListener("mouseout",function(){e.isClosable=!0}),this.block.addEventListener("click",function(t){e.isClosable&&e.close()}),this.searchLink.addEventListener("click",function(t){"#"!==t.target.getAttribute("href")&&0!==t.target.getAttribute("href").length||t.preventDefault(),window.setTimeout(function(){e.close()},100)})},this.replaceAllAccents=function(e){for(var t=["ö","ü","ó","ő","ú","é","á","ű","í"],s=["o","u","o","o","u","e","a","u","i"],o=0;o<t.length;o++)e=e.split(t[o]).join(s[o]);return e},this.search=function(){var e=this;this.boxes=[];var t=e.searchTerm.split(" "),s=this.filteredsearchData.data.filter(function(e){if(0==e.is_18_plus){for(var s in t)if(0===e.term.indexOf(t[s])&&t[s].length>2)return!0;return!1}for(var s in t)if(e.term==t[s])return!0;return!1});s.length?(s.forEach(function(t){t.boxes.forEach(function(t){e.filteredsearchData.boxes.hasOwnProperty(t)&&-1===e.boxes.indexOf(e.filteredsearchData.boxes[t])&&e.boxes.push(e.filteredsearchData.boxes[t])})}),this.show()):(Helpers.removeClass(this.block,"visible"),Helpers.removeClass(this.overlay,"active"))},this.show=function(){if(Helpers.removeClass(this.block,"visible"),this.boxes.length){Helpers.addClass(this.overlay,"active"),Helpers.addClass(this.block,"visible"),window.pageYOffset>0&&this.setBlockForScroll(),this.content.innerHTML='<div class="container structure-container"></div><div class="container structure-container"></div><div class="container structure-container last"></div>';var e=this.block.querySelectorAll(".block-content .structure-container");e=Array.prototype.slice.call(e),this.boxes.forEach(function(t){e.sort(function(e,t){return e.clientHeight-t.clientHeight}),e[0].innerHTML+=t}),this.setSearchLink(),this.block.dispatchEvent(fsShowEvent)}},this.resetTopPosition=function(){this.defaultBlockTop=0,this.defaultOverlayTop=0,this.baseWindowTop=0,this.baseOverlayTop=0,this.baseBlockTop=0,this.overlay.removeAttribute("style"),this.block.removeAttribute("style"),window.removeEventListener("scroll",this.scrollBlock)},this.setBlockForScroll=function(){this.resetTopPosition(),this.baseWindowTop=window.pageYOffset,this.defaultOverlayTop=parseInt(window.getComputedStyle(this.overlay).top),this.defaultBlockTop=parseInt(window.getComputedStyle(this.block).top),this.baseOverlayTop=this.defaultOverlayTop+window.pageYOffset,this.baseBlockTop=this.defaultBlockTop+window.pageYOffset,this.overlay.style.top=this.baseOverlayTop+"px",this.block.style.top=this.baseBlockTop+"px",window.addEventListener("scroll",this.scrollBlock)},this.scrollBlock=function(){window.pageYOffset<=this.baseWindowTop?(this.overlay.style.top=this.defaultOverlayTop+"px",this.block.style.top=this.defaultBlockTop+"px",this.baseOverlayTop=this.defaultOverlayTop+window.pageYOffset,this.baseBlockTop=this.defaultBlockTop+window.pageYOffset,this.overlay.style.position="fixed",this.block.style.position="fixed",this.baseWindowTop=window.pageYOffset):(this.overlay.style.top=this.baseOverlayTop+"px",this.block.style.top=this.baseBlockTop+"px",this.overlay.style.position="absolute",this.block.style.position="absolute")},this.close=function(){this.content.innerHTML="",window.removeEventListener("scroll",this.scrollBlock),this.overlay.removeAttribute("style"),this.block.removeAttribute("style"),Helpers.removeClass(this.overlay,"active"),Helpers.removeClass(this.block,"visible"),this.searchInput.value="",this.setSearchLink()},this.setSearchLink=function(){if(this.searchLink.setAttribute("href","#"),this.searchInput.value.length){var e=this.form.getAttribute("action")+"?",t=this.form.querySelectorAll('input:not([type="submit"])'),s=[];[].forEach.call(t,function(e){s.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),e+=s.join("&"),this.searchLink.setAttribute("href",e)}},this.start()}var filteredsearchLoadAttempt=0;function setFilteredsearch(){filteredsearchLoadAttempt++,"object"==typeof Helpers&&"string"==typeof filteredsearchData?new Filteredsearch:filteredsearchLoadAttempt<=10?window.setTimeout(function(){setFilteredsearch()},1e3):console.error("FILTEREDSEARCH CANNOT LOAD")}setFilteredsearch();
