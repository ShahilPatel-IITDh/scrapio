var JonahFormValidateRecaptcha={blocked:!1,recheckRecaptcha:!0,siteKeyValidated:!1,siteKeyValid:!0,bypassToken:{_token:null,_request:null,_callback:[],_retrieve:function(e){var a=this;this._token||this._request||(this._request=$.post("/form-validate-events/",{action:e,page:window.location.href},function(e){e&&(e=JSON.parse(e),a._token=e.bypass_token,a._fireCallbacks(a._token))}))},_fireCallbacks:function(e){if(this._callback)for(i=0;i<this._callback.length;i++){(0,this._callback[i])(e)}},get:function(e,a,t){this._callback.push(a),this._token?a(this._token):this._retrieve(e,t)}},showLogs:function(){return"undefined"!=typeof console&&window.location.search.match(/show-rc-logs=1/gi)},log:function(e,a){if(this.showLogs())switch(a){case"error":console.error(e);break;case"warn":console.warn(e);break;default:console.log(e)}},recaptchaNeeded:function(){return $("[data-recaptcha],[data-ts-recaptcha]").length},recaptchaNeedsRecheck:function(){return this.recheckRecaptcha},evalAsyncLoad:function(e){this.recaptchaNeeded()&&"undefined"!=typeof JonahFormValidateRecaptchaAsyncLoad?$(window).data("recaptcha-requested")?e&&e():$.getScript(JonahFormValidateRecaptchaAsyncLoad,function(){$(window).data("recaptcha-requested",1),e&&e()}):"undefined"!=typeof JonahFormValidateRecaptchaAsyncLoad&&JonahFormValidateRecaptchaAsyncLoad||$(window).data("recaptcha-requested",1)},watchDom:function(){var e,a=this;$("body").bind("DOMSubtreeModified",function(t){e&&clearTimeout(e),e=setTimeout(function(){a.log("DOM change detected."),a.load()},500)})},disableSubmitButtons:function(){$("[data-recaptcha],[data-ts-recaptcha]").not("[data-recaptcha-bound=1]").attr("disabled",1).css({opacity:.4})},enableSubmitButtons:function(){$("[data-recaptcha],[data-ts-recaptcha]").removeAttr("disabled").css({opacity:1})},evalButtons:function(){var e=this;this.blocked?JonahFormValidateRecaptcha.bypassToken.get("recaptcha-blocked",function(e){$("[data-recaptcha],[data-ts-recaptcha]").not("[data-recaptcha-bound=1]").each(function(){var a=$(this),t=$(this).parents("form"),r=$('<button type="submit" class="'+a.get(0).className+'">'+a.text()+"</button>");t.data("jr.allow-recaptcha-bypass",1),t.find('[name="bypass-token"]').length?t.find('[name="bypass-token"]').val(e):t.prepend('<input type="hidden" value="'+e+'" name="bypass-token" />'),a.after(r).remove()})}):"undefined"!=typeof grecaptcha&&$("[data-recaptcha],[data-ts-recaptcha]").not("[data-recaptcha-bound=1]").each(function(){var a=$(this),t=$(this).parents("form"),r=$('<button type="submit" class="'+a.get(0).className+'">'+a.text()+"</button>");a.attr("data-recaptcha-bound",1),void 0===t.data("jr.recaptcha-widget-id")&&grecaptcha.ready(function(){try{var n=grecaptcha.render(a.get(0),{sitekey:a.data("sitekey"),callback:function(e){e&&(t.data("jr.last-recaptcha-response",e),a.after(r).remove(),t.submit())},"error-callback":function(){t.data("jr.last-recaptcha-response")?(e.log("Having trouble connecting to ReCaptcha."),t.trigger("show-error-message","Having trouble connecting to ReCaptcha. You may be submitting the form too rapidly. Please try submitting again in a moment.")):(e.log("ReCaptcha error-callback executed. Possible bad Site Key."),JonahFormValidateRecaptcha.validateSiteKey(function(n){n||(e.log("ReCaptcha Site Key is invalid. Adjusting forms as necessary to use bypass tokens."),JonahFormValidateRecaptcha.bypassToken.get("invalid-recaptcha-site-key",function(e){t.data("jr.allow-recaptcha-bypass",1),t.find('[name="bypass-token"]').length?t.find('[name="bypass-token"]').val(e):t.prepend('<input type="hidden" value="'+e+'" name="bypass-token" />'),a.after(r).remove()}))}))}});t.data("jr.recaptcha-widget-id",n)}catch(t){if(t&&(t=String(t),e.log("Error when trying to render ReCaptcha: ",t),t.match(/reCAPTCHA has already been rendered/gi))){var i=a.clone().removeAttr("data-recaptcha-bound");a.after(i).remove(),JonahFormValidateRecaptcha.evalButtons()}}})})},evalRecaptchaLoad:function(e){var a=this;if(this.recaptchaNeedsRecheck()){if(a.recaptchaNeeded()&&"undefined"!=typeof JonahFormValidateExpectingRecaptcha&&JonahFormValidateExpectingRecaptcha){a.recheckRecaptcha=!1;var t,r=0;a.log("Trying to request the ReCaptcha script from Google..."),a.disableSubmitButtons(),t=setInterval(function(){$(window).data("recaptcha-requested")&&"undefined"!=typeof grecaptcha?(clearInterval(t),a.log("ReCaptcha script requested succesfully."),a.enableSubmitButtons(),e&&e(!0)):r>=8&&(clearInterval(t),a.log("ReCaptcha script has been blocked and was not requested succesfully. Adjust forms as necessary to use bypass tokens."),a.enableSubmitButtons(),e&&e(!1)),++r},500)}}else $(window).data("recaptcha-requested")&&!this.blocked?(a.log("ReCaptcha has previously been requested succesfully. Adjusting forms as necessary."),e&&e(!0)):this.blocked&&(a.log("ReCaptcha has not previously been requested succesfully. Adjusting forms as necessary to use bypass tokens."),e&&e(!1))},load:function(e){var a=this;this.evalAsyncLoad(),this.evalRecaptchaLoad(function(t){a.blocked=!t,a.evalButtons(),e&&e(t)})},validateSiteKey:function(e){var a=this;this.siteKeyValidated?e&&e(a.siteKeyValid):JonahFormValidateRecaptcha.whenBadgeAvailable(function(t){var r=t.find("iframe").attr("src");$.post("/form-validate-events/",{action:"validate-recaptcha-site-key",src:r},function(t){t&&(a.siteKeyValidated=!0,t=JSON.parse(t),a.siteKeyValid=t.valid,e&&e(a.siteKeyValid))})})},whenBadgeAvailable:function(e){var a=this,t=0,r=setInterval(function(){var n=$(".grecaptcha-badge");n.length?(clearInterval(r),e&&e(n)):t>=20&&(clearInterval(r),a.log("Badge search not found and cancelled.")),++t},100)},init:function(){this.load(function(e){window.location.search.match(/rc-status=1/)&&console.log("ReCaptcha Load Status: "+(e?"Loaded":"Blocked"))}),this.watchDom()}};$(function(){JonahFormValidateRecaptcha.init()}),$.fn.formulateNC=function(e){function a(e,a){return-1!==a.indexOf(e)}e=$.extend({},{errorClass:"error",ajaxSuccess:"success",inlineMsgClass:"error_msg",inlineMsg:!1,errorParent:!1,errorLabel:!1,hideFormOnSubmit:!0,ajax:!0},e);var t,r,n=this;if(e.errorMsgContainer){var i=n.find(e.errorMsgContainer);i.length&&n.data("error-message-container",i)}e.require&&(t=e.require.split(",")),e.conditional&&(r=e.conditional.split(","));var o,s,c,l=e.errorClass,d=e.inlineMsgClass,h=e.ajaxSuccess,u=e.hideFormOnSubmit,p=e.hideOnSubmit,f=e.showOnSubmit,m=e.ajax,v=e.id,g=!1;if(!0===e.errorLabel?o=!0:!0!==e.errorLabel&&!1!==e.errorLabel&&(o=e.errorLabel,g=!0),p){p=p.split(",");var b=0,y=$.makeArray();$(p).each(function(){var e=$.trim(p[b]);y.push(e),++b})}if(f){f=f.split(",");var k=0,C=$.makeArray();$(f).each(function(){var e=$.trim(f[k]);$(e).hide(),C.push(e),++k})}if(!0===e.errorParent)s=!0;else if(!0!==e.errorParent&&!1!==e.errorParent){var w=e.errorParent;s="custom"}var A=!1;function R(){var i=0;function h(t,r,h){var u,p,f,m,v=n.find('[name="'+t+'"]');function b(){return"checkbox"===v.attr("type")||"radio"===v.attr("type")}function y(){var e=0;return v.each(function(){++e}),e}function k(){!0===s?v.parent().removeClass(l):"custom"===s&&v.parents(w).removeClass(l)}""===v.val()||r&&("Email"===r?(m=v.val(),!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(m)):"Phone"===r?(f=v.val(),!/^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/.test(f)):"Integer"===r?(p=v.val(),!$.isNumeric(p)&&!a(",",p)):void 0)||b()?(v.addClass(l),v.attr("aria-invalid",1),i=1+i,!0===s?v.parent().addClass(l):"custom"===s&&v.parents(w).addClass(l),!0===o?v.siblings("label").addClass(l):g&&n.find("label["+o+"="+t+"]").addClass(l),e.inlineMsg&&(u=a("{FIELD",c)?function(e){if(a("{FIELD",e)){var r=e.match("{(.*)}");a(".",r[1])?(getAttr=r[1].split("."),e=e.replace("{"+r[1]+"}",v.attr(getAttr[1]))):e=e.replace("{FIELD}",t)}return e}(c):!A&&r&&"Checkbox Counter"!==r?"Invalid":c,b()||v.before('<span class="'+d+'" id="inlineErrorMsg">'+u+"</span>"))):(v.removeClass(l),v.removeAttr("aria-invalid"),k(),i=0+i);if("checkbox"===v.attr("type")){var C=0,R=0,E=1,O=!0;"Checkbox Counter"===r&&(E=parseInt(h)),v.each(function(){if(++R,$(this).is(":checked")){if(++C===E)return v.removeClass(l),$('#inlineErrorMsgAlt[for="'+$(this).attr("name")+'"]').remove(),k(),v.removeAttr("aria-invalid"),i-=1,O=!1,!1;C<E&&(O=!0)}O&&R===y()&&($('#inlineErrorMsgAlt[for="'+$(this).attr("name")+'"]').remove(),"LABEL"===$(this).parent().get(0).nodeName?$(this).parent("label").after('<span class="'+d+'" id="inlineErrorMsgAlt" for="'+$(this).attr("name")+'">'+u+"</span>"):$(this).last().after('<span class="'+d+'" id="inlineErrorMsgAlt">'+u+"</span>"))})}if("radio"===v.attr("type")){var F=0;v.each(function(){if(++F,$(this).is(":checked"))return v.removeClass(l),k(),$('#inlineErrorMsgAlt[for="'+$(this).attr("name")+'"]').remove(),i-=1,!1,!1;!0&&F===y()&&($('#inlineErrorMsgAlt[for="'+$(this).attr("name")+'"]').remove(),"LABEL"===$(this).parent().get(0).nodeName?$(this).parent("label").after('<span class="'+d+'" id="inlineErrorMsgAlt" for="'+$(this).attr("name")+'">'+u+"</span>"):$(this).last().after('<span class="'+d+'" id="inlineErrorMsgAlt">'+u+"</span>"))})}return i}n.find("span#inlineErrorMsg").remove();var u=0,p=0;return $(r).each(function(){var e=$.trim(r[p]),n=null;if(a("{",e)){var i="{"+e.match("{(.*)}")[1]+"}";n=e.replace(i,"")}var o=$(document).find("[name="+n+"]");if(""!==o.val())-1===$.inArray(e,t)&&t.push(e);else{var c=t.indexOf(e);-1!==$.inArray(e,t)&&c>-1&&(t.splice(t.indexOf(e),1),o.removeClass(l),!0===s?o.parent().removeClass(l):"custom"===s&&o.parents(w).removeClass(l))}++p}),$(t).each(function(){var e,r=!1,n=$.trim(t[u]),i=!1,o=1;a("{",n)&&(e=n.match("{(.*)}"),$.isNumeric(e[1])&&(i=!0)),a("{email}",n)?(n=n.replace("{email}",""),r="Email"):a("{phone}",n)?(n=n.replace("{phone}",""),r="Phone"):a("{integer}",n)?(n=n.replace("{integer}",""),r="Integer"):a("{recaptcha}",n)?(n=n.replace("{recaptcha}",""),r="ReCaptcha"):i&&a("{"+e[1]+"}",n)&&(o=e[1],n=n.replace("{"+e[1]+"}",""),r="Checkbox Counter"),r?"Checkbox Counter"!==r?h(n,r):h(n,r,o):h(n),++u}),h()}!0===e.inlineMsg?c="Required":!0!==e.inlineMsg&&!1!==e.inlineMsg&&(c=e.inlineMsg,e.inlineMsg=!0,A=!0),n.on("show-error-message",function(e,a){a&&$(this).data("error-message-container")&&($(this).data("hide-error-message-timeout")&&clearTimeout($(this).data("hide-error-message-timeout")),$(this).data("error-message-container").html(a).slideDown(100))}).on("hide-error-message",function(){if($(this).data("error-message-container")){var e=$(this);$(this).data("hide-error-message-timeout",setTimeout(function(){e.data("error-message-container").empty().slideUp(100)},500))}}),n.data("form-validation-bound",1).submit(function(a){if($("input, textarea, password").on("input",function(){R()}),$('select, input[type="checkbox"], input[type="radio"]').on("change",function(){R()}),$.isFunction(e.fireOnSubmit)&&e.fireOnSubmit.call(this,!1),m||0!==R()&&(a.preventDefault(),$.isFunction(e.fireOnError)&&e.fireOnError.call(this,!1),$.isFunction(e.fireOnValidateError)&&e.fireOnValidateError.call(this,!1)),m)if(a.preventDefault(),0===R()){var t=n.serialize();v&&(t=t+"&formID="+v),$.post(n.attr("action"),t,function(a){if(a===h){if(u&&n.hide(),$.isFunction(e.fireOnSuccess)&&e.fireOnSuccess.call(n,a),$.isFunction(e.fireOnPostSuccess)&&e.fireOnPostSuccess.call(n,a),p){var t=0;$(y).each(function(){var e=y[t];0!==$(document).find(e).length?$(e).hide():console.error('Formulate: Could not hide element "'+e+'" because it could not be found in the DOM tree.'),++t})}if(f){var r=0;$(C).each(function(){var e=C[r];0!==$(document).find(e).length?$(e).show():console.error('Formulate: Could not show element "'+e+'" because it could not be found in the DOM tree.'),++r})}}else $.isFunction(e.fireOnError)&&e.fireOnError.call(n,a),$.isFunction(e.fireOnPostError)&&e.fireOnPostError.call(n,a)})}else $.isFunction(e.fireOnError)&&e.fireOnError.call(n,!1),$.isFunction(e.fireOnValidateError)&&e.fireOnValidateError.call(n,!1)})};