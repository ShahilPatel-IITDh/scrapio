
Ext.ns('Pegasus.bea.component.helper');Pegasus.bea.component.helper.uiUtils=Ext.extend(Object,{_uuidLength:6,idpostFixwithUuid:function(id){var chars='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz'.split('');if(!this._uuidLength){this._uuidLength=Math.floor(Math.random()*chars.length);}
var str=id+"-";for(var i=0;i<this._uuidLength;i++){str+=chars[Math.floor(Math.random()*chars.length)];}
return str.replace(/ /g,'');},forceBeaContentHeightToAchiveNewDesign:function(aContBlockId){var contBlock=document.getElementById(aContBlockId);var headerH=document.getElementById('bea_navbar').offsetHeight;var currWindowheight=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;var contBlockCalMinHeight=Math.ceil(((currWindowheight-headerH)*80)/100);contBlock.setAttribute("style","min-height:"+contBlockCalMinHeight+"px;");},getDomElmInfo:function(el){var rect=el.getBoundingClientRect();return{left:rect.left||(el.offsetLeft+(window.scrollX?window.scrollX:0)),top:rect.top||(el.offsetTop+(window.scrollY?window.scrollY:0)),width:rect.width||el.outerWidth,height:rect.height||el.outerHeight};},bbRequestAnimationFrame:function(anExicutable){var reqAnimFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;reqAnimFrame(anExicutable);},bbCancelAnimationFrame:function(anExicutableRef){var delAnimFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame;delAnimFrame(anExicutableRef);},handleBlurAnimationLifeCyle:function(anExicutable,aListOfEvts){var AnimFramRef=this.idpostFixwithUuid("AFR");window[AnimFramRef]=undefined;if(Ext.isDefined(anExicutable)&&typeof anExicutable==='function'){if(Ext.isDefined(aListOfEvts)&&!Ext.isEmpty(aListOfEvts)){Ext.each(aListOfEvts,function(evt){var scope=this;window.addEventListener(evt,function(){if(Ext.isDefined(window[AnimFramRef])){this.bbCancelAnimationFrame(window[AnimFramRef]);}
window[AnimFramRef]=this.bbRequestAnimationFrame(anExicutable);}.bind(scope),{passive:true});},this);}else{console.log("bbRequestAnimationFrame+++");window[AnimFramRef]=this.bbRequestAnimationFrame(anExicutable);console.log("bbCancelAnimationFrame+++");this.bbCancelAnimationFrame(window[AnimFramRef]);}}}});Pegasus.bea.component.helper.uiUtils=new Pegasus.bea.component.helper.uiUtils();UiUtils=Pegasus.bea.component.helper.uiUtils;Ext.ns('Pegasus.bea');Pegasus.bea.BackgroundImageSequancer=Ext.extend(Ext.util.Observable,{background_seq_canvas:undefined,background_seq_canvas_ctx:undefined,background_seq_canvas_blurred_offscreen:undefined,background_seq_canvas_blurred_offscreen_ctx:undefined,background_seq_canvas_dirty_offscreen:undefined,background_seq_canvas_dirty_offscreen_ctx:undefined,bg_seqRender_tracker:undefined,_parent:undefined,_compWithBlurOverlayColor:undefined,_initClipBackgroundImg:true,_bgHasBeenUnset:false,curr_img_resource_on_bg_canvas:'resources/images/bb/login_bg_landscape.jpg',glContextAttributes:{preserveDrawingBuffer:true,alpha:true,mozImageSmoothingEnabled:false,webkitImageSmoothingEnabled:false,msImageSmoothingEnabled:false,imageSmoothingEnabled:false},curr_img_on_bg_canvas:undefined,constructor:function(config){this._parent=this;this.addEvents('background_img_sequencer_initiated');if(Ext.isDefined(config)&&Ext.isDefined(config.listeners)){this.listeners=config.listeners;}
Ext.apply(this,config||{});Pegasus.bea.BackgroundImageSequancer.superclass.constructor.call(this,config);var eventList=["resize"];UiUtils.handleBlurAnimationLifeCyle(eventList,this.loadBgImgery.bind(this));},initBackgroundSequencer:function(){this.genBackgroundImgRsc();this._parent.background_seq_canvas=document.getElementById("bb_bg_loader");this._parent.background_seq_canvas_ctx=this._parent.background_seq_canvas.getContext('2d',this._parent.glContextAttributes);this._parent.background_seq_canvas.width=window.outerWidth;this._parent.background_seq_canvas.height=window.outerHeight;this._parent.background_seq_canvas_blurred_offscreen=document.createElement("canvas");this._parent.background_seq_canvas_blurred_offscreen.id="bb_bg_loader_blurred";this._parent.background_seq_canvas_blurred_offscreen_ctx=this._parent.background_seq_canvas_blurred_offscreen.getContext('2d',this._parent.glContextAttributes);this._parent.background_seq_canvas_blurred_offscreen.width=window.outerWidth;this._parent.background_seq_canvas_blurred_offscreen.height=window.outerHeight;this._parent.background_seq_canvas_dirty_offscreen=document.createElement("canvas");this._parent.background_seq_canvas_dirty_offscreen.id="bb_bg_loader_dirty";this._parent.background_seq_canvas_dirty_offscreen_ctx=this._parent.background_seq_canvas_dirty_offscreen.getContext('2d',this._parent.glContextAttributes);this._parent.background_seq_canvas_dirty_offscreen.width=window.outerWidth;this._parent.background_seq_canvas_dirty_offscreen.height=window.outerHeight;UiUtils.handleBlurAnimationLifeCyle(this.loadBgImgery.bind(this));},loadBgImgery:function(){if(!Ext.isDefined(this._parent.curr_img_on_bg_canvas)){var imageObj=new Image();imageObj.src=this.getImgResourceForBg();imageObj.crossOrigin='anonymous';imageObj.onload=(function(imageObj,scope){return function(){scope.manageScalingOfImage(scope.curr_img_on_bg_canvas,scope.background_seq_canvas,scope.background_seq_canvas_ctx,scope,true);scope.manageScalingOfImageBlur(scope,true);scope.fireEvent("background_img_sequencer_initiated");};})(imageObj,scope=this._parent);this._parent.curr_img_on_bg_canvas=imageObj;}else{manageScalingOfImage(this._parent.curr_img_on_bg_canvas,this._parent.background_seq_canvas,this._parent.background_seq_canvas_ctx,this._parent,false);manageScalingOfImageBlur(this._parent,false);}},manageScalingOfImage:function(aImg,aCanvas,aCtx,scope){if(!Ext.isDefined(aImg)||!Ext.isDefined(aCanvas)||!Ext.isDefined(aCtx)||!Ext.isDefined(scope)){console.error("Cannot execute manageScalingOfImage: aImg, aCanvas, aCtx, scope, isInit arguments are manadatory for image rendering!",arguments);return false;}
var srcWidth=aImg.width;var srcHeight=aImg.height;var docWidth=document.documentElement.clientWidth||document.body.clientWidth;var docHeight=document.documentElement.clientHeight||document.body.clientHeight;var widthFactor=docWidth/srcWidth;var heightFactor=docHeight/srcHeight;var primaryFactor=Math.max(widthFactor,heightFactor);var drawWidth=srcWidth*primaryFactor;var drawHeight=srcHeight*primaryFactor;var overFlowX=drawWidth-docWidth;var overFlowY=drawHeight-docHeight;var drawX=-(overFlowX/2);var drawY=-(overFlowY/2);aCanvas.width=docWidth;aCanvas.height=docHeight;aCtx.clearRect(0,0,aCanvas.width,aCanvas.height);aCtx.drawImage(aImg,0,0,srcWidth,srcHeight,drawX,drawY,drawWidth,drawHeight);},manageScalingOfImageBlur:function(scope,isInit){if(Ext.isDefined(isInit)&&Ext.isBoolean(isInit)){if(isInit){var canv=scope.background_seq_canvas_blurred_offscreen;var ctx=scope.background_seq_canvas_blurred_offscreen_ctx;scope.manageScalingOfImage(scope.curr_img_on_bg_canvas,canv,ctx,scope);bbBoxBlurCanvasRGB(canv,0,0,canv.width,canv.height,54,1);}else{var baseCanvForImg=scope.background_seq_canvas_blurred_offscreen;var canv=scope.background_seq_canvas_dirty_offscreen;var ctx=scope.background_seq_canvas_dirty_offscreen_ctx;scope.manageScalingOfImage(baseCanvForImg,canv,ctx,scope);}}else{console.error("Cannot execute manageScalingOfImageBlur: scope, isInit arguments are manadatory for blurred image rendering!",arguments);return false;}},clipBackgroundImg:function(aParentRef){if(!Ext.isDefined(aParentRef)&&!document.documentElement.contains(aParentRef)){console.error("There was an error while trying run clipBackgroundImg. Missing arguments that is necessery for running this function : aParentRef",aParentRef);return false;}
var roundedW=Math.floor(UiUtils.getDomElmInfo(aParentRef).width);var roundedH=Math.floor(UiUtils.getDomElmInfo(aParentRef).height);var x=Math.floor(UiUtils.getDomElmInfo(aParentRef).left);var y=Math.floor(UiUtils.getDomElmInfo(aParentRef).top);this.manageScalingOfImage(this._parent.curr_img_on_bg_canvas,this._parent.background_seq_canvas,this._parent.background_seq_canvas_ctx,this._parent,false);this.manageScalingOfImageBlur(this._parent,false);this.drawRoundedCorners(x,y,roundedW,roundedH,aParentRef);},drawRoundedCorners:function(x,y,width,height,aParentRef){var curParentStyle=getComputedStyle(aParentRef);if(this._parent._initClipBackgroundImg){this._parent._initClipBackgroundImg=false;this._parent._compWithBlurOverlayColor=curParentStyle.backgroundColor;aParentRef.style.backgroundColor="transparent";this._parent._bgHasBeenUnset=true;}
var mainCtx=this._parent.background_seq_canvas_ctx;mainCtx.fillStyle="rgba(255,255,255,0)";mainCtx.fill();mainCtx.beginPath();mainCtx.moveTo(x+parseInt(curParentStyle.borderTopLeftRadius),y);mainCtx.arcTo(x+width,y,x+width,y+height,parseInt(curParentStyle.borderTopRightRadius));mainCtx.arcTo(x+width,y+height,x,y+height,parseInt(curParentStyle.borderBottomRightRadius));mainCtx.arcTo(x,y+height,x,y,parseInt(curParentStyle.borderBottomLeftRadius));mainCtx.arcTo(x,y,x+width,y,parseInt(curParentStyle.borderTopLeftRadius));mainCtx.closePath();mainCtx.clip();mainCtx.drawImage(this._parent.background_seq_canvas_dirty_offscreen,0,0);mainCtx.fillStyle=this._parent._compWithBlurOverlayColor?this._parent._compWithBlurOverlayColor:"rgba(0,0,0,0.2)";mainCtx.fill();mainCtx.beginPath();mainCtx.moveTo(x+parseInt(curParentStyle.borderTopLeftRadius),y);mainCtx.arcTo(x+width,y,x+width,y+height,parseInt(curParentStyle.borderTopRightRadius));mainCtx.arcTo(x+width,y+height,x,y+height,parseInt(curParentStyle.borderBottomRightRadius));mainCtx.arcTo(x,y+height,x,y,parseInt(curParentStyle.borderBottomLeftRadius));mainCtx.arcTo(x,y,x+width,y,parseInt(curParentStyle.borderTopLeftRadius));mainCtx.closePath();},getImgResourceForBg:function(){return this.curr_img_resource_on_bg_canvas;},genBackgroundImgRsc:function(){try{var currMonth=(new Date()).getMonth();var month='winter';if(currMonth>1&&currMonth<5){month='spring';}
if(currMonth>4&&currMonth<8){month='summer';}
if(currMonth>7&&currMonth<11){month='autumn';}
var prefix='pegasus.login.bacground.'+month+'.';var bgrUrls=new Array();var counter=1;var url=Pegasus.resolve(prefix+counter);while(Ext.isDefined(url)&&url.indexOf('Resource not found:')!=0)
{bgrUrls.push(url);url=Pegasus.resolve(prefix+counter);counter++;}
var randUrl=bgrUrls[Math.floor((Math.random()*bgrUrls.length))];if(randUrl!==undefined){this.curr_img_resource_on_bg_canvas=randUrl;}}catch(error){if(Pegasus.bea.BackgroundImageSequancerFallbackSupport.imageResource){console.log("There has been an error at genBackgroundImgRsc. Unable to generate image sequence will default to FallbackSupport image resource!");this.curr_img_resource_on_bg_canvas=Pegasus.bea.BackgroundImageSequancerFallbackSupport.imageResource;}else{console.log("There has been an error at genBackgroundImgRsc. Unable to generate image sequence will default to default image resource!");}}}});Pegasus.bea.BackgroundImageSequancerFallbackSupport={imageResource:undefined};Ext.onReady(function(){var me=this;Pegasus.bea.BackgroundImageSequancer=new Pegasus.bea.BackgroundImageSequancer({listeners:{"background_img_sequencer_initiated":me.setContentToBeBlured}});Pegasus.bea.BackgroundImageSequancer.initBackgroundSequencer();UiUtils.forceBeaContentHeightToAchiveNewDesign('bea_welcome');var eventList=["resize","scroll"];UiUtils.handleBlurAnimationLifeCyle(this.setContentToBeBlured.bind(this),eventList);});function setContentToBeBlured(){var tempWelcomeContRef=document.getElementById("welcome_top_cont");Pegasus.bea.BackgroundImageSequancer.clipBackgroundImg(tempWelcomeContRef);}