(function () {
  $('.section-content').hide();
  $('.section-holder .cmp-tabs__tabpanel--active').show();
  
  if($('#tabbed-tab .b-active').length ==0){
    $('.section-holder .section-content:first-child').show();
    $('#tabbed-tab button:first-child').addClass('b-active').attr('aria-selected', true);
  }
                                                                                              
  ISscrollbar();
  if ($('#tabbed-tab button').length < 5) {
    $('#tabbed-tab').parent().addClass('tabbed-4-layout');
  } else if ($('#tabbed-tab button').length >= 6) {
    $('#tabbed-tab').parent().addClass('tabbed-long');
  } else if ($('#tabbed-tab button').length = 5) {
    $('#tabbed-tab').parent().addClass('tabbed-5-layout');
  }
  $('.L-block').each(function () {                                                            
    var priceDiv = $(this).find(".prt-2-L").children().length;
    if (priceDiv < 2) {
      $(this).find(".prt-2-L").children().first().css("border", "none")
    }
  })
  
  $('#tabbed-tab button').click(function () {
    var tab_id = $(this).attr('data-tab');

    $('#tabbed-tab button').removeClass('b-active').attr('aria-selected', false);
    //$('#tabbed-tab button').attr('aria-selected', false);
    $('.section-content').hide();

    $(this).addClass('b-active').attr('aria-selected', true);
    //$(this).attr('aria-selected', true);
    
    var scrollBar = document.getElementById('tabbed-tab'),
        hasHorizontalScrollbar = scrollBar.scrollWidth > scrollBar.clientWidth,
        isIE11 = !!window.MSInputMethodContext && !!document.documentMode;
            
    if(!isIE11 && hasHorizontalScrollbar === true) {
      setTimeout(function () {
        let element = document.querySelector('.tab-holder .b-active');
        if (element)
        element.scrollIntoView({
          behavior: 'smooth',
          block: 'nearest',
          inline: 'center'
        });
      }, 1);
    } else {
      if ($(".tab-holder .b-active").length && typeof $.fn.scrollCenter === "function")
      $(".tab-holder").scrollCenter(".b-active", 100);
    }

    $("#" + tab_id).show();
    var xPos = window.scrollX;
    var yPos = window.scrollY;
    $("#" + tab_id).focus();
    window.scrollTo(xPos, yPos);
    
    //Analytics
    try {

      var pageTitle = $(this).attr('data-page-title') !=undefined	? $(this).attr('data-page-title') : $(this).attr('name');

      if(pageTitle!=undefined){

       const contextData = { widget: "widget|tab selection|"+ pageTitle +"|"};

        callAnalytics('widget_interaction', contextData);
      }

    }catch (e) {
      console.log("Error: PageView Analytics failed for Tab component : " + e);
    }
  })
        
  $('[href^="#"]').not('.skip-links').click(function(e) {
    e.preventDefault();
    deeplink( $(this).attr('href'))
  });

  $(".ctaHashtagClass").click(function(e) {
    e.preventDefault();
    deeplink($(this).attr('data-cta-link'));
  });

})();
    
function deeplink(deepVal){
  if(deepVal.startsWith('#')){
		deepVal = deepVal.replace('#', '.');
    
	if( $(deepVal).length >0 ){
      $(deepVal).trigger('click');    
		  $('html, body').animate({
			  scrollTop: $(deepVal).offset().top - $(".site-header").height() - 30
		  }, 'slow');
    }
  }
}

//ACCESS TAB DEEPLINK EXTERNALLY
if(window.location.hash){
  deeplink(window.location.hash)
} 
    
$(window).on("resize", function (event) {
  ISscrollbar();
});
    
function ISscrollbar() {
  var scrollBar = document.getElementById('tabbed-tab'),
      hasHorizontalScrollbar = scrollBar.scrollWidth > scrollBar.clientWidth;
  
  if (hasHorizontalScrollbar) {
    scrollBar.classList.add("jc-start");
    scrollBar.classList.remove("jc-center");
  } else {
    scrollBar.classList.remove("jc-start");
    scrollBar.classList.add("jc-center");
  }
}

var checkStatus = "";
function trackTooltip(name) {
	checkStatus = "widget|tool tip|" + name + "|";
	console.log(checkStatus);
	updateWidgetDTM(checkStatus);
}

var updateWidgetDTM = function() {
	try {
		// HRBData.digital_data.widget = checkStatus;
		// HRBData.digital_data.loc = "b";
		// HRB.analytics.callRule("widget_interaction");                                                      
		var contextData = {
			'widget': checkStatus,
			'loc': 'b'
		}
		callAnalytics('widget_interaction', contextData);

	} catch (e) {
		console.log("Error: DTM call Bubble 'widget_interaction' failed : " + e);
	}
};

$.fn.scrollCenter = function(elem, speed) {
  var active = $(this).find(elem); 
  var activeWidth = active.width()/2;
  var pos = active.position().left+activeWidth; 
  var currentscroll = $(this).scrollLeft(); 
  var divwidth = $(this).width();
  
  pos = pos + currentscroll - divwidth / 2; 

  $(this).animate({
    scrollLeft: pos
  }, speed == undefined ? 1000 : speed);
  return this;
};

$.fn.scrollleft = function(elem, speed) {
  $(this).animate({
    scrollLeft: $(this).scrollLeft() - $(this).offset().left + $(elem).offset().left
  }, speed == undefined ? 1000 : speed);
  return this;
};