"use strict";(self.webpackChunkAemPortal=self.webpackChunkAemPortal||[]).push([[565],{8565:function(e,t,s){s.d(t,{t:function(){return d}});var i=s(3360),o=s(5823),n=s(9582),l=s(6301);function r(e,t="mod"){return(0,n.xH)((e||[]).filter(Boolean).map((e=>{const s=[].slice.call(e.getElementsByClassName(t));return e&&e.classList.contains(t)&&s.push(e),s})))}function a(e,t="mod"){return e.length>t.length&&e.startsWith(t)?e.substr(3):null}class h{constructor(e,t=!1,s="mod"){this.modules=e,this.debug=t,this.moduleClass=s}getModuleInstances(e){return this.modules.has(e)?{...this.modules.get(e)}:{}}getAllModuleInstancesInElement(e){const t=e.querySelectorAll(`.${this.moduleClass}`),s=[];return t.forEach((e=>{const t=this.getModuleInstances(e);for(const e in t)s.push(t[e])})),s}notifyVisibilityChange(e,t){const s=this.getAllModuleInstancesInElement(e);for(const e of s)e.onVisibilityChange(t)}removeModulesFrom(...e){const t=r(e,this.moduleClass);this.stopModules(t)}stopModules(e){for(const t of e)if(this.modules.has(t)){const e=this.modules.get(t);this.modules.delete(t);for(const t in e)e[t].stop()}}}var c=s(1239),u=s(8725);const d=new class{constructor(e=!1,t="mod"){this.debug=e,this.moduleClass=t,this.registry={},this.resolved=[],this.modules=new WeakMap,this.application=new h(this.modules,e,this.moduleClass)}register(e,t){if(null!==this.elementsByType){if("string"==typeof e){if(!t)return void(this.debug&&console.error(`Error registering module ${e}, no class given`));e={[e]:t}}if(this.debug){const t=new Set(Object.keys(this.registry)),s=Object.keys(e).filter((e=>t.has(e)));s.length>0&&console.error(`The modules ${s.join(", ")} were registered multiple times. The behaviour of this is undefined.`)}this.elementsByType&&this.init(e),this.registry={...this.registry,...e}}else this.debug&&console.error("Can’t register new modules, application initialization is already finished",e,t)}async lazyBootstrap(e){null===this.elementsByType?e&&(this.elementsByType=void 0,this.bootstrap(e),await this.finalize()):this.debug&&console.error("Can’t do lazyBootstrap during initialization phase. Call it asynchronously.")}bootstrap(...e){if(void 0!==this.elementsByType)return void(this.debug&&console.error("Can’t initialize trafical application twice",this,e));const t=r(e,this.moduleClass),s={};for(const e of t)e.classList.forEach((t=>{const i=a(t,this.moduleClass);i&&(i in s||(s[i]=[]),s[i].push(e))}));this.elementsByType=s,this.init(this.registry)}async finalize(){if(!this.elementsByType)return this.debug&&console.warn("Called finalize "+(null===this.elementsByType?"twice":"before bootstrap")),this.application;if(this.debug){const e=Object.keys(this.elementsByType).filter((e=>!(e in this.registry)));e.length>0&&console.warn(`Module type(s) ${e.join(", ")} found in DOM element(s)`,(0,n.xH)(e.map((e=>this.elementsByType[e]))),"but not registered")}this.elementsByType=null;const e=this.resolved;this.resolved=[];try{const t=await Promise.all(e);for(const e of t)if(e)try{let t={};e.moduleStateChanged&&(t=(0,l.VB)(e.hashKey,!0),window.addEventListener("hashchange",(()=>{var t;return e.moduleStateChanged(null!==(t=(0,l.VB)(e.hashKey))&&void 0!==t?t:{})})));const s=e.after(t);s&&await s}catch(t){this.debug&&console.error("Error calling `after` of module",e.modName,t)}}catch(e){this.debug&&console.error("Exception during module init",e)}return this.application}init(e){this.debug&&console.info("Bootstrapping trafical with modules",e,"and elements",this.elementsByType);for(const t in e){if(!(t in this.elementsByType))continue;const s=this.elementsByType[t];for(const i of s){const s=this.modules.get(i)||{};this.modules.set(i,s),this.resolved.push(this.createModule(i,t,s,e))}}}async createModule(e,t,s,i){try{let n=i[t];(function(e){let t=e;for(;t;){const e=Object.getPrototypeOf(t);if(e===o.Y)return!0;t=e}return!1})(n)||(n=await n());const l=new n(e,t,this.application);s[t]=l;const r=l.on();return r&&await r,l}catch(e){this.debug&&console.error("Error initializing module",t,e)}return null}}(i.mH);c.Cd.then((()=>(d.bootstrap(document.documentElement),c.CL))).then((()=>d.finalize())).then((e=>{(0,u.wh)()&&(window.application_onlyExposedInEditMode=e),i.mH&&(window.application_onlyExposedInDevMode=e)})).catch(console.error.bind(console)),window.addEventListener("content-updated",(e=>{(null==e?void 0:e.target)&&d.lazyBootstrap(e.target).catch(console.error.bind(console))}))},5823:function(e,t,s){s.d(t,{Y:function(){return n}});var i=s(3360),o=s(6301);class n{constructor(e,t,s){this.ctx=e,this.modName=t,this.app=s,this.debug=!1,this.hashKey=t,this.debug=s.debug,this.log=(0,i.O6)(`Tc.Module.${t}`)}on(){}after(e){}stop(){}onVisibilityChange(e){}setModuleState(e){this.moduleStateChanged?(0,o.rk)(this.hashKey,e):this.log.error("Module is not hash-capable")}}}}]);
//# sourceMappingURL=565.c51f6e2e6f154cf7740a.js.map