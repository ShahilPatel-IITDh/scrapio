(self.webpackChunkweb_fr_portal_20=self.webpackChunkweb_fr_portal_20||[]).push([[8241],{418:function(e,t,o){"use strict";o(9600),o(7042),o(4916),o(3123),o(5306),o(9826),o(1539),o(9601),o(4747),o(7941),o(4723),o(1249),o(6755),o(2526),o(1817),o(2165),o(6992),o(8783),o(3948);var n=o(2077),i=o(7484);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){try{n.register("locale","fr",{delimiters:{thousands:" ",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(e){return 1===e?"er":"e"},currency:{symbol:"€"}})}catch(e){}n.locale("fr");var t,o,r={transport:null},s=!!sessionStorage.getItem("feedStreaming:debug"),c={login:null,password:null,notificationsJwt:null,notificationsOrigin:null,bufferedRenderingLoopDelay:500,uri:(document.location+"").replace(/^http/,"ws").split("/").slice(0,3).join("/"),highlightDelay:500,restartDelay:3e3,restartLimit:10,highlightClass:"js-feed-streaming-highlight",idleThreshold:18e5,idleInBackgroundThreshold:1e4},d=!1,l={},m={},u={},f={},g=[],h=!1,b=0,v=!1,p={symbols:{}},k={},y=["ask-quantity","ask-price","ask-size","bid-quantity","bid-price","bid-size"],S=["volume","last","variation","instant-variation","currency","high","low","last-trade-datetime","last-transactions","orderbook","variation-indicator"],C=function(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))};e("[data-ist-last-transactions]").each((function(){var t=e(this).data("istLastTransactions");t||(t=10),e(this).on("feedstreaming:update",(function(){e(this).find("[data-ist-transaction]").slice(t).remove()}))})),r.computeLive=function(t,o){var n=l[t],a={};if(void 0!==o.last&&o.last!==n.last&&(void 0===o.factor||isNaN(parseFloat(o.factor))||(o.last*=o.factor),n.variation=(o.last-n.prevClose)/n.prevClose,n.instantVariation+=(o.last-n.last)/n.last,a.variation=n.variation,a.instantVariation=n.instantVariation,a.last=n.last=o.last,o.last>n.high&&(n.high=a.high=o.last),o.last<n.low&&(n.low=a.low=o.last)),void 0!==o.volume&&o.volume!==n.volume&&(n.volume=o.volume,a.volume=o.volume),o.tradeTime&&(n.lastTradeDatetime=o.tradeTime,a.lastTradeDatetime=i(i().format("YYYY-MM-DD ")+o.tradeTime).toDate()),o.tradeVolume&&o.tradeTime&&o.last){a.transactions=a.transactions||[];var s={tradeVolume:o.tradeVolume,lastTradeDatetime:o.tradeTime,last:o.last};a.transactions.push(s),i(n.lastTradeDatetime).format("YYYY-MM-DD HH:mm:ss")<i().format("YYYY-MM-DD ")+o.tradeTime&&(n.lastTradeDatetime=a.lastTradeDatetime=i(i().format("YYYY-MM-DD ")+o.tradeTime).toDate()),e(document).trigger("feedstreaming:newtransaction",Object.assign({symbol:t},s))}return r.computeIntraday(t,o),a},r.computeBook=function(t,o){var n=l[t],i={},a=parseInt(o.bookRow,10);return delete o.bookRow,n.orderbook.lines[a]=e.extend({},n.orderbook.lines[a],o),i.orderbook=[],i.orderbook[a]=n.orderbook.lines[a],-2==i.orderbook[a].askPrice&&(i.orderbook[a].askPrice="MX"),-2==i.orderbook[a].bidPrice&&(i.orderbook[a].bidPrice="MX"),isNaN(i.orderbook[a].askPrice)&&"MX"!==i.orderbook[a].askPrice&&delete i.orderbook[a].askPrice,isNaN(i.orderbook[a].askQuantity)&&delete i.orderbook[a].askQuantity,isNaN(i.orderbook[a].bidPrice)&&"MX"!==i.orderbook[a].bidPrice&&delete i.orderbook[a].bidPrice,isNaN(i.orderbook[a].bidQuantity)&&delete i.orderbook[a].bidQuantity,i},r.computeIntraday=function(e,t){var o,n=l[e];t.tradeTime&&(k[e]=k[e]?k[e]:{volume:0,openingLast:n.last,last:n.last,high:n.last,low:n.last,closeLast:n.last,prevClose:n.prevClose,lastTradeDatetime:null},(o=k[e]).closeLast=t.last,o.high=Math.max(o.last,o.high),o.low=Math.min(o.last,o.low),o.volume+=parseInt(t.tradeVolume,10),o.timestamp=i(t.tradeTime,"HH:mm:ss").format())},r.intradayRenderingLoop=function(){Object.keys(k).forEach((function(t){var o=k[t];delete k[t],e(document).trigger("feedstreaming:intraday",{symbol:t,intraday:o})}))},r.bufferedRendering=function(t,o){var n;return p.symbols[t]||(p.symbols[t]={transactions:[],orderbook:[]}),n=p.symbols[t],o.orderbook&&(e.extend(n.orderbook,o.orderbook),delete o.orderbook),e.extend(n,o),o.transaction&&(n.transactions.push(o.transaction),delete o.transaction,delete n.transaction),!p.isRunning&&(p.isRunning=!0,p.timeoutId=setTimeout((function(){Object.keys(p.symbols).forEach((function(e){r.render(e,p.symbols[e]),delete p.symbols[e]})),p.isRunning=!1}),c.bufferedRenderingLoopDelay),!0)},r.isConnected=function(){return!!r.socket},r.render=function(t,o){var a,c,d,m,u=l[t],f=l[t].elements;if(!u)return s&&console.error("streaming.render","Invalid data for symbol "+t),!1;if(m="0,0."+Array(u.decimals+1).join("0"),e(document).trigger("feedstreaming:render",{symbol:t,changes:o,feedData:l[t]}),a=l[t].elements,s&&console.log("instrument.render",t,o),void 0!==o.volume&&r.highlight(a.volume,o.volume,"0,0"),void 0!==o.tradeTime&&r.highlight(a.lastTradeDatetime,o.lastTradeDatetime,"0,0"),void 0!==o.last&&(r.highlight(a.last,o.last,m,{way:o.instantVariation}),o.variation<0?(a.variation.addClass("u-color-stream-down").removeClass("u-color-stream-up"),a.variationIndicator.addClass("is-negative").removeClass("is-positive")):o.variation>0?(a.variation.addClass("u-color-stream-up").removeClass("u-color-stream-down"),a.variationIndicator.addClass("is-positive").removeClass("is-negative")):(a.variation.removeClass("u-color-stream-up").removeClass("u-color-stream-down"),a.variationIndicator.removeClass("is-negative").removeClass("is-positive")),r.highlight(a.variation,o.variation,"+0.00%",{way:o.instantVariation})),void 0!==o.high&&r.highlight(a.high,o.high,m),void 0!==o.low&&r.highlight(a.low,o.low,m),o.transactions.length){if(!a.lastTransactions)return;var g,h=a.lastTransactions.find("div.data-instrument-currency-symbol"),b=o.transactions.slice(0);for(h=void 0===h?"€":h.text();c=b.shift();)s&&console.log("streaming.add_transaction",c),d=a.lastTransactions.find("tbody"),(g=d.find("[data-ist-transaction]:first").clone()).find("[data-ist-transaction-date]").html(c.lastTradeDatetime),g.find("[data-ist-transaction-volume]").html(n(c.tradeVolume).format()),g.find("[data-ist-transaction-value]").html(n(c.last).format(m)),d.prepend(g),g.addClass("js-feed-streaming-highlight"),window.setTimeout((function(){g.removeClass("js-feed-streaming-highlight")}),400),g.length&&e(document).trigger("load",g);e(document).trigger("feedstreaming:addtransactions",o.transactions),e(a.lastTransactions).trigger("feedstreaming:update",o.transactions)}return o.orderbook&&o.orderbook.length&&(r.computeSumForOrderbook(t),f.orderbook.each((function(){var t=e(this);y.forEach((function(e){var n=C(e),i=e.match(/price/i)?m:"0,0";Object.keys(o.orderbook).forEach((function(o){var a=t.find("[data-ist-orderbook-lines] tr:eq("+o+"), [data-ist-orderbook-line]:eq("+o+")");"MX"!=u.orderbook.lines[o][n]&&u.orderbook.lines[o][n]||(i=!1),r.highlight(a.find("[data-ist-"+e+"]"),u.orderbook.lines[o][n],i)})),r.highlight(t.find("[data-ist-summary-"+e+"]"),u.orderbook.summary[n],i)}))})),u.orderbook.symbol=u.symbol,e(document).trigger("feedstreaming:updateorderbook",u.orderbook),e(f.orderbook).trigger("feedstreaming:update",u.orderbook)),o.lastTradeDatetime&&r.highlight(a.lastTradeDatetime,i(o.lastTradeDatetime).format("DD/MM/YYYY HH:mm:ss")),!0},r.highlight=function(t,o,i,a){var r,s=c.highlightClass;return(a=a||{}).way>0?(s+="-up",r="buy"):a.way<0?(s+="-down",r="sell"):r="neutral",i&&(o=n(o).format(i)),a.suffix&&(o+=""+a.suffix),t.previousValue!=o&&(t.previousValue=o,e([]).add(document).add(t).trigger("feedstreaming:highlight",{elements:e(t),value:o,format:i,infos:a,changeSide:r}),t.addClass(s),window.setTimeout((function(){t.removeClass(s)}),400),t.html(o),!0)},r.stop=function(t){return"FEED_ACCESS_DENIED"===t||"NOTIFICATION_ACCESS_DENIED"===t?(o=e.Deferred(),r.isConnected()&&(d=!0,r.socket.close(),o.resolve("stop")),r.cleanup(),e(document).trigger("FEED_ACCESS_DENIED"===t?"feedstreaming:access_denied":"notificationstreaming:access_denied"),o):(console.info("streaming.stop"),o=e.Deferred(),r.isConnected()?(d=!0,r.socket.close(),o.resolve("stop")):o.resolve("connected"),r.cleanup(),o)},r.cleanup=function(){t=e.Deferred(),m={},g.forEach((function(e){e&&window.clearInterval(e)}))},r.send=function(e,t){if(!d)return s&&console.log("streaming.send",{channel:e,data:t}),r.start(!0).then((function(o,n){o.send(JSON.stringify({channel:e,user:t.connection,data:t}))}))},r.getBookChannelId=function(e){return"#book"+e.exchangeCode+"-"+e.symbol},r.getLiveChannelId=function(e){return"#live"+e.exchangeCode+"-"+e.symbol},r.joinChannel=function(e){return!m[e]&&(m[e]=!0,r.send("feed.streaming.join",{connection:r.getToken(),feed:e}),!0)},r.computeSumForOrderbook=function(e){var t=l[e].orderbook.summary,o=l[e].orderbook.lines;return Object.keys(t).forEach((function(e){t[e]=0})),o.forEach((function(e,o){Object.keys(e).forEach((function(o){t[o]+=e[o]}))})),t},r.registerInstrument=function(t,o){if((o=o||{}).symbol=t,t&&"string"==typeof t){if(l[t]=l[t]||{instantVariation:0,lastTradeDatetime:0,orderbook:{lines:[],summary:{askPrice:0,askQuantity:0,askSize:0,bidSize:0,bidQuantity:0,bidPrice:0}},transactions:[],isStreamingLive:!1,isStreamingBook:!1},l[t].elements||(l[t].elements=S.reduce((function(t,o){return t[C(o)]=e([]),t}),{})),e(document).trigger("feedstreaming:registerinstrument",o),e.each({previousClose:"prevClose",totalVolume:"volume",tradeDate:"lastTradeDatetime"},(function(e,t){o[t]=void 0!==o[e]?o[e]:o[t]})),o.exchangeCode=""+o.exchangeCode,!o.exchangeCode)throw new Error("Invalid exhangeCode",o);o.prevClose=parseFloat(o.prevClose),o.last=parseFloat(o.last),o.high=parseFloat(o.high),o.low=parseFloat(o.low),o.variation=parseFloat(o.variation),o.factor=parseFloat(o.factor),o.decimals=parseInt(o.decimals,10),o.orderbook=o.orderbook||{lines:[]};var n=function(e){y.forEach((function(t){var o=C(t);e[o]=parseFloat(e[o])}))};o.orderbook.lines.forEach((function(e){n(e)})),o.orderbook.summary&&n(o.orderbook.summary),o.orderbook=Object.assign(l[t].orderbook,o.orderbook),o.transactions=Object.assign(l[t].transactions,o.transactions),e.extend(l[t],o),r.computeSumForOrderbook(t)}else console.error("streaming","invalid symbol")},r.register=function(o,n){window.$doc=e(o||document.body),(n=n||[]).forEach||(n=Object.keys(n).map((function(e){return n[e].symbol=e,n[e]}))),n.forEach((function(e){r.registerInstrument(e.symbol,e)})),Object.keys(l).forEach((function(e){r.findListeners(window.$doc,e)})),Object.keys(l).forEach((function(e){var o=l[e];o.isStreamingLive||t.then((function(){s&&console.log("streaming.channel","start live streaming",r.getLiveChannelId(o)),o.isStreamingLive=!0,r.joinChannel(r.getLiveChannelId(o))})),!o.isStreamingBook&&o.elements.orderbook&&o.elements.orderbook.length&&t.then((function(){s&&console.log("streaming.channel","start book streaming",r.getLiveChannelId(o)),o.isStreamingBook=!0,r.joinChannel(r.getBookChannelId(o))}))}))},r.escapeSymbol=function(e){return e.replace(/[^a-z0-9A-Z]/g,"_")},r.findListeners=function(t,o){var n=l[o].elements;if(!window.$doc.data("feed-streaming:listeners:"+o)){window.$doc.data("feed-streaming:listeners:"+o,!0),t=e(t);var i=r.escapeSymbol(o);S.forEach((function(o){var a=C(o);n[a]=e.merge(e(n[a]),t.find([".ist__"+o+".ist__"+i,'[data-ist="'+i+'"] [data-ist-'+o+"]",'[data-ist="'+i+'"][data-ist-'+o+"]"].join(", ")))}))}},r.getToken=function(){return{login:c.login,password:c.password}},r.getJoinNotificationConfig=function(){return{jwt:c.notificationsJwt,origin:c.notificationsOrigin}},r.hasValidNotificationConfig=function(){return!!c.notificationsJwt&&"string"==typeof c.notificationsJwt},r.isListeningTo=function(e){return!!l[e]},r.getOptions=function(){return c},r.onMessage=function(e,t){e.startsWith("notification.amq")?r.handleNotificationStreamingMessage(e,t):r.handleFeedStreamingMessage(e,t)},r.handleFeedStreamingMessage=function(t,o){if(e(document).trigger("feedstreaming:message",{channel:t,message:o}),"feed.streaming.access_denied"===t&&this.stop("FEED_ACCESS_DENIED"),"feed.streaming.error"===t&&(e(document).trigger("feedstreaming:connection_timeout"),e(document).trigger("feedstreaming:error")),"feed.streaming.message"===t)if(r.isListeningTo(o.symbol)){if(s&&console.log("streaming.instrument.onmessage",o.symbol,o.type,o.data),"live"===o.type){var n=r.computeLive(o.symbol,o.data);r.bufferedRendering(o.symbol,n)}"book"===o.type&&(n=r.computeBook(o.symbol,o.data),r.bufferedRendering(o.symbol,n))}else s&&console.log("streaming.message.notListenedSymbol",t,":",o);else s&&console.log("streaming.message",t,":",o)},r.handleNotificationStreamingMessage=function(t,o){"notification.amq.message"===t&&e(document).trigger("notificationstreaming:message",{channel:t,message:o.message}),"notification.amq.modal"===t&&e(document).trigger("notificationstreaming:modal",o),"notification.amq.access_denied"===t&&this.stop("NOTIFICATION_ACCESS_DENIED")},r.sendMessageToRoom=function(e,t){r.start(!0).then((function(){r.send("streaming.amq.message",{route:e,message:t})}))},r.joinRoom=function(e){u[e]=!0,r.send("streaming.amq.join",{route:e})},r.joinNotifications=function(){s&&console.log("Join notifications"),this.hasValidNotificationConfig()?r.send("notification.amq.join",this.getJoinNotificationConfig()):s&&console.log("No or Invalid config: "+JSON.stringify(this.getJoinNotificationConfig()))},r.setUserIdle=function(e){(e=!!e)!==v&&(v=!!e,e&&r.isConnected()?r.stop():e||r.isConnected()||r.start())},r.restart=function(){return r.stop().then((function(){return r.start()})).then((function(){r.register()}))},r.start=function(n){var i;return i=c.uri,r.isConnected()?t:Object.keys(l).length||Object.keys(u).length||!this.has||this.hasValidNotificationConfig()||n?(g.push(window.setInterval((function(){r.intradayRenderingLoop()}),6e4)),r.socket=r.transport=new WebSocket(i,"echo-protocol"),o=e.Deferred(),c.login||c.password||500!=c.bufferedRenderingLoopDelay||(c.bufferedRenderingLoopDelay=1e3*(s?10:45)),r.socket.onerror=function(){e(document).trigger("feedstreaming:connection_error")},r.socket.onopen=function(){e(document).trigger("feedstreaming:connection_open"),e.each(l,(function(e,t){t.isStreamingBook=t.isStreamingLive=!1})),Object.keys(u).forEach((function(e){r.joinRoom(e)})),d=!1,r.socket&&(r.socket.onmessage=function(e){var o;r.debug&&console.log(e.data);try{o=JSON.parse(e.data)}catch(e){return void console.error(e)}"function"!=typeof o.forEach&&(o=[o]),o.forEach((function(e){"streaming.infos.welcome"===e.channel&&t.resolve(r.socket,e.data),r.onMessage(e.channel,e.data||e.body)}))})},r.socket.onclose=function(){e(document).trigger("feedstreaming:connection_close"),r.socket=null,d||setTimeout((function(){r.restart()}),c.restartDelay),r.cleanup(),o.resolve("closed"),e.each(l,(function(e,t){t.isStreamingLive=t.isStreamingBook=!1}))},t.then((function(){r.register(),r.joinNotifications()})),t):(s&&console.log("streaming","no feeds to listen to and no notification token, delay start"),setTimeout((function(){r.start()}),c.restartDelay),t)},r.feeds=l,r.setupIdleWatchers=function(){var e;h||(e=function(e){b=0,v&&r.setUserIdle(!1)},h=setInterval((function(){b+=1e3,(document.hidden&&b>=c.idleInBackgroundThreshold||b>=c.idleThreshold)&&r.setUserIdle(!0)}),1e3),["touchstart","touchmove","mousemove","keypress"].forEach((function(t){document.addEventListener(t,e)})),document.addEventListener("visibilitychange",(function(){document.hidden?b=0:e()}),!1))},e.feedStreaming=function(o){var n=Array.prototype.slice.call(arguments,1);switch("object"===a(o)&&(c=e.extend(c,o)),r.setupIdleWatchers(),t||(t=e.Deferred()),o){case"register":r.register.apply(null,n);break;case"feeds":return l;case"listeners":return f;case"debug":return void 0===n[0]?s:(s=!!n[0],sessionStorage.setItem("feedStreaming:debug",0+s),r);case"stop":return r.stop(),r}return r}}(o(9755));var r=o(9755);r((function(){var e=function(){},t=BRS_CONFIG.debug?console:{info:e,warn:e,log:e,trace:e,error:e},o="feedStreaming:disabled",n=!!sessionStorage.getItem(o),i=r(document).find(".c-faceplate__actions--streaming .c-switch__checkbox");if(window.WebSocket){n?i.removeAttr("checked"):i.attr("checked","checked");var a=function(){i.length?i.is(":checked")?(r.feedStreaming().start(),sessionStorage.removeItem(o)):(r.feedStreaming().stop(),sessionStorage.setItem(o,1)):n?r.feedStreaming().stop():r.feedStreaming().start()},s=function(){return BRS_USER_CONFIG.USER_HASH},c=function(){return BRS_CONFIG.JWT_TOKEN_ID},d=function(){return r.cookie(c())},l=function(e){if("string"!=typeof e)return!1;if(3!==(e=e.split(".")).length)return!1;try{e=JSON.parse(atob(e[1]))}catch(e){return!1}return"string"==typeof e.scopes&&(e.session&&"CUSTOMER"===e.session.level&&e.scopes.split(";").indexOf("ROLE_CUSTOMER")>=0||"MEMBER"===e.session.level&&e.scopes.split(";").indexOf("ROLE_MEMBER")>=0)},m=function(){try{localStorage.removeItem("brs_streaming")}catch(e){}},u=function(e){var t=function(){try{var e=JSON.parse(localStorage.getItem("brs_streaming"));return s()!=e.userHash||c()!=e.sso||!e.created||e.created+36e5<=Date.now()?(m(),null):e.config}catch(e){}}();t?e(t):f((function(t){!function(e){try{var t={config:e,created:Date.now(),sso:c(),userHash:s()};localStorage.setItem("brs_streaming",JSON.stringify(t))}catch(e){}}(t),e(t)}))},f=function(e){r.ajax({url:null!==s()?"/streaming/bootstrap?hash="+s():"/streaming/bootstrap",context:document.body,success:function(t){void 0!==t.config?e(t.config):console.warn("No valid response could be retrieved, streaming won't start")}})};r(document).on("feedstreaming:connection_timeout",(function(){r.feedStreaming().stop().then((function(){setTimeout((function(){r.feedStreaming().start()}),5e3)}))})),r(document).on("feedstreaming:access_denied notificationstreaming:access_denied",(function(){m(),u((function(e){l(d())&&(e.notificationsJwt=d()),r.feedStreaming(e),setTimeout((function(){r.feedStreaming().start()}),e.startOffset)}))})),r(document).on("notificationstreaming:modal",(function(e,t){window.location.href="/avertissement/avertissement"}));var g={};r(document).on("notificationstreaming:message",(function(e,t){if(t.message){var o=5e3,n=(t.message||"").match(/data-expire="([^"]+)"/);if(n){var i=Date.parse(n[1]);isNaN(i)||(o=Math.max(o,i-Date.now()))}if(g[t.message])return;g[t.message]=r.toast({heading:"Message de Boursorama",text:t.message,allowToastClose:!0,icon:"success",hideAfter:o,position:"bottom-right",stack:5,loader:!1,afterHidden:function(){delete g[t.message]}})}})),r(document).on("load",(function(e,t){u((function(e){l(d())&&(e.notificationsJwt=d(),e.notificationsOrigin="portal"),function(e,t){r.feedStreaming(e),function(e){if(!e||!e.quotaPeriod||!e.quotaLimit)return!0;var t,o=function(){try{return localStorage.getItem("brs_streaming_start")}catch(e){console.error(e)}return null}(),n=new Date;if(t=new Date(parseInt(o)),null==o||n-t>1e3*e.quotaPeriod)!function(e){try{localStorage.setItem("brs_streaming_start",e)}catch(e){console.error(e)}}(Date.now());else if(n-t>1e3*e.quotaLimit)return!1;return!0}(e)&&setTimeout((function(){var o=r(t).find("[data-feed-streaming-registry]:last").data("feedStreamingRegistry")||{};r(t).find("[data-ist-init]").each((function(e,t){var n=r(t).data("istInit");o[n.symbol]=r.extend({},o[n.symbol],n)})),r.feedStreaming("register",t,function(e,t){if(t.filterExchangeCodes&&0!=t.filterExchangeCodes.length||t.filterSymbols&&0!=t.filterSymbols.length){var o={};for(var n in e)(t.filterExchangeCodes&&-1!=t.filterExchangeCodes.indexOf(e[n].exchangeCode)||t.filterSymbols&&-1!=t.filterSymbols.indexOf(n))&&(o[n]=e[n]);return o}return e}(o,e)),i.on("change",a),a()}),e.startOffset)}(e,t)}))}))}else t.warn("feed.streaming","WebSocket not available, streaming require WebSocket, stop")}))}},0,[[418,3666,9755,7098,439,9754,8185,514]]]);