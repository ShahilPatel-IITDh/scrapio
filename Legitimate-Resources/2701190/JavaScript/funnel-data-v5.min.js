// Version 1.2.139-master
var FunnelDataNS=FunnelDataNS||{};function FunnelData(a,e,t,n,r,i,s){var o,l,d=null!=a?a.map(function(e){return e.toLowerCase()}):a,u=e,c=t,m={},f=null,a=null;if(e=i,(t=s)&&"object"==typeof t&&"object"==typeof t.testDataCookie&&e&&"object"==typeof e&&"object"==typeof e.document&&"string"==typeof e.document.cookie){if(w(s)&&w(s.testDataCookie)&&w(s.testDataCookie.modified)&&s.testDataCookie.modified){var t=function(e){try{return JSON.parse(decodeURIComponent(e))}catch(e){}}(F(i,"888TestData"));if(t){n.datecreated=t.datecreated||(new Date).toISOString(),a=s.testDataCookie.extendExpiration?(N=C(s.testDataCookie.expiresIn),n.expiredat=N):(n.expiredat=t.expiredat||C(s.testDataCookie.expiresIn),n.expiredat);var e=0;try{e=Number.parseInt(t.modifiedcounter),isNaN(e)&&(e=0)}catch(e){}e+=1,n.datemodified=(new Date).toISOString(),n.modifiedcounter=e+""}else{n.datecreated=(new Date).toISOString();var N=C(s.testDataCookie.expiresIn);a=n.expiredat=N}f=I(n)}else{var t=F(i,"888TestData");if(void 0!==t){var e=decodeURIComponent(t);try{var D=JSON.parse(e),f=I(D);a=D.expiredat}catch(e){a=C(s.testDataCookie.expiresIn)}}else{n.datecreated=(new Date).toISOString();N=C(s.testDataCookie.expiresIn);a=n.expiredat=N,f=I(n)}}t=i,e=a,D=f,a=";domain="+(N=s).testDataCookie.domain,e=";expires="+e,o=";samesite="+s.testDataCookie.sameSite,N=s.testDataCookie.secure?";secure":"",D=JSON.stringify(D),D="888TestData="+encodeURIComponent(D)+a+e+o+N+";path=/",t.document.cookie=D}else FunnelDataNS.TestDataParser.ParseAndSetTestDataJSON(JSON.stringify(n)),f=FunnelDataNS.FunnelDataHandler.GetFunnelData([]),a=i,e=f,t=";domain="+(o=s).testDataCookieDomain,n=";max-age="+s.testDataCookieMaxAge,i=";samesite="+s.testDataCookieSameSite,o=s.testDataCookieSecure?";secure":"",e="888TestData="+encodeURIComponent(e)+t+n+i+o+";path=/",a.document.cookie=e;for(l in r)r.hasOwnProperty(l)&&O(l,r[l],!1);var g=100,h=setInterval(function(){v=v||Date.now();try{(f.client_id&&f.session_id||Date.now()-v>=150*g)&&clearInterval(h);var e=function(){var a=[],t=document.getElementsByTagName("script");if(t)for(let e=0;e<t.length;e++){var n=t[e];if(n.src&&n.src.includes("gtag/js")){n=n.src.match(/id=([^&]+)/);if(n){a.push(n[1]);break}}}return a}();0!=e.length&&e.forEach(e=>{f.client_id||gtag("get",e,"client_id",function(e){e&&(f.client_id=e)}),f.session_id||gtag("get",e,"session_id",function(e){e&&(f.session_id=e)})})}catch(e){console.log(e)}},g),v=null;function C(e){return new Date((new Date).setSeconds(e)).toUTCString()}function O(e,a,t){if(null==t&&(t=!0),"string"==typeof e){if("string"==typeof a){if(0<=d.indexOf(e.toLowerCase()))switch(e){case"sr":case"lang":case"datecreated":case"datemodified":case"modifiedcounter":case"testdata":if(t)throw"'"+e+"' is readonly";break;default:m[e]=a}else if(t)throw"'"+e+"' is not allowed in funnel data"}else if(t)throw"the value of '"+e+"' is not string type"}else if(t)throw"'"+e+"' is not string type"}function S(){return p()}function p(){var e,a,t,n="";for(a in null!=c&&(n+="lang="+c),null!=u&&(n+=(""===n?"":"&")+"sr="+u),null!=f&&(e=JSON.stringify(f),n+=(""===n?"":"&")+"testdata="+encodeURIComponent(e)),m)m.hasOwnProperty(a)&&"lang"!==a.toLowerCase()&&"sr"!==a.toLowerCase()&&"testdata"!==a.toLowerCase()&&FunnelDataNS.TestDataParser.IsParamValueValid(m[a])&&(t=(""===n?"":"&")+a.toLowerCase()+"="+m[a],n=n.concat(t));return n}function F(e,a){var t,e=e.document.cookie.split("; ").find(function(e){return e.startsWith(a+"=")});return t=null!=e&&-1<e.indexOf("=")&&null!=(t=e.split("=")[1])&&-1<t.indexOf(";")&&null!=(t=t.substr(0,t.indexOf(";")))?decodeURIComponent(t):t}function w(e){return null!=e}function I(a){try{return Object.assign({},a)}catch(e){a=JSON.stringify(a);return JSON.parse(a)}}this.split=function(e,a){return p().split(e,a)},this.toString=S,this.queryString=p,this.get=function(e){switch(e){case"sr":return u;case"lang":return c;case"testdata":return JSON.stringify(f);default:return null!=f[e]?f[e]:void 0!==m&&FunnelDataNS.TestDataParser.IsParamValueValid(m[e])?m[e]:void 0}},this.queryStringEncoded=function(){return encodeURI(p())},this.set=O,this.all=function(){var e,a={};for(e in null!=c&&(a.lang=c),null!=u&&(a.sr=u),null!=f&&(a.testdata=JSON.stringify(f)),m)m.hasOwnProperty(e)&&"lang"!==e.toLowerCase()&&"sr"!==e.toLowerCase()&&"testdata"!==e.toLowerCase()&&FunnelDataNS.TestDataParser.IsParamValueValid(m[e])&&(a[e.toLowerCase()]=m[e]);return a},this.substring=function(e,a){return p().substring(e,a)},this.lastIndexOf=function(e,a){return p().substring(e,a)}}!function(){var e,a;"undefined"==typeof JSON&&(e=document.getElementsByTagName("script")[0],(a=document.createElement("script")).async=!0,a.src="json-backwordcapability.min.js",e.parentNode.insertBefore(a,e))}(),FunnelDataNS.TestDataParser={IsParamValueValid:function(e){return!("string"!=typeof e||""===e||0<=e.indexOf("<script")||0<=e.indexOf("<\/script>"))},SetTestDataFromXml:function(e){if(void 0!==e.children)for(var a=0;a<e.children[0].childNodes.length;a++)null!=FunnelDataNS.FunnelDataHandler.GetParamConfig(e.children[0].childNodes[a].nodeName.toLowerCase())&&this.IsParamValueValid(e.children[0].childNodes[a].innerHTML)&&void 0===FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[e.children[0].childNodes[a].nodeName.toLowerCase()]&&(n=(n=e.children[0].childNodes[a].innerHTML).replace(/!/g,"&"),FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[e.children[0].childNodes[a].nodeName.toLowerCase()]=n);else if(void 0!==e.childNodes[0].childNodes)for(var t,n,a=0;a<e.childNodes[0].childNodes.length;a++)null!=FunnelDataNS.FunnelDataHandler.GetParamConfig(e.childNodes[0].childNodes[a].nodeName.toLowerCase())&&null!=(t=e.childNodes[0].childNodes[a].textContent||e.childNodes[0].childNodes[a].text)&&this.IsParamValueValid(t)&&void 0===FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[e.childNodes[0].childNodes[a].nodeName.toLowerCase()]&&(n=(n=t).replace(/!/g,"&"),FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[e.childNodes[0].childNodes[a].nodeName.toLowerCase()]=n)},ConvertEncodedTestDataToQueryString:function(e){var a,e=decodeURIComponent(e),t=JSON.parse(e),n="";for(a in t)n+=a+"="+encodeURIComponent(t[a])+"&";return n=n.slice(0,n.length-1)},ParseAndSetTestDataXML:function(e){var a,t,n=e,r=n.indexOf("</XML>");-1<(r=-1==r?n.indexOf("</xml>"):r)&&(n=e.substring(0,r+"</xml>".length),a=e.substring(r+"</xml>".length)),null!=a&&""!=a&&this.ParseAndSetTestDataUnderScore(a),window.DOMParser?(parser=new DOMParser,n=n.replace(/&/g,"!"),t=parser.parseFromString(n,"text/xml")):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(n)),this.SetTestDataFromXml(t)},ParseAndSetTestDataUnderScore:function(e){for(var a=e.split("_"),t=0;t<a.length;t++){var n=a[t].split("=");2==n.length&&null!=FunnelDataNS.FunnelDataHandler.GetParamConfig(n[0].toLowerCase())&&this.IsParamValueValid(n[1])&&void 0===FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[n[0].toLowerCase()]&&(FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[n[0].toLowerCase()]=n[1])}},ParseAndSetTestDataJSON:function(e){for(var a=this.getIndicesOf("{",e,!1);1<a.length;){var t=e.indexOf("}",a[a.length-1]),t=e.substring(a[a.length-1],t+1),n=escape(t);":"==e[a[a.length-1]-1]&&(n='"'+n+'"'),e=e.replace(t,n),a=this.getIndicesOf("{",e,!1)}var r,i,s=e,o=s.lastIndexOf("}"),l=(o<s.length&&(s=e.substring(0,o+1),r=e.substring(o+1)),null!=r&&""!=r&&this.ParseAndSetTestDataUnderScore(r),JSON.parse(s));for(i in l){l[i]=this.unescapeStr(l[i]);var d=FunnelDataNS.FunnelDataHandler.GetParamConfig(i.toLowerCase());if(null!=d&&this.IsParamValueValid(l[i])&&void 0===FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[i.toLowerCase()])try{FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[i.toLowerCase()]=decodeURIComponent(l[i])}catch(e){FunnelDataNS.FunnelDataHandler.jsonFunnelDataItems[i.toLowerCase()]=l[i]}}},unescapeStr:function(e){for(var a=e,t=unescape(e);0!=a.localeCompare(t);)a=t,t=unescape(t);return t},getIndicesOf:function(e,a,t){var n,r=0,i=e.length,s=[];for(t||(a=a.toLowerCase(),e=e.toLowerCase());-1<(n=a.indexOf(e,r));)s.push(n),r=n+i;return s}},FunnelDataNS.FunnelDataHandler={jsonFunnelDataItems:{},systemParms:["datecreated","datemodified","modifiedcounter"],SetFromTestDataParameter:function(e){try{for(var a=0;a<e.length;a++)if("testdata"===e[a].Name.toLowerCase()&&""!==e[a].Value){var t=decodeURIComponent(e[a].Value);-1!=t.indexOf("<xml>")||-1!=t.indexOf("<XML>")?FunnelDataNS.TestDataParser.ParseAndSetTestDataXML(t):-1!=t.indexOf("_")&&-1==t.indexOf(":")?FunnelDataNS.TestDataParser.ParseAndSetTestDataUnderScore(t):FunnelDataNS.TestDataParser.ParseAndSetTestDataJSON(t);break}}catch(e){}},GetFunnelData:function(e){try{this.SetFromTestDataParameter(e);for(var a=[],t=0;t<e.length;t++){var n=e[t],r=this.GetParamConfig(n.Name);null!=r&&("true"===r.Override&&FunnelDataNS.TestDataParser.IsParamValueValid(n.Value)?void 0===a[n.Name.toLowerCase()]&&(this.jsonFunnelDataItems[n.Name.toLowerCase()]=n.Value,a[n.Name.toLowerCase()]=n.Value):"false"===r.Override&&FunnelDataNS.TestDataParser.IsParamValueValid(n.Value)&&void 0===this.jsonFunnelDataItems[n.Name.toLowerCase()]&&void 0===a[n.Name.toLowerCase()]&&(this.jsonFunnelDataItems[n.Name.toLowerCase()]=n.Value,a[n.Name.toLowerCase()]=n.Value))}return JSON.stringify(this.jsonFunnelDataItems)}catch(e){return null}},GetParamConfig:function(e){for(var a=0;a<FunnelDataNS.FunnelDataParamsConfiguration.length;a++)if(FunnelDataNS.FunnelDataParamsConfiguration[a].Name.toLowerCase()===e.toLowerCase()||FunnelDataNS.FunnelDataParamsConfiguration[a].Alias.toLowerCase()===e.toLowerCase())return FunnelDataNS.FunnelDataParamsConfiguration[a];return null}},FunnelDataNS.FunnelDataParamsConfiguration=[{Name:"utm_source",Override:"true",Alias:""},{Name:"utm_campaign",Override:"true",Alias:""},{Name:"utm_medium",Override:"true",Alias:""},{Name:"anid",Override:"true",Alias:""},{Name:"mkw",Override:"true",Alias:""},{Name:"st",Override:"true",Alias:"sitetest"},{Name:"dlp",Override:"true",Alias:""},{Name:"dl",Override:"true",Alias:""},{Name:"referrer",Override:"false",Alias:""},{Name:"mm_id",Override:"true",Alias:""},{Name:"wtv",Override:"true",Alias:""},{Name:"wtc",Override:"true",Alias:""},{Name:"deviceid",Override:"true",Alias:""},{Name:"appid",Override:"true",Alias:""},{Name:"last-referrer",Override:"true",Alias:""},{Name:"orig-lp",Override:"false",Alias:""},{Name:"gclid",Override:"true",Alias:""},{Name:"dclid",Override:"true",Alias:""},{Name:"fbclid",Override:"true",Alias:""},{Name:"twclid",Override:"true",Alias:""},{Name:"utm_content",Override:"true",Alias:""},{Name:"utm_term",Override:"true",Alias:""},{Name:"utm_id",Override:"true",Alias:""},{Name:"currentvisittype",Override:"true",Alias:""},{Name:"strategy",Override:"true",Alias:""},{Name:"substrategy",Override:"true",Alias:""},{Name:"serialsource",Override:"true",Alias:""},{Name:"strategysource",Override:"true",Alias:""},{Name:"marketingchannel",Override:"false",Alias:""},{Name:"publisher",Override:"false",Alias:""},{Name:"campaignid",Override:"false",Alias:""},{Name:"campaignname",Override:"false",Alias:""},{Name:"adsetid",Override:"false",Alias:""},{Name:"adsetname",Override:"false",Alias:""},{Name:"adid",Override:"false",Alias:""},{Name:"adname",Override:"false",Alias:""},{Name:"queryserial",Override:"false",Alias:""},{Name:"client_id",Override:"false",Alias:""},{Name:"session_id",Override:"false",Alias:""}],function(e){e.sCutInit&&(e.sCut=new FunnelData(e.sCutInit.allowedParameters,e.sCutInit.serial,e.sCutInit.lang,e.sCutInit.testData,e.sCutInit.additionalParameters,e,e.sCutInit.options),e.sCut2=e.sCut,e.fireSCutInitialized())}(this);
//# sourceMappingURL=funnel-data-v5.min.js.map