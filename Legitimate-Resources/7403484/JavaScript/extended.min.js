!function(){function n(e){for(var t=0,r=["=","!=",">","<","<=",">="],a=0;a<e.length;a++){if(-1<r.indexOf(e[a])&&!t)return{operand:e[a],left:e.substring(0,a).trim(),right:e.substring(a<e.length-1?a+1:a).trim()};"("==e[a]&&t++,")"==e[a]&&t--}return{operand:"=",left:e,right:"true"}}function i(e,t){return"true"===(e=WAPF.Util.parseFx(e,t,!1))||"false"!==e&&(""===e?"":(t=WAPF.Util.evalFx(""+e,!1),isNaN(t)?e:t))}function f(e,t,r,a){switch(e=i(e,a),t=i(t,a),r){case"<":return e<t;case">":return t<e;case">=":return t<=e;case"<=":return e<=t;case"!=":return e!==t;default:return e===t}}var e=WAPF.Util.formulas;["abs","round","floor","ceil","sqrt","sin","cos","tan"].forEach(function(r){e[r]=function(e,t){return Math[r](WAPF.Util.parseFx(e[0],t))}}),e.pow=function(e,t){return Math.pow(WAPF.Util.parseFx(e[0],t),WAPF.Util.parseFx(e[1],t))},e.checked=function(e,t){e=t.find(".input-"+e[0]),e=WAPF.Util.getFieldValue(e,!0);return Array.isArray(e)?e.length:0},e.files=function(e,t){e=t.find(".input-"+e[0]),e=WAPF.Util.getFieldValue(e,!0);return e?e.split(",").length:0},e.if=function(e,t){var r=n(e[0]);return f(r.left,r.right,r.operand,t)?e[1]:e[2]},e.or=function(e,t){for(var r=0;r<e.length;r++){var a=n(e[r]);if(f(a.left,a.right,a.operand,t))return"true"}return"false"},e.and=function(e,t){for(var r=0;r<e.length;r++){var a=n(e[r]);if(!f(a.left,a.right,a.operand,t))return"false"}return"true"},e.datediff=function(e,t){var r=wapf_config.date_format,a=e[0]?WAPF.Util.parseFx(e[0],t,!1):"",t=e[1]?WAPF.Util.parseFx(e[1],t,!1):"";return a&&t?(a=dpParseDate(a,r),t=dpParseDate(t,r),Math.round((t.getTime()-a.getTime())/864e5)):0},e.today=function(){return dpFormatDate(wapf_config.today,wapf_config.date_format)};function o(e){return e=e.split(/-/g),(e=new Date(new Date(2===e.length?(new Date).getFullYear():parseInt(e[2]),parseInt(e[0])-1,parseInt(e[1])).getTime())).setHours(0,0,0,0),e}function l(e,t){if(!t)return e;var r=new Date(e.getTime()),a=0,n=0,i=0,f=t.split(" ");if(f.length)for(var l=0;l<f.length;l++){var d=f[l].toLowerCase();-1<d.indexOf("y")&&(a+=parseInt(d.replace("y",""))),-1<d.indexOf("m")&&(n+=parseInt(d.replace("m",""))),-1<d.indexOf("d")&&(i+=parseInt(d.replace("d","")))}return r.setFullYear(e.getFullYear()+a),r.setMonth(e.getMonth()+n),r.setDate(e.getDate()+i),r}function g(e,t,r){var a,n=t.field.data(e),i=null;return n&&(d[e][r]?i=d[e][r]:new RegExp("[0-9]{2}-[0-9]{2}([0-9]{4})?").test(n)?(i=o(n),d[e][r]=i):0===n.indexOf("[field")?(a=/field.(.+?)\]/.exec(n))&&(!(a=t.field.closest(".wapf").find(".input-"+a[1]))||(a=WAPF.Util.getFieldValue(a,!0))&&(i=l(dpParseDate(a,wapf_config.date_format),n.replace(/\[(.+)\]/,"").trim()))):(i=l(t.today,n),d[e][r]=i)),i}var p={},d={min:{},max:{}};WAPF.Filter.add("date/selectable",function(e,t){var r=t.field.data("field-id");if(t.field.data("disable-after")&&t.isToday){var a=t.field.data("disable-after").split(":"),n=new Date((new Date).getTime()+(1e3*t.offset+6e4*(new Date).getTimezoneOffset()));if(n.getHours()>=parseInt(a[0])&&n.getMinutes()>=parseInt(a[1]))return!1}if(void 0!==t.field.data("disabled-days")&&-1<(u=(""+t.field.data("disabled-days")).split(",").map(function(e){return parseInt(e)})).indexOf(t.date.getDay()))return!1;a=g("min",t,r);if(a&&t.date<a)return!1;if((a=g("max",t,r))&&t.date>a)return!1;if(t.field.data("disabled-dates")){var i={normal:[],recurring:[]};p[r]?i=p[r]:(t.field.data("disabled-dates").split(",").map(function(e){return e.trim()}).forEach(function(e){var t=2===e.split(/-/g).length?"recurring":"normal",e=o(e);i[t].push(e)}),p[r]=i);for(var f=["normal","recurring"],l=0;l<f.length;l++)for(var d=0;d<i[f[l]].length;d++){var u=i[f[l]][d],s=("recurring"===f[l]?t.date:u).getFullYear();if(t.date.getMonth()===u.getMonth()&&t.date.getFullYear()===s&&t.date.getDate()===u.getDate())return!1}}return e})}();