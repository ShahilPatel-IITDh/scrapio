dla.helper.createNamespace("dla.scratchcards"),dla.scratchcards=function(){var a,e,t={},r=!1;function n(a){r=a}function c(a,t,r,n){var c={scratchcardName:a};return r?(c.isDemo=!0,e="Demo"):e="Real",t&&(c.scratchcardId=t),n&&(c.onevent=n),dla.frontContent.show("scratchcardGame",c),!1}function s(){var e=dla.skin.isMobile?".bundleSelection:checked":".js-bundleSelection:checked",t=$(e,a.element);a.data.quantity=parseInt(t.val()),$(".ticketData",a.element).val(JSON.stringify(a.data));var r=parseInt(t.data("price"),10);dla.payment.getInstance("paymentChecker").getModel().setPrice(r,null),""!==dla.resources.playerNr&&dla.skin.isMobile&&function(a){$("#pageMenuCartTotal .price").html(dla.helper.formatPrice(a)),$("#menuCart").removeClass("hidden")}(r)}function o(a,e){if(e&&e.payload&&"modal-close"==e.payload.name){if(subscriptions&&Object.keys(subscriptions).forEach(a=>{window.messageBus.unsubscribe(a)}),$(".scratchcardsTeaser").length&&jsf.ajax.render("scratchcardTeaserEditors"),!r){const a=History.getPageUrl?History.getPageUrl():location.href;jsf.ajax.get(a.replace(/\/+$/,""))}return n(!1),dla.frontContent.hide(),window.scrollTo(0,0),!1}}function i(){setTimeout(()=>{const a=document.querySelector(".js-scratchcard-quantity");var e=dla.skin.isMobile?".js-bundleSelection:checked":".js-sc-form input[type=radio]:checked";const t=document.querySelector(e);if(!t)return;const r=document.querySelector(".js-scratchcardItem"),n=t.value;a&&(a.value=n);const{price:c}=t.dataset,s=dla.skin.isMobile?t.parentElement.querySelector(".js-bundleAmount"):t.nextElementSibling;if(!s)return;const o=s.textContent.trim(),i=r.dataset.name,l=r.dataset.title,d=Number.parseInt(t.value),u={type:"scratchcards",name:l,summary:o,total:Number.parseInt(c),ticket:{scratchcardName:i,quantity:d}};window.dispatchEvent(new CustomEvent("productChange",{detail:u}))})}function l(a,e){e&&e.payload&&"scratchcard.goToShoppingCart"==e.payload.name&&e.payload.shoppingCartUrl&&(location.href=e.payload.shoppingCartUrl)}function d(a,t){var r,n;t&&t.payload&&"scratchcard.goToOverview"==t.payload.name&&(dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackUniversal("CLICK_scratchcardGame"+e+"-BuyMore")})),r=t.payload.overviewUrl,n=dla.skin.isMobile?".scratchcardItem":".l-scratchcardItem","undefined"!=typeof llMobile&&void 0!==llMobile.router?(dla.frontContent.hide(),llMobile.router.showPageByUrl(r)?jsf.ajax.reloadComponents(n,(function(a){"success"===a.status&&$(".scratchcard").trigger("page:enter")})):location.href=r):(dla.frontContent.hide(),location.pathname===r?jsf.ajax.reloadComponents(n):dla.navigate.navigateTo(r)))}function u(a,e){e&&e.payload&&"scratchcard.track"==e.payload.name&&dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackUniversal(e.payload.label)}))}function h(a,t){t&&t.payload&&"scratchcard.gameEnd"==t.payload.name&&(null!=t.payload.win&&(0==t.payload.win?dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackUniversal("LOSE_scratchcardGame"+e)})):dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackUniversal("WIN_scratchcardGame"+e+"-"+t.payload.win)}))),jsf.ajax.reloadComponents("#navItemUserControl, #navItemPayinNoRecurringControl, #navItemPayinControl, #userAccountBalance, #closedScratchcards-closedHistory, #submittedScratchcards-submittedHistory, #scratchcardNavItem"))}return $(document).on("page:enter",".scratchcard",(function(e){var r=$(e.currentTarget),n=dla.skin.isMobile?"sc".length:"l-sc".length,c=r.data("name").substr(n),o=t[c],i=r.find("article").data("openGames"),l=$(".payInTarget");if(l.removeClass("hide"),i>0)return void l.addClass("hide");dla.skin.isMobile?(a={data:{scratchcardName:c,quantity:0},element:r},$(".bundleSelection",r).on("change",s)):($(".js-bundleSelection",r).on("change",s),o||(o={data:{scratchcardName:c,quantity:0},element:r},t[c]=o),a=o);s()})),jsf.ajax.addOnEvent((function(a){if("success"===a.status){var e=$(a.responseXML).find("update[ id^='scratchcardOverviewEditors-' ]");e&&e.length&&llMobile.router.enterCurrentPage()}})),subscriptions=null,{startDemo:function(a){return c(a,null,!0)},startGame:c,historyMore:function(a){var e=$("."+a+"HistoryLength");e.val(parseInt(e.val(),10)+4)},openScratchcardAfterPurchase:function(a){function e(e){"success"===e.status&&$("header.back").removeAttr("onclick").on("click",(function(e){e.stopPropagation(),location.href=a.backLinkUrl}))}window.setTimeout((function(){$(".thank-you").addClass("frontContentParent"),dla.skin.isMobile&&sessionStorage.removeItem("scSubmitted"),c(a.scName,null,null,e)}),2e3)},navigate:function(a){("INPUT"===a.target.tagName||dla.skin.isMobile)&&i(),$(".detailLink",$(a.currentTarget||a.srcElement).parent()).triggerHandler("click")},closeGameClient:function(a){a.stopPropagation();var e=llMobile.router.getCurrentPage(),t=e.data("url");e.removeAttr("data-url"),llMobile.router.showPageByUrl(t,"",!0)},reloadPageAndCloseFrontContent:o,setSuppressReloadOnPostPurchase:n,getValueOrBlank:function(a,e){var t=a.attr(e);return void 0===t?"":t},initScratchcardPage:function(){i()},subscribeToGameEvents:function(){subscriptions={ScratchcardsModalClosed:window.messageBus.subscribe("ScratchcardsModalClosed",o),ScratchcardsGoToShoppingCar:window.messageBus.subscribe("ScratchcardsGoToShoppingCar",l),ScratchcardsGameEnd:window.messageBus.subscribe("ScratchcardsGameEnd",h),ScratchcardsGoToOverview:window.messageBus.subscribe("ScratchcardsGoToOverview",d),ScratchcardsTrack:window.messageBus.subscribe("ScratchcardsTrack",u)}}}}(),$(window).trigger("available","scratchcardsJS");