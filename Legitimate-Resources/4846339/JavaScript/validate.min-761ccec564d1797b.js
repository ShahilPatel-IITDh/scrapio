"use strict";dla.helper.createNamespace("dla.payment.validator"),dla.payment.validator=function(){var e,a,t,r,n,i=dla.helper.sniffer,s=!1,o=dla.payment.blockedBinsIndexDB(),l={};function c(e,a){var t=$(this),n=t.closest("fieldset");0===n.length&&(n=t.closest("form"));var i=t.data("validationMethod"),o=t.data("validationPattern"),l=!1;if(a&&C.call(this)){var c=s;s=!1,N(t),s=c}return i&&r[i]?l=r[i].call(this,n,e):o&&(l=p.call(this,o,e)),l&&t.parent().hasClass("error")&&(l=!1),t.data("isValid",l),u(n)}function d(){n||(n=setTimeout(function(){c.apply(this,arguments),n=null}.bind(this),25))}function u(e){var a=!0,t=function(){var e=dla.payment.getLastInstance();if(!e||void 0===e.getModel()||!e.getModel().getSelectedPaymentId())return!1;var a=e.getModel().getSelectedPaymentId();if(/instrument\d/.test(a))return document.querySelector("form[id$=recurringPaymentForm]");{const e=a.replace(/^\D+/g,"");return document.querySelector("form[id*=methods-"+e+"]")}}();t||(t=e);var r=$(".js-terms-conditions-input",e),n=$(".js-header-overlay-funds-custom.has-error").length;return(dla.skin.isMobile?$(".validate, .js-terms-conditions-input",t):r.length>0?r:$(".js-payment-gateway.selected").find(".validate")).each((function(){(!$(this).data("isValid")||r.length&&n)&&(a=!1)})),$("button.payButton",e).prop("disabled",!a),a}function p(e){var a=$(this),t=this.value.trim();return new RegExp(e).exec(t)?(N(a),!0):(P(a,a.data("errorMessage")),!1)}function v(e){return $(e).closest("form")}function f(e,a){var t=e.prevObject;N(t);var r=a(t.val());return r?t.addClass("success"):P(t,t.data("errorMessage")),t.data("isValid",r),u(e),r}function h(e){var a=!1;if(11===e.length){for(var t=0,r=0,n=1;n<=9;n++)t+=n*parseInt(e.charAt(n-1)),n<9&&(r+=n*parseInt(e.charAt(n)));t%=11,r=(r+9*(t%=10))%11,r%=10,a=t===parseInt(e.charAt(9))&&r===parseInt(e.charAt(10))}return a}function m(e){return e.val().replace(/\s/g,"")}function y(e){for(var a=0;a<adyen.cardTypes.size;a++)if(adyen.cardTypes[a].checkCardNumber(e))return adyen.cardTypes[a].getCardType().toLowerCase();return null}function g(e){switch(e){case"mc":case"maestro":case"maestrouk":case"bijcard":return"master_card";case"solo":case"visadankort":case"visaalphabankbonus":return"visa";default:return e}}function k(){var e=$(this),a=m(e),t=function(e){for(var a=0,t=1,r=e.length-1;r>=0;r--)-1!==i(r,e)&&(a+=(n=i(r,e)*t)%10+Math.floor(n/10),t=3-t);var n;return a;function i(e,a){return a.charAt(e)<"0"||a.charAt(e)>"9"?-1:parseInt(a.slice(e,e+1),10)}}(a);return function(e,a){var t=v(a),r=$(".jsPaymentMethod",t),n=r.val();if(n){n=n.toLowerCase();var i=y(e),s=g(i);null!==i&&n!==s&&(r.val(s),$(".paymentMethodName",t).val(s))}}(a,this),function(e,a){return e%10==0&&""!==a&&!isNaN(a)&&a.length>10}(t,a)?(N(e),!!C.call(this)||(P(e,e.data("errorCardWithBlockedBinMessage")),!1)):(P(e,e.data("error-message")),!1)}function C(){var e=$(this);return e.attr("id").indexOf("recurringPaymentMethods")>0||(!function(e,a){if(function(){var e=document.querySelector('[id$="-countryFeatureForBlockedBinsEnabled"]');return e&&"true"===e.value}())return function(e,a){if(!l||$.isEmptyObject(l))return!1;for(var t=4;t<=11;t++){var r=parseFloat(e.substring(0,t)),n=l.find(e=>e.name===a.toLowerCase());if(n&&n.ranges.filter(e=>e.first<=r&&e.last>=r).length>0)return!0}return!1}(e,($(".paymentSelector.selected").length>0?$(".paymentSelector.selected")[0].classList[1]:$(".paymentMethod.selected")[0].getAttribute("data-method")).replace(/[\W_]+/g,"").toUpperCase());return!1}(m(e))||(P(e,e.data("errorCardWithBlockedBinMessage")),!1))}function I(e){if(e.data("payInAmountChecked"))return e.removeData("payInAmountChecked"),!1;var a=dla.payment.getInstance(t).getModel(),r=e.find(".jsDisplayedPriceToPay").val();return a.getPayOutAmount()===parseInt(r,10)&&(dla.messages.showConfirm(dla.messages.get("common_confirmEqualPayOutAmount",dla.helper.formatPricePlain(r)),(function(){e.data("payInAmountChecked",!0),e.find("button.payButton, .js-pay-button").click()}),$.noop),!0)}function A(){var e=$("#kyc");return e.length?e.data("kycPlayerData"):(dla.helper.log("WARNING","kyc not available, can't get missing player data"),!1)}function b(e){return function(e){return"MISSING_D24_DATA"!==e||(dla.frontContent.show("addAdditionalD24PlayerData"),!1)}(e)&&function(e){return"MISSING_BRAZILIAN_DATA"!==e||(dla.frontContent.show("addAdditionalBrazilianPlayerData"),!1)}(e)}function w(e,a){var t=e.find('input[name$="-cardNumber-input"]');return t.val(t.val().split(" ").join("")),dla.payment.clientSideEncryption.encryptCreditCard(a,e)}function S(e){var a=e.val();return new RegExp("^[0-9]{3}$").test(a)?(j(e)&&N(e),!0):(P(e,e.data("errorMessage")),T(e.parent("div")).css("white-space","nowrap"),!1)}function T(e){return e.find("span").not(".tooltip").not("#expiryLabel")}function P(e,a){if(!s&&a){var t=e.parent("div");t.addClass("error"),T(t).addClass("message").html(a).show();var r=e.data("trackName");r&&dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackPayment(r+"-"+dla.universalTracking.action.VALIDATION_FAILED,"add-payment")}))}}function N(e){if(!s){var a=e.parent("div");a.removeClass("error"),T(a).empty().hide()}}function j(e){return e.parent("div").hasClass("error")}function M(){return"MISSING"===A()||"MISSING_FOR_AVS"===A()}function x(e){var a=parent!==document?parent:a;a.dla.payment.avsPayButton=e,a.dla.frontContent.show("addAvsPlayerData",{pushState:!0,source:"PAYMENT"})}function D(e){return $(e).closest(".js-payment-gateway").attr("data-kyc")||$(e).closest(".paymentMethod.selected").attr("data-kyc")}function V(r){if(M())return x(r),!1;v(r);if(!b(D(r)))return!1;if($(r).data("fixAmount")&&$("#"+$(r.form).attr("id")+"-fixPriceToPay").val($(r).data("amount")),"buy"!==a)return!0;var n=[];return e.find(".ticketIds").each((function(){n.push(this.value)})),$.ajax({url:void 0!==window.History&&void 0!==window.History.getState?window.History.getState().url:window.location.href,type:"POST",async:!1,headers:{"Faces-Request":"partial/ajax"},data:{shoppingCartForm:"shoppingCartForm","shoppingCartForm-ticketIdsForValidation":n.join(","),paymentMethodToCheck:dla.payment.getInstance(t).getModel().getSelectedPaymentName(),"javax.faces.ViewState":"stateless","javax.faces.source":"shoppingCartForm","javax.faces.partial.execute":"shoppingCartForm ticketIdsForValidation","javax.faces.partial.render":"shoppingCartForm","Body-Version":dla.version,"X-Skin":dla.skin.name,"javax.faces.partial.ajax":!0},success:function(e,a,t){jsf.ajax.response(t,{formid:"none",sourceid:"shoppingCartForm"}),e.querySelector('[id$="shoppingCartForm"]')||e.querySelector('[id$="growlMessages"]')||e.querySelector("redirect")||B()}}),"true"===$("#shoppingCartForm-consistent").val()}function B(){const e=document.querySelector('[id$="shoppingCartForm"]').dataset.inconstancyMessage||"Your cart has been changed in the meantime and was reloaded.";dla.messages.showConfirm(e,(function(){location.reload()}))}function E(e){return dla.resources.currencyDecimals<1&&function(e){return e.indexOf(dla.resources.decimalSeparator)<0}(e)}function F(e){return!(!E(e)&&!function(e){const a=e.split("")[0],t=e.split("")[1];if(!/[0-9]/.test(a)&&a!==dla.resources.decimalSeparator)return!1;if("0"===a&&t!==dla.resources.decimalSeparator)return!1;if(e.indexOf(dla.resources.decimalSeparator)<0)return!0;if(e.indexOf(dla.resources.decimalSeparator)+1===e.length)return!1;var r=e.split(dla.resources.decimalSeparator).length<=2,n=e.substr(e.indexOf(dla.resources.decimalSeparator)+1);return r&&n.length<=dla.resources.currencyDecimals}(e)||!L(e))}function L(e){if("string"==typeof e&&new RegExp("^\\d*("+dla.resources.groupingSeparator+"\\d{3})*["+dla.resources.decimalSeparator+"]?\\d*$").test(e)){var a=parseInt(100*parseFloat(dla.helper.getCleanAmountValue(e)));return!isNaN(a)}return!1}function O(e){return e.which?e.which:e.keyCode}function R(e){var a=O(e);return e&&q(a)||_(a)}function _(e){return e>=48&&e<=57}function q(e){switch(e){case 8:case 9:case 13:case 32:case 35:case 37:case 39:return!0;default:return!1}}function H(e){return _(e)||function(e){return e>=65&&e<=90||e>=97&&e<=122}(e)}return{init:function(n,u,p){e=n,a=u,t=p,s=!0,r=this,$(".enableBinBlocking").length>0&&async function(){const e=$("meta[name=apiKey]").attr("content"),a=JSON.parse(localStorage.getItem("authToken")),{binChecksumStore:t,binRangesStore:r}=await o.getStores();l=await o.getRanges(r);const n=jQuery.isEmptyObject(l)?"":await o.get("checksum",t);var i={headers:{"X-API-KEY":e,"Content-Type":"application/json",Accept:"application/json","BlockedBins-Checksum":n},credentials:"include"};a&&(i.headers.Authorization="Bearer ".concat(a.accessToken));fetch("/api/stateful/payment/blockedbins",i).then(e=>{if(e.status>=200&&e.status<=304){const a=e.headers.get("BlockedBins-Checksum");return a&&o.set("checksum",a,t),e}var a=new Error(e.statusText);throw a.response=e,a}).then(e=>e&&e.ok?e.json():Promise.reject()).then(async e=>{const a=e.cache;jQuery.isEmptyObject(a)||(l=Object.entries(a).map(e=>({name:e[0].toLowerCase(),ranges:e[1]})),await o.setRanges(a))}).catch(e=>e)}(),e.find(".validate, .js-terms-conditions-input").each((function(){var e=$(this),a=!1,t=e.data("validationEvent");t&&i.hasEvent(t)&&(e.on(t,c),"change"===t&&(a=!0)),a||function(e,a){i.hasEvent("input")||(e.on("keydown",(function(e){var t=e.which;91===t||15<t&&t<19||37<=t&&t<=40||(a&&(s=!0),d.call(this,e,!0),a&&(s=!1))})),i.hasEvent("paste")&&e.on("paste cut",(function(e){a&&(s=!0),d.call(this,e,!0),a&&(s=!1)})));e.on("input change",(function(e){a&&(s=!0),c.call(this,e,!0),a&&(s=!1)}))}(e,t);var n=e.data("validationKeypress");n&&r[n]&&e.on("keypress",(function(e){return r[n].call(this,e)}));var o=e.data("validationKeyup");o&&r[o]&&e.on("keyup",(function(e){return r[o].call(this,e)})),c.call(this)})),s=!1},validate:c,validateExpiryDate:function(){var e=!1;2===arguments.length&&void 0!==arguments[1]&&(e="blur"===arguments[1].type);var a=$(this).closest("form"),t=$(".expiryMonthInput",a),r=$(".expiryYearInput",a),n=u(t,e),i=p(r,e);if(N(t),N(r),!n||!i){n||P(t,t.data("errorMessage")),i||P(r,r.data("errorMessage"));var s=$(".selectValidTo",a);return j(t)&&j(r)?s.addClass("errorBoth"):s.removeClass("errorBoth"),!1}var o=r.data("validationValue"),l=t.data("validationValue"),c=new Date,d=new Date(o,l,0,23,59,59);return d<c?(P(r,r.data("errorMessagePastDate")),!1):(r.data("isValid",!0),t.data("isValid",!0),!0);function u(e,a){var t=e[0],r=(e.is("select")?t.options[t.selectedIndex].value:e.val()).toInt();return!(isNaN(r)||r<=0||r>12)&&(e.data("validationValue",r),r<10&&(r="0"+r),a&&e.val(r),!0)}function p(e,a){var t=e[0],r=(e.is("select")?t.options[t.selectedIndex].value:e.val()).toInt(),n=(new Date).getFullYear();return!isNaN(r)&&(r<100&&(r+=2e3),e.data("validationValue",r),a&&e.val(r),r>=n&&r<=n+10)}},validateFormData:function(e){if(!V(e))return!1;var a=v(e);return!I(a)&&(u(a)?(dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.pseudoPageView("pay3")})),!0):(dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackDeposit(dla.universalTracking.action.DEPOSIT_FAIL)})),!1))},validateCardNumber:k,validateCardNumberAndType:function(){var e=$(this);return function(){var a=v(e),t=m(e),r=$(".jsPaymentMethod",a).val();if(r)return r.toLowerCase()!==g(y(t));return!1}()?(P(e,e.data("error-card-type-message")),!1):(N(e),k.call(this))},validateAndEncryptFormData:function(e,a){if(dla.helper.preventDoubleClick(a),!b(D(a)))return!1;if(!V(a))return!1;var t=v(a);return!I(t)&&(dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackUniversal($(a).data("trackName"),"addPayment")})),u(t)?(dla.payment.getInstance(a).showPaymentProcess(),!t.data("useClientSideEncryption")||w(t,e)):(dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackPayment(dla.universalTracking.action.DEPOSIT_FAIL,"card")})),!1))},encryptFormData:function(e,a){return w(v(a),e)},validatePaymentKyc:b,validateELVData:function(){var e=!0,a=$(this).closest("form"),t=a.find("input[id$='bankLocationId-input']"),r=a.find("input[id$='bankAccountNumber-input']"),n=t.val(),i=r.val();N(t),N(r),e=!(!n||!i),""!==n&&""!==i&&(dla.helper.isNumber(n)&&!dla.helper.isNumber(i)||!dla.helper.isNumber(n)&&dla.helper.isNumber(i))&&(P(r,r.data("errorMessageSepa")),P(t,r.data("errorMessageSepa")),e=!1),t.data("isValid",e),r.data("isValid",e);var s=a.find("input[id$='mandateInput']");return s&&"undefined"!==s&&s.data("isValid",s.is(":checked")),e},validateElvAccountHolder:function(e){return f(e,dla.payment.helper.isValidElvAccountHolderName)},validateTaxId:function(e){return f(e,h)},validateBrazilianIban:function(e){var a,t=f(e,(a="^(BR|br)[0-9\\sa-zA-Z]{27,}",function(e){return!!new RegExp(a).exec(e)}));return"undefined"==typeof IBAN?t:t&&f(e,IBAN.isValid)},validateTaxIdInBootstrapInput:function(){var e=$(this).closest("form"),a=e.find("input[id$='inputTaxId-input']"),t=a.val();(s=a.parent("div")).removeClass("error");var r=s.parent("div");r.removeClass("has-error");var n=T(r);n.empty().hide();var i=h(t);if(i)a.addClass("success");else{var s;(s=a.parent("div")).addClass("error");var o=a.data("errorMessage");r.addClass("has-error"),n.addClass("help-block").html(o).show(),dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackPayment("taxId-"+dla.universalTracking.action.VALIDATION_FAILED)}))}return a.data("isValid",i),u(e),i},isShoppingCartConsistent:V,showAddAvsPlayerData:x,isRequiredPlayerDataMissing:M,confirmEqualPayOutAmount:I,validateCVC:S,validateCVCInitialPayin:function(){return S($(this))},validateCVCRecurringPayin:function(e){var a=$(this);return a.closest(".js-payment-gateway",e).hasClass("selected")?S(a):(j(a)&&N(a),!0)},beautifyCardNumber:function(e){var a=$(this);return 0!==e.which&&setTimeout((function(){var e=function(e){return e%5==0?e+1:e}(a[0].selectionStart),t=a.val().replace(/\s/g,"").chunk(4).join(" ");a.val(t),a[0].setSelectionRange(e,e)}),25),R(e)},checkBlockedBins:C,validateCheckBox:function(e,a){return!!a&&$(a.currentTarget).is(":checked")},onlyNumbers:R,onlyLettersAndNumbersAndHyphen:function(e){var a=O(e);return e&&q(a)||H(a)||45===a},onlyLettersAndNumbersAndHyphenAndSlash:function(e){var a=O(e);return e&&q(a)||H(a)||function(e){return 45===e||47===e}(a)},handleValidationResponse:function(e){if(dla.helper.preventDoubleClick(e),dla.helper.onAvailability(["universalTracking"],(function(){dla.universalTracking.trackInputValidationFailure(e)})),"success"===e.status){var a=$(e.source).data("checkId");a&&dla.payment.getInstance(e.source).check(a,500);var t=$("#"+e.source.id).closest("form");dla.payment.getInstance(e.source)||dla.payment.createForId("addFunds","payIn"),s=!0,$(".validate, .js-terms-conditions-input",t).each((function(){var e=$(this).parent(),a=T(e);e.hasClass("error")&&""===a.eq(0).html()&&e.removeClass("error"),c.call(this)})),s=!1}},isAmount:L,validateAmount:F,validateAmountElement:function(e){var a=(e=$(e)).closest(".formEl").children(),t=e.closest(".js-header-overlay-funds-custom");return a.removeClass("error").find(".message").remove(),t.find(".help-block").remove(),!!F(e.val())||(a.addClass("error").append($('<span class="message">'+e.data("errorMessage")+"</span>")),t.append($('<span class="help-block l-header-overlay-funds-custom-error-message js-header-overlay-funds-custom-error-message">'+e.data("errorMessage")+"</span>")),!1)},showInconstancyMessage:B}},$(window).trigger("available","paymentValidateJsLoaded");