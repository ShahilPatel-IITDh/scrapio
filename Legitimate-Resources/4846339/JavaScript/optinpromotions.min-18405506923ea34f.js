dla.optinpromotions=function(){function e(e){return $.get("/api/optin/isRegistered?code="+e.join(","))}function n(e,n){return $.ajax({type:"PUT",url:dla.resources.localePrefix+"/api/optin?code="+e.code}).then((function(t){if(!t)return o(e,n),void(e.confirmationMessage&&dla.messages.growl({message:e.confirmationMessage}));if(dla.messages.growl({message:t.msg}),"registered"===t.code)return o(e,n);if("nopromotion"!==t.code)throw new Error(t.msg)}))}function t(){var n=[];if($("a.jsOptin").each((function(e,t){var o=r(t);o.code&&n.push(o)})),n.length)return e(n.map((function(e){return e.code}))).then((function(e){Object.keys(e).forEach((function(t){n.forEach((function(n){e.hasOwnProperty(t)&&t===n.code&&!0===e[t]&&o(n)}))}))}))}function o(e,n){e.$element.text(e.labelAfter),e.url?(e.$element.attr("href",e.url),e.$element.addClass("js-ajaxNavi"),e.$element.data("oneClick")&&n&&function(e,n){dla.navigate.onEvent.call(e.$element[0],n)}(e,n)):e.$element.on("click",(function(){return!1}))}function r(e){var n=$(e);return{url:n.data("url"),code:n.data("code"),labelAfter:n.data("labelAfter"),confirmationMessage:n.data("confirmationMessage"),$element:n}}return $(window).on("page:enter",(function(){t()})),$(document).on("click","a.jsOptin",(function(o){var a=r(o.target);if(!a.$element.attr("href"))return o.isDeferred=!0,$("#trackingInfo").data("playerLoggedIn")?(n(a,o),!1):(dla.authentication.open().then((function(){return e([a.code])})).then((function(e){if(!0!==e[a.code])return n(a,o)})).then((function(){t()})),!1)})),{updateStatus:t}}();