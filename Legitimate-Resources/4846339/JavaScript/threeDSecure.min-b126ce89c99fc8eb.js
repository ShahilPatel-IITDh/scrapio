"use strict";class ThreeDSecure extends HTMLElement{static get observedAttributes(){return["url"]}constructor(){super(),this.attachShadow({mode:"open"}),this.iframe=ThreeDSecure.createIframe(),this.shadowRoot.appendChild(this.iframe),this.shadowRoot.appendChild(ThreeDSecure.createForm()),this.urlIsSet=!1,this.connected=!1}findIframeUrl(){try{if(void 0!==this.iframe.contentWindow.location.href)return this.iframe.contentWindow.location.href}catch(e){return""}}checkIframe(){let e=this.findIframeUrl();return e.indexOf("/payin/return?")>=0&&e.indexOf("merchantReference=")>=0?(clearInterval(this.checkInterval),e.indexOf("status=PENDING")>=0||e.indexOf("status=SUCCESS")>=0||e.indexOf("status=AUTHORIZED")>=0?"SUCCESS":"ABORT"):""}startIframeCheckInterval(){let e=this;this.checkInterval=window.setInterval((function(){"SUCCESS"===e.checkIframe()?e.dispatchEvent(new CustomEvent("3dSuccess",{})):"ABORT"===e.checkIframe()&&e.dispatchEvent(new CustomEvent("3dAbort",{}))}),50)}static createIframe(){var e=dla.helper.storage.get("3DSecureWidth"),t=dla.helper.storage.get("3DSecureHeight"),r=document.createElement("iframe");return r.setAttribute("id","threeDSecureIframe"),r.setAttribute("name","LottolandPayment"),r.setAttribute("width",e),r.setAttribute("height",t),r.setAttribute("frameborder",0),r.setAttribute("sandbox","allow-scripts allow-forms allow-modals allow-same-origin"),r}static createForm(){let e=document.createElement("form");return e.setAttribute("id","threeDSecureForm"),e.method="POST",e.style.display="none",e.target="LottolandPayment",e}addParametersAsInputsToForm(e,t){var r={};for(var n in e.replace(/[#?&]+([^=&]+)=([^&]*)/gi,(function(e,t,n){r[t]=n})),r)if(r.hasOwnProperty(n)){var i=document.createElement("input");i.type="hidden",i.name=decodeURIComponent(n),i.value=decodeURIComponent(r[n]),t.appendChild(i)}}attributeChangedCallback(e,t,r){if("url"===e){let e=r;if(r.startsWith("get://"))return e=e.replace("get://","https://"),this.iframe.src=e,this.connected=!0,void this.startIframeCheckInterval();e=e.replace("post://","https://");let t=this.shadowRoot.getElementById("threeDSecureForm");this.addParametersAsInputsToForm(e,t),t.action=e.substring(0,e.indexOf("?")),this.urlIsSet=!0,this.submitFormWhenConditionsAreFulfilled()}}submitFormWhenConditionsAreFulfilled(){this.urlIsSet&&this.connected&&(this.shadowRoot.getElementById("threeDSecureForm").submit(),this.startIframeCheckInterval())}connectedCallback(){this.connected=!0,this.submitFormWhenConditionsAreFulfilled()}}window.customElements.define("ll-3d-secure",ThreeDSecure);