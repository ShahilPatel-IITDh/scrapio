dla.helper.createNamespace("dla.payment.model"),dla.payment.model=function(){var e,t=[],r=[],i=0,n=0,a=0,o=0,u=0,c=0,s=0,l=0,d=0,h=!1,m=!1,f=!1,p=!1,b=0,v=!1,y=!1;function g(e){0!==arguments.length&&(Object.defineProperty(this,"id",{value:e.id}),Object.defineProperty(this,"name",{value:e.name}),Object.defineProperty(this,"maxLimit",{value:e.maxLimit}),Object.defineProperty(this,"minLimit",{value:e.minLimit}),Object.defineProperty(this,"recurrable",{value:e.recurrable}),Object.defineProperty(this,"lengthy",{value:e.lengthy}),Object.defineProperty(this,"isThreeDSecure",{value:e.isThreeDSecure}),Object.defineProperty(this,"availableForSubscriptionWithinBacs",{value:!e.hasOwnProperty("availableForSubscriptionWithinBacs")||e.availableForSubscriptionWithinBacs}),Object.defineProperty(this,"withinSavedInstrumentsLimit",{value:!e.hasOwnProperty("withinSavedInstrumentsLimit")||e.withinSavedInstrumentsLimit}),Object.defineProperty(this,"providerCurrency",{value:e.providerCurrency}),Object.defineProperty(this,"providerCurrencyDecimals",{value:e.providerCurrencyDecimals}),Object.defineProperty(this,"exchangeRateToProviderCurrency",{value:e.exchangeRateToProviderCurrency}),Object.defineProperty(this,"rateAdjustmentToProviderCurrency",{value:e.rateAdjustmentToProviderCurrency}),Object.defineProperty(this,"bacsAsMainRecurringInstrument",{value:e.bacsAsMainRecurringInstrument}),this.prioritized=!1,this.disabled=!1,this.selected=!1,this.isBACS=function(){return"bacs_direct_debit"===this.name},this.isPaymentMethodAvailableBasedOnBacsMobileCheck=function(){return!(!p&&this.isBACS())&&!(p&&this.bacsAsMainRecurringInstrument&&!this.isBACS())},this.isMobileTippengineSection=function(){const e=null!=document.querySelector(".new-purchase-journey");return dla&&dla.skin&&dla.skin.isMobile&&llMobile&&llMobile.router&&llMobile.router.getCurrentPage()&&llMobile.router.getCurrentPage().get(0)&&llMobile.router.getCurrentPage().get(0).dataset&&"/shoppingcart"===llMobile.router.getCurrentPage().get(0).dataset.url&&!e},this.isDepositOrWithdrawSection=function(){return["account/deposit","account/payout"].filter(e=>window.location.href.includes(e)).length>0},this.checkAvailabilityBasedOnBacs=function(){return this.isMobileTippengineSection()?this.isPaymentMethodAvailableBasedOnBacsMobileCheck()&&this.availableForSubscriptionWithinBacs:this.availableForSubscriptionWithinBacs})}function P(e){this.parent.constructor.call(this,e),Object.defineProperty(this,"expired",{value:e.expired}),Object.defineProperty(this,"blocked",{value:e.blocked}),Object.defineProperty(this,"providerCurrency",{value:e.providerCurrency}),Object.defineProperty(this,"providerCurrencyDecimals",{value:e.providerCurrencyDecimals}),Object.defineProperty(this,"exchangeRateToProviderCurrency",{value:e.exchangeRateToProviderCurrency}),Object.defineProperty(this,"rateAdjustmentToProviderCurrency",{value:e.rateAdjustmentToProviderCurrency})}function A(){var e=u-n-a-i;return Math.max(0,e)}function C(){y=!!t.find((function(e){return!!e.prioritized}));var i=!1,n=!1;t.forEach((function(t){t.isAvailable()?(e.trigger("availableMethod",t),n=!0):e.trigger("unavailableMethod",t)})),r.forEach((function(t){t.isAvailable()?(e.trigger("availableInstrument",t),i=!0):e.trigger("unavailableInstrument",t)})),e.trigger("paymentInstrumentsAvailable",i),e.trigger("paymentMethodsAvailable",n),e.trigger("paymentStateChanged",function(){if(0===u)return"empty";var e=A();if(e>s&&u>=b&&!h)return"limitReached";if(u>l&&u>=b&&!m)return"betLimitReached";if(u>d&&u>=b&&!f)return"netLossLimitReached";if(e<=0)return"fulfilled";if(u<b)return"undercut";if(k()&&!function(){var e=!1;return t.forEach((function(t){e|=t.recurrable})),e}())return"subscriptionImpossible";if(N(e))return"enteredPriceAboveAvailableLimits";var i=!1;return t.forEach((function(e){e.isAvailable()&&(i=!0)})),r.forEach((function(e){e.isAvailable()&&(i=!0)})),i?"possible":"impossible"}()),e.trigger("availablePaymentChanged")}function M(e,t){if("string"!=typeof t.providerCurrency)return e;var r=isNaN(t.rateAdjustmentToProviderCurrency)?0:t.rateAdjustmentToProviderCurrency;if(convertedPriceNumberFloat=e*t.exchangeRateToProviderCurrency*(1-r/100),t.providerCurrencyDecimals>dla.resources.currencyDecimals){var i=t.providerCurrencyDecimals-dla.resources.currencyDecimals;convertedPriceNumberFloat*=Math.pow(10,i)}return Math.floor(convertedPriceNumberFloat)}function S(){var i=A(),o={},c={},s={},l={};t.concat(r).forEach((function(e){var t=M(i,e),r=M(u,e);isNaN(t)||(c[e.name]=t),isNaN(r)||(o[e.name]=r),isNaN(e.providerCurrencyDecimals)||(l[e.name]=e.providerCurrencyDecimals),"string"==typeof e.providerCurrency&&(s[e.name]=e.providerCurrency)})),e.trigger("priceUpdate",{totalPrice:u,price:A(),pricePerPaymentMethod:c,totalPricePerPaymentMethod:o,currencyPerPaymentMethod:s,providerCurrencyDecimalsPerPaymentMethod:l,bonus:n,bonusFunds:a})}function B(){t.forEach((function(t){t.selected?e.trigger("selectedMethod",t):e.trigger("deselectedMethod",t)})),r.forEach((function(t){t.selected?e.trigger("selectedInstrument",t):e.trigger("deselectedInstrument",t)})),e.trigger("finishedInstrumentSelection")}function O(e){for(var r=0;r<t.length;r++){var i=t[r];if(i.id===e)return i}}function j(e){for(var t=0;t<r.length;t++){var i=r[t];if(i.id===e)return i}}function L(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.selected)return r}return!1}function I(){var e=L(r);return e||L(t)}function k(){return p}g.prototype.isAvailable=function(){if(!this.isDepositOrWithdrawSection()&&!this.checkAvailabilityBasedOnBacs())return!1;if(!this.withinSavedInstrumentsLimit)return!1;if(y&&!this.prioritized)return!1;if(k()&&!this.recurrable)return!1;const e=A();return this.minLimit<=e&&e<=this.maxLimit&&e<=s&&b<=e&&o<=e},P.inheritsFrom(g),P.prototype.isAvailable=function(){return!this.blocked&&!this.expired&&this.parent.isAvailable.call(this)};const N=e=>{let i=t.concat(r);return!(!i||!i.length)&&!t.concat(r).some(t=>!t.maxLimit||t.maxLimit>=e)};return{init:function(y,A,M,B){e=$(M),y=y||{},i=parseInt(y.balance)||0,n=parseInt(y.bonus)||0,a=parseInt(y.bonusFunds)||0,v=y.enableBonusFundsInWeb,y.price,o=y.price||0,u=parseInt(y.totalPrice),c=parseInt(y.payoutAmount),s="buy"===B||"quickBuy"===B?y.limit:Number.MAX_VALUE,l="buy"===B||"quickBuy"===B?y.betLimit:Number.MAX_VALUE,d="buy"===B||"quickBuy"===B?y.netLossLimit:Number.MAX_VALUE,h=("buy"===B||"quickBuy"===B)&&y.depositLimitSilentMode,m=("buy"===B||"quickBuy"===B)&&y.betLimitSilentMode,f=("buy"===B||"quickBuy"===B)&&y.netLossLimitSilentMode,y.etid,y.idempotencyToken,p=y.containsSubscriptionTicket,b=y.payinMinimumAmount||0,t=[],r=[];for(var O=0;O<A.length;O++){var j=A[O];"PaymentMethod"===j.type?t.push(new g(j)):"PaymentInstrument"===j.type&&r.push(new P(j))}C(),S()},setPrice:function(e){isNaN(e)||(dla.payment.promotion&&$(".js-promotionCodeForm").length&&dla.payment.promotion.checkBonusesAndUpdateShoppingCart(v,e,u,a),e!==u&&(u=e,C(),S()))},getPrice:A,getPayOutAmount:function(){return c},setBonus:function(e){n=e,C(),S()},setBonusFunds:function(e){a=e},getBonusFunds:function(){return a},setEnableBonusFundsInWeb:function(e){v=e},getEnableBonusFundsInWeb:function(){return v},setSubscription:function(e){p=e,C()},getSelectedPayment:I,getSelectedPaymentId:function(){var e=I();return!!e&&e.id},getSelectedPaymentName:function(){var e=I();return!!e&&e.name},selectMethod:function(e){if(!function(e){var t=j(e);return t||O(e)}(e).isAvailable())return!1;t.forEach((function(t){t.selected=t.id===e})),r.forEach((function(e){e.selected=!1})),B()},selectInstrument:function(e){if(!j(e).isAvailable())return!1;r.forEach((function(t){t.selected=t.id===e})),t.forEach((function(e){e.selected=!1})),B()},updateMethodPriority:function(e,t){O(e).prioritized=t,C()},updateAvailability:C}},$(window).trigger("available","paymentModelJsLoaded");