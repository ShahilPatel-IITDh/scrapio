"use strict";var dla=window.dla||{};class ProductSearch{constructor(e){const t=document.querySelector("html").lang,r="".concat(dla.resources.localePrefix,"/api/client/v1/productsearch/products");this._productTypeList=["lotteries","scratchcards","games","syndicates"],this._bodyElement=document.querySelector("body"),this._productSearchElement=e,this._inputElement=this._productSearchElement.querySelector("#js-productSearch-input"),this._searchContainerSelector="#js-productSearch-search-container",this._searchContainerElement=this._productSearchElement.querySelector(this._searchContainerSelector),this._formElement=this._searchContainerElement.querySelector(".js-form-control"),this._controlOpenElement=this._productSearchElement.querySelector("#js-productSearch-control-open"),this._controlCloseElement=this._productSearchElement.querySelector("#js-productSearch-control-close"),this._resultListElement=this._productSearchElement.querySelector(".js-productSearch-list"),this._notificationContainerElement=this._productSearchElement.querySelector(".js-productSearch-notification-container"),this.searchContainerVisible=!1,this._translationKeys=this.translationKeys,this._isDesktop="desktop"===this._productSearchElement.dataset.device,this._renderObject=new ProductSearchRender,this._dataManagerObject=new ProductSearchDataManager(r,36e5,t),this._dataParserObject=new ProductSearchDataParser(this._renderObject,this._translationKeys,5),this._keyBoardNavObject=!!this._isDesktop&&new ListKeyBoardNavigation(this._searchContainerSelector),this._isGameInfoModalEnabled=this._productSearchElement.dataset.gameModalEnabled}init(){this.resetSearchContainer(),this.setupListeners(),this.hide(!1)}get translationKeys(){const e=this._productSearchElement.querySelector(".js-productSearch-translations").dataset;return{lotteries:e.lotteries,syndicates:e.syndicates,games:e.games,scratchcards:e.scratchcards,introMsg:e.introMsg,noMatches:e.noMatches,errorAPI:e.errorApi}}destroy(){this.hide(),this._keyBoardNavObject&&this._keyBoardNavObject.removeListeners()}hide(e=!0){e?this._productSearchElement.classList.add("hidden"):this._productSearchElement.classList.remove("hidden")}setupListeners(){this._inputElement.addEventListener("input",this.debounceInputChange.bind(this),!1),window.addEventListener("resize",()=>{this.searchContainerVisible&&(this.disableBodyOverFlow(this.below768),""===this.keyWordSearch&&this.showMsg("introMsg"))}),document.addEventListener("click",e=>{this.searchContainerVisible&&(this._productSearchElement.contains(e.target)||this.leaveSearchContainer())}),this._controlOpenElement.addEventListener("click",()=>{this._dataManagerObject.inited||this._dataManagerObject.init(),this.showSearchContainer(),this.disableBodyOverFlow(this.below768)}),this._controlCloseElement.addEventListener("click",()=>{this.leaveSearchContainer()}),this._productSearchElement.addEventListener("keydown",e=>{/(27|39|13)/.test(e.which)&&(13!==e.which&&39!==e.which||e.target.classList.contains("currentPage"))&&this.leaveSearchContainer()}),this._resultListElement.addEventListener("click",e=>{if("true"===this._isGameInfoModalEnabled&&e.target.getAttribute("data-modal-url")&&"true"===this._productSearchElement.dataset.useGameInfoModal&&!dla.skin.isMobile)e.stopPropagation(),e.preventDefault(),this.openGameInfoModal(e),this.leaveSearchContainer();else{if(!e.target.classList.contains("currentPage"))return;e.preventDefault(),this.leaveSearchContainer()}})}disableBodyOverFlow(e=!0){e?this._bodyElement.classList.add("disableOverFlow"):this._bodyElement.classList.remove("disableOverFlow")}get below768(){return"fixed"===window.getComputedStyle(this._searchContainerElement).position}leaveSearchContainer(){this.showSearchContainer(!1),this.disableBodyOverFlow(!1)}showSearchContainer(e=!0){this.resetSearchContainer(),this.searchContainerVisible=e,e||this._formElement.blur(),e?this._productSearchElement.classList.add("active"):this._productSearchElement.classList.remove("active")}resetSearchContainer(){this.keyWordSearch="",this._inputElement.value="",this.resetResultList(),this.showMsg("introMsg")}resetResultList(){this._resultListElement.scrollTop=0,this._renderObject.emptyMarkup(this._resultListElement)}debounceInputChange(){this.debounced=this.debounced||window.requestAnimationFrame(this.getProductData.bind(this))}getProductData(){this._dataManagerObject.getProductData(this.showMsg.bind(this,"errorAPI")).then(e=>{this.updateProductList(e)}).then(()=>{this.debounced=!1})}updateProductList(e){this.keyWordSearch=this._renderObject.normalizeText(this._inputElement.value),this.resetResultList(),this.renderBySearchString(this.keyWordSearch,e)}renderBySearchString(e,t){if(""===e)this.showMsg("introMsg");else if(void 0!==t.searchHistory[e])this.renderMarkupListString(t.searchHistory[e],e);else{const r=this._dataParserObject.parseAllProducts(this._productTypeList,t,e);this.renderMarkupListString(r,e),this._dataManagerObject.saveSearchHistory(r,e)}}renderMarkupListString(e){""===e?this.showMsg("noMatches"):this._renderObject.render(this._resultListElement,e)}showMsg(e){switch(e){case"introMsg":this.below768?this._renderObject.render(this._notificationContainerElement,this._renderObject.getMarkupNotification(this._translationKeys.introMsg,"l-productSearch-notification-introMsg")):this._renderObject.emptyMarkup(this._notificationContainerElement);break;case"noMatches":this._renderObject.render(this._notificationContainerElement,this._renderObject.getMarkupNotification(this._translationKeys.noMatches.replace("[XXX]",this._renderObject.sanitizeString(this._inputElement.value)),"l-productSearch-notification-noMatches"));break;case"errorAPI":this._renderObject.render(this._notificationContainerElement,this._renderObject.getMarkupNotification(this._translationKeys.errorAPI,"l-productSearch-notification-apiError"))}}openGameInfoModal(e){window.messageBus.publish("OmniOpenGameInfoModal",{payload:{url:e.target.getAttribute("data-modal-url"),gameName:e.target.getAttribute("data-modal-gamename")}})}}dla.InjectionObserver.register({SELECTOR:".js-productSearch",init:e=>{dla.helper.onAvailability(["productSearchDataManager","productSearchDataParser","productSearchRender","listKeyBoardNavigation"],()=>{dla.productSearch=new ProductSearch(e),dla.productSearch.init()})},destroy:()=>{dla.productSearch.destroy(),dla.productSearch=void 0}});