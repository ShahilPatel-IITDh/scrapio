if (top.location.href != self.location.href) 	{ top.location.href = self.location.href; }
if (top.location!= self.location) 				{ top.location = self.location.href; }

this.top.location !== this.location && (this.top.location = this.location);

$("*[rel=popover]").popover().click(function(e) { e.preventDefault(); });

email_form.append("<input type='hidden' name='js' value='1'>");
email_input.focus();
email_input.emailautocomplete();

function is_valid_email_address(email_address) {
		var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
		return pattern.test(email_address);
};

$(email_form).submit(function(){ $(this).find(':submit').attr('disabled','disabled'); });
$('#form-submit').click(function(e)
{ 
	if(pop == 'y')
	{
		var email_address	= email_input.val(),
			pop_url 		= url + "/" + email_address;
		
		if(email_address == 'email@example.com')	{ return; }
		if(! is_valid_email_address(email_address)) { return; } 
		
		var popup =  window.open(pop_url,"_blank","height="+screen.height+", width="+screen.width);
		
		if(!popup || popup.closed || typeof popup.closed =='undefined')
		{
			$.get('https://rewardingpromos.com/go/api/popBlock/'+user_subid);
		}
	}
	
	e.preventDefault();
	window.onbeforeunload = null;
	email_input.verify();
});

if(drop != 'n')
{
	window.onbeforeunload = function()
	{ 
		return "Warning";
	};
}

if(back)
{
	(function()
	{
		var campaign_link = back,
			t;
		try
		{
		for(t=0;10>t;++t)history.pushState({},"","#");
		onpopstate=function(t){t.state&&location.replace(campaign_link)}}
		catch(o){}
	})();
}
