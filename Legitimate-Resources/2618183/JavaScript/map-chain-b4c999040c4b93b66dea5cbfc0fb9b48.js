fourSq.views.ChainMap=function(a,b){};
fourSq.views.ChainMap=fourSq.views.Map.extend({initialize:function(a){fourSq.views.ChainMap.__super__.initialize.call(this);_.each(["id","serviceCall"],function(b){fourSq.isUndefinedOrNull(a[b])&&fourSq.debug.error(b+" is required for VenuePage")});this.serviceCall_=a.serviceCall;this.id=a.id;this.numVenues=a.numVenues||0;this.venuesStack=[];this.venuesProcessed={};this.offset=0;this.prevCenter=null},initLoad:function(){this.venuesProcessed={};this.mapLoaded?$(this).queue(this.fetch).queue(this.processVenues).queue(this.fit):
setTimeout(fourSq.bind(this.initLoad,this),300)},load:function(){$(this).queue(this.fetch).queue(this.processVenues)},fetch:function(a){this.venuesProcessed>=this.numVenues||(this.fetchingVenues.show(),this.serviceCall_(this.getApiParams(),fourSq.bind(function(b){this.fetchingVenues.hide();for(var c=0;c<b.length;++c)this.venuesStack.push(b[c]);a()},this),fourSq.bind(function(a,c){this.fetchingVenues.hide()},this)))},getApiParams:function(){var a=this.userLoc.lat+","+this.userLoc.lng,b={id:this.id},
c=0>=_.keys(this.venuesProcessed).length;b.limit=c?25:250>this.numVenues?250:50;if(c)b.ll=a,b.offset=0;else{var a=this.map.getBounds().getSouthWest().lat,c=this.map.getBounds().getSouthWest().lng,d=this.map.getBounds().getNorthEast().lat,e=this.map.getBounds().getNorthEast().lng;2>=d-a?(b.sw=a+","+c,b.ne=d+","+e):(b.ll=this.searchPoint.lat+","+this.searchPoint.lng,this.offset=this.prevCenter==b.ll?this.offset+this.prevLimit:0,b.offset=0<this.offset?this.offset:0,this.prevCenter=b.ll,this.prevLimit=
b.limit)}return b},findBounds:function(a){var b=180,c=-180,d=180,e=-180,f=-90,g=90;_.each(a,function(a){var h=a.lat,q=a=a.lng;0>a&&(q=360+a);b=Math.min(a,b);c=Math.max(a,c);d=Math.min(q,d);e=Math.max(q,e);g=Math.min(h,g);f=Math.max(h,f)});if(c-b<e-d){a=new L.LatLng(f,c);var h=new L.LatLng(g,b);return new L.LatLngBounds(h,a)}a=new L.LatLng(f,e,!0);h=new L.LatLng(g,d,!0);return new L.LatLngBounds(h,a)},latSpan:function(a){return a.getNorthEast().lat-a.getSouthWest().lat},lngSpan:function(a){return a.getNorthEast().lng-
a.getSouthWest().lng},pointIsBounded:function(a,b){return b.contains(new L.LatLng(a.lat,a.lng))},boundByUserLoc:function(a){a=_.sortBy(a,function(a){return a.distance});var b=a[0].distance,c=0,d=Math.min(4,Math.floor(this.userAcc/500)),d=_.range(8,this.initialZoom-d+1),e=d.pop(),f=this.map.options.zoomAnimation;this.map.options.zoomAnimation=!1;this.map.setZoom(e);for(var g=0;g<a.length;++g){var h=a[g];if(h.distance>3*b)break;else if(this.pointIsBounded(h,this.map.getBounds()))c++;else for(;0<d.length;)if(e=
d.pop(),fourSq.debug.debug("Setting zoom: "+e),this.map.setZoom(e),this.pointIsBounded(h,this.map.getBounds())){c++;break}if(0==d.length||3<=c)break}this.map.options.zoomAnimation=f;return 0<c},boundByVenueCluster:function(a){var b=this.findBounds(a);a=this.findBounds(a.concat([this.userLoc]));var c=this.latSpan(b),d=this.lngSpan(b),e=this.latSpan(a),f=this.lngSpan(a);e<=5*Math.max(.1,c)&&f<=5*Math.max(.1,d)&&(b=a);this.map.fitBounds(b)},fit:function(a){this.clearMotionListeners();var b=_.values(this.venuesProcessed);
0<b.length&&!this.boundByUserLoc(b)&&this.boundByVenueCluster(b);this.addMotionListeners();a()},processVenues:function(a){for(;0<this.venuesStack.length;){var b=this.venuesStack.pop();b.id in this.pins||(this.pins[b.id]=this.render(b),$(this.pins[b.id].mainMarker_._icon).addClass("bluePin iconPin"));b.id in this.venuesProcessed||(this.venuesProcessed[b.id]={distance:b.location.distance,lat:b.location.lat,lng:b.location.lng})}a()},render:function(a){var b=this.pinImage("blah"),c=fourSq.api.models.companion.venue.VenueUtil.venueUrl(a),
d=templates.fourSq.chain.chainMarker({name:a.name,address:a.location.address||"",url:c}),e=fourSq.api.models.companion.venue.VenueUtil.primaryCategoryIcon(a,!0);return this.renderPin(a.location.lat,a.location.lng,e,c,d,1,!1,b)}});"undefined"==typeof templates.fourSq&&(templates.fourSq={});"undefined"==typeof templates.fourSq.chain&&(templates.fourSq.chain={});
templates.fourSq.chain.venuesSidebar=function(a,b){return'\x3cdiv class\x3d"chainVenues box"\x3e\x3cdiv class\x3d"chainHeader"\x3e\x3ca href\x3d"'+soy.$$escapeHtml(a.chainUri)+'"\x3e\x3cimg class\x3d"chainLogo" src\x3d"'+soy.$$escapeHtml(a.logoUri)+'" width\x3d"32" height\x3d"32" /\x3e\x3c/a\x3e\x3cdiv class\x3d"chainName"\x3e'+(a.abbreviateHeader?'\x3ch5\x3e\x3ca href\x3d"'+soy.$$escapeHtml(a.chainUri)+'"\x3e'+soy.$$escapeHtml(a.name)+"\x3c/a\x3e\x3c/h5\x3e":'\x3ch5\x3eMore from \x3ca href\x3d"'+
soy.$$escapeHtml(a.chainUri)+'"\x3e'+soy.$$escapeHtml(a.name)+"\x3c/a\x3e\x3c/h5\x3e")+"\x3cspan\x3e"+(a.abbreviateHeader?0==a.count?"at "+soy.$$escapeHtml(a.count)+" locations":1==a.count?"at 1 location":"at "+soy.$$escapeHtml(a.count)+" locations":0==a.count?"No more locations":1==a.count?"One more location":soy.$$escapeHtml(a.count)+" locations")+"\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e"+(a.showMap&&0<a.venues.length?'\x3cdiv class\x3d"venueCompact"\x3e'+templates.fourSq.venue.helpers.map({venueId:a.venues[0].id})+
"\x3c/div\x3e":"")+"\x3c/div\x3e"};
templates.fourSq.chain.map=function(a,b){return'\x3cdiv id\x3d"mapsContainer" class\x3d"chainMap blockContainer"\x3e\x3cdiv class\x3d"blockHeader"\x3e\x3ch3\x3e'+soy.$$escapeHtml(a.name)+' locations\x3c/h3\x3e\x3c/div\x3e\x3cdiv id\x3d"mapContainer"\x3e\x3cdiv id\x3d"noticeContainer"\x3e\x3cdiv id\x3d"fetchingLocation" class\x3d"notice"\x3e\x3cimg src\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/map-spinner-9baa49cd961510898e8b6cb75f38a417.gif")+'" /\x3e Getting your current location\x3c/div\x3e\x3cdiv id\x3d"fetchingVenues" class\x3d"notice"\x3e\x3cimg src\x3d"'+soy.$$escapeHtml("https://ss0.4sqi.net/img/map-spinner-9baa49cd961510898e8b6cb75f38a417.gif")+
'" /\x3e Finding '+soy.$$escapeHtml(a.name)+' locations\x3c/div\x3e\x3cdiv id\x3d"mapNotice" class\x3d"notice"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"map"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mapCopy"\x3e\x3cdiv id\x3d"justificationContainer"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'};
templates.fourSq.chain.chainMarker=function(a,b){return'\x3cdiv class\x3d"mapTooltip blue"\x3e\x3cdiv\x3e\x3ca href\x3d"'+soy.$$escapeHtml(a.url)+'"\x3e'+soy.$$escapeHtml(a.name)+'\x3c/a\x3e\x3c/div\x3e\x3cem\x3e\x3cspan class\x3d"category"\x3e\x3cdiv\x3e'+soy.$$escapeHtml(a.address)+"\x3c/div\x3e\x3c/span\x3e\x3c/em\x3e\x3c/div\x3e"};
templates.fourSq.chain.checkinFacepile=function(a,b){for(var c='\x3cdiv id\x3d"venueFriends" class\x3d"box userGrid"\x3e\x3ch5\x3e'+(a.userHasVisited?0==a.friends.length-1?"You have visited":1==a.friends.length-1?"You and 1 friend have visited":"You and "+soy.$$escapeHtml(a.friends.length)+" friends have visited":0==a.friends.length?"No friends have visited":1==a.friends.length?"1 friend has visited":soy.$$escapeHtml(a.friends.length)+" friends have visited")+"\x3c/h5\x3e",d=a.friends,e=d.length,
f=0;f<e;f++)var g=d[f],c=c+helpers.user.xsmallImageWLink(soy.$$augmentMap(g.user,{alt:helpers.user.fullName(g.user)+" "+(0==g.venueCount?"("+soy.$$escapeHtml(g.checkinCount)+"x at 0 locations)":1==g.venueCount?"("+soy.$$escapeHtml(g.checkinCount)+"x at 1 location)":"("+soy.$$escapeHtml(g.checkinCount)+"x at "+soy.$$escapeHtml(g.venueCount)+" locations)")}));return c+"\x3c/div\x3e"};