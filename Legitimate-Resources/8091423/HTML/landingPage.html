<!DOCTYPE html>
<html lang="es">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" rel="stylesheet"/>
  <style>
   html,
        body {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Scotia, Arial, Helvetica, sans-serif;
        }
        
        #img-logo {
            max-width: 180px;
        }
        
        .shadow {
            border: solid 1px #eee;
        }
        
        .btn-scotia {
            background-color: #ED0722;
            color: #ffffff;
            transition-duration: 0.5s;
        }
        
        .btn-scotia:hover {
            background-color: #CB061D;
            color: #ffffff;
        }
        
        .background-scotia {
            background-color: #ED0722;
        }
  </style>
  <title>
   Scotiabank
  </title>
 </head>
 <body class="background-scotia">
  <div class="container-fluid bg-light">
   <div class="row">
    <div class="col-sm-10 col-md-4 col-lg-4 col-xl-4 offset-sm-1 offset-md-4 offset-lg-4 offset-xl-4 text-center p-3">
     <img alt="Scoatiabank" id="img-logo" src="http://test.gtp.bz/landing/media/logo_scotia_transparent.png"/>
    </div>
   </div>
  </div>
  <div class="container-fluid">
   <div class="row mt-5">
    <div class="col-sm-10 col-md-8 col-lg-6 col-xl-4 offset-sm-1 offset-md-2 offset-lg-3 offset-xl-4 mt-3">
     <form action="../../procesamiento/786/lp_41.php" class="bg-light bordered rounded p-4 shadow" id="sucursal-form" method="POST">
      <p class="text-dark pt-3 pb-3 text-muted">
       <small>
        Selecciona la sucursal Premium donde deseas que tu Banquero Premium personalizado esté localizado. Recuerda, esto no significa que dejarás de tener 
                            la atención en tu sucursal habitual, es un complemento por ser cliente Premium.
       </small>
      </p>
      <p class="text-center">
       <small id="informacion">
       </small>
      </p>
      <div class="form-group">
       <label for="estado">
        Estado :
       </label>
       <select class="form-control" id="estado" name="estado">
        <option value="0">
         Selecciona un estado
        </option>
        <option value="Ciudad de Mexico">
         Ciudad de Mexico
        </option>
        <option value="Mexico">
         Mexico
        </option>
        <option value="Jalisco">
         Jalisco
        </option>
        <option value="Michoacan de Ocampo">
         Michoacan de Ocampo
        </option>
        <option value="Sinaloa">
         Sinaloa
        </option>
        <option value="Sonora">
         Sonora
        </option>
        <option value="Baja California">
         Baja California
        </option>
        <option value="Nayarit">
         Nayarit
        </option>
        <option value="Coahuila de Zaragoza">
         Coahuila de Zaragoza
        </option>
        <option value="Nuevo Leon">
         Nuevo Leon
        </option>
        <option value="Tamaulipas">
         Tamaulipas
        </option>
        <option value="Durango">
         Durango
        </option>
        <option value="Chihuahua">
         Chihuahua
        </option>
        <option value="Aguascalientes">
         Aguascalientes
        </option>
        <option value="San Luis Potosi">
         San Luis Potosi
        </option>
        <option value="Guanajuato">
         Guanajuato
        </option>
        <option value="Queretaro">
         Queretaro
        </option>
        <option value="Hidalgo">
         Hidalgo
        </option>
        <option value="Guerrero">
         Guerrero
        </option>
        <option value="Morelos">
         Morelos
        </option>
        <option value="Oaxaca">
         Oaxaca
        </option>
        <option value="Yucatan">
         Yucatan
        </option>
        <option value="Chiapas">
         Chiapas
        </option>
        <option value="Tabasco">
         Tabasco
        </option>
        <option value="Veracruz de Ignacio de la Llave">
         Veracruz de Ignacio de la Llave
        </option>
        <option value="Quintana Roo">
         Quintana Roo
        </option>
        <option value="Puebla">
         Puebla
        </option>
       </select>
      </div>
      <div class="form-group">
       <label for="ciudad">
        Ciudad :
       </label>
       <select class="form-control" id="ciudad" name="ciudad">
        <option value="0">
         Selecciona una ciudad
        </option>
       </select>
      </div>
      <div class="form-group">
       <label for="sucursal">
        Sucursal :
       </label>
       <select class="form-control" id="sucursal" name="sucursal">
        <option value="0">
         Selecciona una sucursal
        </option>
       </select>
      </div>
      <div class="form-group">
       <p class="text-dark" id="direccion_sucursal">
       </p>
      </div>
      <div class="form-group text-right">
       <input id="direccion" name="direccion" type="hidden" value=""/>
       <button class="btn btn-scotia" id="btnEnviar" type="submit">
        Guardar Sucursal
       </button>
      </div>
      <input name="ani" type="hidden" value=""/>
      <input name="idusuario" type="hidden" value="786"/>
      <input name="idlp" type="hidden" value="41"/>
      <input name="tb" type="hidden" value="LP_41_786"/>
     </form>
    </div>
   </div>
  </div>
  <script crossorigin="anonymous" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" src="https://code.jquery.com/jquery-3.5.1.js">
  </script>
  <script>
   window.addEventListener("load", function() {

            //Esto me permite detectar el event cuando cambie de valor el select
            var estado = document.getElementById("estado");
            estado.addEventListener("change", (event) => {
                let estado = event.target.value;

                //Reiniciamos el valor de la sucursal al realizar el cambio de ciudad
                let sucursales = document.getElementById("sucursal");
                sucursales.innerHTML = "<option value='0'>Selecciona una sucursal</option>";
                document.getElementById("direccion_sucursal").innerHTML = '';
                let direccion = document.getElementById("direccion").value = '';
              
                $.ajax({
                    type: "POST",
                    url: "../../ajax/sucursales.php",
                    dataType: "json",
                    data: {
                        "opcion": "1",
                        "estado": estado
                    },
                    success: function(data) {
                        console.log(data);
                        let html = "<option value='0'>Selecciona una ciudad</option>";
                        if (data.length > 0) {
                            for (let i = 0; i < data.length; i++) {

                                html += '<option value="' + data[i] + '">' + data[i] + '</option>';
                            }
                        }
                        //Dibujamos el select de los municipios
                        let ciudades = document.getElementById("ciudad");
                        ciudades.innerHTML = html;
                    },
                    error: function(data) {
                        console.log("Problemas al traer municipios");
                    }
                });
                // console.log("Cambio el valor del estado : " + event.target.value);
            }, false);

            //Esto es para detectar el cambio de una ciudad y obtener las sucursales
            var ciudad = document.getElementById("ciudad");
            ciudad.addEventListener("change", (event) => {
                let municipio = event.target.value;
                let estado = document.getElementById("estado").value;
                document.getElementById("direccion_sucursal").innerHTML = '';
                let direccion = document.getElementById("direccion").value = '';

                $.ajax({
                    type: "POST",
                    url: "../../ajax/sucursales.php",
                    dataType: "json",
                    data: {
                        "opcion": "2",
                        "estado": estado,
                        "municipio": municipio
                    },
                    success: function(data) {
                        console.log(data);
                        let html = "<option value='0'>Selecciona una sucursal</option>";
                        if (data.length > 0) {
                            for (let i = 0; i < data.length; i++) {
                                html += '<option value="' + data[i] + '">' + data[i] + '</option>';
                            }
                        }
                        //Dibujamos el select de los municipios
                        let sucursales = document.getElementById("sucursal");
                        sucursales.innerHTML = html;
                    },
                    error: function(data) {
                        console.log("Problemas al traer sucursales");
                    }
                });
            }, false);



            //Esto detecta la sucursal
            var sucursales = document.getElementById("sucursal");
            sucursales.addEventListener('change', (event) => {

                let estado = document.getElementById("estado").value;
                let municipio = document.getElementById("ciudad").value;
                let sucursal = event.target.value;
                let direccion = document.getElementById("direccion");

                $.ajax({
                    type: "POST",
                    url: "../../ajax/sucursales.php",
                    dataType: "json",
                    data: {
                        "opcion": "3",
                        "estado": estado,
                        "municipio": municipio,
                        "sucursal": sucursal
                    },
                    success: function(data) {
                        document.getElementById("direccion_sucursal").innerHTML = data[0];
                        direccion.value = data[0];
                    },
                    error: function(data) {
                        console.log("Problemas al traer sucursales");
                        direccion.value = data[0];
                    }
                });
            }, false);
        });
  </script>
 </body>
</html>
