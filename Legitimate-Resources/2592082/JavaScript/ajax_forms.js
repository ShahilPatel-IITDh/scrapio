(function(window,$,validation,ajax_token){'use strict';var DEBUG=false;window.AJAX={send:function(options){var isValidationAvailable=typeof validation==='object'&&typeof validation.exec==='function',valid=!options.validation||isValidationAvailable&&validate();var params={url:options.url,type:options.type||'POST',data:options.data,beforeSend:options.beforeSend||null,success:successHandler,error:errorHandler,complete:completeHandler};if(window.is_legacy&&!params.url.match("/members/legacy/")){params.url=params.url.replace(/\/members\//,"/members/legacy/");}
if(options.additional&&!$.isEmptyObject(options.additional)){params=$.extend({},params,options.additional);}
if(!valid){if(typeof options.onValidationFail==='function'){options.onValidationFail.call(null);}
return false;}else{if(typeof options.onValidationSuccess==='function'){options.onValidationSuccess.call(null);}}
var ajax_token=Public.ajax_token||window.ajax_token;if(typeof ajax_token!=='undefined'&&ajax_token.length>0){if(typeof params.data==='string'){params.data+='&ajax_token='+ajax_token;}else if(typeof params.data==='object'){params.data.ajax_token=ajax_token;}else if(typeof params.data==='undefined'){params.data={ajax_token:ajax_token}}}
this.debug=function(status){DEBUG=status;};return $.ajax(params);function successHandler(response){var json;try{json=typeof response==='string'&&response.length>0?JSON.parse(response):response;if(typeof json.redirect==='string'){if(window.is_legacy&&typeof window.__messageApp==="function"){return window.__messageApp({redirect:json.redirect})}
if(json.redirect.length>0){return window.location=json.redirect;}else{return window.location.reload();}}
if(typeof options.callback==='function'){options.callback.call(null,json);}
if(json.status==false&&json.data&&typeof json.data.validation==='object'){if(isValidationAvailable){validation.setInvalid(json.data.validation);}}}catch(error){console.info('Error:',error,'; Response:',response);}}
function errorHandler(response){console.warn('Ajax Error:',response);options.error&&options.error(response);}
function validate(){var elementTagName=options.validation.tagName?options.validation.tagName.toLowerCase():null,elementParentForm;if(typeof options.validation!=='string'&&elementTagName!==null&&elementTagName!=='form'){elementParentForm=$(options.validation).closest('form')[0];return elementParentForm?validation.execEl(elementParentForm,options.validation):false;}else{return validation.exec(options.validation);}}
function completeHandler(response){options.complete&&options.complete.call(null,response);}}};}(window,jQuery,window.validation,window.Public.ajax_token));