"use strict";var adn=adn||{};adn.calls=adn.calls||[],adn.version="40889485950457619c069193d7f22f1d69e18487";try{!function(C,P,T){var c="ADN_DEV_SCRIPT",n=!!(P.getElementById(c)||{}).src;if(C.out&&!n)return C.out.devOutput("adn.out is already defined","initial check");var w,e,p,S,m,E={env:{localhost:{id:"localhost",as:"localhost:8078"},lcl:{id:"lcl",as:"adserver.dev.lcl.test",dt:"dev.data.lcl.test"},andemu:{id:"andemu",as:"10.0.2.2:8078"},dev:{id:"dev",as:"adserver.dev.adnuntius.com",dt:"dev.data.adnuntius.com"},staging:{id:"staging",as:"adserver.staging.adnuntius.com",dt:"staging.data.adnuntius.com"},production:{id:"production",as:"delivery.adnuntius.com",dt:"data.adnuntius.com"}},dn:{as:"delivery.",dt:"data."},sync:{PLATFORM_161:"https://ads.creative-serving.com/cm?redir=https%3A%2F%2Fdata.adnuntius.com%2Fsync%3FbrowserId%3D{BROWSER_ID}%26folderId%3D{FOLDER_ID}%26externalSystemType%3DP161%26externalSystemUserId%3D%24%7BUUID%7D"},impReg:{manual:"manual"},events:{CUSTOM:"CUSTOM"},methodEnums:{ifr:"ifr",composed:"composed",preview:"preview",previewDirect:"previewDirect"},loadEnums:{lazy:"lazy",lazyRequest:"lazyRequest"},requestMode:{hasTarget:"hasTarget",default:"default"},requestTiming:{immediate:"immediate",onReady:"onReady",onLoad:"onLoad"},syncAds:["//pagead2.googlesyndication.com/pagead/show_ads.js"],postMessageType:{toParentImpression:"toParentImpression",toParentResponse:"toParentResponse",toParentPageLoad:"toParentPageLoad",toParentResize:"toParentResize",toParentUpdateAd:"toParentUpdateAd",toParentSubscribe:"toParentSubscribe",toParentGetAdUnitInfo:"toParentGetAdUnitInfo",toParentFunctions:"toParentFunctions",toParentAllChildrenViewed:"toParentAllChildrenViewed",toParentAdVisibilityEvent:"toParentAdVisibilityEvent",toParentCustomEvent:"toParentCustomEvent",toParentIsolateAdVisibilityEvent:"toParentIsolateAdVisibilityEvent",toChildViewability:"toChildViewability",toChildPubs:"toChildPubs",toChildAdUnitInfo:"toChildAdUnitInfo"},composedRequest:{noRequest:"noRequest",requestMade:"requestMade",requestReturned:"requestReturned"},container:{iframe:"iframe",div:"div"},feedback:{console:{allAndInfo:"allAndInfo",all:"all",warnings:"warnings",errors:"errors",silent:"silent"},inScreen:{inAdUnit:"inAdUnit",silent:"silent"}},cwClass:"contentWrapperPerItem",nativeClass:"adnNative",widgetIdPrefix:"adn-widget-",adIdPrefix:"adn-id-",longestTime:9e5,defaultProximity:200,defaultVisibilityPercentage:1,postMessageSrcKey:"messageSrc",postMessageSrcValue:"adn",functionContext:{parent:"parent",inIframe:"inIframe"},viewabilityStatus:{notViewed:"notViewed",divMissing:"divMissing",blocked:"blocked",viewed:"viewed",viewSent:"viewSent"},visibilityStatus:{notVisible:"notVisible",visible:"visible",visibleSent:"visibleSent"},displayStatus:{notDisplayed:"notDisplayed",displayed:"displayed"},adStatus:{init:"init",processed:"processed",procured:"procured",distributed:"distributed"},scriptOverride:{github:{id:"github",url:"https://adnuntius.github.io/examples/adn/adn.dev.src.js"},localhost:{id:"localhost",url:"http://localhost:8001/adn.src.js"},andemu:{id:"andemu",url:"http://10.0.2.2:8001/adn.src.js"}},errorStatus:{noTarget:"noTarget"},previewId:"appPreviewId"},A=0,s=0,y=!0,b=!0,D={},O={},x={},k={},R={},L={},M={},l=!1,g="allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation-by-user-activation",v="data-parent-top",h="data-env",I="data-dn",N="data-imp-reg",U="adn-data-div-",F="adn.metaData",d="adn.conv",a="adn.data",o="adn.data.segments",u="adn.consent",f={PROFILE:"PROFILE",COUNTS:"COUNTS",EXTERNAL:"EXTERNAL",TARGETING:"TARGETING"},q=["auId","widgetId","auW","auH","w","h","stack","ifrStyle","targetStyle","retAdsW","retAdsH","ads","dims","retAdCount","targetId","replacements","keywords","kv","userSegments","c","ps","auml","floorPrice","requestArgs","targetClass"],j=[],W={console:E.feedback.console.warnings,inScreen:E.feedback.inScreen.silent},V=E.composedRequest.noRequest;function t(){var i={};this.getItem=function(e){return i[e]},this.setItem=function(e,t){i[e]=t},this.removeItem=function(e){delete i[e]}}var B,i,H=new t,z=new t;C.util={dimension:function(e){if(C.util.isString(e)){var t=C.util.trim(e);return 0===t.length||C.util.endsWith(t,"%")||C.util.endsWith(t,"px")?t:t+"px"}return C.util.isNumber(e)?e+"px":e},isLoopable:function(e){if(C.util.isArray(e))return!0;var t=Object.prototype.toString.call(e);return"[object HTMLCollection]"===t||"[object NodeList]"===t},isArray:function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},isObject:function(e){return"object"==typeof e&&null!==e&&!C.util.isArray(e)},isInteger:function(e){return parseInt(e,10)===e},isNumber:function(e){return"number"==typeof e&&isFinite(e)},isString:function(e){return"string"==typeof e},isDefined:function(e){return null!=e},isNotBlankString:function(e){return C.util.isStringWithChars(e)},isStringWithChars:function(e){return C.util.isString(e)&&0<C.util.trim(e).length},isBlankString:function(e){return C.util.isString(e)&&0===C.util.trim(e).length},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},noop:function(){},uniques:function(e){for(var t=[],i=0,n=e.length;i<n;i++)-1===t.indexOf(e[i])&&""!==e[i]&&t.push(e[i]);return t},isTopWindow:function(){return T.top===T||"localhost:9876"===T.location.host},trim:function(e){return C.util.isString(e)?String.prototype.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""):e},getFrameElement:function(){if(B.canAccessLocalStorage())try{return T.frameElement}catch(e){C.out.devOutput("Error looking up frame element")}},endsWith:function(e,t){return C.util.isStringWithChars(e)&&C.util.isStringWithChars(t)&&e.substr(e.length-t.length,t.length)===t},createDelegate:function(e,t){if(!C.util.isObject(e)&&null!==e||!C.util.isFunction(t))return C.out.output("Args not sufficient","createDelegate",e,t);var i=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,0<i.length?Array.prototype.slice.call(arguments,0).concat(i):arguments)}},detachEventListener:function(e,t,i){return C.util.isObject(e)&&t?C.util.isFunction(e.removeEventListener)?e.removeEventListener(t,i,!1):e.detachEvent?e.detachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","detachEventListener",e,t):C.out.output("Args not sufficient","detachEventListener",e,t)},addEventListener:function(e,t,i){return C.util.isObject(e)&&t?C.util.isFunction(e.addEventListener)?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):C.out.output("Object to attach event listeners is not sufficient","addEventListener",e,t,i):C.out.output("Args not sufficient","addEventListener",e,t,i)},getWindowDims:function(){var e=C.util.getWindowSize();return{w:e.width,h:e.height}},getWindowSize:function(){var e={width:0,height:0};return C.util.isNumber(T.innerWidth)?(e.width=T.innerWidth,e.height=T.innerHeight):P.documentElement&&(P.documentElement.clientWidth||P.documentElement.clientHeight)?(e.width=P.documentElement.clientWidth,e.height=P.documentElement.clientHeight):P.body&&(P.body.clientWidth||P.body.clientHeight)&&(e.width=P.body.clientWidth,e.height=P.body.clientHeight),e},getScrollPos:function(){var e={left:0,top:0};return C.util.isNumber(T.pageYOffset)?(e.top=T.pageYOffset,e.left=T.pageXOffset):P.body&&(P.body.scrollLeft||P.body.scrollTop)?(e.top=P.body.scrollTop,e.left=P.body.scrollLeft):P.documentElement&&(P.documentElement.scrollLeft||P.documentElement.scrollTop)&&(e.top=P.documentElement.scrollTop,e.left=P.documentElement.scrollLeft),e},getElementPosition:function(e){var t={left:0,top:0};if(e.offsetParent)for(;t.left+=e.offsetLeft,t.top+=e.offsetTop,e=e.offsetParent;);return t},getNewAjax:function(e,t,i){if(C.util.isDefined(T.XDomainRequest)&&-1===T.navigator.appVersion.indexOf("MSIE 10")){var n=new T.XDomainRequest;return n.open(e,t),n.contentType="text/plain",n.onerror=C.util.noop,n.ontimeout=C.util.noop,n.onprogress=C.util.noop,n.timeout=C.util.noop,n.onload=C.util.noop,C.util.isFunction(i)&&(n.onload=i),n}var r=new XMLHttpRequest;return r.open(e,t),r.setRequestHeader("Content-Type","text/plain"),C.util.isFunction(i)&&(r.onreadystatechange=i),r},hasValue:function(e,t){var i=!1;return C.util.forEach(e,function(e){if(e===t)return!(i=!0)}),i},find:function(i,n){if(!C.util.isFunction(n)||!C.util.isObject(i)&&!C.util.isLoopable(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","find",i,n);var r=null;return C.util.forEach(i,function(e,t){if(!0===n.call(i,e,t))return r=e,!1}),r},map:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","map",i,n);var r=[];return C.util.forEach(i,function(e,t){r.push(n.call(i,e,t))}),r},filter:function(i,n){if(!C.util.isFunction(n)||C.util.isString(i)||!C.util.isDefined(i))return C.out.output("Args not sufficient","filter",i,n);var r=[];return C.util.forEach(i,function(e,t){!0===n.call(i,e,t)&&r.push(e)}),r},forEach:function(e,t){if(!C.util.isFunction(t)||!C.util.isObject(e)&&!C.util.isLoopable(e)||!C.util.isDefined(e))return C.out.output("Args not sufficient","forEach",e,t);var i;if(C.util.isLoopable(e)){for(var n=e.length,r=[],s=0;s<n;s++)r.push(e[s]);for(s=0;s<n;s++)if(i=r[s],!1===t.call(r,i,s))return i}else for(var a in e)if(e.hasOwnProperty(a)&&(i=e[a],!1===t.call(e,i,a)))return i},loadScriptElements:function(e,s){var t=e.getElementsByTagName("script");C.util.forEach(t,function(e){if(e)if(C.util.isStringWithChars(e.type)&&"text/javascript"!==e.type)C.out.devOutput("Not executing script type","showAdContent",e.type,e);else{var t={};C.util.forEach(e.attributes,function(e){e.specified&&(t[e.name]=e.value)});var i=e.innerHTML,n=e.parentNode;if(e.src){var r=e.src;n.removeChild(e),B.loadScriptSrc(r,n.id||s,t,i)}else n.removeChild(e),B.loadScriptContent(i,n.id||s,t)}})},hasProperties:function(e){if(!C.util.isObject(e))return!1;for(var t in e)if(e.hasOwnProperty(t))return!0;return!1},getElementDimensions:function(e){try{var t=e.getBoundingClientRect();return{w:t.width||t.right-t.left,h:t.height||t.top-t.bottom}}catch(e){return C.out.output("element dimensions failed","getElementDimensions: catch block",e)}},isTrue:function(e){return!0===e||"true"===e}},function(){C.out={simple:function(e,t){T.console.log("%cAdnuntius%c "+e,"background-color: purple; color: white; padding: 2px; border-radius: 3px;","background-color: white; color: black; padding: 0",t)},devOutput:function(e,t){return!(!l&&W.console!==E.feedback.console.all&&W.console!==E.feedback.console.allAndInfo)&&C.out.output("(dev) "+e,t,Array.prototype.slice.call(arguments,2))},infoOutput:function(e,t){return!(!l&&W.console!==E.feedback.console.allAndInfo)&&C.out.output("(dev) "+e,t,Array.prototype.slice.call(arguments,2))},output:function(e,t){if(W.console!==E.feedback.console.silent){var i=Array.prototype.slice.call(arguments,2),n=C.util.filter(i,function(e){return C.util.isFunction(e)}),r=C.util.filter(i,function(e){return!C.util.isFunction(e)}),s=function(e,t,i){e(t,i),C.util.forEach(n,function(e){e({context:t,message:i,args:r})})},a=function(i){r&&r.length&&C.util.forEach(r,function(e,t){C.util.isFunction(e)?n.push(e):i("Arg #"+t,e)})};return T.console&&T.console.warn&&T.console.error&&T.console.log?(C.util.isObject(e)&&0<=e.lineNumber?s(T.console.error,"At "+t+":",e):s(T.console.warn,"At "+t+":",e),a(T.console.log),!1):!1}},warn:function(e){W.console!==E.feedback.console.silent&&T.console&&T.console.warn&&T.console.warn(e)}};function f(e,t){var i,n,r=e.env||E.env.production.id;i=E.env[r]?E.env[r]:E.env.production;var s=!!e.dn&&E.dn[t||"as"]+e.dn,a="http"+(B.isTestAddress(T.location.href)||r===E.env.localhost.id||"http:"===T.location.protocol?"":"s");n=("https"===e.protocol||"http"===e.protocol?e.protocol:a)+"://";var o=B.isTestAddress(r);l=o||l;var u=s||i[t||"as"];e.subdomain&&(u=e.subdomain+"."+u);var d=l&&0===(r||"").indexOf("http")?r:n+u;return{serverUrlBase:d,baseRequestLoc:d+(o?"?":"/i?")+"tzo="+(new Date).getTimezoneOffset(),isTestEnv:o}}C.lib={setDevMode:function(e){l=!0===e},testingHook:function(e){0===T.location.origin.indexOf("http://localhost")&&(D={},R={},k={},e.adn=C,e.CONSTANTS=E,e.ev=Q,e.dom=Y,e.readings=$,e.misc=B,e.conv=G,e.gComposedAds=R,e.gWidgetSpecs=D,e.gLocalStorage=z,e.gSessionStorage=H,e.gAdSpecs=k,e.gAdLocs=x,e.gDevMode=l,e.gKeywords=j,e.storageMetadataKey=F,e.storageConversionKey=d,e.storageDataKey=a,e.cookies=X,e.parentMethods=ee,e.pFrameMethods=Z,e.requestMethods=w)},isParentTopWindow:function(){var e=C.inIframe.getIframeArgs()[v];if(C.util.isTrue(e))return!0;var t=P.getElementsByTagName("body")[0];if(t&&t.hasAttribute(v))return C.util.isTrue(t.getAttribute(v));var i=C.util.getFrameElement();return!!C.util.isDefined(i)&&C.util.isTrue(i.getAttribute(v))},getEnv:function(){var e=C.inIframe.getIframeArgs()[h];if(C.util.isStringWithChars(e)&&E.env[e])return E.env[e].id;var t=P.getElementsByTagName("body")[0];if(e=t?t.getAttribute(h):"",C.util.isStringWithChars(e)&&E.env[e])return E.env[e].id;var i=B.getEnvFromHref(B.getParam(T.location,"host"));return i?i.id:E.env.production.id},getDn:function(){var e=C.inIframe.getIframeArgs()[I];if(C.util.isStringWithChars(e))return e;var t=P.getElementsByTagName("body")[0];return e=t?t.getAttribute(I):"",C.util.isStringWithChars(e)?e:void 0},getAdnDataLocs:function(e){var t=B.clone(e||{});t.protocol="https";var i=f(t,"dt"),n={};return B.copyArgValues(n,t,["browserId","folderId","sessionId"]),!0!==t.noCookies&&!1!==t.useCookies&&!1!==b||(n.noCookies=!0),{page:i.baseRequestLoc.replace("/i?","/page?")+B.encodeAsUrlParams(n,!0),visitor:i.baseRequestLoc.replace("/i?","/visitor?")+B.encodeAsUrlParams(n,!0),user:i.baseRequestLoc.replace("/i?","/usr?")+B.encodeAsUrlParams(n,!0),sync:i.baseRequestLoc.replace("/i?","/sync?")+B.encodeAsUrlParams(n,!0),segment:i.baseRequestLoc.replace("/i?","/segment?")+B.encodeAsUrlParams(n,!0)}},getRequestLocs:function(e,t){var i=f(e),n={};B.copyArgValues(n,e,["network","usi","siteId","latitude","longitude","segments","uui"]);var r=!1;e.adUnits&&C.util.isArray(e.adUnits)&&(r=!!C.util.find(e.adUnits,function(e){return!1===e.useCookies})),!r&&!0!==e.noCookies&&!1!==e.useCookies&&!1!==b||(n.noCookies=!0),!t||C.util.isTopWindow()||B.supportsIntersectionObserver()||(n.immeasurable=!0);var s={},a=B.getQueryParamsByName("adn-lp-li");if(p=!C.util.isTrue(B.getQueryParamsByName("adn-hide-warning")),C.util.isStringWithChars(a)){s.lpl=a;var o=B.getQueryParamsByName("adn-lp-c");C.util.isStringWithChars(o)&&(s.lpc=o)}if(p&&a&&C.util.isTopWindow()){var u=P.createElement("div");u.id="previewDiv",u.style.cssText="position:absolute;z-index:1000;background-color:pink;padding:10px;cursor: pointer",u.innerHTML="<div onclick=\"document.getElementById('previewDiv').style.display='none';\">You are previewing ads delivered by Adnuntius. Previewed ads should have a message like this one in their top-left corner.</div>",P.body.prepend(u),S=a,m=o}if(T.URLSearchParams){var d=new URLSearchParams(T.location.search);if(C.util.isTrue(d.get("adn-params")))for(var l,c=d.keys();(l=c.next())&&!l.done;){var g=d.get(l.value);"adn-params"!==l.value&&C.util.isDefined(g)&&(s[l.value]=g)}}return{imp:i.baseRequestLoc+B.encodeAsUrlParams(n,!0)+(C.util.hasProperties(s)?B.encodeAsUrlParams(s,!0):""),rendered:i.baseRequestLoc.replace("/i?","/b?"),viewable:i.baseRequestLoc.replace("/i?","/v?"),visible:i.baseRequestLoc.replace("/i?","/s?"),custom:i.baseRequestLoc.replace("/i?","/u?"),retargeting:i.baseRequestLoc.replace("/i?","/r?"),conversion:i.baseRequestLoc.replace("/i?","/conv?"),click:i.serverUrlBase+"/c/",preview:i.serverUrlBase+(i.isTestEnv?"?":"/preview?")}},sendRenderedImps:function(e,t){if(!C.util.isArray(e))return C.out.devOutput("No tokens to speak of","sendRenderedImps",e,t);if(!(e.length<1)){if(!t||C.util.isBlankString(t))return C.out.devOutput("Missing a location","sendRenderedImps",e,t);var i=t;s!==A&&0<A&&(i+="&tripTime="+(s=A));var n=C.util.getNewAjax("POST",i,function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}e&&e.metaData&&X.writeAdvLs(e.metaData)}}),r={rts:e};B.setAndReturnMetaData(r),n.send(JSON.stringify(r))}},doDebug:function(n,e,t){if(S&&p&&C.util.find(n.ads,function(e){return e.lineItemId===S&&(!m||e.creativeId===m)})){var i=P.createElement("div");i.style.cssText="position:absolute;background-color:pink;padding:5px;z-index:10000;opacity:0.9;cursor:pointer";var r="div-preview-"+n.widgetId;return i.id=r,i.innerHTML="<div onclick=\"document.getElementById('"+r+"').style.display='none';\">Previewed Ad</>",e.parentNode.insertBefore(i,e),void(t.style.position="relative")}if(W.inScreen===E.feedback.inScreen.inAdUnit){var s=P.createElement("div");s.id=U+n.widgetId;var a="position: absolute;top: 0; left: 0; text-align: left;";a+="border: 1px solid red; background-color: pink; padding: 5px;z-index: 10000;opacity: 0.9;",a+="min-width: 250px;max-width: "+Math.max(e.width,350)+"px; max-height: 500px; overflow: auto",s.style.cssText=a,s.className="adnDebugDataDiv";var o=[];C.util.forEach(n.ads,function(e){o.push({adId:e.id,lineItemId:e.lineItemId,creativeId:e.creativeId,cost:e.cost?e.cost.amount+e.cost.currency:"n/a",bid:e.bid?e.bid.amount+e.bid.currency:"n/a"})});var u="<div style='min-height: 1em;height:auto;'>AU Tag id: <a target='_blank' href='https://admin.adnuntius.com/search?q="+n.auId+"'>"+n.auId+"</a></strong></div>";u+="<div style='padding-bottom: 2px; margin-bottom: 2px; border-bottom: 1px dashed #333;height:auto'><small>",C.util.forEach(n.requestArgs,function(e,t){if("adUnits"!==t)"userId"!==t&&"sessionId"!==t&&(u+=B.dataOutput(t,e));else{var i=C.util.find(e,function(e){return!(e.auId!==n.auId||e.targetId&&e.targetId!==n.targetId||e.targetClass&&e.targetClass!==n.targetClass)});i&&C.util.forEach(i,function(e,t){"auId"!==t&&(u+=B.dataOutput(t,e))})}});var d=X.getIdsAsObj(n);d.userId&&(u+=B.dataOutput("userId",d.userId)),d.sessionId&&(u+=B.dataOutput("sessionId",d.sessionId)),u+="</small></div>",0===o.length&&(u+="<div><strong>No ads returned for ad call</strong></div>"),C.util.forEach(o,function(e){u+="<div style='min-height: 1em;height: auto;'>LI: <a target='_blank' href='http://admin.adnuntius.com/line-items/line-item/"+e.lineItemId+"'>"+e.lineItemId+"</a> | Cr: <a target='_blank' href='http://admin.adnuntius.com/creatives/creative/"+e.creativeId+"'>"+e.creativeId+"</a> | cost: "+e.cost+" | bid: "+e.bid+"</div>"}),u+="<div style='height:auto;'><small>",C.util.forEach(["Segments","Keywords"],function(e){var t="returned"+e;n[t]&&0<n[t].length&&(u+=B.dataOutput(e.toLowerCase(),n[t]))}),u+="</small></div>",s.innerHTML=u,e.parentNode.insertBefore(s,e),t.style.border="2px solid red",t.style.position="relative"}},showAdContent:function(t,e){var i=B.getDocEl(t),n=R[t.targetId];if(!i)return n&&(n.errorStatus=E.errorStatus.noTarget),C.out.output("Unable to find HTML element","showAdContent",n,t),C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId);n&&(n.errorStatus=""),C.util.isTrue(t.clearTarget)&&(i.innerHTML="");var r=e.html,s=e.matchedAdCount;if((t.container===E.container.div&&C.util.isNumber(s)||0<r.indexOf('data-ad-format="')&&0<r.indexOf("adsbygoogle.js"))&&0===C.util.filter(E.syncAds,function(e){return 0<r.indexOf(e)}).length){if(t.container=E.container.div,0<i.getElementsByTagName("div").length){if(!C.util.isObject(t.refresh))return;i.innerHTML=""}return Y.showTargetDiv(i,t),i.innerHTML=B.getAdContentOnly(r,t.widgetId),C.util.loadScriptElements(i,t.widgetId),C.lib.doDebug(t,P.getElementById(t.widgetId),i),!0}if(t.container=E.container.iframe,!C.util.find(i.childNodes,function(e){return e.id===t.widgetId})){var a=C.util.filter(i.childNodes,function(e){var t=e?e.id:"";return t&&0===t.indexOf(E.widgetIdPrefix)})||[];t.serverUrl=null;var o=Y.insIframe(t,i),u=B.getScriptOverride();u&&(r=r.replace(/<script type="?text\/javascript"? src="?https?:\/\/[A-Za-z_0-9:.-]{5,50}\/adn.(src.)?js"?><\/script>/g,'<script type="text/javascript" src="'+u+'" id="'+c+'"><\/script>')),t.isolateSubFrame&&(r=r.replace(/<iframe/g,"<iframe sandbox='"+g+"'"));var d="<body id='"+t.widgetId+"' "+v+"='"+C.util.isTopWindow()+"'";if(t.env&&t.env!==E.env.production.id&&(d+=" "+h+"='"+t.env+"'"),t.impReg&&(d+=" "+N+"='"+t.impReg+"'"),t.dn&&(d+=" "+I+"='"+t.dn+"'"),r=r.replace("<body",d),B.supportsSrcDoc()&&t.isolateFrame)o.setAttribute("srcdoc",r);else{var l=o.contentDocument||o.contentWindow;l&&l.document&&(l=l.document),l||C.out.devOutput("Couldn't find iframeDoc","showAdContent",i,o,l),l.open(),l.write(r),l.close()}return C.util.forEach(a,function(e){e.style.display="none"}),C.lib.doDebug(t,o,i),!0}}}}(),i="012356789bcdfghjklmnpqrstvwxyz",B={uuid:function(){for(var e="",t=0;t<24;t++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},supportsSrcDoc:function(){return"srcdoc"in P.createElement("iframe")},isSrcdocFrame:function(){return"about:srcdoc"===B.getLocationHref()||"null"===T.location.origin},getLocationHref:function(){return T.location.href},canAccessLocalStorage:function(){try{return T.localStorage.getItem("random"),!0}catch(e){return!1}},getImpReg:function(){var e=C.inIframe.getIframeArgs()[N];if(C.util.isStringWithChars(e))return e;var t=P.getElementsByTagName("body")[0];if(t&&t.hasAttribute(N))return t.getAttribute(N);var i=C.util.getFrameElement();return C.util.isDefined(i)?i.getAttribute(N):void 0},supportsIntersectionObserver:function(){return"IntersectionObserver"in T&&"IntersectionObserverEntry"in T&&"intersectionRatio"in T.IntersectionObserverEntry.prototype},getParam:function(e,t){if(C.util.isObject(e))return e[t]},getNewViewability:function(){return{maxPercent:0,prevPercent:0,timeNone:0,timePartly:0,timeHalf:0,timeFully:0,timeIntersect:0,timeStart:0,isViewed:!1}},onDocReady:function(e){"complete"===P.readyState||"interactive"===P.readyState?e():C.util.addEventListener(T,"DOMContentLoaded",e)},onLoad:function(e){"complete"===P.readyState?e():C.util.addEventListener(T,"load",e)},getAdsFromContainer:function(e){return C.util.filter(e.getElementsByTagName("div"),function(e){return-1<e.className.indexOf(E.cwClass)&&0===e.id.indexOf(E.adIdPrefix)})},isVisible:function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},generateAdData:function(e,t,i){return e&&e.ads?e.ads:t&&t.ads&&i?C.util.map(t.ads,function(e){var t=i[e.id];return{adId:e.id,dims:e.dims,creativeId:e.creativeId,rt:e.rt,lineItemId:e.lineItemId,definedDims:t?t.definedDims:e.definedDims}}):[]},getAdsInfo:function(e){var t={contentDims:{},definedDims:{},adUnitContainerId:e,ads:[]};try{if(t.adsDivEl=P.getElementById(e),!t.adsDivEl)return{};if(t.contentDims=C.util.getElementDimensions(t.adsDivEl),0===t.contentDims.w||0===t.contentDims.h){var i=C.util.find(C.util.map(t.adsDivEl.getElementsByTagName("div"),function(e){if(e.style&&("absolute"===e.style.position||"fixed"===e.style.position)){var t=C.util.getElementDimensions(e);if(5<t.w&&5<t.h)return t}return null}),function(e){return!!e});i&&(t.contentDims=i,C.out.infoOutput("Dims for out-of-flow div","getAdsInfo",i,e))}t.ads=C.util.map(B.getAdsFromContainer(t.adsDivEl),function(e){return{id:e.id,el:e,subdomain:B.dimForAttr(e.getAttribute("data-subdomain")),creativeId:B.dimForAttr(e.getAttribute("data-creative-id")),lineItemId:B.dimForAttr(e.getAttribute("data-line-item-id")),rt:B.dimForAttr(e.getAttribute("data-response-token")),definedDims:{w:B.dimForAttr(e.getAttribute("data-creative-width")),h:B.dimForAttr(e.getAttribute("data-creative-height"))},dims:C.util.getElementDimensions(e)}});var n=C.util.find(t.ads,function(e){return!!e.subdomain});n&&(t.subdomain=n.subdomain)}catch(e){t.contentDims={}}return t},loadScriptSrc:function(e,t,i,n){if(!C.util.isString(e))return C.out.output("src should be a string","loadScriptSrc",e);try{var r=P.createElement("script");C.util.forEach(i,function(e,t){r.setAttribute(t,e)}),C.util.isStringWithChars(n)&&(r.innerHTML=n),r.src=e;var s=t?P.getElementById(t):null;if(s)s.appendChild(r);else{var a=P.getElementsByTagName("script")[0];a.parentNode.insertBefore(r,a)}}catch(e){return C.out.output(e,"loadScriptSrc: in catch block")}},dimForAttr:function(e){if(C.util.isString(e)){var t=C.util.trim(e),i=parseInt(t,10);return C.util.endsWith(t,"px")?i:i.toString(10)===t?i:e}return C.util.isNumber(e)?e:""},addWidgetIdToProcessAd:function(e,t){var i="adn.inIframe.processAdResponse({ widgetId: '"+t+"', ",n='adn.inIframe.getIframeId("'+t+'"';return e.replace(/adn.inIframe.processAdResponse\({/g,i).replace(/adn.inIframe.getIframeId\(/g,n)},loadScriptContent:function(e,t,i){if(!C.util.isString(e))return C.out.output("content should be a string","loadScriptContent",e);try{var n=P.createElement("script");C.util.forEach(i||{},function(e,t){n.setAttribute(t,e)});var r=P.createTextNode(e);n.appendChild(r),(P.getElementById(t)||P.body).appendChild(n)}catch(e){return C.out.output(e,"loadScriptContent: in catch block")}},applyStyle:function(i,e){return C.util.forEach(e,function(e,t){i.style[t]=e})},parseHashArgs:function(){var e,t;return B.decodeUrlEncodedPairs((e=T.location.href||"",-1<(t=e.indexOf("#"))?e.substr(t+1):""))},parseUrlArgs:function(){return B.decodeUrlEncodedPairs(T.location.search)},clone:function(e){var t=C.util.isObject(e)?{}:C.util.isArray(e)?[]:null;return t?B.assign(t,e):e},assign:function(i,e){return C.util.forEach(e,function(e,t){C.util.isObject(e)?(C.util.isObject(i[t])||(i[t]={}),B.assign(i[t],e)):C.util.isArray(e)?(C.util.isArray(i[t])||(i[t]=[]),function(e,t){for(var i=0;i<t.length;i++)e.push(B.clone(t[i]))}(i[t],e)):i[t]=e}),i},isWidgetId:function(e){var t=C.util.isString(e)?e:B.getParam(e,"widgetId");return C.util.isString(t)&&0===t.indexOf(E.widgetIdPrefix)},copyArgValues:function(i,e,n){return C.util.isArray(n)&&C.util.isObject(i)&&C.util.isObject(e)?(C.util.forEach(e,function(e,t){C.util.isDefined(e)&&C.util.hasValue(n,t)&&(i[t]=B.clone(e))}),i):C.out.output("Args not sufficient","copyArgValues",i,e,n)},decodeUrlEncodedPairs:function(e){if(!C.util.isString(e))return C.out.output("urlEncodedPairs should be a string","decodeUrlEncodedPairs");for(var t={},i=e.replace(/\?/,"").replace(/#/,"").split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(2===r.length){var s=decodeURIComponent(r[0]),a=decodeURIComponent(r[1]);C.util.isDefined(t[s])?(C.util.isArray(t[s])||(t[s]=[t[s]]),t[s].push(a)):t[s]=a}}return t},combineArgs:function(){for(var e={},t=arguments.length,i=0;i<t;i++){var n=arguments[i];C.util.isObject(n)&&B.assign(e,arguments[i])}return e},getQueryParamsByName:function(e){if(!C.util.isString(e)||C.util.isBlankString(e))return null;var t=B.getLocationHref(),i=e.replace(/[[\]]/g,"\\$&"),n=new RegExp("[?&]"+i+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},encodeAsUrlParams:function(e,t){if(C.util.isString(e))return e;var n=[];if(C.util.forEach(e,function(e,t){var i=encodeURIComponent(t)+"=";C.util.isArray(e)?C.util.forEach(e,function(e){n.push(i+encodeURIComponent(C.util.isObject(e)?JSON.stringify(e):e))}):C.util.isObject(e)?n.push(i+encodeURIComponent(JSON.stringify(e))):C.util.isDefined(e)&&!C.util.isBlankString(e)&&n.push(i+encodeURIComponent(e))}),0===n.length)return"";var i=n.join("&");return t?"&"+i:i},isAdnPrice:function(e){return C.util.isObject(e)&&C.util.isNumber(e.amount)&&0<e.amount&&C.util.isString(e.currency)&&3===e.currency.length},postMessageToParent:function(e){return C.util.isObject(T.parent)&&T.parent.postMessage&&C.util.isObject(e)?e.isDivContainer?Q.handlePostMessage(e):(e[E.postMessageSrcKey]=E.postMessageSrcValue,void T.parent.postMessage(JSON.stringify(e),"*")):C.out.output("Attributes not sufficient","postMessageToParent")},visibilityEventHandling:function(e,i){C.util.isObject(i.refresh)&&e===i.refresh.event&&0<i.refresh.count&&T.setTimeout(function(){var e=i.parentArgs||{},t=B.clone(i.auArgs);t.refresh=B.clone(i.refresh),t.refresh.count--,e.requestParams={},t.requestParams={},e.adUnits=[t],delete e.headerBids,C.request(e)},1e3*i.refresh.delay);var t=i[e+"Data"];i[e]&&C.util.isFunction(i[e])&&i[e](t);var n=P.getElementById(U+i.widgetId);n&&t.feedbackText&&(n.innerHTML+="<div><small>"+t.feedbackText+" sent - "+t.creativeId+"</small></div>")},postMessageToChild:function(e,t){return C.util.isObject(t)?C.util.isTrue(t.isDivContainer)?Q.handlePostMessage(t):e&&e.contentWindow?e.contentWindow.postMessage?(t[E.postMessageSrcKey]=E.postMessageSrcValue,void e.contentWindow.postMessage(JSON.stringify(t),e.src||"*")):C.out.output("Childframe doesn't support postMessage","postMessageToChild",e,t):C.out.output("Childframe isn't really a child frame","postMessageToChild",e,t):C.out.output("Expected an object for a message","postMessageToChild",t)},dataOutput:function(e,t){return e+": "+(C.util.isObject(t)||C.util.isArray(t)?JSON.stringify(t):t)+" | "},ampCheck:function(e,t){e&&"amp"===e.mode&&T.context&&C.util.isFunction(T.context.renderStart)&&(t&&0===t.width?T.context.noContentAvailable():T.context.renderStart(t||void 0))},getUnixTimestamp:function(e,t){var i=e/(t?1440:1);return Date.now()+(C.util.isNumber(e)&&0<e?864e5*i:0)},getDocEl:function(e){if(e.targetClass){var t=P.getElementsByClassName(e.targetClass);return C.util.find(t,function(e){return!e.hasChildNodes()})||t[0]}if(e.duplicateId){var i=P.querySelectorAll("*[id='"+e.targetId+"']");return C.util.find(i,function(e){return!e.hasChildNodes()})||i[0]}return P.getElementById(e.targetId)},isTestAddress:function(e){return!!(C.util.isString(e)&&0===e.indexOf("http://localhost")&&0<e.indexOf("/test"))&&(l=!0)},isUnitTest:function(){return-1<T.location.href.indexOf("http://localhost:9876/context.html")},getEnvFromHref:function(t){if(t&&C.util.isString(t))return C.util.find(E.env,function(e){return t===e.as||0<t.indexOf("://"+e.as)})},getAdContentOnly:function(e,t){var i="</body>",n=e.indexOf('<div id="adn-rsp-'),r=e.indexOf(i);if(!(n<1||r<1)){var s=e.substring(n,r);return s='<div id="'+t+'">'+s+"</div>",B.addWidgetIdToProcessAd(s,t)}if(-1<e.indexOf(E.nativeClass)){var a='<div id="'+t+'">'+e+"</div>";return B.addWidgetIdToProcessAd(a,t)}C.out.output("Something unexpected has gone on with the content of the ad server response","getAdContentOnly",i,r,e)},gatherDataParams:function(e,t,i,n){var r=[],s={},a=C.util.isFunction(t)?t:function(){return!0},o=C.util.isFunction(i)?i:C.util.noop,u=n||{},d=["auId","creativeId","networkId","targetId","c","kv","keywords","replacements","ps","auml","floorPrice","dimensions"],l=[{server:"userSegments",script:"userSegments"},{server:"context",script:"ctx"},{server:"canonical",script:"canonical"}];return C.util.forEach(e,function(t){if(!0===a(t)){var i={};C.util.forEach(d,function(e){i[e]=t[e]}),t.floorPrice&&!B.isAdnPrice(t.floorPrice)&&(C.out.output("Floor price is not valid","gatherDataParams",t),delete i.floorPrice),r.push(i),C.util.forEach(l,function(e){s[e.server]=s[e.server]||t[e.script]}),o(t)}}),C.util.forEach(d,function(e){delete u[e]}),C.util.forEach(l,function(e){delete u[e.server],delete u[e.script]}),{adUnits:r,params:s}},getScriptOverride:function(){if(C.util.isString(e))return e;var t=B.getQueryParamsByName("script-override");return e="",C.util.isString(t)&&0<t.length&&(e=(C.util.find(E.scriptOverride,function(e){return e.id===t})||{}).url||""),e},gatherExclusions:function(e){function t(e,t,i){C.util.isArray(t[i])&&0<t[i].length&&(e[i]=t[i])}var i={};return C.util.isArray(e)?C.util.forEach(e,function(e){t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")}):(t(i,e,"excludedLineItems"),t(i,e,"excludedCreatives")),i},encodeUrlParams:function(e,t,i){var n=i||{};B.copyArgValues(t,n,["auml","ps","c"]),n.keywords&&(t.keywords=n.keywords.slice(0,20)),n.kv&&(t.kv=JSON.stringify(n.kv)),n.ctx&&(t.ctx=n.ctx),n.canonical&&(t.canonical=n.canonical),n.replacements&&(t.replacements=JSON.stringify(n.replacements)),n.userSegments&&(t.userSegments=JSON.stringify(n.userSegments)),B.isAdnPrice(n.floorPrice)?t.fp=JSON.stringify(n.floorPrice):n.floorPrice&&C.out.output("Not a valid floorprice supplied.","encodeUrlParams",n);try{return e+=B.encodeAsUrlParams(t,!0)}catch(e){return C.out.output("encoding urls failed","insIframe: catch block",e)}},setAndReturnMetaData:function(e){var t=e,i=X.getAllAdvStorageAsObjForAjaxSend();return C.util.hasProperties(i)&&((t=t||{}).metaData=i),t},normalise:function(i){var n={auW:"auW",auH:"auH"};return C.util.forEach(i,function(e,t){n[t]&&(i[t]=e.toString())}),i}};var r,J,_,K,G={regDestination:function(){var e=B.getQueryParamsByName("adn_creative");if(C.util.isStringWithChars(e)){var t=B.getQueryParamsByName("adn_campaign"),i=B.getQueryParamsByName("adn_source");C.util.isStringWithChars(t)&&C.util.isStringWithChars(i)&&X.writeConvLs({adn_campaign:t,adn_source:i,adn_creative:e})}}},Q={handleChildPageLoad:function(t,e){var i=C.inIframe.getResponseCtrId(t.widgetId?P.getElementById(t.widgetId):""),n=B.getAdsInfo(i);if(!n.adsDivEl)return C.out.devOutput("Can't find container ID","handleChildPageLoad",C.inIframe.getResponseCtrId());if(t.containerDiv||t.pageLoadBeforeProcessAd||C.util.isArray(n.ads)&&n.ads.length&&k[n.ads[0].id]){var r=t.widgetId||C.inIframe.getIframeId();if(!r)return C.out.devOutput("Can't find a widget ID","handleChildPageLoad",t);var s=C.inIframe.isResizeToContent(),a=C.util.isNumber(e)?e:0,o=0<a?E.postMessageType.toParentResize:E.postMessageType.toParentPageLoad,u=n.adsDivEl.getElementsByTagName("iframe")[0];if(u){var d=C.util.getElementDimensions(u);d.w>n.contentDims.w&&(n.contentDims.w=d.w),d.h>n.contentDims.h&&(n.contentDims.h=d.h)}var l=B.assign({},k),c=!1;C.util.forEach(k,function(e){t.widgetId&&t.widgetId!==e.widgetId||JSON.stringify(e.dims)===JSON.stringify(n.contentDims)||(e.dims=n.contentDims,c=!0)}),t.isZeroCount=t.isZeroCount||0,0===n.contentDims.w||0===n.contentDims.h?t.isZeroCount++:t.isZeroCount=0;var g=c||2===t.isZeroCount;if(g||o===E.postMessageType.toParentPageLoad){var f={widgetId:r,messageType:o,w:n.contentDims.w,h:n.contentDims.h,hasSizeChange:g,retAdCount:n.ads.length,dims:n.contentDims,ads:B.generateAdData(null,n,l),resizeToContent:s&&g};C.out.infoOutput("Message to parent for "+r,"handleChildPageLoad",f,l,k,t),B.postMessageToParent(f)}0<n.contentDims.w&&0<n.contentDims.h&&9<a||(a<20||!B.isVisible(n.adsDivEl))&&T.setTimeout(function(){Q.handleChildPageLoad({widgetId:t.widgetId,containerDiv:t.containerDiv,pageLoadBeforeProcessAd:!0,isZeroCount:t.isZeroCount},a+1)},a<20?205:1500)}else T.setTimeout(function(){Q.handleChildPageLoad({pageLoadBeforeProcessAd:!0})},50)},handleChildSubs:function(e,t){if(!t.widgetId)return C.out.devOutput("Cannot find widget ID","handleChildSubs",e,t);var i=P.getElementById(t.widgetId);if(!i)return C.out.output("Cannot find widget","handleChildSubs",e,t);var n={messageType:E.postMessageType.toChildPubs,windowDims:C.util.getWindowDims(),widgetDims:C.util.getElementDimensions(i),widgetParentDims:C.util.getElementDimensions(i.parentElement),widgetId:t.widgetId,event:t.event,isDivContainer:t.isDivContainer};C.util.isDefined(t.functionCalls)&&(n.functionCalls=t.functionCalls),B.postMessageToChild(i,n)},handlePostResponse:function(e,t){t.hasResponse=!0,B.copyArgValues(t,e,["retAdsW","retAdsH","retAdCount"]);var i={};B.copyArgValues(i,t,q),B.copyArgValues(i,e,q),C.util.isFunction(t.onResponse)&&t.onResponse(i);var n=O[t.requestId];n&&(n.returnArgs=n.returnArgs||[],n.returnArgs.push(i),0===C.util.filter(n.widgetIds,function(e){return!D[e].hasResponse}).length&&n.onAllResponses(n.returnArgs));return i},handlePostMessage:function(t){if(!C.util.isObject(t))return C.out.output("Handle post aMessage is being used in weird ways","handlePostMessage",t);if(C.util.isString(t.data)||C.util.isTrue(t.isDivContainer)){var i={};if(C.util.isTrue(t.isDivContainer))i=B.clone(t);else{try{i=JSON.parse(t.data)}catch(e){return C.out.devOutput("Couldn't handle parsing","handlePostMessage",e,t.data,t)}if(i[E.postMessageSrcKey]!==E.postMessageSrcValue)return!1}var e=D[i.widgetId]||{};if(i.messageType===E.postMessageType.toChildPubs){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires more data","handlePostMessage",i);var n={widgetId:i.widgetId,event:i.event,windowDims:i.windowDims,widgetDims:i.widgetDims,widgetParentDims:i.widgetParentDims};C.util.isDefined(i.functionCalls)&&(n.functionCalls=i.functionCalls),Z.handleChildPubs(n)}else if(i.messageType===E.postMessageType.toChildAdUnitInfo){if(!C.util.isString(i.adUnitInfoId))return C.out.output("Requires more data","handlePostMessage",i);Z.handleAdUnitInfo(i)}else if(i.messageType===E.postMessageType.toParentGetAdUnitInfo){if(!C.util.isString(i.adUnitInfoId)||!C.util.hasProperties(e))return C.out.output("Needs ad unit info id and widget id","handlePostMessage",i,e);B.postMessageToChild(P.getElementById(i.widgetId),{adUnitInfoId:i.adUnitInfoId,messageType:E.postMessageType.toChildAdUnitInfo,adUnitInfo:e,isDivContainer:i.isDivContainer})}else if(i.messageType===E.postMessageType.toParentCustomEvent){if(!C.util.isDefined(i.args)||!C.util.isObject(i.customArgs)||!C.util.isObject(i.pAdSpec))return C.out.output("Missing required data to send custom event info","handlePostMessage",i);C.inIframe.sendCustomEvent(i.args,i.customArgs,i.pAdSpec)}else if(i.messageType===E.postMessageType.toParentFunctions){if(!C.util.hasProperties(e))return C.out.output("Needs valid widget id","handlePostMessage",i,e);if(!i.name)return C.out.output("Needs a function name","handlePostMessage",i,e);if(e.functions&&C.util.isArray(e.functions)){var r=C.util.find(e.functions,function(e){return e&&e.name===i.name&&C.util.isFunction(e.func)});if(r&&C.util.isFunction(r.func)){var s={};B.copyArgValues(s,e,q),r.func(s,i.args)}}}else if(i.messageType===E.postMessageType.toParentAdVisibilityEvent){if(!C.util.hasProperties(e))return C.out.output("Need widget info","toParentAdVisibility",i,e);e[i.callbackProp+"Data"]={widgetId:i.widgetId,auId:e.auId,adId:i.adId,creativeId:i.creativeId,lineItemId:i.lineItemId,viewability:i.viewability,feedbackText:i.feedbackText},i.delayedImpression?e.impReg!==E.impReg.manual||e["outside"+i.feedbackText]?($.sendEventFromParent(i.impRequestLoc,i.spec,i.feedbackText),B.visibilityEventHandling(i.callbackProp,e)):e.impReg===E.impReg.manual&&(e["inside"+i.feedbackText]={impRequestLoc:i.impRequestLoc,spec:i.spec,feedbackText:i.feedbackText}):B.visibilityEventHandling(i.callbackProp,e)}else if(i.messageType===E.postMessageType.toParentSubscribe){if(!C.util.isString(i.event)||!C.util.isString(i.widgetId))return C.out.output("Requires on event","handlePostMessage",i);C.util.addEventListener(T,i.event,C.util.createDelegate(Q,Q.handleChildSubs,{widgetId:i.widgetId,event:i.event,isDivContainer:i.isDivContainer}))}else if(i.messageType===E.postMessageType.toParentPageLoad||i.messageType===E.postMessageType.toParentResize){if(!1!==e.resizeOnPageLoad&&(!C.util.isFunction(e.resizeOnPageLoad)||!1!==e.resizeOnPageLoad(i))&&C.util.isTrue(i.resizeToContent)&&C.util.isTrue(i.hasSizeChange)){var a={};B.copyArgValues(a,e,q),B.copyArgValues(a,i,q),ee.iframeResizer(a,!1)}if(i.messageType===E.postMessageType.toParentPageLoad&&C.util.isFunction(e.onPageLoad)){var o={};B.copyArgValues(o,e,q),B.copyArgValues(o,i,q),e.onPageLoad(B.normalise(o))}}else{if(C.util.isStringWithChars(i.method))try{i.functionContext===E.functionContext.inIframe?C.util.isFunction(Z[i.method])?Z[i.method].call(C.inIframe,i):C.inIframe[i.method].call(C.inIframe,i):ee[i.method].call(ee,i)}catch(e){return C.out.output(e,"catch block for calling method",i,e)}if(i.messageType===E.postMessageType.toParentImpression||i.messageType===E.postMessageType.toParentResponse){var u=Q.handlePostResponse(i,e);i.messageType===E.postMessageType.toParentImpression&&(C.util.isFunction(e.onImpressionResponse)&&e.onImpressionResponse(B.normalise(u)),Q.handleChildSubs({},{event:"impRegistered",widgetId:i.widgetId,functionCalls:(e.functionCalls||[]).concat(e.cachedFunctionCalls),isDivContainer:i.isDivContainer}))}}}},registerListeners:function(){C.util.addEventListener(T,"message",C.util.createDelegate(C.lib,Q.handlePostMessage)),C.util.isTopWindow()||C.util.addEventListener(T,"load",C.util.createDelegate(C.lib,Q.handleChildPageLoad))},setFeedbackOptions:function(e){C.util.isObject(e)&&(C.util.isString(e.console)&&E.feedback.console[e.console]&&(W.console=e.console),C.util.isString(e.inScreen)&&E.feedback.inScreen[e.inScreen]&&(W.inScreen=e.inScreen)),0<T.location.href.toLowerCase().indexOf("adnlog123")&&(W.console=E.feedback.console.allAndInfo),0<T.location.href.toLowerCase().indexOf("adndebug123")&&(W.inScreen=E.feedback.inScreen.inAdUnit);var t=B.getQueryParamsByName("inScreen");C.util.isString(t)&&E.feedback.inScreen[t]&&(W.inScreen=t)}},X=(_={userId:"cX_P"},{getEuConsentAsObj:function(e){var t=e&&e.consentString?e.consentString:X.get("euconsent-v2")||X.get("euconsent");if(C.util.isStringWithChars(t))return{consentString:t}},getAdnConsentAsObj:function(){var e=X.get("adnconsent"),t={};return C.util.isStringWithChars(e)&&(t.adnConsent=e),t},getAllIdsAsObj:function(){var e=[],t=X.get(_.userId);t&&e.push({CXENSE:{userId:t}});var i=X.get(K.userId);if(i&&e.push({RELAY42:{userId:i}}),!(e.length<1))return{userAliases:JSON.stringify(e)}},getIdsAsObj:function(e){var t={userId:e.userId||X.getAllDatStorageAsObj().browserId,sessionId:e.sessionId};return t.userId||delete t.userId,t.sessionId||delete t.sessionId,t},get:function(e){for(var t=e?e+"=":null,i=t?null:{},n=decodeURIComponent(P.cookie).split(";"),r=0;r<n.length;r++){for(var s=n[r];" "===s.charAt(0);)s=s.substring(1);if(t){if(0===s.indexOf(t))return s.substring(t.length,s.length)}else{var a=s.split("=");i[a[0]]=a[1]}}return C.util.isObject(i)?i:""},set:function(e){C.util.forEach(e,function(e,t){var i=new Date;i.setTime(i.getTime()+2592e6);var n="; expires="+i.toUTCString();P.cookie=t+"="+(e||"")+n+"; path=/"})},clearAdvLocalStorage:function(){try{T.localStorage.removeItem(u),z.removeItem(u),T.localStorage.removeItem(F),z.removeItem(F),T.localStorage.removeItem(d),z.removeItem(d),T.sessionStorage.removeItem(F),H.removeItem(F)}catch(e){C.out.devOutput("Problem clearing adv local storage","clearAdvLocalStorage",e)}},writeConsent:function(t){if(!t||!C.util.isArray(t))return C.out.devOutput("Not a valid consent object","writeConsent",t);var e=y?T.localStorage:z,i=[];C.util.forEach(t,function(e){f[e]===e?i.push(e):C.out.devOutput("Invalid consent item","writeConsent",t)});try{i.length<1?e.removeItem(u):e.setItem(u,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeConsent",e,i)}},getConsent:function(){return ae(u)},writeConvLs:function(t,e){if(!(e||C.util.isObject(t)&&C.util.hasProperties(t)))return C.out.devOutput("Not an object of data","writeAdvLs");function n(e,t){return e.adn_creative&&C.util.isStringWithChars(e.adn_creative)&&e.adn_source&&C.util.isStringWithChars(e.adn_source)&&t&&C.util.isStringWithChars(t)}function r(e,t,i,n){e[t]={adn_source:i.adn_source,adn_creative:i.adn_creative,timestamp:n||B.getUnixTimestamp()}}function i(i,e){C.util.forEach(e,function(e,t){n(e,t)&&r(i,t,e,e.timestamp)})}y||X.clearAdvLocalStorage();var s={};if(e){var a=t;if(C.util.isStringWithChars(a))try{a=JSON.parse(a)}catch(e){return C.out.devOutput("Problem deciphering data from adserver","writeConvLs",e,t)}if(i(s,a),C.util.hasProperties(a)&&(!C.util.isObject(s)||!C.util.hasProperties(s)))return}else{s=ae(d,!0);var o=[];C.util.forEach(s,function(e,t){n(e,t)&&e.timestamp&&C.util.isNumber(e.timestamp)||o.push(t)}),C.util.forEach(o,function(e){delete s[e]}),n(t,t.adn_campaign)?r(s,t.adn_campaign,t):i(s,t)}var u=y?T.localStorage:z;try{C.util.hasProperties(s)?u.setItem(d,JSON.stringify(s)):u.removeItem(d)}catch(e){C.out.devOutput("Problem setting item","writeAdvLs",e,s)}},writeAdvLs:function(t){if(!C.util.isObject(t)||!C.util.hasProperties(t))return C.out.devOutput("Not an object of data","writeAdvLs");y||X.clearAdvLocalStorage();var i=[],e=ae(F,!0),n=oe(),r=["clicks","voidAuIds"];C.util.forEach(e,function(e){(C.util.isStringWithChars(e.value)||C.util.hasProperties(e.value))&&C.util.isStringWithChars(e.key)&&r.indexOf(e.key)<0&&!t[e.key]&&e.exp&&e.exp>B.getUnixTimestamp()&&i.push(e)}),C.util.forEach(t,function(e,t){-1<t.indexOf("session")?n[t]=e:r.indexOf(t)<0&&C.util.isStringWithChars(t)&&C.util.isStringWithChars(e)&&i.push({exp:B.getUnixTimestamp(100),key:t,value:e})});var s=C.util.map(C.util.isStringWithChars(t.voidAuIds)?t.voidAuIds.split(";"):[],function(e){return{exp:B.getUnixTimestamp(1),auId:e}})||[],a={};C.util.forEach((X.getAllAdvStorageAsObj().voidAuIds||[]).concat(s),function(e){var t=a[e.auId];(!t||e.exp>t)&&(a[e.auId]=e.exp)});var o=C.util.map(a,function(e,t){return{exp:e,auId:t}});0<o.length&&i.push({key:"voidAuIds",value:o});var u={};C.util.forEach(n,function(e,t){u[t]=e});var d=y?T.localStorage:z,l=y?T.sessionStorage:H;try{0<i.length?d.setItem(F,JSON.stringify(i)):d.removeItem(F),C.util.hasProperties(u)?l.setItem(F,JSON.stringify(u)):l.removeItem(F)}catch(e){C.out.devOutput("Problem setting item","writeAdvLs",e,u,i)}t.clicks&&X.writeConvLs(t.clicks,!0)},writeDatSegments:function(i,e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");var n={};n[i]={},C.util.forEach(e,function(e,t){"segments"===t&&(n[i][t]=e)}),n[i].segments||(n[i].segments=[]),n[i].exp=B.getUnixTimestamp(1,!0);var t=y?T.localStorage:z;try{t.setItem(o,JSON.stringify(n))}catch(e){C.out.devOutput("Problem setting item","writeDatSegments",e,n)}},getDatSegments:function(e){var i={},t=y?T.localStorage:z,n=y?T.sessionStorage:H;try{var r=B.assign({},B.assign(se(n,o),se(t,o)));if(C.util.forEach(r,function(e,t){C.util.isArray(e.segments)&&e.segments.length&&e.exp&&!(e.exp<=B.getUnixTimestamp())&&(i[t]=e)}),!i||!C.util.hasProperties(i))return T.localStorage.removeItem(o),z.removeItem(o),T.sessionStorage.removeItem(o),H.removeItem(o),{}}catch(e){return C.out.devOutput("Problem getting dat segments","getDatSegments",e),{}}if(!i[e])return{};var s=i[e]||{};return s.segments=C.util.isArray(s.segments)?s.segments:[],delete s.exp,s},writeDatLs:function(e){if(!C.util.isObject(e)||!C.util.hasProperties(e))return C.out.devOutput("Not an object of data","writeDatLs");var i={},n={};C.util.forEach(e,function(e,t){0===t.indexOf("sessionId")?i[t]=e:0===t.indexOf("browserId")?n[t]=e:0===t.indexOf("extSync")&&(n[t]=e)});var t=y?T.localStorage:z,r=y?T.sessionStorage:H;try{t.setItem(a,JSON.stringify(n)),r.setItem(a,JSON.stringify(i))}catch(e){C.out.devOutput("Problem setting item","writeDatLs",e,i,n)}},getAllDatStorageAsObj:function(){var e=y?T.localStorage:z,t=y?T.sessionStorage:H;try{return B.assign(se(t,a),se(e,a))}catch(e){return C.out.devOutput("Problem with local storage","getAllDatStorageAsObj",e),{}}},getAllAdvStorageAsObj:function(){return B.assign(ae(F),oe())},getAllAdvStorageAsObjForAjaxSend:function(){var e=X.getAllAdvStorageAsObj();return delete e.voidAuIds,e},getConvStorageAsObj:function(){var e=y?T.localStorage:z;return se(e,d)}}),Z={},Y={distributeComposedAds:function(o){var u=!1,d=[],l="";C.util.forEach(o.adUnits||o,function(t){var i=C.util.find(D,function(e){return e.targetId===t.targetId&&e.adStatus===E.adStatus.init});if(i)if(i.ads=t.ads,i.returnedKeywords=o.keywords,i.returnedSegments=o.segments,l=i.renderedImpRequestLoc,0<t.matchedAdCount&&(i.native?i.container=E.container.div:(t.renderOption?i.renderOption=t.renderOption:(0<t.html.indexOf("adnOptionContainerDiv")&&(i.container=E.container.div),0<t.html.indexOf("adnOptionContainerIframe")&&(i.container=E.container.iframe)),"IFRAME"===t.renderOption&&(i.container=E.container.iframe),"SANDBOXED_IFRAME"===t.renderOption&&(i.container=E.container.iframe,i.isolateFrame=!0),"DIV"===t.renderOption&&(i.container=E.container.div))),0===t.matchedAdCount){i.adStatus=E.adStatus.processed;var e=B.copyArgValues({matchedAdCount:t.matchedAdCount,html:t.html},i,["auId","targetId","auW","auH","kv","keywords","userSegments","c","ps","replacements","auml","floorPrice","requestArgs"]);e.retAdCount=0,e.retAdsW=0,e.retAdsH=0,e.h=0,e.w=0,Q.handlePostResponse(e,i),C.util.isFunction(i.onNoMatchedAds)&&i.onNoMatchedAds(e),C.util.isFunction(i.onPageLoad)&&i.onPageLoad(e),B.ampCheck(i,{width:0,height:0})}else if(B.getParam(i.requestParams,"load")!==E.loadEnums.lazy||i.withinBounds){B.ampCheck(i);var n=C.lib.showAdContent(i,t);if(C.util.isTrue(n)){i.adStatus=E.adStatus.distributed,C.util.forEach(t.rts||[],function(e){d.push(e)});var r=document.getElementsByClassName((i.targetClass||i.targetId)+"-show");C.util.forEach(r,function(e){e.style.display=i.display||"block"})}}else{u=!0,i.adStatus=E.adStatus.procured,t.renderedImpRequestLoc=l;var s=B.getDocEl(i),a=R[t.targetId];s&&a?(a.errorStatus="",Y.showTargetDiv(s,i),s.style.width=C.util.dimension(i.auW),s.style.height=C.util.dimension(i.auH)):(a.errorStatus=E.errorStatus.noTarget,C.out.output("Unable to find target element","distributeComposedAds",i))}else C.out.output("No ad unit data found, mismatched target probably or not the right status","composed",i)}),C.lib.sendRenderedImps(d,l),u&&$.initProximity()},showTargetDiv:function(e,t){e&&(C.util.isString(t.display)&&e.style.display!==t.display?e.style.display=t.display:"none"===e.style.display&&(e.style.display="block"))},insIframe:function(e,t){var i=t&&t.targetId===e.targetId||B.getDocEl(e);if(!i&&"script"!==e.format)return C.out.warn("Unable to find HTML element on page with the following id or class: "+e.targetId+" - "+e.targetClass),C.out.output("No targetId was found.","insIframe");var n=P.createElement("iframe");n.id=e.widgetId,n.name=e.widgetId,n.setAttribute(v,C.util.isTopWindow()),n.allowTransparency=!0,n.setAttribute("data-adn-console",W.console),e.impReg&&n.setAttribute(N,e.impReg);var r={ifrId:n.id};if(e.serverUrl){e.env&&e.env!==E.env.production.id&&E.env[e.env]&&(r[h]=e.env),e.dn&&(r[I]=e.dn),e.impReg&&(r[N]=e.impReg);var s=B.encodeUrlParams(e.serverUrl,r,e);if(5<e.serverUrl.length){s+=B.encodeAsUrlParams(X.getIdsAsObj(e),!0),s+=B.encodeAsUrlParams(X.getAllIdsAsObj()||{},!0),s+=B.encodeAsUrlParams(X.getEuConsentAsObj(e)||{},!0);var a=X.getConsent();if(0<a.length&&(s+=B.encodeAsUrlParams({consent:a},!0)),e.gdpr&&(s+=B.encodeAsUrlParams({gdpr:e.gdpr},!0)),!C.util.isTopWindow()){var o={"data-parent-top":!1};s+=B.encodeAsUrlParams(o,!0)}}if(!s)return C.out.output("Failure to create server src","insIframe",s);n.src=s}if(n.setAttribute("style","display: block; margin: 0; borderWidth: 0; padding: 0;"),n.setAttribute("scrolling","no"),n.frameBorder="0",e.isolateFrame&&B.supportsSrcDoc()){var u=g;e.blockScript&&(u=u.replace("allow-scripts","")),n.setAttribute("sandbox",u)}if("script"===e.format){var d=n.src;d+=B.encodeAsUrlParams({format:"script"},!0),P.write("<script src='"+d+"'><\/script>")}else{var l=e.auW||(e.creativeData?e.creativeData.creativeWidth:null);n.width=C.util.isString(l)||0<l?l:0,i.style.width=C.util.isNumber(l)&&0<l?C.util.dimension(n.width):n.width;var c=e.auH||(e.creativeData?e.creativeData.creativeHeight:null);n.height=C.util.isString(c)||0<c?c:0,i.style.height=C.util.isNumber(c)&&0<c?C.util.dimension(n.height):n.height,i.appendChild(n)}return Y.showTargetDiv(i,e),n}},$=(r=!(K={userId:"_svtri"}),J=[],{sendEventFromParent:function(e,t,i){ne(e,t,i)},sendClick:function(e){ne(e,null,"Click")},sendVisibilityImpressions:function(){re("visible","visibilityStatus","visible","visibleSent","Visible","onVisible")},sendViewableImpressions:function(){re("viewable","viewabilityStatus","viewed","viewSent","Viewable","onViewable")},cancelProximityListeners:function(){C.util.detachEventListener(T,"resize",$.takeProximity),C.util.detachEventListener(T,"scroll",$.takeProximity)},cancelViewabilityListeners:function(){C.util.detachEventListener(T,"resize",$.takeViewability),C.util.detachEventListener(T,"scroll",$.takeViewability)},initViewability:function(){C.util.isTopWindow()&&!B.supportsIntersectionObserver()&&($.takeViewability(),!1===r&&(r=T.setInterval($.takeViewability,203)),C.util.addEventListener(T,"resize",$.takeViewability),C.util.addEventListener(T,"scroll",$.takeViewability))},initProximity:function(){C.util.isTopWindow()&&($.takeProximity(),C.util.addEventListener(T,"resize",$.takeProximity),C.util.addEventListener(T,"scroll",$.takeProximity))},takeProximity:function(){var p,m,e=C.util.filter(D,function(e){return(e.adStatus===E.adStatus.procured||B.getParam(e.requestParams,"load")===E.loadEnums.lazyRequest)&&!e.withinBounds});if(0===e.length)return $.cancelProximityListeners(),C.out.devOutput("No more ads to proximity check","takeProximityReading",D);if(C.util.isTopWindow()){try{p=C.util.getWindowSize()}catch(e){C.out.output("takeProximityReading window size calcs off",e)}try{m=C.util.getScrollPos()}catch(e){C.out.output("takeProximityReading scroll calcs off",e)}var v=[],h="";C.util.forEach(e,function(e){try{var t=B.getDocEl(e);if(!t)return void C.out.devOutput("Missing appearance of element","takeProximity",t,e);var i=t.style.display;"none"===i.toLowerCase()&&(t.style.display="block");var n=C.util.getElementPosition(t),r=(t.offsetWidth,t.offsetHeight),s=C.util.isNumber(B.getParam(e.requestParams,"proximity"))?B.getParam(e.requestParams,"proximity"):E.defaultProximity,a=m.top,o=(m.left,m.top+p.height),u=m.left+p.width,d=n.top,l=n.left,c=n.top+r;if(n.left,d-o<s&&-1*s<c-a&&l-u<s&&(e.withinBounds=!0,e.adStatus===E.adStatus.procured)){e.adStatus=E.adStatus.distributed;var g=R[e.targetId];if(!C.util.isObject(g))return C.out.output("Can't find composed ad details","proximity",R,e);var f=C.lib.showAdContent(e,g);C.util.isTrue(f)&&(C.util.forEach(g.rts||[],function(e){v.push(e)}),h=g.renderedImpRequestLoc)}t.style.display=i}catch(e){C.out.output("some catch error for takeProximityReading",e)}}),C.lib.sendRenderedImps(v,h)}},takeViewability:function(e){var h,y,b=!1,I=!1,w=C.util.isTrue(e),t=C.util.isTopWindow()&&!w?D:k,i=C.util.filter(t,function(e){return e.displayStatus===E.displayStatus.displayed&&e.viewabilityStatus===E.viewabilityStatus.notViewed&&!e.isNested&&!e.preview});if(0===i.length)return $.cancelViewabilityListeners(),T.clearInterval(r),r=!1,C.util.isTopWindow()&&!w||B.postMessageToParent({messageType:E.postMessageType.toParentAllChildrenViewed,widgetId:C.inIframe.getIframeId(),functionContext:E.functionContext.parent,method:"allChildrenViewed"}),C.out.devOutput("No more ads to viewability check","takeViewabilityReadings",D,k,C.util.isTopWindow());try{(h=C.util.getWindowSize()).width=Math.max(h.width,1),h.height=Math.max(h.height,1),L.prevWindowWidth===h.width&&L.prevWindowHeight===h.height||(L.prevWindowWidth=h.width,L.prevWindowHeight=h.height)}catch(e){C.out.output("takeViewabilityReading window size calcs off",e)}try{y=C.util.getScrollPos(),L.prevScrollLeft===y.left&&L.prevScrollTop===y.top||(L.prevScrollLeft=y.left,L.prevScrollTop=y.top),L.maxViewLeft=Math.max(y.left+h.width,L.maxViewLeft),L.maxViewTop=Math.max(y.top+h.height,L.maxViewTop)}catch(e){C.out.output("takeViewabilityReading scroll calcs off",e)}var S,A=(new Date).getTime();if(w){L.childPrevTime=L.childPrevTime||{};var n=i[0].widgetId;L.childPrevTime[n]=L.childPrevTime[n]||(new Date).getTime(),S=A-L.childPrevTime[n],L.childPrevTime[n]=A}else L.prevTime=L.prevTime||(new Date).getTime(),S=A-L.prevTime,L.prevTime=A;C.util.forEach(i,function(e){try{var t=P.getElementById(e.adId||e.widgetId);if(!t)return e.viewabilityStatus=E.viewabilityStatus.divMissing,void C.out.devOutput("Missing div","takeViewabilityReading",e);var i=C.util.getElementPosition(t),n={width:Math.max(t.offsetWidth,1),height:Math.max(t.offsetHeight,1)},r=Math.max(i.left,y.left),s=Math.min(i.left+n.width,y.left+h.width),a=Math.max(i.top,y.top),o=Math.min(i.top+n.height,y.top+h.height),u=L.metricsFromParent;if(!B.isVisible(t))return;if(u){var d=u.overlapPos.left+y.left,l=u.overlapPos.left+u.overlapSize.width+y.left,c=u.overlapPos.top+y.top,g=u.overlapPos.top+u.overlapSize.height+y.top;r=Math.max(d,r),s=Math.min(l,s),a=Math.max(c,a),o=Math.min(g,o)}var f=Math.max(s-r,0),p=Math.max(o-a,0),m=Math.round(f*p/(n.width*n.height)*100);if(m>E.defaultVisibilityPercentage&&e.visibilityStatus===E.visibilityStatus.notVisible&&(C.util.isTopWindow()&&!w||(e.visibilityStatus=E.visibilityStatus.visible,I=!0)),100===m&&100===e.viewability.prevPercent&&e.viewability.timeFully<E.longestTime&&(e.viewability.timeFully+=S),50<=m&&50<=e.viewability.prevPercent&&e.viewability.timeHalf<E.longestTime&&(e.viewability.timeHalf+=S),0<m&&0<e.viewability.prevPercent&&e.viewability.timePartly<E.longestTime?e.viewability.timePartly+=S:e.viewability.timeNone+=S,m>e.viewability.maxPercent&&(e.viewability.maxPercent=m),e.viewability.prevPercent=m,(1e3<e.viewability.timeFully||1e3<e.viewability.timeHalf)&&e.viewabilityStatus===E.viewabilityStatus.notViewed&&(C.util.isTopWindow()&&!w||(e.viewabilityStatus=E.viewabilityStatus.viewed,b=!0)),C.util.isTopWindow()&&!w){var v=[A,y.left,y.top,h.width,h.height,i.left,i.top,n.width,n.height,r-i.left,a-i.top,f,p];C.util.forEach(v,function(e,t){v[t]=Math.round(e)}),B.postMessageToChild(t,{messageType:E.postMessageType.toChildViewability,functionContext:E.functionContext.inIframe,method:"updateMetricsFromParent",metricsFromParent:v.join(","),metaData:X.getAllAdvStorageAsObj(),isDivContainer:e.container===E.container.div||e.isDivContainer})}}catch(e){C.out.output("takeViewabilityReading off",e)}}),I&&$.sendVisibilityImpressions(),b&&$.sendViewableImpressions()}}),ee={allChildrenViewed:function(e){var t=D[e.widgetId];t&&(t.visibilityStatus=E.visibilityStatus.visible,t.viewabilityStatus=E.viewabilityStatus.viewed)},updateIframe:function(e){return te(e,function(e,t,i){C.util.isDefined(i.w)&&(e.width=i.w),C.util.isDefined(i.h)&&(e.height=i.h);var n=e.parentNode;"relative"===i.stack?(n.style.position="relative",e.style.position="absolute"):"fixed"===i.stack?e.style.position="fixed":"absolute"===i.stack?(C.util.isBlankString(n.style.position)||"relative"!==n.style.position||(n.style.position="static"),e.style.position="absolute"):(C.util.isBlankString(e.style.position)||"static"===e.style.position||(e.style.position="static"),C.util.isDefined(e.width)&&(n.style.width=C.util.dimension(e.width)),C.util.isDefined(e.height)&&(n.style.height=C.util.dimension(e.height))),C.util.isDefined(i.ifrStyle)&&!C.util.isBlankString(i.ifrStyle)&&B.applyStyle(e,i.ifrStyle),C.util.isDefined(i.targetStyle)&&!C.util.isBlankString(i.targetStyle)&&B.applyStyle(n,i.targetStyle),ie(t,i)})},triggerViewabilityReading:function(e){te(e,function(e,t){t.adStatus=E.adStatus.processed,t.displayStatus=E.displayStatus.displayed,$.initViewability(t)})},iframeResizer:function(e,d,l){return te(e,function(e,t,i){var n=parseInt(i.w,10),r=parseInt(i.h,10),s=C.util.isDefined(l)?l:t.collapsible;if(n<0||r<0)return C.out.output("Invalid width ("+i.w+") and height ("+i.h+") for resize","iframeResizer");var a=0===n,o=0===r;if((a||o)&&!s)return C.out.devOutput("Resize to zero not allowed -- ad unit is not collapsible","iframeResizer",i,s);e.width=i.w,e.height=i.h;var u=e.parentNode;u.style.width=C.util.dimension(i.w),u.style.height=C.util.dimension(i.h),(a||o)&&d&&(e.style.display="none",u.style.display="none"),C.out.infoOutput("Resizing to "+e.width+"x"+e.height+" and "+u.style.width+"-"+u.style.height+" for "+i.widgetId,"iframeResizer",i),ie(t,i)})},styleFromAds:function(e){if(!B.isWidgetId(e.widgetId))return C.out.devOutput("missing widget ID","styleFromAds",e);var t=parseInt(e.retAdCount,10),i=D[e.widgetId],n={};if(B.copyArgValues(n,i,q),0===t)n=B.assign(n,{w:0,h:0,retAdCount:0,ads:[]}),ee.iframeResizer(n,W.inScreen!==E.feedback.inScreen.inAdUnit);else{if(!(C.util.isNumber(t)&&0<t))return C.out.output("adCount is not valid: "+t,"styleFromAds");if(!i||!C.util.hasProperties(i))return C.out.output("Missing widget spec","styleFromAds",e);i.displayStatus=E.displayStatus.displayed,$.initViewability(i),n=B.assign(n,{w:parseInt(e.retAdsW,10),h:parseInt(e.retAdsH,10),retAdCount:e.retAdCount,ads:B.generateAdData(e)}),ee.iframeResizer(n,!1,!1)}}};function te(e,t,i){if(!B.isWidgetId(e.widgetId)){var n=P.getElementById(e.widgetId);return n?t.call(ee,n,{},e):C.out.output("Couldn't find a widget ID","checkArgs",e)}var r=D[e.widgetId];if(!r&&e.widgetId!==E.previewId)return C.out.output("Couldn't find widget specs for "+e.widgetId,"checkArgs",e);var s=i||P.getElementById(e.widgetId)||P.getElementById(E.previewId);return s?r?t.call(ee,s,r,e):void 0:C.out.output("Couldn't find widget in the document","checkArgs",e,s)}function ie(e,t){if(e&&C.util.isFunction(e.onRestyle)){var i={};B.copyArgValues(i,e,q),B.copyArgValues(i,t,q),e.onRestyle(B.normalise(i))}}function ne(e,t,i){var n=e,r=!t||!t.rt;try{if(r||(n+=B.encodeAsUrlParams({rt:t.rt},!0)),-1<J.indexOf(n))return C.out.devOutput("URL has already been sent. Not sending again.","sendEvent",n,t);if(B.isTestAddress(n)||B.isTestAddress(B.getLocationHref()))J.push(n),C.out.devOutput(i+" being sent","sending"+i+"Event",n);else if(C.util.isStringWithChars(t.rt)&&0===t.rt.indexOf("preview-"))J.push(n),C.out.devOutput(i+" would have been sent if this was not a previewed ad","sending"+i+"Event",n);else{var s,a=C.util.getNewAjax(r?"GET":"POST",n,function(){if(a.readyState&&4!==a.readyState)return!1;if((!a.status||200===a.status)&&C.util.isStringWithChars(a.responseText)){var e={};try{e=JSON.parse(a.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block send event",a)}e&&e.metaData&&C.util.hasProperties(e.metaData)&&X.writeAdvLs(e.metaData)}}),o=B.canAccessLocalStorage();a.withCredentials=!B.isTestAddress(n)&&o,(s=!o||L&&L.metaData?L.metaData:B.setAndReturnMetaData())?a.send(JSON.stringify(s)):a.send(),J.push(n)}return 1}catch(e){return C.out.output("sending a "+i+" event failed",e),0}}function re(n,r,s,a,o,u){C.util.forEach(k,function(e){if(C.util.isStringWithChars(e.rt)||!e.displayStatus){var t=x[n];if(C.util.isString(t)){if(e.displayStatus===E.displayStatus.displayed&&e[r]===E[r][s]){var i={messageType:E.postMessageType.toParentAdVisibilityEvent,widgetId:e.widgetId,adId:e.adId,creativeId:e.creativeId,lineItemId:e.lineItemId,viewability:e.viewability,spec:e,callbackProp:u,feedbackText:o,isDivContainer:e.isDivContainer,impRequestLoc:t};if(e.impReg||!B.canAccessLocalStorage()&&C.lib.isParentTopWindow()?i.delayedImpression=!0:ne(t,e,o),e[r]=E[r][a],!B.isWidgetId(e.widgetId))return C.out.devOutput("Couldn't find a widget ID","sendImpression",e);B.postMessageToParent(i)}}else C.out.output("Missing a imp request location","send"+o+"Impression",x,n)}else C.out.output("Need a response token on the spec object to send imp","send"+o+"Impression",e)})}function se(t,e){var i=t.getItem(e);if(C.util.isStringWithChars(i))try{return JSON.parse(i)}catch(e){return C.out.output("Error reading from local storage","cookie.getLs",e,t,i)}return{}}function ae(e,t){var i,n=y?T.localStorage:z;try{i=se(n,e)}catch(e){return C.out.devOutput("Problem with local storage","getLocalStorage",e),{}}if(e===d?C.util.hasProperties(i)||(i={}):C.util.isArray(i)||(i=[]),!0===t)return i;if(e===u){var r=[];return C.util.forEach(i,function(e){f[e]===e&&r.push(e)}),r}var s={};return C.util.forEach(i,function(e){if("voidAuIds"===e.key){if(!C.util.isArray(e.value))return;s.voidAuIds=C.util.filter(e.value,function(e){return e.auId&&e.exp&&e.exp>B.getUnixTimestamp()})}else C.util.isStringWithChars(e.key)&&e.exp&&e.exp>B.getUnixTimestamp()&&(s[e.key]=e.value)}),s}function oe(){var e=y?T.sessionStorage:H,t=se(e,F);C.util.isObject(t)||(t={});var i={};return C.util.forEach(t,function(e,t){C.util.isStringWithChars(t)&&(i[t]=e)}),i}C.inIframe=function(){var e=!0,t={},n=[],c=[],r=[],s={};B.isTestAddress(T.location.href),Z={handleAdUnitInfo:function(e){if(!e||!C.util.isString(e.adUnitInfoId))return C.out.output("Missing ad unit info id for ad unit info response","handleAdUnitInfo",e);var t=s[e.adUnitInfoId];if(!t||!C.util.isArray(t)||t.length<1)return C.out.output("Missing some ad unit info response handlers","handleAdUnitInfo",s,e);var i=e.adUnitInfo,n=B.copyArgValues({},i,["auId","latitude","longitude","adStatus","auH","auW","collapsible","display","c","kv","keywords","replacements","auml","ps","displayStatus","targetId","targetClass","widgetId","functionCalls","functions","requestParams","method","onNoMatchedAds","onImpressionResponse","onPageLoad","usi","siteId","userId","sessionId","segments","userSegments","resizeOnPageLoad","ctx"]);C.util.forEach(t,function(e){e(n)})},handleChildPubs:function(i){if(!C.util.isObject(i)||!C.util.isString(i.widgetId)||!C.util.isString(i.event))return C.out.output("Missing some args","handleChildPubs",i);C.util.forEach(i.functionCalls||[],function(t){if(t&&t.name){var e=C.util.filter(r,function(e){return e.name===t.name&&C.util.isFunction(e.func)&&!0!==e.isCalled});C.util.forEach(e||[],function(e){e.func(t.args),e.isCalled=i.event!==E.events.CUSTOM&&t.event!==E.events.CUSTOM})}else C.out.output("Missing a name parameter for a function call","handleChildPubs",i)}),C.util.forEach(t[i.event]||[],function(e){if(e.widgetId===i.widgetId){var t={};C.util.isObject(i.windowDims)&&(t.windowDims=i.windowDims),C.util.isObject(i.widgetDims)&&(t.widgetDims=i.widgetDims),C.util.isObject(i.widgetParentDims)&&(t.widgetParentDims=i.widgetParentDims),e.cb(t)}})},updateMetricsFromParent:function(e){if(!e||!C.util.isObject(e))return C.out.devOutput("Missing required args","updateMetricsFromParent",e);if(e.metricsFromParent&&!e.isDivContainer){var i=e.metricsFromParent.split(",");C.util.forEach(i,function(e,t){i[t]=parseInt(e,10)}),L.metricsFromParent={updateTime:i[0],scrollPos:{left:i[1],top:i[2]},windowSize:{width:i[3],height:i[4]},widgetPos:{left:i[5],top:i[6]},widgetSize:{width:i[7],height:i[8]},overlapPos:{left:i[9],top:i[10]},overlapSize:{width:i[11],height:i[12]}}}e.metaData&&(L.metaData=e.metaData),C.util.forEach(n,function(e){e()}),n=[],B.supportsIntersectionObserver()||$.takeViewability(C.util.isTrue(e.isDivContainer))}};function g(s,a,o,u,d){var l=!1,c=!1,g=s+"Status",f=E.viewabilityStatus.notViewed,p=E.viewabilityStatus.viewed;-1<s.indexOf("visibility")&&(f=E.visibilityStatus.notVisible,p=E.visibilityStatus.visible),(c=new T.IntersectionObserver(function(e){var t=k[a],i=(new Date).getTime();t[s]=t[s]||B.getNewViewability(),t[g]=t[g]||f;function n(){t[s].timeIntersect=t[s].timeIntersect+(new Date).getTime()-t[s].timeStart,t[g]=p,t[s].eventSent=!0,d(t[s]),T.clearTimeout(l),l=!1,c.disconnect()}if(t[g]===f)if(0<e[0].intersectionRatio&&e[0].intersectionRatio>=o||"visibility"===s&&0===o&&e[0].isIntersecting){if(t[s].timeStart=i,u<5)t[s].timeIntersect=Math.max(u,1),n();else{var r=u-t[s].timeIntersect;l=T.setTimeout(n,r)}t[s].isBeingViewed=!0}else l&&0<t[s].timeStart&&(t[s].timeIntersect=t[s].timeIntersect+(new Date).getTime()-t[s].timeStart,t[s].timeStart=0,T.clearTimeout(l),l=!1,t[s].isBeingViewed=!1)},{root:null,rootMargin:"0px",threshold:o})).observe(P.getElementById(a)),s.indexOf("customTiming")<0||C.util.addEventListener(T,"beforeunload",function(){var e=k[a];if(!e[s])return C.out.output("Could not find matching adspec for view","viewCallback",e,s);e[s].eventSent||(e[s].isBeingViewed&&(e[s].timeIntersect=e[s].timeIntersect+(new Date).getTime()-e[s].timeStart),0<e[s].timeIntersect&&d(e[s]),e[s]=null)})}function f(e,t){return e||C.util.find(k,function(e){return e.adId===t})}return{sendCustomEvent:function(a,o,t){var e=B.getParam(a,"id")||a;if(!C.util.isDefined(e)||!C.util.isDefined(o))return C.out.output("Missing an ad ID to perform the custom event","sendCustomEvent",a,o);function i(e){if(B.isSrcdocFrame()&&!t)return B.postMessageToParent({args:a,customArgs:o,pAdSpec:e,messageType:E.postMessageType.toParentCustomEvent});!function(e){if(!C.util.isObject(e))return C.out.output("Need an ad spec to send a custom event","sendCustomEvent",k,a,o);if(!C.util.isString(e.rt))return C.out.output("Need a response token on the spec object to send imp","sendCustomEvent",e,k,a,o);var t=C.lib.getRequestLocs({env:l?"http://localhost:8000/test":C.lib.getEnv(),subdomain:e.subdomain,dn:C.lib.getDn()}).custom;if(e&&D&&D[e.widgetId]&&(t=D[e.widgetId].customRequestLoc),!t)return C.out.output("Need a custom request loc","sendCustomEvent",t,e,k,a,o);var i=B.getParam(o,"events")||[{customType:B.getParam(o,"customType"),customValue:B.getParam(o,"customValue")}],n=[];if(C.util.forEach(C.util.isArray(i)?i:[],function(e){if(C.util.isString(B.getParam(e,"customType"))){var t=parseInt(B.getParam(e,"customValue"),10),i={customType:e.customType,customValue:C.util.isNumber(t)?t:0};0===i.customValue&&delete i.customValue,n.push(i)}else C.out.output("Missing type for the custom event","sendCustomEvent",e,a,o)}),0===n.length)return C.out.output("Found no valid custom events","sendCustomEvent",a,o);try{var r=t+B.encodeAsUrlParams({rt:e.rt},!0);if(B.isTestAddress(r))C.out.devOutput("Custom request loc being send","sending",e,r);else{var s=C.util.getNewAjax("POST",r);s.withCredentials=B.canAccessLocalStorage()&&!B.isTestAddress(r),s.send(JSON.stringify({events:n}))}}catch(e){C.out.output("sending a custom event failed",e,k,a,o)}}(e)}var n=f(t,e);n?i(n):c.push({adId:e,func:function(){return i(f(t,e))}})},intersectionCallback:function(e,t){if(!C.util.isFunction(t.callback))return C.out.output("Need a callback registered","intersectionCallback",t);var i=B.assign({},t);i.recordType="intersection",i.maxTime=t.maxTime||0,C.inIframe.recordInScreen(e,C.util.isStringWithChars(i.id)?i.id:B.uuid(),i)},recordInScreen:function(t,i,n){if(!B.supportsIntersectionObserver())return C.out.devOutput("Browser doesn't support IntersectionObserver -- cannot do timing.","recordInScreen");var r=B.getParam(t,"id")||t,e=f(null,r),s=parseFloat(B.getParam(n,"threshold"))/100,a=0<=s&&s<=1?s:.5;C.util.isDefined(s)&&a!=s&&C.out.output("Threshold needs to be between 0 and 100. Using default value of "+100*a+" instead.","recordInScreen",n);var o=B.getParam(n,"maxTime"),u=0<=o?o:12e4;if(C.util.isDefined(u)&&o!==u&&C.out.output("Max time needs to be greater than 0. Using default value of "+u+" instead.","recordInScreen",n),!C.util.isStringWithChars(r))return C.out.output("Cannot register in screen without an adId.","recordInScreen",r,i,n);if(!C.util.isStringWithChars(i))return C.out.output("Cannot register in screen without a custom event type.","recordInScreen",r,i,n);function d(){g(l,r,a,u,function(e){if(n&&"intersection"===n.recordType)return n.callback({adId:r,id:i,timeIntersect:e.timeIntersect,criteriaMet:e.timeIntersect>=u});C.inIframe.sendCustomEvent(t,{customType:i,customValue:Math.min(e.timeIntersect,u)})})}var l="customTiming"+i;e?d():c.push({adId:r,func:function(){d()}})},getResponseCtrId:function(e){var t,i=(C.util.isObject(e)&&C.util.isFunction(e.getElementsByTagName)?e:P).getElementsByTagName("div");return C.util.forEach(i,function(e){if(0===e.id.indexOf("adn-rsp-"))return t=e,!1;t||0!==e.id.indexOf(E.widgetIdPrefix)||(t=e)}),t?t.id:"responseCtr"},blockViewability:function(e){if(!C.util.isStringWithChars(e))return C.out.output("Need to supply the ad id to block viewability","blockViewability",e);k[e]=k[e]||{},k[e].viewabilityStatus=E.viewabilityStatus.blocked},blockResizeToContent:function(){e=!1},isResizeToContent:function(){return e},getAdRequestInfo:function(e){if(!e||!C.util.isFunction(e.onInfoReceived))return C.out.output("Need onData function populated","getAdRequestInfo",e);var t=e.adUnitInfoId||"adUnitInfoId-"+Math.random();s[t]=s[t]||[],s[t].push(e.onInfoReceived),B.postMessageToParent({messageType:E.postMessageType.toParentGetAdUnitInfo,adUnitInfoId:t,widgetId:C.inIframe.getIframeId()})},registerFunction:function(e,t){if(!e)return C.out.output("Missing important parameters","registerFunction",e);var i=C.util.isString(e)?e:e.name,n=C.util.isFunction(t)?t:e.func;if(!C.util.isString(i)||!C.util.isFunction(n))return C.out.output("Missing important parameters",e);r.push({name:i,func:n})},processAdResponse:function(e){if(!e||!C.util.isNumber(e.matchedAdCount))return C.out.output("Missing the necessary args in "+e,"resizeAds");var t=e.widgetId,i=e.widgetId;if(t||(t=C.inIframe.getIframeId(),i=C.inIframe.getResponseCtrId()),!t&&C.lib.isParentTopWindow())return C.out.devOutput("Unable to find iframeId","processAdResponse",t,e);!function(n,e,t){var i=B.getAdsInfo(e);if(!i.adsDivEl)return C.out.output("Can't find the ads container","processAd",n,e,t,i);var r=(D||{})[n]||{};x=C.lib.getRequestLocs({env:l?"http://localhost:8000/test/i":r.env||C.lib.getEnv(),dn:C.lib.getDn(),subdomain:i.subdomain},!1);var s=i.adsDivEl&&"div"===i.adsDivEl.tagName.toLowerCase()&&(-1<i.adsDivEl.className.indexOf(E.nativeClass)||e!==C.inIframe.getResponseCtrId()||0===e.indexOf(E.widgetIdPrefix)),a=!s&&(!n||!C.lib.isParentTopWindow())||s&&(!n||!C.util.isTopWindow());if(0!==t){var o={};if(C.util.forEach(i.ads,function(e){if(!k[e.id]){var t={widgetId:n,isNested:a,isDivContainer:s,adId:e.id,dims:e.dims,subdomain:e.subdomain,definedDims:e.definedDims,creativeId:e.el.getAttribute("data-creative-id"),lineItemId:e.el.getAttribute("data-line-item-id"),rt:e.el.getAttribute("data-response-token"),impReg:r.impReg||B.getImpReg(),adStatus:E.adStatus.processed,displayStatus:E.displayStatus.displayed,viewabilityStatus:E.viewabilityStatus.notViewed,visibilityStatus:E.visibilityStatus.notVisible,viewability:B.getNewViewability(),visibility:B.getNewViewability()};if(k[e.id]=t,o[e.id]=t,B.supportsIntersectionObserver()){var i=e.id;g("visibility",i,0,1,function(){$.sendVisibilityImpressions()}),g("viewability",i,.5,1e3,function(){$.sendViewableImpressions()})}}}),C.util.hasProperties(o)){var u=P.getElementsByClassName("adn-external-container");if(C.util.forEach(u,function(i){var e=i.parentNode;e&&e.className&&!(e.className.indexOf(E.cwClass)<0)&&i.href&&C.util.addEventListener(e,"click",function(e){for(var t=e.target;t&&"a"!==t.nodeName.toLowerCase();)t=t.parentNode;t&&!B.getEnvFromHref(t.href)&&$.sendClick(i.href)})}),C.util.forEach(c,function(e){o[e.adId]&&e.func()}),c=C.util.filter(c,function(e){return!o[e.adId]}),!B.isWidgetId(n))return C.out.devOutput("Couldn't derive a widget ID","processAd",n,e,t);var d={messageType:E.postMessageType.toParentImpression,method:C.inIframe.isResizeToContent()?"styleFromAds":"triggerViewabilityReading",retAdCount:t,retAdsW:i.contentDims.w,retAdsH:i.contentDims.h,dims:{w:i.contentDims.w,h:i.contentDims.h},ads:B.generateAdData(null,i,o),widgetId:n,isDivContainer:s};B.postMessageToParent(d),s&&T.setTimeout(function(){Q.handleChildPageLoad({containerDiv:!0,widgetId:n})},150)}}else B.postMessageToParent({messageType:E.postMessageType.toParentImpression,retAdCount:t,retAdsW:i.contentDims.w,retAdsH:i.contentDims.h,dims:{w:i.contentDims.w,h:i.contentDims.h},ads:[],widgetId:n,isDivContainer:s})}(t,i,e.matchedAdCount)},callParentFunction:function(e,t){if(!C.util.isStringWithChars(e))return C.out.output("Missing the necessary args in "+e,"callParentFunction");B.postMessageToParent({messageType:E.postMessageType.toParentFunctions,widgetId:C.inIframe.getIframeId(),name:e,args:t})},getIframeArgs:function(){return B.combineArgs(B.parseUrlArgs(),B.parseHashArgs())},getIframeId:function(e){if(e&&0===e.indexOf(E.widgetIdPrefix))return e;var t=P.getElementsByTagName("body")[0].id;if(t&&0===t.indexOf(E.widgetIdPrefix))return t;var i=C.inIframe.getIframeArgs().ifrId;if(C.util.isStringWithChars(i)&&i!==E.previewId)return i;var n="";i===E.previewId&&(n=E.previewId);var r=C.util.getFrameElement();return C.util.isDefined(r)&&!r.id&&(r.id="adn-sup-"+Math.random()),C.util.isDefined(r)?r.id:n},parentSubscribeEvent:function(e){if(!(C.util.isObject(e)&&C.util.isString(e.event)&&C.util.isString(e.ifrId)&&C.util.isFunction(e.cb)))return C.out.output("Need better args","parentSubscribeEvent",e);B.postMessageToParent({messageType:E.postMessageType.toParentSubscribe,event:e.event,widgetId:e.ifrId}),t[e.event]=t[e.event]||[],t[e.event].push({widgetId:e.ifrId,cb:e.cb})},updateAd:function(t){if(!t||!t.ifrId)return C.out.output("Need arguments and an iframe id","inIframe",t);var e=B.getAdsInfo(t.ifrId),i=t.method||"updateIframe",n=t.targetStyle||t.parentStyle,r={messageType:E.postMessageType.toParentUpdateAd,method:i,w:t.ifrW||"",h:t.ifrH||"",ads:B.generateAdData(null,e,k),params:C.util.isObject(t.params)?t.params:"",ifrStyle:C.util.isObject(t.ifrStyle)?t.ifrStyle:"",targetStyle:C.util.isObject(n)?n:"",widgetId:t.ifrId,stack:t.stack||"static"};t.el&&t.event?C.util.addEventListener(t.el,t.event,C.util.createDelegate(C.util,function(e){if(B.postMessageToParent(r),t.cb){if(!C.util.isFunction(t.cb))return C.out.output("Callback supplied not a function","inIframe");t.cb(e,t)}})):B.postMessageToParent(r)}}}(),function(){function s(t){var p=C.lib.getRequestLocs(t,!0);if(I=[],a=[],0===j.length){var e=P.querySelector("meta[name='keywords']");e&&e.content&&(j=C.util.uniques(C.util.map(e.content.split(","),function(e){return C.util.trim(e)})).slice(0,100))}function i(e,t,i,n,r){var s=C.util.isObject(n)?B.clone(n):{},a=Math.random(),o=i.keywords||s.keywords||[];C.util.isString(o)&&(o=[o]);var u=0<o.length?C.util.uniques(j.concat(o)):j,d=P.querySelector("link[rel='canonical']"),l=d?d.href||d.getAttribute("href"):void 0,c={requestId:e,auId:i.auId||i.targetId||i.widgetId,requestArgs:r,parentArgs:n,auArgs:i,mode:s.mode||i.mode,format:"script"===i.format?"script":void 0,creativeId:i.creativeId,creativeData:i.creativeData,creativeContent:i.creativeContent,network:s.network||i.network,requestMode:E.requestMode[s.requestMode||i.requestMode]||E.requestMode.DEFAULT,networkId:i.networkId||s.networkId,widgetId:i.widgetId||E.widgetIdPrefix+a,auW:i.auW||i.creativeWidth||0,auH:i.auH||i.creativeHeight||0,display:i.display||void 0,dimensions:C.util.isArray(i.dimensions)&&0<i.dimensions.length&&C.util.isArray(i.dimensions[0])&&2===i.dimensions[0].length?i.dimensions:void 0,c:i.c||s.c||void 0,gdpr:i.gdpr||s.gdpr||void 0,consentString:i.consentString||s.consentString||void 0,ctx:i.ctx||s.ctx||T.location.href,canonical:i.canonical||s.canonical||l,kv:i.kv||s.kv||void 0,keywords:0<u.length?u:void 0,auml:i.auml||void 0,native:i.native||s.native||!1,replacements:i.replacements||s.replacements,segments:i.segments||s.segments,userSegments:s.userSegments||i.userSegments,ps:C.util.isNumber(i.ps)?i.ps:void 0,adStatus:E.adStatus.init,displayStatus:E.displayStatus.notDisplayed,container:E.container[i.container||s.container||"nothing"]||E.container.iframe,env:i.env||s.env||E.env.production.id,dn:i.dn||s.dn||!1,viewabilityStatus:E.viewabilityStatus.notViewed,visibilityStatus:E.visibilityStatus.notVisible,impRequestLoc:p.imp,floorPrice:i.floorPrice||s.floorPrice||void 0,protocol:i.protocol||s.protocol||void 0,renderedImpRequestLoc:p.rendered,viewImpRequestLoc:p.viewable,visImpRequestLoc:p.visible,customRequestLoc:p.custom,previewLoc:p.preview,headerBids:i.headerBids||s.headerBids,functionCalls:i.functionCalls||s.functionCalls,functions:i.functions||s.functions,requestParams:B.assign(s.requestParams||{},i.requestParams||{}),collapsible:!1!==i.collapsible,method:s.method||i.method,devScript:i.devScript||!1,excludedCreatives:s.excludedCreatives||[],excludedLineItems:s.excludedLineItems||[],onError:i.onError||s.onError||C.util.noop,onVisible:i.onVisible||s.onVisible||C.util.noop,onViewable:i.onViewable||s.onViewable||C.util.noop,onNoMatchedAds:i.onNoMatchedAds||s.onNoMatchedAds,hasResponse:!1,onResponse:i.onResponse||s.onResponse,onImpressionResponse:i.onImpressionResponse||s.onImpressionResponse,onPageLoad:i.onPageLoad||s.onPageLoad,onRestyle:i.onRestyle||s.onRestyle,siteId:i.siteId||s.siteId,usi:i.usi||s.usi,userId:i.userId||s.userId,useCookies:!(!1===i.useCookies||!1===s.useCookies),sessionId:i.sessionId||s.sessionId,latitude:i.latitude||s.latitude,longitude:i.longitude||s.longitude,clearTarget:C.util.isDefined(i.clearTarget)?i.clearTarget:C.util.isTrue(s.clearTarget),targetClass:s.targetClass||i.targetClass,externalId:r.externalId,impReg:E.impReg[r.impReg]?r.impReg:void 0,targetId:i.targetId||"adn-"+(i.auId||i.creativeId)+(s.targetClass||i.targetClass?a:""),isolateFrame:C.util.isDefined(i.isolateFrame)?i.isolateFrame:s.isolateFrame||!1,blockScript:C.util.isDefined(i.blockScript)?i.blockScript:s.blockScript||!1,isolateSubFrame:C.util.isDefined(i.isolateSubFrame)?i.isolateSubFrame:s.isolateSubFrame||!1,serverUrl:p.imp+"&auId="+i.auId,resizeOnPageLoad:C.util.isDefined(i.resizeOnPageLoad)?i.resizeOnPageLoad:s.resizeOnPageLoad,viewability:B.getNewViewability()};if(c.cachedFunctionCalls=c.cachedFunctionCalls||[],C.util.isNumber(i.refresh)&&(c.refresh={delay:parseInt(i.refresh,10),event:"onViewable",count:1}),C.util.isObject(i.refresh)&&C.util.isNumber(i.refresh.delay)&&(c.refresh={delay:parseInt(i.refresh.delay,10),event:"onVisible"===i.refresh.event?i.refresh.event:"onViewable",count:C.util.isNumber(i.refresh.count)&&0<C.util.isNumber(i.refresh.count)?parseInt(i.refresh.count):1}),c.devScript&&(c.serverUrl+="&isDevScript=true"),t.push(c),!c.targetClass){var g=C.util.filter(D,function(e){return e.targetId===c.targetId});c.duplicateId=0<g.length}var f=B.getDocEl(c);c.prevStyle=f?f.getAttribute("style"):"",D[c.widgetId]=c}var n=B.assign({},t);delete n.adUnits,delete n.creatives;var r=B.uuid();C.util.isArray(t.adUnits)&&!t.isPreview?C.util.forEach(C.util.isArray(t.adUnits)?t.adUnits:[],function(e){i(r,I,e,n,t)}):C.util.isArray(t.creatives)?C.util.forEach(C.util.isArray(t.creatives)?t.creatives:[],function(e){i(r,a,e,n,t)}):C.util.isStringWithChars(t.creativeContent)?i(r,a,t,void 0,t):i(r,I,t,void 0,t),C.util.isFunction(t.onAllResponses)&&(O[r]={onAllResponses:t.onAllResponses},O[r].widgetIds=C.util.map(C.util.filter(D,function(e){return e.requestId===r}),function(e){return e.widgetId}))}var I,a;function o(t,e){var i=B.getDocEl(t);if(!i)return C.out.output("Couldn't find target element","Creative preview",t,i,t.onError);var n=C.util.find(i.childNodes,function(e){return e.id===t.widgetId});if(0<e.indexOf("adnOptionContainerDiv")&&(t.container=E.container.div),0<e.indexOf("adnOptionContainerIframe")&&(t.container=E.container.iframe),n||(t.container!==E.container.div||t.isolateFrame?(t.serverUrl=null,C.lib.showAdContent(t,{html:e,matchedAdCount:1})):(Y.showTargetDiv(i,t),i.innerHTML=B.getAdContentOnly(e,t.widgetId),C.util.loadScriptElements(i,t.widgetId))),t.blockScript&&C.util.isFunction(t.onImpressionResponse)){var r={};B.copyArgValues(r,t,q),t.onImpressionResponse(B.normalise(r))}}w={ifr:function(){var e=I[0];return e&&e.auId?e.requestMode!==E.requestMode.hasTarget||B.getDocEl(e)?void Y.insIframe(e):(C.out.devOutput("Skipping ad request","ifr",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):C.out.output("No auId was found.","ifr")},previewDirect:function(){C.util.forEach(a,function(e){D[e.widgetId].preview=!0,o(e,e.creativeContent)})},preview:function(e){var t=e&&e.widgetId?[e]:a;if(t.length<1)return C.out.output("No creatives to make request for","preview");var s=t[0].previewLoc,i=C.util.filter(t,function(e){return!D[e.widgetId].preview||e.firstPreviewFailed&&!e.secondPreviewAttempted});C.util.forEach(i,function(e){D[e.widgetId].preview=!0,e.secondPreviewAttempted=!!e.firstPreviewFailed}),C.util.forEach(i,function(t){if(!C.util.isString(t.networkId)||!C.util.isString(t.creativeId)&&!C.util.isObject(t.creativeData))return C.out.output("Insufficient creative information for preview","preview",t,t.onError);var e="POST",i=s+"context="+t.networkId;C.util.isString(t.creativeId)&&(e="GET",i+="&creativeId="+t.creativeId,t.secondPreviewAttempted&&(i="https://api.adnuntius.com/api/v1/creativepreview/"+t.creativeId+"?context="+t.networkId));var n,r=C.util.getNewAjax(e,i,function(){if(r.readyState&&4!==r.readyState)return!1;if(r.status&&200!==r.status){if(t.secondPreviewAttempted)return C.out.output("Error status returned","composed",r,t.onError);t.firstPreviewFailed||(t.firstPreviewFailed=!0,w.preview(t))}else{var e;try{e=t.secondPreviewAttempted?JSON.parse(r.responseText):r.responseText}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",t.onError)}o(t,e.html||e)}});C.util.isObject(t.creativeData)&&(n=JSON.stringify(t.creativeData)),r.send(n)})},composed:function(e,t){var i=C.util.isArray(B.getParam(t,"adUnits"))?t.adUnits:I;if(i.length<1)return C.out.output("No ad units to make request for","composed");var n=C.util.isArray(e)?e:I;$.takeProximity();var r=i[0],s=r.impRequestLoc,a=r.headerBids,o=[],u=B.getParam(t,"requestId"),d=0,l=B.gatherDataParams(n,function(e){var t=D[e.widgetId],i=B.getParam(t.requestParams,"load")!==E.loadEnums.lazyRequest||t.withinBounds;return i?i&&e.requestMode===E.requestMode.hasTarget&&!B.getDocEl(e)?(C.out.devOutput("Skipping ad request","composed",e),C.util.isFunction(e.onNoMatchedAds)&&e.onNoMatchedAds(e.requestArgs),!1):i&&50<=d?(o.push(e),!1):(d++,i):(o.push(e),!1)},function(e){D[e.widgetId].composed=!0}),c=C.util.map(X.getAllAdvStorageAsObj().voidAuIds||[],function(e){return e.auId})||[],g=C.util.filter(l.adUnits,function(e){return c.indexOf(e.auId)<0}),f=l.params;if(0<g.length){s+=B.encodeAsUrlParams(X.getIdsAsObj(r),!0),s+=B.encodeAsUrlParams(X.getAllIdsAsObj()||{},!0),s+=B.encodeAsUrlParams(X.getEuConsentAsObj(r)||{},!0),r.gdpr&&(s+=B.encodeAsUrlParams({gdpr:r.gdpr},!0)),u=u||"request-"+Math.random();var p=W.inScreen===E.feedback.inScreen.inAdUnit||S?"format=json":r.native?"tt=native":"tt=multi",m=Date.now(),v=C.util.getNewAjax(B.isTestAddress(s)?"GET":"POST",s+"&"+p,function(){if(v.readyState&&4!==v.readyState)return!1;if(!v.status||200===v.status){var e;V=E.composedRequest.requestReturned;try{e=JSON.parse(v.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",r.onError)}return e.adUnits?(e.metaData&&X.writeAdvLs(e.metaData),C.util.forEach(e.adUnits,function(e){R[e.targetId]=e}),M[u]={requestId:u,duplicateFilter:B.getParam(e,"duplicateFilter")},A=Date.now()-m,void Y.distributeComposedAds(e)):C.out.output("No ad units defined in returned data","composed",r.onError)}B.ampCheck(r,{width:0,height:0});var t={};if(v.responseText)try{t=JSON.parse(v.responseText)||{}}catch(e){C.out.output("ajax.responseText: catch block","composed",v),t={}}return t.metaData&&X.writeAdvLs(t.metaData),C.out.output("Error status returned","composed",v,r.onError)});v.withCredentials=B.canAccessLocalStorage()&&!B.isTestAddress(s);var h=B.gatherExclusions(i);h.adUnits=g,B.setAndReturnMetaData(h),C.util.isArray(a)&&(h.headerBids=a);var y=B.getParam(M[u],"duplicateFilter");y&&(h.duplicateFilter=y);var b=X.getConsent();0<b.length&&(h.consent=b),h=B.combineArgs(h,f),v.send(JSON.stringify(h)),V=E.composedRequest.requestMade}0<o.length&&T.setTimeout(function(){w.composed(o,{requestId:u,adUnits:i})},153)}};var t={style:function(t){e(function(e){B.applyStyle(e,t.style)})},resize:function(t){e(function(e){C.util.isDefined(t.width)&&(e.style.width=C.util.dimension(t.width)),C.util.isDefined(t.height)&&(e.style.height=C.util.dimension(t.height))})}};function e(e){var t,i,n=C.util.getFrameElement()||(t=I[0],(i=B.getDocEl(t))?i.firstChild:(C.out.warn("Unable to find HTML element on page with the following id: "+t.targetId),C.out.output("No target element was found.","getWidgetEl")));n&&e(n)}function u(e,t,i){var n=e.method||i;return t[n]?t[n].call(this,e):C.out.output("Matching method not found for "+n,"init")}function i(t,i,e){if(t.externalId){var n="outside"+e,r="inside"+e;C.util.forEach(D,function(e){e.externalId===t.externalId&&(e[n]=!0,e.impReg===E.impReg.manual&&C.util.isObject(e[r])&&($.sendEventFromParent(e[r].impRequestLoc,e[r].spec,e[r].feedbackText),B.visibilityEventHandling(i,e),e[r]=null))})}}C.regVisible=function(e){i(e,"onVisible","Visible")},C.regViewable=function(e){i(e,"onViewable","Viewable")},C.clearLocalStorage=function(){X.clearAdvLocalStorage()},C.useLocalStorage=function(e){y=!1!==e},C.useCookies=function(e){b=!1!==e},C.consent=function(e){var t=C.util.isArray(e)?{consent:e}:e;if(!t.consent||!C.util.isString(t.consent)&&!C.util.isArray(t.consent))return C.out.output("Not a valid network id or array object","adn.regConsent",e);X.writeConsent(C.util.isArray(t.consent)?t.consent:[t.consent])},C.regTargets=function(i){if(!C.util.isString(i.network)||!C.util.isArray(i.keyValues))return C.out.output("Not a valid network id or array object","adn.regTarget",i);var n=[];if(C.util.forEach(i.keyValues,function(e){if(C.util.isString(e.key)&&C.util.isString(e.value)){var t={key:e.key,value:e.value};e.expiry&&C.util.isInteger(e.expiry)&&(t.expiry=e.expiry),n.push(t)}else C.out.output("Missing an appropriate key and value for registering a target","adn.regTarget",e,i)}),n.length<1)return C.out.output("Missing appropriate targets to register","adn.regTarget",i);var e=C.lib.getRequestLocs(i).retargeting;if(!e)return C.out.output("Couldn't generate req url","regTargets",e,i);var t=C.util.getNewAjax("POST",e,function(){if(t.readyState&&4!==t.readyState)return!1;if(!t.status||200===t.status)return!0;var e=Math.floor(t.status/100);return 4===e?C.out.output("400 error","ajax.onreadystatechange in regTargets",t):5===e?C.out.output("500 error","ajax.onreadystatechange in regTargets",t):C.out.output("Misc error","ajax.onreadystatechange in regTargets",t)});t.open("POST",e),t.withCredentials=B.canAccessLocalStorage()&&!B.isTestAddress(e),t.send(JSON.stringify({network:i.network,keyValues:n}))},C.renderComposedAds=function(){function e(){return C.util.filter(R,function(e){return e.errorStatus===E.errorStatus.noTarget})}if(V!==E.composedRequest.requestReturned)return-1;var t=e();return t.length<1?0:(Y.distributeComposedAds(t),e().length)},C.requestData=function(e){if(!C.util.isDefined(e.auId)&&!C.util.isArray(e.adUnits))return C.out.output("Need an ad unit id or adUnits to make this work.","adn.requestData",e);var n=B.assign({},e);if(!C.util.isFunction(n.onSuccess)&&!C.util.isFunction(n.onResponse))return C.out.output("Need a callback function to make the call worthwhile","adn.requestData",n,e);n.onSuccess=C.util.isFunction(n.onSuccess)?n.onSuccess:C.util.noop,n.onError=C.util.isFunction(n.onError)?n.onError:C.util.noop,n.onResponse=C.util.isFunction(n.onResponse)?n.onResponse:C.util.noop;var t,i,r,s=C.lib.getRequestLocs(n,!0).imp;if(r=n.auId&&!C.util.isArray(n.adUnits)?(i=B.gatherDataParams([n],null,null,e).adUnits,n):(i=B.gatherDataParams(n.adUnits).adUnits)[0],!(t=B.encodeUrlParams(s,{format:"json"},e)))return C.out.output("Couldn't generate server url","requestData",t,e);t+=B.encodeAsUrlParams(X.getIdsAsObj(r),!0),t+=B.encodeAsUrlParams(X.getAllIdsAsObj()||{},!0),t+=B.encodeAsUrlParams(X.getEuConsentAsObj(e)||{},!0),e.gdpr&&(t+=B.encodeAsUrlParams({gdpr:e.gdpr},!0));var a=C.util.getNewAjax("POST",t,function(){if(a.readyState&&4!==a.readyState)return!1;function t(e,t){var i=B.assign(e,{responseCode:a.status,responseText:a.responseText});n.onResponse(i),(t||n.onError)(i)}if(!a.status||200===a.status)try{var e=JSON.parse(a.responseText);return t({responseJSON:e},n.onSuccess),e.metaData&&X.writeAdvLs(e.metaData),e}catch(e){return t({error:e,errorText:"Error with parsing the response text"}),C.out.output("Parsing response text fail","ajax.onreadystatechange: catch block",e)}var i=Math.floor(a.status/100);return 4===i?(t({errorText:"Likely error in request made"}),C.out.output("400 error","ajax.onreadystatechange",a)):5===i?(t({errorText:"Likely error in service"}),C.out.output("500 error","ajax.onreadystatechange",a)):(t({errorText:"Error"}),C.out.output("Misc error","ajax.onreadystatechange",a))}),o=B.gatherExclusions(n);B.setAndReturnMetaData(o),o.adUnits=i;var u=X.getConsent();0<u.length&&(o.consent=u),a.send(JSON.stringify(o))},C.regConversion=function(e){if(!C.util.isStringWithChars(e.eventType))return C.out.output("Missing a value for eventType","regConversion",e);if(e.eventValue&&!C.util.isNumber(e.eventValue))return C.out.output("The event value must be a number","regConversion",e);var t=C.lib.getRequestLocs(e).conversion,i=C.util.getNewAjax(B.isTestAddress(t)?"GET":"POST",t,function(){if(i.readyState&&4!==i.readyState)return!1;if(i.status&&200!==i.status)return C.out.output("Error status returned","composed",i);var e;try{e=JSON.parse(i.responseText)}catch(e){return C.out.output(e,"ajax.onreadystatechange: catch block",i)}e.metaData&&X.writeAdvLs(e.metaData)});i.withCredentials=B.canAccessLocalStorage();var n=B.copyArgValues({},e,["network","adSource","eventType","eventValue"]);B.setAndReturnMetaData(n);var r=X.getConvStorageAsObj();C.util.isObject(r)&&C.util.hasProperties(r)&&(n.metaData=n.metaData||{},n.metaData.clicks=JSON.stringify(r)),i.send(JSON.stringify(n))},C.clearDivs=function(){C.util.forEach(D,function(e){var t=B.getDocEl(e);t&&(C.util.isStringWithChars(e.prevStyle)?t.setAttribute("style",e.prevStyle):t.style.display="none",t.innerHTML="")}),C.clearOut()},C.clearOut=function(){D={},x={},k={},R={},L={},O={},M={},j=[]};var d,l,c,g,n=(d=[],l=2e3,c=4e3,g=function(e){if(!C.util.isArray(e))return!1;var t=!0;return C.util.forEach(e,function(e){C.util.isArray(e)&&2===e.length&&C.util.isInteger(e[0])&&C.util.isInteger(e[1])||(t=!1)}),t},function(e,t,i){r(e,t,i)});function f(t){return C.util.find(d,function(e){return e.reqId===t})}function p(r,s,n,e,a){if(f(e)){var t;t=e,d=C.util.filter(d,function(e){return e.reqId!==t});var i=function(){!a&&C.util.isTrue(B.getParam(n,"gptAsync"))&&r.setTargetingForGPTAsync&&r.setTargetingForGPTAsync();var e=C.util.isFunction(r.getBidResponses)?r.getBidResponses():[],t=C.util.isFunction(r.getNoBids)?r.getNoBids():[],i=C.util.isTrue(B.getParam(n,"debug"));if(i&&(a&&C.out.output("Prebid.js load timed-out","headerBidRequest"),C.out.simple("Bid responses from prebid",e),C.out.simple("Responses with no bids",t)),s.headerBids=[],C.util.forEach(e,function(e){C.util.forEach(e.bids,function(e){var t=B.clone(e);t.dealId||delete t.dealId,s.headerBids.push(t)})}),C.util.forEach(t,function(e){C.util.forEach(e.bids,function(e){var t=B.clone(e);t.cpm=0,t.statusMessage="Bid returned empty or error response";var i=e.bidderCode||e.bidder;t.bidderCode=C.util.isStringWithChars(i)?i:"",C.util.isStringWithChars(i)||C.out.output("Invalid bidder code has been set. Needs to be a String.","headerBidRequest",e.bidderCode||e.bidder,e);var n=g(e.sizes);n||C.out.output("Invalid sizes have been configured. Should be an two-dimension array of integers within an array","headerBidRequest",e.sizes,e),t.sizes=n?e.sizes:[],t.dealId||delete t.dealId,s.headerBids.push(t)})}),!s.adUnits||!C.util.isArray(s.adUnits)||0===s.adUnits.length)return C.util.isFunction(r.getHighestCpmBids)?void C.util.forEach(r.getHighestCpmBids(),function(e){if(e.adId&&e.adUnitCode){var t=P.createElement("iframe"),i=P.getElementById(e.adUnitCode);if(i){i.append(t);var n=t.contentDocument||t.contentWindow.document;n.open(),r.renderAd(n,e.adId),n.close()}else C.out.output("Could not find target div for "+e.adUnitCode,"Prebid",e)}else C.out.output("Could not find required adId or adUnitCode in bid","Prebid loop",e)}):void C.out.output("Prebid.js not loaded or could not find getHighestCpmBids","Prebid loop",r,s);i&&C.out.output("Header bids sent through to Adnuntius","headerBidRequest",s.headerBids),C.request(s)};a||!r.que?i():r.que.push(i)}}function m(){if(0<d.length){var e=d[0];r(e.prebidAdUnits,e.adnRequest,e.config,e.reqId)}}function r(e,t,i,n){var r=t||{},s=n||B.uuid();if(f(s)||d.push({reqId:s,prebidAdUnits:e,adnRequest:r,config:i}),!e||!C.util.isArray(e)||e.length<1)return p({},r,i,s),void m();if(!(1<d.length)||C.util.isString(n)){T.pbjs=T.pbjs||{};var a=T.pbjs;a.que=a.que||[];var o;o=T.setTimeout(function(){p(a,r,i,s,!0),m()},c),a.que.push(function(){o&&T.clearTimeout(o),f(s)?(a.removeAdUnit(),i&&a.setConfig(i),a.addAdUnits(e),a.requestBids({bidsBackHandler:function(){p(a,r,i,s),m()},timeout:l})):C.out.output("Prebid script loading probably timed out and only now has prebid loaded, which is after the ad request has passed through to Adnuntius","headerBid",d)})}}function v(){var e=X.getAllDatStorageAsObj();return e.browserId=C.util.isStringWithChars(e.browserId)?e.browserId:B.uuid(),e.sessionId=C.util.isStringWithChars(e.sessionId)?e.sessionId:B.uuid(),e.extSync=C.util.isObject(e.extSync)?e.extSync:{},X.writeDatLs(e),e}function h(e,t,i,n){if(!C.util.isStringWithChars(e))return C.out.output("Need a folder Id","adnDataRequest",e,t,i);var r=B.clone(t||{});r.folderId=e;var s=v();r.browserId=r.browserId||s.browserId,r.sessionId=s.sessionId,r.ctx=T.location.href;var a,o=C.lib.getAdnDataLocs(r),u=o[i.locKey];if(u+=B.encodeAsUrlParams(X.getEuConsentAsObj(r)||{},!0),u+=B.encodeAsUrlParams(X.getAdnConsentAsObj()||{},!0),i.pick&&i.pick.length){var d=B.copyArgValues({},r,i.pick)||{};"POST"===i.method?a=JSON.stringify(d):u+=B.encodeAsUrlParams(d,!0)}var l=C.util.getNewAjax(i.method,u,C.util.isFunction(n)?function(){n(l)}:null);l.withCredentials=B.canAccessLocalStorage()&&!B.isTestAddress(o[i.locKey]),l.send(a)}C.getSegments=function(i,n){var e=X.getDatSegments(i);e.segments?n&&C.util.isFunction(n.onResponse)&&n.onResponse(e):h(i,n,{method:"GET",locKey:"user"},function(t){if(t.readyState&&4!==t.readyState)return!1;if((!t.status||200===t.status)&&C.util.isStringWithChars(t.responseText)){var e={};try{e=JSON.parse(t.responseText)}catch(e){C.out.output(e,"ajax.onreadystatechange: catch block send event",t)}delete(e=C.util.isObject(e)?e:{}).expiryEpochMillis,X.writeDatSegments(i,e),n&&C.util.isFunction(n.onResponse)&&n.onResponse(e)}})},C.getBrowserId=function(){return v().browserId},C.visitor=function(e,t){h(e,t,{method:"POST",pick:["profileValues","browserId","sessionId","folderId"],locKey:"visitor"})},C.view=function(e,t){h(e,t,{method:"POST",pick:["categories","keywords","domainName","ctx"],locKey:"page"})},C.assignSegment=function(e,t){h(e,{segmentId:t},{method:"GET",pick:["segmentId"],locKey:"segment"})},C.externalUserSync=function(e,t){if(!C.util.isStringWithChars(e)||!E.sync[t])return C.out.output("Need a valid folder ID and external system ID to proceed","externalUserSync",e,t);var i=v(),n=E.sync[t].replace("{BROWSER_ID}",encodeURIComponent(i.browserId)).replace("{FOLDER_ID}",encodeURIComponent(e)),r=i.extSync[t];(new Date).getTime();C.util.isInteger(r);var s=P.createElement("img");s.setAttribute("alt",""),s.setAttribute("src",n),s.setAttribute("class","adn-sync-pixel"),s.setAttribute("style","position:absolute;top:-999999px;left:-9999999px;"),s.setAttribute("height","1"),s.setAttribute("width","1"),P.body.appendChild(s)},C.sync=function(e,t){if(!C.util.isStringWithChars(t.externalSystemType)||!C.util.isStringWithChars(t.externalSystemUserId))return C.out.output("Need an external system type or external system user id","sync",e,t);h(e,t,{method:"POST",pick:["externalSystemType","externalSystemUserId","browserId"],locKey:"sync"})},C.chbRequest=n,C.regScriptServe=function(e,t){var i=P.getElementById("script-"+t);return i&&i.src&&-1<i.src.indexOf("format=js")?(s({subdomain:-1<e.indexOf('data-subdomain="limited"')&&"limited",widgetId:t,container:"div"}),B.addWidgetIdToProcessAd(e,t)):e},C.callChildFunction=function(n){if(!n||!C.util.isStringWithChars(n.name))return C.out.output("Not enough info to proceed","callChildFunction",name);var r={name:n.name,args:n.args,event:E.events.CUSTOM},s={messageType:E.postMessageType.toChildPubs,event:E.events.CUSTOM,functionCalls:[r]};C.util.forEach(D,function(e,t){if(!(C.util.isStringWithChars(n.targetId)&&e.targetId!==n.targetId||C.util.isStringWithChars(n.targetClass)&&e.targetClass!==n.targetClass||C.util.isStringWithChars(n.auId)&&e.auId!==n.auId)){s.widgetId=e.widgetId;var i=P.getElementById(e.widgetId);if(!i)return D[t].cachedFunctionCalls=D[t].cachedFunctionCalls||[],void D[t].cachedFunctionCalls.push(r);B.postMessageToChild(i,s)}})},C.request=function(r){function e(){var i=r;if(r.amp&&r.amp.data){(i=r.amp.data).mode="amp",i.container=i.container||"div",i.adUnits=[{auId:i.auId,auW:i.width,auH:i.height}],C.util.forEach(["c","kv","segments","floorPrice"],function(t){if(C.util.isString(i[t]))try{i[t]=JSON.parse(i[t])}catch(e){i[t]=""}else i[t]=""});var e=i.targetId||"adn-"+i.auId;if(!P.getElementById(e)){var t=P.createElement("div");t.setAttribute("id",e),P.getElementById("c").appendChild(t)}}s(i);var n=E.methodEnums.ifr;C.util.isArray(i.adUnits)&&!r.isPreview?n=E.methodEnums.composed:C.util.isArray(i.creatives)?n=E.methodEnums.preview:C.util.isStringWithChars(i.creativeContent)&&(n=E.methodEnums.previewDirect),u(i,w,n)}r.requestTiming===E.requestTiming.onReady?B.onDocReady(e):r.requestTiming===E.requestTiming.onLoad?B.onLoad(e):e()},C.display=function(e){u(e,t,"style")},C.setFeedbackOptions=function(e){Q.setFeedbackOptions(e)},C.preview=function(e){return C.util.isArray(e.creatives)?C.util.isStringWithChars(e.networkId)?(e.isPreview=!0,void C.request(e)):C.out.output("A network ID is required for a preview","preview",e):C.out.output("An array of creatives is required for preview","preview",e)}}(),function(){if(!n){var t=B.getScriptOverride();if(t){var e=function(){var e=P.createElement("script");e.id=c,e.src=t,P.body.appendChild(e)};return P.body?e():C.util.addEventListener(T,"load",e)}}G.regDestination(),Q.registerListeners(),Q.setFeedbackOptions();function i(){try{for(var t;t=C.calls.shift();)try{t()}catch(e){C.out.output(e,"executeCalls: inside while catch block",t,C.calls)}}catch(e){C.out.output(e,"executeCalls: outside while catch block",C.calls)}}T.setTimeout(i,25),C.calls.push=function(){return Array.prototype.push.apply(this,arguments),T.setTimeout(i,1),this.length}}()}(adn,document,window)}catch(e){adn.out.output(e,"Blanket catch block")}
//# sourceMappingURL=adn.js.map
