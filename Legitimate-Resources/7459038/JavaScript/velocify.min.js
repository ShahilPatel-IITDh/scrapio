var consultationWidget=function(e){var t={validationMsgFieldClass:"velocify-form-field-error-message",erroredInputFieldClass:"velocify-form-field-error",hasFormError:!1,validationPatterns:{phone:/(\d){3}-(\d){3}-(\d){4}/,zip:"^[0-9]{5}(-[0-9]{4})?$",email:/(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,datepicker:/^(0?[1-9]|1[0-2])[\/](0?[1-9]|[1-2][0-9]|3[01])[\/]\d{4}$/},requiredMessage:"This field is required.",maxValueErrorMessage:"Value must be less than or equal to ",validationMessage:{phone:"Please use the format xxx-xxx-xxxx.",zip:"Please use the format xxxxx or xxxxx-xxxx.",email:"This is not a valid email format.",datepicker:"Please enter a valid date in the form of MM/DD/YYYY."},validateKeyWithRegex:function(e){var t=e.key,a=this.getFieldAttributeValue(e.target,"pattern")
if(a){if(!new RegExp(a).test(t))return e.preventDefault()}},allowNumbersOnly:function(e,t,a,r){var i=e.target.value,n=i.split("."),o=e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105,s=110===e.keyCode||190===e.keyCode,d=109===e.keyCode||189===e.keyCode
return e.shiftKey?e.preventDefault():(i.length!==a||this.isTextSelected(e))&&(0!==t||o||r&&d)&&(s||o||r&&d)?void(t>0&&n.length>1&&n[1].length===t&&e.preventDefault()):e.preventDefault()},formatNumbers:function(e,t,a,r){var i=r&&0===e.indexOf("-")?"-":""
e=e.replace(/[^0-9.]+/g,""),e=e.split("."),e.length>1&&e.splice(e.length-1,0,"."),e=e.join("")
var n=e.split(".")
return a&&(n[0]=n[0].replace(/\d(?=(?:\d{3})+$)/g,"$&,")),n.length>1&&(n[1]=n[1].substring(0,t)),i+n.join(".")},formatPhoneNo:function(e){var t=e.target.value
if(t){t=t.replace(/-/g,"")
var a=t&&t.length
if(a>3&&a<6)return t.substring(0,3)+"-"+t.substring(3,6)
if(a>6)return t.substring(0,3)+"-"+t.substring(3,6)+"-"+t.substring(6,10)}},formatZipCode:function(e){var t=e.target.value
if(t){t=t.replace(/-/g,"")
if((t&&t.length)>5)return t.substring(0,5)+"-"+t.substring(5,9)}},dateWithSlash:function(e){if("/"===e.slice(-1)||!isNaN(e.slice(-1))){if(e){var t=e.length
if("/"===e.slice(-1)&&3!==t&&6!==t)return e=e.slice(0,e.length-1),this.oldDateSlashStr=e=e.replace(/[^\d/]/g,""),e
if(void 0!==this.oldDateSlashStr&&this.oldDateSlashStr.length-1===t&&"/"===this.oldDateSlashStr.slice(-1))return this.oldDateSlashStr=e=e.replace(/[^\d/]/g,""),e
2!==t&&5!==t||(e+="/"),3===t&&-1===e.indexOf("/")&&(e=e.slice(0,2)+"/"+e.slice(2),t++),6===t&&"/"!==e.slice(-1)&&(e=e.slice(0,5)+"/"+e.slice(5),t++)}return this.oldDateSlashStr=e=e.replace(/[^\d/]/g,""),e}if(isNaN(e.slice(-1)))return e=e.slice(0,e.length-1),this.oldDateSlashStr=e=e.replace(/[^\d/]/g,""),e},compareDateWithSlash:function(e){var t=e.replace(/\D/g,""),a=t.length
return a>2&&(t=a>4?t.slice(0,2)+"/"+t.slice(2,4)+"/"+t.slice(4):t.slice(0,2)+"/"+t.slice(2),e!==t)?t:e},runtimeRelativeFileResolver:function(e,t){return t=t||"",window.___ems_build?"runtime/"+e:"../../runtime/"+t+e},isTextSelected:function(e){return e.target.selectionStart!==e.target.selectionEnd},getFieldAttributeValue:function(e,t){return e.attributes&&e.attributes[t]?e.attributes[t].value:""},getRadioInputValue:function(t){return e('input[name ="'+t+'"]:checked').val()},onFormInputKeyDown:function(e){if(!([8,9,37,38,39,40,46].indexOf(e.keyCode)>-1)){var t=this.getFieldAttributeValue(e.target,"fieldUiType")
switch(t){case"amount":this.allowNumbersOnly(e,2,15,!1)
break
case"percentage":this.allowNumbersOnly(e,2,5,!1)
break
default:this.validateKeyWithRegex(e)}}},onFormInputKeyUp:function(e){if(!([9,16,37,38,39,40].indexOf(e.keyCode)>-1)){var t=this.getFieldAttributeValue(e.target,"fieldUiType")
if(window.navigator.userAgent.match(/Android/i)){var a=this.getFieldAttributeValue(e.target,"pattern"),r=e.target.value
if(a&&r){var i=this.validateInputForAndroid(r,a)
e.target.value=i}}switch(t){case"amount":case"percentage":e.target.value=this.formatNumbers(e.target.value,2,!0,!1)
break
case"datepicker":var n=this.dateWithSlash(this.compareDateWithSlash(e.target.value))
n&&"string"==typeof n&&(n=n.substring(0,10)),e.target.value=n
break
case"phone":var o=this.formatPhoneNo(e)
o&&(e.target.value=o)
break
case"zip":var s=this.formatZipCode(e)
s&&(e.target.value=s)}this.validateInputValue(e)}},validateInputForAndroid:function(e,t){if(!new RegExp("^"+t+"+$").test(e)){var a=t.split("[").join("[^"),r=new RegExp(a,"g")
return e=e.replace(r,"")}return e},validateInputValue:function(e){this.removeErrorFromInput(e),this.checkValidations(e.target)},onFormInputChange:function(e){this.validateInputValue(e)},validateFormData:function(e){this.hasFormError=!1
for(var t in e)if(e.hasOwnProperty(t)){var a=e[t]
this.checkValidations(a)}},focusErroredField:function(t){var a=e(t).find(".field-container .velocify-form-field-error")
a.length>0&&a.first().focus()},checkValidations:function(e){this.checkRequiredValidation(e),this.checkMinAndMax(e),this.checkRegExValidations(e)},checkRequiredValidation:function(e){if(!e.value&&e.required){var t=this.requiredMessage
this.addErrorToInput(e.id,t),this.hasFormError=!0}},checkMinAndMax:function(e){var t=e.maxValue||this.getFieldAttributeValue(e,"maxValue"),a=e.value
if(t&&a){a=Number(a.replace(/[^0-9\.-]+/g,""))
var r=""
a>t&&(r=this.maxValueErrorMessage+this.formatNumbers(t,2,!0,!1),this.addErrorToInput(e.id,r),this.hasFormError=!0)}},checkRegExValidations:function(e){var t=e.fieldUiType||this.getFieldAttributeValue(e,"fieldUiType"),a=e.value
if(a&&(a=a.trim()),t&&a&&this.validationPatterns[t]){var r=this.validationPatterns[t],i=this.validationMessage[t]
new RegExp(r).test(a)||(this.addErrorToInput(e.id,i),this.hasFormError=!0)}},addErrorToInput:function(t,a){var r=e("#"+t),i=r.closest(".field-container")
if(i){var n="validation-error-"+t,o=this.createErrorElement(a,n)
i.append(o)
r.closest(".form-row").find(".modal-input-label").addClass(this.erroredInputFieldClass),r.addClass(this.erroredInputFieldClass),r.attr("aria-describedby",n)}},removeErrorFromInput:function(t){var a=e(t.target)
a.closest(".form-row").find("."+this.erroredInputFieldClass).removeClass(this.erroredInputFieldClass),a.closest(".field-container").find("."+this.validationMsgFieldClass).remove(),a.removeAttr("aria-describedby")},createErrorElement:function(t,a){var r=this.runtimeRelativeFileResolver("ic-error.svg"),i='<img class="ic-error" src="'+r+'" alt="error" />',n='<span id="'+a+'">'+t+"</span>"
return e("<div></div>").addClass(this.validationMsgFieldClass).prepend(i).append(n)},removeOldErrors:function(){var t=e("#velocify-lead-form-"+a.formId),r=t.find("."+this.erroredInputFieldClass)
t.find("."+this.validationMsgFieldClass).remove(),r.removeClass(this.erroredInputFieldClass),r.removeAttr("aria-describedby")},debounce:function(e,t){var a
return function(){var r=this,i=arguments
clearTimeout(a),a=setTimeout(function(){e.apply(r,i)},t)}},resetFormData:function(e){document.getElementById("velocify-lead-form-"+e).reset()}},a={formId:null,getVelocifyApiUrl:function(e){var t=this.formId,a=document.getElementById("clientId-"+t).value,r=document.getElementById("leadSourceId-"+t).value,i=document.getElementById("velocifyLeadImportUrl-"+t).value,n=i.replace(/:clientId/g,a)
return n=n.replace(/:campaignId/g,r)},getOwnerUrn:function(){var e=this.formId
return document.getElementById("ownerUrn-"+e).value||""},getSiteId:function(){var e=this.formId
return document.getElementById("siteId-"+e).value||""},setFormId:function(e){this.formId=e.id.split("form-")[1]},init:function(e){t.resetFormData(e),this.formId=e,t.removeOldErrors(),t.hasFormError=!1},getFormData:function(e){for(var a=e.querySelectorAll("input, select"),r={},i=0;i<a.length;++i){var n=a[i]
if("submit"!==n.type){var o=n.name,s=n.value,d=t.getFieldAttributeValue(n,"fieldUiType")
o&&!r.hasOwnProperty(o)&&(s&&(s=s.trim()),"radio"===n.type&&(s=t.getRadioInputValue(o)),r[o]={name:o,value:s,required:n.required,fieldUiType:d,id:n.id,maxValue:n.maxValue})}}return r},getApiRequestPayload:function(e){function t(t,a){var r,i="",n=e[t]&&e[t].value
switch("amount"===(e[t]&&e[t].fieldUiType)&&"."===n&&(n=null),t){case"95353705-6911-4aee-ae76-fe8c8dd84b63":r=n||"Single"
break
case"819a1713-f257-4bf1-80b5-1c3125fe1898":r=n||"false"
break
case"4493a094-e5f5-4998-bf8e-e8493495b13a":n=n?Number(n.replace(/[^0-9.-]+/g,"")):"",r=n?(parseFloat(n)/12).toFixed(2):null
break
case"1fece94d-4e48-4377-82fb-b68f416b8ac4":n&&(r="firstName"===a?n.split(" ")[0]:n.split(" ").slice(1).join(" "))
break
case"91636a33-fd0a-4267-86d8-22bdee022b6b":r=n?n.split("/")[2]:null
break
case"4b70d65e-bfb8-4769-a483-f2d33cc61af4":r=n?Math.round(parseInt(n)/12):null
break
default:i=e[t]}return(i?n:r||"")||null}return{RefId:null,BorrowerUUID:"Consultation Widget Borrower",Borrower:{FirstName:t("949210d0-879d-41b3-b513-ffb1cd42e539"),LastName:t("0c921ad9-caaf-46b3-9fba-ebbd8dbf22c3"),HomePhoneNumber:t("8785670f-9725-4030-a03b-c9880a79fdc6"),EmailAddressText:t("25de3e07-fac1-4481-a2b3-cdebe07fb81a"),BirthDate:t("0ea58d5e-0743-4f1d-9677-42febd462947"),TotalMonthlyIncomeAmount:t("4493a094-e5f5-4998-bf8e-e8493495b13a"),EstimatedCreditScore:t("70148bdb-fbd4-45ac-88c1-4b118f8d3936"),MaritalStatus:t("95353705-6911-4aee-ae76-fe8c8dd84b63"),BankruptcyIndicator:t("819a1713-f257-4bf1-80b5-1c3125fe1898")},CoBorrower:{FirstName:t("1fece94d-4e48-4377-82fb-b68f416b8ac4","firstName"),LastName:t("1fece94d-4e48-4377-82fb-b68f416b8ac4","lastName")},BorrowerEmploymentDetails:{EmployerName:t("fa0ec565-8fad-44e7-983e-4cffcc3a76d9"),Position:t("7d44dcd7-cc75-4c0e-a015-0e661c1914da")},BorrowerEmployerAddress:{City:t("154890f7-2ada-43a7-9dae-53cb30ae3e53"),State:t("4d253bc8-305f-47f2-b6c8-c49c81181566"),PostalCode:t("674fc02a-ede0-44c0-84cc-cd28317061eb"),StreetAddress:(t("425de166-98f9-4fb0-aa15-44647a610c06")||"")+" "+(t("c7b755b9-a3fb-442a-ba06-9a8a72e30838")||"")},ResidenceDetails:{MailingAddressIndicator:"true",AddressCity:t("f2f36afc-bbd6-4332-8442-9b4515f7f3d2"),AddressState:t("2b000dd7-d047-431e-b235-0c4410b74afa"),AddressPostalCode:t("a1de76d0-9bd9-4b19-9a0e-31920d7b97e5"),AddressStreetLine1:(t("a1f1840a-29f4-461c-851c-b2d33b2de6f8")||"")+" "+(t("fa00d13b-de87-456d-be5e-07dfc8a8cc70")||"")},Property:{City:t("75a6fbab-feb4-4fc2-9019-afef450a1ce5"),State:t("f2753c71-9665-4e22-aa0d-94880242cbb9"),PostalCode:t("ea17d9f6-efc1-47b2-8017-84782bc6d033"),StreetAddress:(t("a55da731-1516-4ec2-8f11-6d6afc094371")||"")+" "+(t("df5c84b6-d453-4792-a8a4-54d8b0736205")||""),LoanPurposeType:t("ee4c630d-1dbd-4945-9fee-07e20f008b87"),RefinancePropertyAcquiredYear:t("91636a33-fd0a-4267-86d8-22bdee022b6b")},HMDADetails:{PropertyType:t("684bbb7f-2ca2-4dbf-bca0-5434846ab08d"),LoanTerm:t("4b70d65e-bfb8-4769-a483-f2d33cc61af4"),PropertyValue:t("1909ecce-dd32-4026-828d-e11c571e89e0"),InterestRate:t("0d644aaa-f592-442a-8c0d-d6b8605fb0a0")},CurrentMortgage:{MortgageBalance:t("f552aeb9-27a7-45e3-875e-8f1a46421f26")},TotalAmounts:{TotalMortgagesMonthlyPaymentAmount:t("063a7924-a224-4d49-ba15-606e3cd06d3f")},LoanOfficerName:t("5e36c690-5034-4798-bec6-1e7977cacb0b"),PropertyUsageType:t("ec791258-b216-450f-a697-ae5a0a3d6522"),Amount:t("3f45552d-41be-428f-8e99-51c68a07fa16"),MortgageType:t("1178e0d5-ca04-498c-970a-477734ff4cfd"),BorrowerRequestedLoanAmount:t("9af064ac-ea53-465d-b6e1-b4af06d72c09")}},showBannerForError:function(){if(window.ConsumerConnectApps){window.ConsumerConnectApps.showBanner("warning","Something went wrong","There was an issue submitting your information. Please try again.")}},getToken:function(t){var a=this,r=document.getElementById("tokenApiUrl-"+this.formId).value,i=function(e){"function"==typeof t&&t(e)},n=["grant_type=client_credentials","scope="+encodeURIComponent("ccbp cc")]
return e.ajax({method:"POST",url:r,data:n.join("&"),headers:{Authorization:"Basic OHNyeXFkc3k6Rm1iVjh0YnNUVlZDZVlVVkdPa0g3empSQW9HRjM1Vnp1TFhDb2pvZlcySHg4RmJKempreUJWZDk2U3h1dzBoUA==","Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"},success:function(e){a.token=e.access_token,i(a.token)},error:function(){a.showBannerForError()}})},submitConsultationFormData:function(a){window.ConsumerConnectApps&&window.ConsumerConnectApps.hideBanner()
var r=this
try{this.getToken(function(i){var n=r.getApiRequestPayload(a),o=r.getVelocifyApiUrl(a)
e.ajax({method:"POST",url:o,data:JSON.stringify(n),contentType:"application/json",headers:{Authorization:"Bearer "+i},success:function(e,a,n){if(200===n.status){var o=e&&e.ImportResults&&e.ImportResults[0].ImportResult
if(o&&"Success"===o.result){t.resetFormData(r.formId),r.showThankYouSection(r.formId)
try{r.emitBeacon(i)}catch(e){console.log("!! Error triggering beacon:",e)}}else console.log("Lead generation api failed: ",e),r.showBannerForError()}else console.log("Lead generation api failed: ",e),r.showBannerForError()},error:function(e){console.log("Error : Lead generation api failed: ",e),r.showBannerForError()},complete:function(){r.enableSubmitButton()}})})}catch(e){console.log(e)}},showThankYouSection:function(e){this.showThankYouMessage(e),this.setFocusOnThankYouSection(e)},getThankYouMessageSection:function(e){return document.querySelector(".thank-you-page-container.form-"+e)},showThankYouMessage:function(e){this.getThankYouMessageSection(e).classList.remove("hide-section")},hideThankYouMessage:function(e){this.getThankYouMessageSection(e).classList.add("hide-section")},setFocusOnThankYouSection:function(e){var t=this.getThankYouMessageSection(e)
t=t.querySelector(".velocify-lead-thank-you-page-header"),t.focus()},isThankYouSectionVisible:function(e){return!this.getThankYouMessageSection(e).classList.contains("hide-section")},getCurrentForm:function(){return document.querySelector("#velocify-lead-form-"+this.formId)},toggleThankYouSection:function(e,t){var a=t.target&&t.target.tagName;("INPUT"===a||"SELECT"===a)&&this.isThankYouSectionVisible(e)&&this.hideThankYouMessage(e)},attachFormListenerAfterSubmit:function(){var e=this.getCurrentForm()
e.addEventListener("keypress",this.toggleThankYouSection.bind(this,this.formId)),e.addEventListener("change",this.toggleThankYouSection.bind(this,this.formId))},showConsultationForm:function(t){e(".thank-you-page-container.form-"+t).addClass("hide-section"),e(".form-container-"+t).removeClass("hide-section")},getSubmitButton:function(){return document.querySelector("#consultation-submit-btn-"+this.formId)},disableSubmitButton:function(){this.getSubmitButton().disabled=!0},enableSubmitButton:function(){this.getSubmitButton().disabled=!1},onFormSubmit:function(e,a){e.preventDefault()
var r=a?e.target:e.target.form
this.setFormId(r),t.removeOldErrors()
var i=this.getFormData(r)
if(t.validateFormData(i),t.focusErroredField(r),!t.hasFormError)return a?(t.resetFormData(this.formId),this.showThankYouSection(this.formId)):(this.disableSubmitButton(),this.submitConsultationFormData(i)),this.attachFormListenerAfterSubmit(),!1},emitBeacon:function(t){var a=this.getBeaconPayload(),r=this.getSiteId(),i=document.getElementById("beaconUrl-"+this.formId).value||""
if(!a||!i)return void console.log("Unable to trigger Beacon API due to endpoint url, site id or ownerUrn being unavailable.")
i=i.replace(/:siteId/g,r),e.ajax({method:"POST",url:i,data:JSON.stringify(a),contentType:"application/json",headers:{Authorization:"Bearer "+t},success:function(){},error:function(){}})},getBeaconPayload:function(){var e=this.getSiteId(),t=this.getOwnerUrn()
return e&&t?{originDate:(new Date).toISOString(),payload:{},source:t+":site:"+e,type:"CONSULTATION_FORM_SUBMITTED"}:""}}
return{onFormSubmit:t.debounce(function(e,t){a.onFormSubmit(e,t)},300),onFormInputKeyUp:function(e){t.onFormInputKeyUp(e)},onFormInputKeyDown:function(e){t.onFormInputKeyDown(e)},onFormInputChange:function(e){t.onFormInputChange(e)},showConsultationForm:function(e){a.init(e),a.showConsultationForm(e)}}}(jQuery)
