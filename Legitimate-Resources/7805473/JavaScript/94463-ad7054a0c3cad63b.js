(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[94463],{94463:function(e,n,t){"use strict";t.d(n,{C6:function(){return Y},jW:function(){return z}});var o=t(1997),i=t(57044),r=t(16946),u=t(99097),d=t(51726),c=t(57611),l=t(67597),a=t(72934),s=t(68721),v=t(72809),f=t(61395),m=t(15129),p=t(9134),_=t.n(p),h=t(30762),b=t(81987),w=t.n(b),y=t(69927),g=t.n(y),S=t(99968),C=t(57731),E=t(77521),Z=t(32689),I=t(84204),k=t(35169),R=t(81547),x=t(14635),T=t(83920),B=t(67935),N=t.n(B);function j(e){var n=window.sessionStorage.getItem(e)||0,t=Date.now();return Math.floor((t-n)/1e3)}var W=["REGISTER","LOGIN"],L=!1,D=!1,P="",H="",M="",F="",O=Date.now(),U={},V=0,G={mobile:"SMS",voice:"voice",email:"Email",mobile_email:"SMS, Email",voice_email:"voice, Email"},z=function(e,n,t){return t?D?G.voice:G[t]||G.mobile:n>2?G.email:D?(null===e||void 0===e?void 0:e.email)?(null===e||void 0===e?void 0:e.mobile)?G.voice_email:G.email:G.voice:(null===e||void 0===e?void 0:e.email)?(null===e||void 0===e?void 0:e.mobile)?G.mobile_email:G.email:G.mobile},A=["REGISTER"],X=function(e){var n=(null===e||void 0===e?void 0:e.email)||P,t=(null===e||void 0===e?void 0:e.country)||H,o=(null===e||void 0===e?void 0:e.mobile)||M,i=e.type||F,r={jira_id:"user-2543",member_id:window._getCookie("u_id")&&!A.includes(i)?sessionStorage.getItem(C.a):null,uc_device_id:window._getCookie(T.v4)||"",uc_client_ip:localStorage.getItem(R.o)||"",email:n?g()(n):null,country_number:t&&o?t:null,phone_number:o&&t?g()(o):null,service_type:i,code_type:e.sendType||z(U,V),is_success:void 0===e.is_success||e.is_success,fail_code:(null===e||void 0===e?void 0:e.fail_code)||500,fail_reason:void 0===e.fail_reason?null:e.fail_reason};return r.is_success?(0,E.omit)(r,"fail_code","fail_reason"):r},Y=function(e,n){if(L||n){var t=X(e),o=Date.now();(0,Z.Wr)("User_fillCode",(0,r.Z)((0,i.Z)({},t),{$event_duration:Math.ceil((o-O)/1e3)})),L=!1}};function $(e,n){var t=e.mobileCode,p=e.sendType,b=void 0===p?"email":p,y=e.needCaptcha,g=void 0!==y&&y,E=e.captchaParams,T=void 0===E?{}:E,B=e.sendParams,G=void 0===B?{}:B,A=e.beforeSendCheck,Y=e.countdownTimeLimit,$=void 0===Y?60:Y,J=e.autoSend,K=void 0!==J&&J,Q=e.buttonType,ee=void 0===Q?"text":Q,ne=e.captchaSendText,te=void 0===ne?"mc_common_captcha_send":ne,oe=e.buttonProps,ie=void 0===oe?{}:oe,re=e.sendResultCallback,ue=(0,f.Z)("common").t,de=(0,m.useRouter)().locale,ce=(0,h.aF)().user,le=(0,C.Z)(!0,ce).userInfo,ae=(0,x.Z)(),se=ae.securityInfo,ve=ae.securityLevel,fe=ae.originInfo,me=(0,l.useState)(!1),pe=me[0],_e=me[1],he=(0,l.useRef)(),be=(0,l.useState)(0),we=be[0],ye=be[1],ge=(0,l.useState)(),Se=ge[0],Ce=ge[1],Ee=(0,l.useRef)(),Ze=(0,l.useRef)(),Ie=function(e,n,t){var o=window._getCookie("u_id"),i=[e,n,null===t||void 0===t?void 0:t.type,o].filter((function(e){return void 0!==e}));return"mexc_captcha_".concat(e,"_").concat(w()(i.join("")).substring(8,24),"_timestamp")}(b,t,G),ke=(0,l.useState)(),Re=ke[0],xe=ke[1],Te=(0,u.Z)((0,I.my)({actions:{setData:Ce,onFail:W.includes(null===G||void 0===G?void 0:G.type)?function(){}:void 0},language:de,params:T,needCaptcha:g}),4),Be=Te[0],Ne=Te[1],je=Te[2],We=Te[3],Le=(0,R.Z)().data,De=(0,S.ZP)(["/api/platform/country",void 0],(function(e){return(0,v.WY)(e)}),{revalidateOnFocus:!1}),Pe=De.data,He=(De.error,(0,l.useMemo)((function(){var e=t||(null===le||void 0===le?void 0:le.country);if(e&&Pe){var n,o=null===Pe||void 0===Pe||null===(n=Pe.data)||void 0===n?void 0:n.find((function(n){return Number(n.mobileCode)===Number(e)}));return 1===(null===o||void 0===o?void 0:o.enableVoice)}return!1}),[t,Pe,le])),Me=(0,l.useState)(!1),Fe=Me[0],Oe=Me[1],Ue=function(e){var n=e||$;ye(n),he.current=setInterval((function(){n<=0||(--n<=0&&(clearInterval(he.current),he.current=null),ye(n))}),1e3)},Ve=function(){var e=(0,o.Z)((function(e){var n,t,o,u;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:if(!G||!G.type||we&&we>0||pe||ie.disabled)return[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,A()];case 2:return n=d.sent(),[3,4];case 3:return d.sent(),n=!1,[3,4];case 4:if("function"===typeof A&&!n)return[2];if(t={},g){if(Oe(e),!Se)return window.sessionStorage.setItem(k.Gm,JSON.stringify({country_number:(null===G||void 0===G?void 0:G.country)||(null===le||void 0===le?void 0:le.country),phone_number:(null===G||void 0===G?void 0:G.mobile)||(null===fe||void 0===fe?void 0:fe.mobile),email:(null===G||void 0===G?void 0:G.email)||(null===fe||void 0===fe?void 0:fe.email)})),null===Be||void 0===Be||null===(o=Be.showCaptcha)||void 0===o||o.call(Be),[2];t={"captcha-token":Se}}return xe(Date.now()),D=Boolean(g&&Fe||e),P=(null===fe||void 0===fe?void 0:fe.email)||null,H=(null===le||void 0===le?void 0:le.country)||null,M=(null===fe||void 0===fe?void 0:fe.mobile)||null,F=null===G||void 0===G?void 0:G.type,U=se,V=ve,(null===Le||void 0===Le?void 0:Le.ip)?null===Le||void 0===Le?void 0:Le.ip:"\u672a\u83b7\u53d6\u5230ip",function(e){var n=X(e);O=Date.now(),(0,Z.Wr)("User_requireCode",(0,i.Z)({},n)),L=!0}((0,i.Z)({sendType:z(U,V,b),email:P,country:H,mobile:M,type:F},G)),"email"!==b?[3,6]:(_e(!0),[4,(0,v.VV)(G,t)]);case 5:u=d.sent(),d.label=6;case 6:return"mobile"!==b?[3,10]:(_e(!0),g&&Fe||e?[4,(0,v.Q4)((0,r.Z)((0,i.Z)({},G),{country:(null===G||void 0===G?void 0:G.country)||void 0}),t)]:[3,8]);case 7:return u=d.sent(),[3,10];case 8:return[4,(0,v.A$)((0,r.Z)((0,i.Z)({},G),{country:(null===G||void 0===G?void 0:G.country)||void 0}),t)];case 9:u=d.sent(),d.label=10;case 10:return W.includes(null===G||void 0===G?void 0:G.type),null===re||void 0===re||re(u),u&&0===u.code?(s.yw.success(ue("mc_common_captcha_send_success"),2),window.sessionStorage.setItem(Ie,Date.now()),setTimeout((function(){Ue()}),300)):je&&Ne(),setTimeout((function(){_e(!1)}),300),g&&Ce(null),[2]}}))}));return function(n){return e.apply(this,arguments)}}(),Ge=function(){Ze.current&&(document.body.removeChild(Ze.current),a.unmountComponentAtNode(Ze.current),Ze.current=null)},ze=function(){var e=(0,o.Z)((function(){var e;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:if(!G||!G.type||we&&we>0||pe||ie.disabled)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,A()];case 2:return e=n.sent(),[3,4];case 3:return n.sent(),e=!1,[3,4];case 4:return"function"!==typeof A||e?"mobile"===b&&He&&j(Ie)<300?(function(){if(!Ze.current){var e=document.createElement("div");document.body.appendChild(e),Ze.current=e,setTimeout((function(){a.render((0,c.jsx)(q,{t:ue,dropdownButtonRef:Ee,isEnableVoice:He,sendHandle:Ve,destroy:Ge}),e)}),0)}}(),[2]):(Ve(),[2]):[2]}}))}));return function(){return e.apply(this,arguments)}}(),Ae=function(){var e=j(Ie);e<$&&Ue($-e),K&&e>$&&ze()};return(0,l.useEffect)((function(){return g?(We||je)&&("mobile"===b?void 0!==He&&Ae():Ae()):"mobile"===b?void 0!==He&&Ae():Ae(),function(){Ge(),he.current&&(clearInterval(he.current),he.current=null,ye(0))}}),[de,He,We,null===G||void 0===G?void 0:G.type,je,t]),(0,l.useEffect)((function(){Se&&Ve()}),[Se]),(0,l.useImperativeHandle)(n,(function(){return{send:function(){return ze()},sendTimestamp:Re}})),(0,c.jsx)("div",{ref:Ee,children:"button"===ee?(0,c.jsx)(s.zx,(0,r.Z)((0,i.Z)({style:{minWidth:88},type:"primary",ghost:!0},ie),{disabled:pe||ie.disabled,onClick:ze,className:_()(null===ie||void 0===ie?void 0:ie.className,we&&"sending-verification-code"),children:we?"".concat(we,"s"):ue(te)})):(0,c.jsx)("span",(0,r.Z)((0,i.Z)({},ie),{className:_()("text"===ee&&N().textButton,"link"!==ee||we?N().textButton:N().linkButton,(pe||ie.disabled)&&N().disabled,ie.className,we&&"sending-verification-code"),onClick:ze,children:we?"".concat(we,"s"):ue(te)}))})}function q(e){var n=e.t,t=e.dropdownButtonRef,o=e.isEnableVoice,i=e.sendHandle,r=e.destroy,u=(0,l.useState)({}),d=u[0],a=u[1],s=(0,l.useState)(!1),v=s[0],f=s[1],m=(0,l.useState)(!1),p=m[0],h=m[1],b=(0,l.useRef)();(0,l.useEffect)((function(){var e=function(e){!b.current.contains(e.target)&&v&&(h(!0),setTimeout((function(){r()}),300))};return document.addEventListener("click",e),function(){return document.removeEventListener("click",e)}}),[v]);var w=(0,E.throttle)((function(){var e=t.current.getBoundingClientRect(),n=b.current.getBoundingClientRect();n.width+e.left>document.body.getBoundingClientRect().width?a({top:Math.ceil(e.top+e.height),left:document.body.getBoundingClientRect().width-n.width,minWidth:e.width}):a({top:Math.ceil(e.top+e.height),left:e.left-(n.width-e.width)/2,minWidth:e.width}),f(!0)}),500);(0,l.useLayoutEffect)((function(){return w(),window.addEventListener("resize",w),function(){return window.removeEventListener("resize",w)}}),[]);var y=function(e){h(!0),setTimeout((function(){r()}),300),i(e)};return(0,c.jsxs)("div",{className:_()(N().dropdownWrapper,v&&N().dropdownShow,p&&N().dropdownHide),style:d,ref:b,children:[(0,c.jsx)("div",{className:N().dropdownItem,onClick:function(){return y()},children:n("common:mc_common_captcha_sms")}),o&&(0,c.jsx)("div",{className:N().dropdownItem,onClick:function(){return y(!0)},children:n("common:mc_common_captcha_voice")})]})}n.ZP=(0,l.forwardRef)($)},14635:function(e,n,t){"use strict";t.d(n,{Z:function(){return d}});var o=t(67597),i=t(72809),r=t(99968),u=t(57731);function d(){var e=(0,u.Z)().userInfo,n=(0,r.ZP)("".concat((null===e||void 0===e?void 0:e.memberId)?"/ucenter/api/secure/check":""),i.P1),t=n.data,d=n.error,c=n.mutate,l=(0,r.ZP)("".concat((null===e||void 0===e?void 0:e.memberId)?"/ucenter/api/origin_info":""),i.UE).data,a=(0,o.useState)(),s=a[0],v=a[1],f=(0,o.useState)(),m=f[0],p=f[1],_=(0,o.useState)(),h=_[0],b=_[1];return(0,o.useEffect)((function(){if(t&&0===t.code){var e=t.data||{},n=Object.keys(e).filter((function(e){return t.data[e]})).length;v(n),p(e)}}),[t]),(0,o.useEffect)((function(){0===(null===l||void 0===l?void 0:l.code)&&b(l.data)}),[l]),{loading:void 0===d&&void 0===t,securityLevel:s,securityInfo:m,originInfo:h,mutate:c}}},67935:function(e){e.exports={textButton:"send-verification-code_textButton__ZWEEH",disabled:"send-verification-code_disabled__gTTft",linkButton:"send-verification-code_linkButton__9FR98",dropdownWrapper:"send-verification-code_dropdownWrapper__l5OXX",dropdownShow:"send-verification-code_dropdownShow__uFeDU",dropdownHide:"send-verification-code_dropdownHide__4eUdE",dropdownItem:"send-verification-code_dropdownItem__YebrK"}}}]);