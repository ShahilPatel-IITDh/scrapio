goteo.trace=function(){try{goteo.debug&&console.log([].slice.apply(arguments))}catch(t){}},goteo.error=function(){try{goteo.debug&&console.error([].slice.apply(arguments))}catch(t){}};var transitionDeferred,prontoTarget="#main-content",prontoScroll="#main-content";function getTransitionOutDeferred(){return transitionDeferred&&(goteo.trace("rejecting current transition"),transitionDeferred.reject()),transitionDeferred=$.Deferred(),$(prontoTarget).addClass("pronto-loading"),$(prontoTarget).contents("*").length?$(prontoTarget).contents("*").animate({opacity:0},200,function(){transitionDeferred.resolve()}):transitionDeferred.resolve(),transitionDeferred}function pageRequested(t){goteo.trace("Request new page",t,"prontoTarget:",prontoTarget)}function pageLoadProgress(t,o){goteo.trace("New page load progress",o,t,"prontoTarget:",prontoTarget)}function pageLoaded(t){goteo.trace("Destroy old page",t,"prontoTarget:",prontoTarget)}function prontoLoad(t,o){prontoScroll=prontoTarget=o=o||"#main-content",$.pronto("defaults",{target:{title:"title",content:prontoTarget}}),$.pronto("load",t)}function pageRendered(t){void 0!==t&&(goteo.trace("Render new page",t,"prontoTarget:",prontoTarget),$(prontoTarget).contents("*").length?$(prontoTarget).contents("*").animate({opacity:1},200,function(){$(prontoTarget).removeClass("pronto-loading")}):$(prontoTarget).removeClass("pronto-loading"),$("html, body").scrollTop()>$(prontoScroll).offset().top&&$("html, body").animate({scrollTop:$(prontoScroll).offset().top},800))}function pageLoadError(t,o){goteo.error("Error loading page",o),$(prontoTarget).html('<div class="alert alert-danger" style="margin: 1em;">'+goteo.texts["ajax-load-error"].replace("%ERROR%",o)+"</div>"),$(prontoTarget).removeClass("pronto-loading")}$(function(){$(window).on("pronto.request",pageRequested).on("pronto.progress",pageLoadProgress).on("pronto.load",pageLoaded).on("pronto.render",pageRendered).on("pronto.error",pageLoadError),$("#main").on("click","a.pronto",function(t){$(this).data("pronto-target")?prontoTarget=$(this).data("pronto-target"):"#main-content"!==prontoTarget&&(prontoTarget="#main-content"),$(this).data("pronto-scroll-to")?prontoScroll=$(this).data("pronto-scroll-to"):prontoScroll!==prontoTarget&&(prontoScroll=prontoTarget),goteo.trace("pronto click",$(this).data("pronto-target"),prontoTarget,$(this).data("pronto-scroll-to"),prontoScroll),$.pronto("defaults",{target:{title:"title",content:prontoTarget}})}),$.pronto({selector:"a.pronto",transitionOut:getTransitionOutDeferred,jump:!1,target:{title:"title",content:prontoTarget}}),pageRendered(),$("table.footable").length&&$("table.footable").footable()});var animationEnd="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";function whichTransitionEvent(){var t,o=document.createElement("fakeelement"),e={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in e)if(void 0!==o.style[t])return e[t]}$.fn.extend({animateCss:function(t,o){return this.off(),this.addClass("animated "+t).on(animationEnd,function(){$(this).removeClass("animated "+t),$.isFunction(o)&&o.call(this),$(this).off()}),this}}),function(p){function i(t,o){var e=t<0?"-":"",a=isNaN(Math.abs(o.rest))?2:o.rest,n=void 0===o.decimal?".":o.decimal,o=void 0===o.thousand?",":o.thousand,r=String(parseInt(t=Math.abs(Number(t)||0).toFixed(a))),i=3<(i=r.length)?i%3:0;return e+(i?r.substr(0,i)+o:"")+r.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+o)+(a?n+Math.abs(t-r).toFixed(a).slice(2):"")}function g(t,o,e,a){a=a||0;var n=e&&e.prefix||"",r=e&&e.suffix||"";t.html(n+i(a,e)+r),a<o?setTimeout(function(){g(t,o,e,a+o/e.steps)},e.velocity):t.html(n+i(o,e)+r)}p.fn.extend({animateNumber:function(l){return this.each(function(){var n=p.extend({decimal:".",thousand:",",rest:"auto",steps:50,velocity:100,suffix:null,prefix:null,start:"onViewport"},l),r=p(this),o=r.html();null===n.prefix&&(n.prefix=o.match(/^[^0-9\.\,]*/),n.prefix=n.prefix?n.prefix.join(""):"");var e,a,i,s=(s=o.match(/[0-9\.\,]+/))?s.join(""):"",c=("auto"===n.rest&&(e=(""+s).split(n.decimal),n.rest=1<e.length?e[1].length:0),null===n.suffix&&(n.suffix=o.match(/[^0-9\.\,]*$/),n.suffix=n.suffix?n.suffix.join(""):""),e=s,d=void 0===(o=n).decimal?".":o.decimal,t=void 0===o.thousand?",":o.thousand,o=new RegExp("\\"+t,"g"),a=new RegExp("\\"+d,"g"),s=+e.replace(o,"").replace(a,"."),!1);"onViewport"===n.start?(i=function(){var t,o,e,a;!c&&(t=(o=(t=r).offset().top)+t.outerHeight(),e=p(window).scrollTop(),a=e+p(window).height(),e<t&&o<a)&&(c=!0,g(r,s,n),p(window).off("resize scroll",i))},p(window).on("resize scroll",i),i()):(c=!0,g(r,s,n))}),this}})}(jQuery),$(function(){function l(t){t&&(t.stopPropagation(),t.preventDefault());var o=$(this),t=o.data("target"),e=$('.toggle-menu[data-target="'+t+'"]'),a=$("#"+t),n=o.find(".show-menu"),r=o.find(".close-menu"),i="absolute"===a.css("position"),s=(!i&&r.length&&o.addClass("active"),"slideInRight"),c="slideOutRight";i&&(s="foldInUp",c="foldOutUp"),$('.top-menu.active:not([id="'+t+'"])').removeClass("active"),e.each(function(){$(this)[0]!==o[0]&&$(this).removeClass("active")}),$("#main-content").off(),a.hasClass("active")?(i&&r.animateCss("flipOutX",function(){o.removeClass("active"),n.animateCss("flipInX")}),a.animateCss(c,function(){a.removeClass("active"),a.find(".submenu.active").removeClass("active")})):(i&&n.animateCss("flipOutX",function(){o.addClass("active"),r.animateCss("flipInX")}),a.addClass("active").animateCss(s,function(){$("#main-content").on("click",function(t){l.call(o[0],t),$(this).off()})}))}function n(t){t.stopPropagation(),t.preventDefault();var o=this,e=$(this).next(".submenu"),t="slideInRight",a="slideOutRight";"absolute"===e.css("position")&&(t="foldInUp",a="foldOutUp"),$(".top-menu.active").find(".submenu.active").not(e).removeClass("active"),e.hasClass("active")?e.animateCss(a,function(){e.removeClass("active")}):(e.find("li a.back").on("click",function(t){n.call(o,t)}),e.addClass("active").animateCss(t))}$(".toggle-menu").on("click",l),$(".top-menu .toggle-submenu").on("click",n),$(".top-menu li > a:not(.toggle-submenu)").on("click",function(){l.call($(".navbar-always .toggle-menu.active")[0])}),$('a[href="#search"], a.global-search').on("click",function(t){t.preventDefault(),$("#search").addClass("open"),$('#search > form > input[type="search"]').focus()}),$("#search, #search button.close").on("click keyup",function(t){t.target!==this&&"close"!==t.target.className&&27!==t.keyCode||$(this).removeClass("open")}),$('a.scroller[href^="#"]').on("click",function(t){t.preventDefault();var t=0,o=this.hash,t=$(o).offset().top>$(document).height()-$(window).height()?$(document).height()-$(window).height():$(o).offset().top;$("html,body").animate({scrollTop:t},800,"swing",function(){window.location.hash=o})})});var transitionEnd=whichTransitionEvent(),locator=($(function(){$(window);function t(){return"absolute"===n.css("position")||"fixed"===n.css("position")}function o(){a.hasClass("has-sidebar")&&(a.hasClass("sidebar-opened")?(n.animateCss("fadeOut"),i.css("opacity",0),r.animateCss("slideOutLeft",function(){i.css({opacity:1}),a.removeClass("sidebar-opened")})):(a.addClass("sidebar-opened"),n.animateCss("fadeIn"),i.css("opacity",0),r.animateCss("slideInLeft",function(){i.css({opacity:1})})))}var e,a=$("body"),n=$("#sidebar-menu"),r=$("#sidebar-menu .sidebar-wrap"),i=$("#sidebar-menu-toggle");$("#main"),$("#footer"),setTimeout(function(){a.addClass("loaded")},500);$("body.has-sidebar").on("click",".toggle-sidebar",o),a.hasClass("has-sidebar")&&(delete Hammer.defaults.cssProps.userSelect,e=!1,a.on("mouseover",".slider,.material-switch",function(){e=!0}),a.on("mouseout",".slider,.material-switch",function(){e=!1}),a.on("touchstart",".slider,.material-switch",function(t){e=!0}),a.on("touchend",".slider,.material-switch",function(){setTimeout(function(){e=!1})}),a.hammer().bind("swiperight",function(){e||!t()||a.hasClass("sidebar-opened")||o()}),a.hammer().bind("swipeleft",function(){e||t()&&a.hasClass("sidebar-opened")&&o()}),$("#sidebar-menu .toggle-submenu").on("click",function(t){t.stopPropagation(),t.preventDefault();var o=$(this).closest("li"),t=$(this).next(".submenu"),e=n.find("li.active .submenu").not(t);e.slideUp(function(){e.closest("li.active").removeClass("active")}),o.hasClass("active")?t.slideUp(function(){o.removeClass("active")}):(o.addClass("active"),t.hide().slideDown())}),$("#sidebar-menu li > a[href^='#']:not(.toggle-submenu)").on("click",function(t){o()}),i.affix&&i.affix({offset:{top:parseInt(i.css("top"),10)}}))}),$(function(){$("body").on("click",".flip-widget .flip",function(t){t.stopPropagation(),t.preventDefault();var t=$(this),o=($widget=$(this).closest(".flip-widget"),"flipOutY");($target=$(t.attr("href"))).hasClass("active")?$target.animateCss(o,function(){$target.removeClass("active")}):($(".flip-widget .backside.active").animateCss(o,function(t){$(this).removeClass("active")}),$target.addClass("active").animateCss("flipInY"))})}),{trace:goteo.trace,map:null,autocomplete:null});locator.getUserLocation=function(e){"function"!=typeof e&&(e=function(){}),goteo.user_location?(locator.trace("Location already defined",goteo.user_location),e(goteo.user_location)):(locator.trace("getting location from ip"),locator.setLocationFromGeoip("user",null,function(t,o){locator.trace("Location from /api/geoloc/ip",t),t?(goteo.user_location=t,e(t)):e(null,o)}))},locator.saveGeolocationData=function(t,o,e){this.trace("Saving geolocation data, type:",t," item:",o," data:",e),$.post("/api/geoloc/locate/"+t+(o?"/"+o:""),e,function(t){locator.trace("Saved gelocation data result:",t)})},locator.setLocationFromGeoip=function(o,e,a){locator.trace("contact /api/geoloc/ip"),$.getJSON("/api/geoloc/ip",function(t){console.log(t),t.latitude&&t.longitude?(locator.trace("Geoip geolocated type:",o," item:",e," data:",t),locator.saveGeolocationData(o,e,{longitude:t.longitude,latitude:t.latitude,city:t.city_name,region:t.region_name,country:t.country_name,country_code:t.country_code,method:"ip"}),"function"==typeof a&&a(t)):(locator.trace("Geoip error"),"function"==typeof a&&a(null,"Geoip error"))})},locator.getLocationFromBrowser=function(a,t){var n=!1,r={};if("undefined"==typeof google&&!google.maps)return t=t||0,t++,this.trace("google.map client does not exists! ["+t+"]"),10<t&&this.trace("Cancelled"),void setTimeout(function(){this.getLocationFromBrowser(a,t)},500);navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){locator.trace("browser info:",t.coords.latitude,t.coords.longitude),r={method:"browser",latitude:t.coords.latitude,longitude:t.coords.longitude},(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(t.coords.latitude,t.coords.longitude)},function(t,o){if(o===google.maps.GeocoderStatus.OK)if(t[0]){for(var e in n=!0,t[0].address_components){e=t[0].address_components[e];"country"===e.types[0]&&"political"===e.types[1]&&(r.country=e.long_name,r.country_code=e.short_name),"locality"===e.types[0]&&"political"===e.types[1]&&(r.city=e.long_name),"administrative_area_level_1"!==e.types[0]&&"administrative_area_level_2"!==e.types[0]||"political"!==e.types[1]||(r.region=e.long_name)}locator.trace("Geocoder data:",r)}else locator.trace("Geocoder failed due to: "+o);"function"==typeof a&&a(n,r)})},function(t){switch(r={locable:1,info:""},t.code){case t.PERMISSION_DENIED:r.locable=0,r.info="User denied the request for Geolocation.";break;case t.POSITION_UNAVAILABLE:r.info="Location information is unavailable.";break;case t.TIMEOUT:r.info="The request to get user location timed out.";break;case t.UNKNOWN_ERROR:r.info="An unknown error occurred."}locator.trace("Geocoder error:",t," data:",r),"function"==typeof a&&a(n,r)})},locator.setLocationFromBrowser=function(e,a,n){this.getLocationFromBrowser(function(t,o){locator.trace("Browser geolocation result:",t,o),t?locator.saveGeolocationData(e,a,o):"function"==typeof n&&n(e,a)})},locator.geoCode=function(e,a,n){(new google.maps.Geocoder).geocode(e,function(t,o){o===google.maps.GeocoderStatus.OK?(locator.trace("Got coordinates for",e,t[0].geometry.location),locator.map.setCenter(t[0].geometry.location),locator.marker.setPosition(t[0].geometry.location),locator.map.setZoom(12),a&&a(t[0])):(locator.trace("No address found for",e),n&&n())})},locator.setGoogleMapPoint=function(e,t){if("undefined"==typeof google||!google.maps)return t=t||0,t++,this.trace("google.maps client does not exists! ["+t+"]"),10<t&&this.trace("Cancelled"),void setTimeout(function(){this.setGoogleMapPoint(e,t)},500);var o,a=(a=$(e).attr("id"))||"map",n=$(e).data("autocomplete-target"),r=$($(e).data("autocomplete-error")).hide(),i=$($(e).data("autocomplete-success")).hide(),s={center:new google.maps.LatLng(39.5858,2.6411),zoom:5,mapTypeId:google.maps.MapTypeId.ROADMAP};if(this.map=new google.maps.Map(e,s),this.marker=new google.maps.Marker({map:this.map,draggable:!0,animation:google.maps.Animation.DROP}),google.maps.event.addListener(this.marker,"dragstart",function(){locator.trace("drag start"),r.hide(),i.hide()}),google.maps.event.addListener(this.marker,"dragend",function(){locator.trace("dragged marker",locator.marker.getPosition()),locator.geoCode({latLng:locator.marker.getPosition()},function(t){locator.trace("triggering changePlace after dragend",n),n&&($(n).val(t.formatted_address),locator.changePlace(n,t),i.show())},function(){r.show()})}),this.markers=[],$(e).data("map-coords")){var c=$(e).data("map-coords");if($.isArray(c)){var l,d,p,g=new google.maps.LatLngBounds,u=new google.maps.Geocoder;for(l in c)c[l].lat&&c[l].lng?(d=new google.maps.Marker,p=new google.maps.LatLng(c[l].lat,c[l].lng),d.setMap(this.map),d.setPosition(p),g.extend(p),c[l].title&&d.setTitle(c[l].title),this.markers[this.markers.length]=d):c[l].address&&u.geocode({address:c[l].address},function(t,o){o===google.maps.GeocoderStatus.OK&&(o=new google.maps.Marker,t=t[0].geometry.location,o.setMap(locator.map),o.setPosition(t),g.extend(t),c[l].title&&o.setTitle(c[l].title),locator.markers[locator.markers.length]=o)});this.map.fitBounds(g)}}$(e).data("map-content")&&(o=$(e).data("map-content"),this.marker=new google.maps.InfoWindow,this.marker.setContent(o),this.marker.setPosition(s.center),this.marker.open(this.map),this.circle||(this.circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map,center:s.center,radius:0})),google.maps.event.addListener(this.map,"zoom_changed",function(){locator.marker.setContent(o),locator.marker.open(locator.map)}));var m=parseFloat($(e).data("map-latitude"))||0,f=parseFloat($(e).data("map-longitude"))||0,s=parseInt($(e).data("map-radius"),10)||0,h=$(e).data("map-address");m&&f?(this.trace("Found printable geomap, map_id: ",a," lat,lng: ",m,f," radius;",s," content",$(e).data("map-content")),m&&f&&(a=new google.maps.LatLng(m,f),this.marker.setPosition(a),this.map.setCenter(a),this.map.setZoom(12))):h&&locator.geoCode({address:h},function(t){m=t.geometry.location.lat(),f=t.geometry.location.lng();var o=locator.getGoogleAddressFromAutocomplete(t);locator.trace("changePlace",$(e)),$(e).data("geocoder-type")&&locator.saveGeolocationData($(e).data("geocoder-type"),$(e).data("geocoder-item")?$(e).data("geocoder-item"):"",o),locator.trace("triggering changePlace",n),n&&locator.changePlace(n,t)}),s&&m&&f&&(this.circle=new google.maps.Circle({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:this.map,center:new google.maps.LatLng(m,f),radius:1e3*s}))},locator.getGoogleAddressFromAutocomplete=function(t){if(t){if(this.trace("Geocoder by place, place object:",t),t&&t.geometry&&t.address_components){var o,e={latitude:t.geometry.location.lat(),longitude:t.geometry.location.lng(),method:"manual",formatted_address:t.formatted_address};for(o in t.address_components){var a=t.address_components[o];"country"===a.types[0]&&"political"===a.types[1]&&(e.country=a.long_name,e.country_code=a.short_name),"route"===a.types[0]&&(e.route=a.long_name),"street_number"===a.types[0]&&(e.number=a.long_name),"locality"===a.types[0]&&"political"===a.types[1]&&(e.city=a.long_name),"postal_code"===a.types[0]&&(e.zipcode=a.long_name),"administrative_area_level_1"!==a.types[0]||"political"!==a.types[1]||e.region||(e.region=a.long_name),"administrative_area_level_2"===a.types[0]&&"political"===a.types[1]&&(e.region=a.long_name)}return e.route&&(e.address=e.route),e.number&&e.route&&(e.address=e.route+", "+e.number),this.trace("location data:",e),e}return[]}this.trace("Geocoder error in getGoogleAddressFromplace, place not present")},locator.changePlace=function(t,o){var e=locator.getGoogleAddressFromAutocomplete(o);if(e){locator.trace("Populating new place:",o,"data:",e,"id:",t,"save:",$(t).data("geocoder-type")),$(t).data("geocoder-type")&&locator.saveGeolocationData($(t).data("geocoder-type"),$(t).data("geocoder-item")?$(t).data("geocoder-item"):"",e);var a,n=["address","city","region","zipcode","country_code","country","latitude","longitude","formatted_address","radius"];if($(t).data("geocoder-skip-population")){var r=$($(t).data("geocoder-populate-latitude")),i=$($(t).data("geocoder-populate-longitude")),r=r.is(":input")?r.val():r.text(),i=i.is(":input")?i.val():i.text();if(r&&i)return void locator.trace("Skipping population. Already populated to",r,i)}for(a in n){var s,c=n[a],l=$(t).data("geocoder-populate-"+c);locator.trace("populate element",t,l,$(l).val()),l&&(s=$(l).text(),$(l).is(":input")&&(s=$(l).val()),locator.trace(l+": "+c+"["+e[c]+"] / "+s),e[c]&&($(l).is(":input")?$(l).val(e[c]):$(l).text(e[c])))}if(locator.map&&locator.marker&&(locator.map.setCenter(o.geometry.location),locator.marker.setPosition(o.geometry.location),locator.circle&&locator.circle.setCenter(o.geometry.location),e.formatted_address))try{locator.marker.setContent(e.formatted_address)}catch(t){}}else locator.trace("No data to populate for place",o)},locator.setGoogleAutocomplete=function(t,o){if("undefined"==typeof google||!google.maps||!google.maps.places)return o=o||0,o++,this.trace("google.maps.places client does not exists! ["+o+"]"),10<o&&this.trace("Cancelled"),void setTimeout(function(){this.setGoogleAutocomplete(t,o)},500);var e={};$(t).data("geocoder-filter")&&(e.types=[$(t).data("geocoder-filter")]),this.autocomplete||(this.autocomplete=[]),this.autocomplete[t]||(this.trace("Setting autocomplete for id: ",t," name: ",$(t).attr("name")," element: ",$(t)[0]),this.autocomplete[t]=new google.maps.places.Autocomplete($(t)[0],e),google.maps.event.addListener(this.autocomplete[t],"place_changed",function(){locator.changePlace(t,locator.autocomplete[t].getPlace())}))},$(function(){locator.getUserLocation(),$(".geo-map").each(function(){locator.setGoogleMapPoint(this)}),$("input.geo-autocomplete").each(function(){$(this).is("[id]")?locator.setGoogleAutocomplete("#"+$(this).attr("id")):locator.trace("Missing ID html element for input:",this),$(this).closest("li.element").bind("superform.dom.done",function(t,o,e){locator.trace("dom update",e),$(e).find("input.geo-autocomplete").each(function(){locator.setGoogleAutocomplete("#"+$(this).attr("id"))})})}),$("input.geo-autocomplete-radius").change(function(){var t;locator.map&&locator.circle&&(locator.circle.setRadius(1e3*$(this).val()),t=$(this).data("geocoder-populate-radius"),locator.trace("set radius",t,$(this).val()),t&&$(t).val($(this).val()))})});