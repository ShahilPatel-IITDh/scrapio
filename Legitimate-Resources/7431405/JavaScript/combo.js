function loadingPesqCoop(key,msg){if(key)AUI().one(".loading-pesq-coop").show();else AUI().one(".loading-pesq-coop").hide()}
function escolherCidade(elemento){if(elemento.value!=""){AUI().one("#cidade").show();AUI().one("#cidade").html(`\x3coption value\x3d""\x3eCidade\x3c/option\x3e`+AUI().Array.map(cidades,function(a){if(a.uf==elemento.value)return`\x3coption value\x3d"${a.idCidade}" ${a.idCidade==cidade?"selected":""}\x3e${a.nomeCidade}\x3c/option\x3e`}).join(""))}else AUI().one("#cidade").hide()}
function limparCidades(){if(AUI().one("#uf")._node.value!=""){AUI().one("#uf")._node.value="";escolherCidade(AUI().one("#uf")._node)}}function limparNomeCooperativa(){if(AUI().one("#coop-number")._node.value!="")AUI().one("#coop-number")._node.value=""}function formSubmit(elemento){loadingPesqCoop(true);if(elemento.value!="")AUI().one("#form-pesq-coop")._node.submit()}
function renderCoops(coops){return AUI().Array.map(coops.unidades,function(e,index){if(e!=null&&Object.keys(e).length!=0)return`\x3cdiv class\x3d"card coop-data refined-search col-md-12"\x3e\n                        \x3cdiv class\x3d"card-body"\x3e\n                            \x3cdiv class\x3d"row"\x3e\n                                \x3cdiv class\x3d"col-md"\x3e\n                                    \x3ch5 class\x3d"card-title"\x3e${e.numeroCooperativa} - ${e.sigla}\x3c/h5\x3e\n                                    \x3ch6 class\x3d"card-subtitle mb-2 text-muted"\x3e${e.nome}\x3c/h6\x3e\n                                    \x3cp class\x3d"card-text"\x3e${e.tipoUnidade=="PAC"?
`PA: ${e.numPac}`:`${e.tipoUnidade}`}\x3c/p\x3e\n                                    \x3cp class\x3d"card-text"\x3e\n                                        ${e.endereco?`${e.endereco}, `:``}                                        \n                                        ${e.numero?`${e.numero}, `:``}\n                                        ${e.complemento?`${e.complemento}, `:``}\n                                        ${e.bairro?`${e.bairro}, `:``}\n                                        ${e.cidade?
`${e.cidade}, `:``}\n                                        ${e.cep?`${e.cep}`:``}\n                                    \x3c/p\x3e\n                                    \x3cp class\x3d"card-text"\x3eTel:${AUI().Array.map(e.telefones,function(a,b){return e.telefones.length==b+1?` ${a}`:` ${a}, `}).join("")}\x3c/p\x3e\n                                    \x3cp class\x3d"card-text"\x3eE-mail: \x3ca href\x3d"mailto:${e.email}"\x3e${e.email}\x3c/a\x3e\x3c/p\x3e\n                                \x3c/div\x3e\n                                \x3cdiv class\x3d"col-md-3 mapa"\x3e\n                                    \x3ca href\x3d"javascript:void(0);" class\x3d"card-link showMaplink"\n\t\t\t\t\t\t\t\t\t\tdata-index-map\x3d"${index}"\n\t\t\t\t\t\t\t\t\t\tdata-numero-cooperativa\x3d"${e.numeroCooperativa}" \n\t\t\t\t\t\t\t\t\t\tdata-numero-pac\x3d"${e.numPac}" \n\t\t\t\t\t\t\t\t\t\tdata-url\x3d"${urlAtms}"\n\t\t\t\t\t\t\t\t\t\tdata-coop-lat\x3d"${e.latitude}" \n\t\t\t\t\t\t\t\t\t\tdata-coop-long\x3d"${e.longitude}"\n\t\t\t\t\t\t\t\t\t\tdata-coop-end\x3d"\n\t                                        ${e.endereco?
`${e.endereco}, `:``}\n\t                                        ${e.complemento?`${e.complemento}, `:``}\n\t                                        ${e.bairro?`${e.bairro}, `:``}\n\t                                        ${e.cidade?`${e.cidade}, `:``}\n\t                                        ${e.cep?`${e.cep}`:``}\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\t\t"                                   \t\n                                    \x3e\n                                    \t\x3cimg src\x3d"${contextPath}/images/icon-map-marker.svg" class\x3d"form-icon"\x3eVisualizar no mapa\n                                    \x3c/a\x3e\n                                \x3c/div\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e`}).join("")}
var map={"\u00e2":"a","\u00c2":"A","\u00e0":"a","\u00c0":"A","\u00e1":"a","\u00c1":"A","\u00e3":"a","\u00c3":"A","\u00ea":"e","\u00ca":"E","\u00e8":"e","\u00c8":"E","\u00e9":"e","\u00c9":"E","\u00ee":"i","\u00ce":"I","\u00ec":"i","\u00cc":"I","\u00ed":"i","\u00cd":"I","\u00f5":"o","\u00d5":"O","\u00f4":"o","\u00d4":"O","\u00f2":"o","\u00d2":"O","\u00f3":"o","\u00d3":"O","\u00fc":"u","\u00dc":"U","\u00fb":"u","\u00db":"U","\u00fa":"u","\u00da":"U","\u00f9":"u","\u00d9":"U","\u00e7":"c","\u00c7":"C"};
function removerAcentos(s){try{return s.replace(/[\W\[\] ]/g,function(a){return map[a]||a})}catch(e){return""}}var camposPesquisaveis=["numeroCooperativa","sigla","nome","tipoUnidade","endereco","complemento","bairro","cidade","cep","email","telefones"];
function refinedSearch(elemento){if(cooperativas.unidades!=undefined)AUI().one(".coop-data-result").html(renderCoops({unidades:AUI().Array.filter(cooperativas.unidades,function(e){if(e!=null&&Object.keys(e).length!=0)if(AUI().Array.filter(camposPesquisaveis,function(a){if(a=="telefones"){if(AUI().Array.filter(e[a],function(b){if(removerAcentos(b).toUpperCase().indexOf(removerAcentos(elemento.value).toUpperCase())!=-1)return e}).length>0)return e}else if(removerAcentos(e[a]).toUpperCase().indexOf(removerAcentos(elemento.value).toUpperCase())!=
-1)return e}).length>0)return e})}));visualizarMapaButton()}
function escolherEstado(elemento,uf_){var uf=elemento.options[elemento.selectedIndex].value;console.log("O indice \u00e9: "+elemento.selectedIndex);console.log("O texto \u00e9: "+elemento.options[elemento.selectedIndex].text);console.log("A chave \u00e9: "+elemento.options[elemento.selectedIndex].value);if(elemento.value=="")document.getElementById("btn_ir_"+uf_).style.display="none";else document.getElementById("btn_ir_"+uf_).style.display="block"}loaded=false;
(function(){$("div.portlet-msg-error").each(function(){var msg=$.trim($(this).html());if(msg==msgErro)$(this).hide()});$(".telefone").each(function(){var value=$.trim($(this).html()).replace(" ","");if(value.length==9)$(this).html(formataCampo(value,"(99) 999-9999"));else if(value.length==10)$(this).html(formataCampo(value,"(99) 9999-9999"));else if(value.length==11)$(this).html(formataCampo(value,"(99) 99999-9999"));else $(this).html(value)});$(".modalLink").click(function(e){e.preventDefault();
loaded=false;var parent=$(this).parent();$("div.mapDiv",parent).empty()});$(".modal").bind(getTransitionEndName(),function(e){e.preventDefault();var modal=$(this);retrieveData(modal)})});
function retrieveData(modal){var modalDiv=$("div.modal-body",modal);var mapDiv=$("div.mapDiv",modal);if(!loaded){loaded=true;var url=modalDiv.data("url");var numeroCooperativa=modalDiv.data("numeroCoop");var numeroPac=modalDiv.data("numeroPac");$.ajax({url:url,type:"post",dataType:"json",data:{numero:numeroCooperativa,numeroPac:numeroPac,atm:true,correspondente:true,cooperativa:false},success:function(data,textStatus,jqXHR){var unidades=data!=null?data.unidades:[];var markers=[];var coopLat=modalDiv.data("coopLat");
var coopLong=modalDiv.data("coopLong");var coopEnd=modalDiv.data("coopEnd");if(coopLat&&coopLat!=0&&coopLong&&coopLong!=0)markers.push({latitude:coopLat,longitude:coopLong,endereco:coopEnd,icon:base_url+"/images/pin_cooperativa.png"});if(unidades!=null&&unidades!=undefined)for(var i=0;i<unidades.length;i++){unidadeValida=true;var unidade=unidades[i];if(unidade!=null&&unidade!=undefined&&unidade.latitude&&unidade.longitude){var tipoUnidade=unidade.tipoUnidade.toLowerCase();var endereco=unidade.endereco+
", "+unidade.numero+", "+unidade.complemento;endereco+="\x3cbr/\x3e"+unidade.bairro+", "+unidade.cidade+" - "+unidade.cep;markers.push({latitude:unidade.latitude+"",longitude:unidade.longitude+"",endereco:endereco,icon:base_url+"/images/pin_"+tipoUnidade+".png"})}}if(markers.length<=0)generateNotFoundMessage(mapDiv);else generateGoogleMap(mapDiv[0],markers)},error:function(jqXHR,textStatus,errorThrown){generateNotFoundMessage("mapDiv");if(console)console.log("Erro no servidor!!!")}})}}
function generateNotFoundMessage(id){var mapDiv=$("."+id);var semUnidadeWrapper=$("\x3cdiv class\x3d'sem-unidade-wrapper'\x3e\x3c/div\x3e");var semUnidadeMensagem=$("\x3cspan\x3e\x3c/span\x3e");semUnidadeMensagem.html("N\x26atilde;o h\x26aacute; nenhuma informa\x26ccedil;\x26atilde;o a ser apresentada no mapa.");semUnidadeMensagem.appendTo(semUnidadeWrapper);mapDiv.append(semUnidadeWrapper)}
function getTransitionEndName(){var transitionEnd="TransitionEnd";if($.browser)if($.browser.webkit)transitionEnd="webkitTransitionEnd";else if($.browser.mozilla)transitionEnd="transitionend";else if($.browser.opera)transitionEnd="oTransitionEnd";return transitionEnd}
function generateGoogleMap(idContainerMap,markers){AUI().use("aui-modal",function(A){var modal=(new A.Modal({bodyContent:'\x3cdiv class\x3d"mapDiv" id\x3d"id-container-map"\x3e\x3c/div\x3e',centered:true,destroyOnHide:true,headerContent:"\x3ch3\x3eMapa\x3c/h3\x3e",modal:true,render:"#modalMapsCooperativas",width:"100%",height:500,resizable:false,zIndex:999})).render()});var mapContainer=document.getElementById("id-container-map");var options={mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU},
navigationControlOptions:{style:google.maps.NavigationControlStyle.DEFAULT}};var map=new google.maps.Map(mapContainer,options);var bounds=new google.maps.LatLngBounds;for(var i=0;i<markers.length;i++){var latLng=new google.maps.LatLng(markers[i].latitude,markers[i].longitude);var marker=new google.maps.Marker({position:latLng,map:map,html:markers[i].endereco,icon:markers[i].icon});google.maps.event.addListener(marker,"click",function(){var boxText=$("\x3cdiv\x3e\x3c/div\x3e");boxText.css("border",
"1px solid black");boxText.css("margin-top","8px");boxText.css("background","white");boxText.css("padding","5px");boxText.html(this.html);var bottom=$("\x3cdiv\x3e\x3c/div\x3e");bottom.addClass("setaBox");bottom.appendTo(boxText);var boxOptions={content:boxText[0],disableAutoPan:false,maxWidth:0,pixelOffset:new google.maps.Size(-75,0),zIndex:null,boxStyle:{background:"url("+base_url+"/images/tipbox.gif) no-repeat",backgroundPositionX:"-65px",opacity:1,width:"150px"},closeBoxMargin:"10px 2px 2px 2px",
closeBoxURL:base_url+"/images/close.gif",infoBoxClearance:new google.maps.Size(1,1),isHidden:false,pane:"floatPane",enableEventPropagation:false};if(typeof lastIb!=="undefined")lastIb.close();lastIb=new InfoBox(boxOptions);lastIb.open(map,this)});bounds.extend(latLng)}google.maps.event.addListener(map,"zoom_changed",function(){zoomChangeBoundsListener=google.maps.event.addListener(map,"bounds_changed",function(event){if(this.getZoom()>16&&this.initialZoom==true){this.setZoom(16);this.initialZoom=
false}google.maps.event.removeListener(zoomChangeBoundsListener)})});map.initialZoom=true;map.fitBounds(bounds);mapContainer.setAttribute("style","");mapContainer.style.width="100%";mapContainer.style.height="400px"}
function formataCampo(campo,Mascara){var boleanoMascara;exp=/\-|\.|\/|\(|\)| /g;campoSoNumeros=campo.replace(exp,"");var posicaoCampo=0;var NovoValorCampo="";var TamanhoMascara=campoSoNumeros.length;for(var i=0;i<=TamanhoMascara;i++){boleanoMascara=Mascara.charAt(i)=="-"||Mascara.charAt(i)=="."||Mascara.charAt(i)=="/";boleanoMascara=boleanoMascara||(Mascara.charAt(i)=="("||Mascara.charAt(i)==")"||Mascara.charAt(i)==" ");if(boleanoMascara){NovoValorCampo+=Mascara.charAt(i);TamanhoMascara++}else{NovoValorCampo+=
campoSoNumeros.charAt(posicaoCampo);posicaoCampo++}}return NovoValorCampo}
function LoadDataModalMaps(obj,modal){if(true){loaded=true;$.ajax({url:obj.url,type:"post",dataType:"json",data:{numeroCooperativa:obj.numero_cooperativa.toString(),numeroPac:obj.numero_pac,atm:true,correspondente:true,cooperativa:false},success:function(data){loadDataMapasUnidades(obj,data,modal)},error:function(jqXHR,textStatus,errorThrown){generateNotFoundMessage("mapDiv");console.log("Erro no servidor!!!");if(modal)modal.show()}})}else if(modal)modal.show()}
function loadDataMapasUnidades(obj,data,modal){var unidades=data!=null&&data.unidades!=null?data.unidades:[];var markers=[];var coopLat=obj.coop_lat;var coopLong=obj.coop_long;var coopEnd=obj.coop_end;if(!isNaN(coopLong)&&!isNaN(coopLat))markers.push({latitude:obj.coop_lat,longitude:obj.coop_long,endereco:obj.coop_end,icon:base_url+"/images/pin_cooperativa.png"});for(var i=0;i<unidades.length;i++){unidadeValida=true;var unidade=unidades[i];if(unidade!=null)if(!isNaN(unidade.latitude)&&!isNaN(unidade.longitude)){var tipoUnidade=
unidade.tipoUnidade.toLowerCase();var endereco=unidade.endereco;endereco+=", "+unidade.numero;endereco+=", "+unidade.complemento;endereco+="\x3cbr\x3e";endereco+=unidade.bairro;endereco+=", "+unidade.cidade;endereco+=" - "+unidade.cep;markers.push({latitude:unidade.latitude.toString(),longitude:unidade.longitude.toString(),endereco:endereco,icon:base_url+"/images/pin_"+tipoUnidade+".png"})}}if(markers.length<=0){generateNotFoundMessage(obj.index_map);if(modal)modal.show()}else{generateGoogleMap(obj.index_map,
markers);if(modal);}}
function visualizarMapaButton(){AUI().use("allPortletsReady","cookie","aui-node","aui-modal",function(A){A.all(".showMaplink").each(function(node){this.on("click",function(event){console.log("Ver Mapa clicado!");var source=event._currentTarget;var obj={index_map:source.getAttribute("data-index-map"),numero_cooperativa:source.getAttribute("data-numero-cooperativa"),numero_pac:source.getAttribute("data-numero-pac"),url:source.getAttribute("data-url"),coop_lat:source.getAttribute("data-coop-lat"),coop_long:source.getAttribute("data-coop-long"),
coop_end:source.getAttribute("data-coop-end")};var ModalMap;LoadDataModalMaps(obj,ModalMap)})})})}(function(){AUI().ready(function(A){loadingPesqCoop(true);escolherCidade(A.one("#uf")._node);A.one("#coop-number")._node.value=textoPesquisado;if(cooperativas!="")if(cooperativas.unidades!=null)A.one(".coop-data-result").html(renderCoops(cooperativas));else A.one(".coop-data-result").html("\x3cp\x3eNenhuma cooperativa encontrada.\x3c/p\x3e");visualizarMapaButton();loadingPesqCoop(false)})})();
