"use strict";angular.module("passwordResetApp",["ngRoute","ngAnimate","ngAria"]);angular.module("passwordResetApp").constant("PasswordResetUiState",{INITIALIZING:"initializing",VIEW_USER_IDENTIFICATION:"viewUserIdentification",SELECT_ACCOUNT_RECOVERY_OPTION:"selectAccountRecoveryOption",SELECT_CHALLENGE_METHOD:"selectChallengeMethod",CHALLENGE_STARTED:"challengeStarted",SET_NEW_PASSWORD:"setNewPassword",UNLOCK_ACCOUNT:"unlockAccount",PASSWORD_RESET_SUCCESS:"passwordResetSuccess",GENERIC_ERROR:"genericError",ON_PREMISES_CONNECTIVITY_FAILURE:"onPremisesConnectivityFailure",FEATURE_NOT_AVAILABLE:"featureNotAvailable",TENANT_NOT_ENABLED:"tenantNotEnabled",USER_IN_FEDERATED_DOMAIN:"userInFederatedDomain",USER_NOT_ENABLED:"userNotEnabled",ADMIN_IN_FEDERATED_DOMIAN:"adminInFederatedDomain",USER_NOT_CONFIGURED:"userNotConfiguredView",USER_THROTTLED:"userThrottled",INVALID_TOKEN:"invalidToken",ADMIN_NOTIFIED:"adminNotified",ON_PREMISES_ADMIN_ACTION_REQUIRED:"onPremisesAdminActionRequired",ON_PREMISES_SUCCESS_CLOUD_FAILURE:"onPremisesSuccessCloudFailure",TIMEOUT:"timeout",INVALID_SESSION:"invalidSession",FAIRFAX_TENANT_NOT_SUPPORTED_IN_PROD:"fairfaxTenantNotSupportedInProd",MOONCAKE_TENANT_NOT_SUPPORTED_IN_PROD:"mooncakeTenantNotSupportedInProd",PROD_TENANT_NOT_SUPPORTED_IN_MOONCAKE:"prodTenantNotSupportedInMooncake"}).constant("PasswordResetConstants",{DEFAULT_CHALLENGE_RESPONSE_KEY:"DefaultChallengeResponseKey"}).constant("PasswordResetClientType",{HYBRID_AZURE_AD_JOINED:"LogonClient_HybridAzureADJoined",AZURE_AD_JOINED:"LogonClient_AzureADJoined"}).constant("PasswordResetSessionState",{NOT_INITIALIZED:0,WAITING_FOR_USER_ID:1,WAITING_FOR_CHALLENGE_SELECTION:4,WAITING_FOR_CHALLENGE_RESPONSE:5,AUTHORIZED_FOR_PASSWORD_RESET:6,AUTHORIZATION_FAILED_OR_CANCELLED:7,COMPLETED:8,THROTTLED:9}).constant("UserPasswordType",{CLOUD:0,ON_PREMISES:1,CLOUD_AND_ON_PREMISES:2,NOT_SUPPORTED:3}).constant("ChallengeType",{NONE:0,SMS_OTP:1,MOBILE_CALL:3,OFFICE_CALL:4,EMAIL_OTP:5,SECURITY_QUESTIONS:6,MOBILE_APP_NOTIFICATION:7,MOBILE_APP_CODE:8}).constant("AccountRecoveryOption",{NONE:0,PASSWORDRESET:1,UNLOCK:2}).constant("PasswordResetAPIResponseResultCode",{UNKNOWN:0,SUCCESS:1,BLANK_CAPTCHA:2,INVALID_CAPTCHA:3,INVALID_USER_ID:4,BLOCKED_USER:5,ON_PREMISES_PASSWORD_RESET_SERVICE_NOT_AVAILABLE:6,USER_THROTTLED:7,UNSUPPORTED_USER:8,TENANT_SSPR_FLAG_DISABLED:9,WRITEBACK_NOT_ENABLED:10,SSPR_NOT_ENABLED_IN_USER_POLICY:11,USER_NOT_LICENSED:12,USER_NOT_MEMBER_OF_SCOPED_ACCESS_GROUP:13,USER_NOT_PROPERLY_CONFIGURED:14,START_CHALLENGE_VALIDATION_FAILED:15,START_CHALLENGE_USER_THROTTLED:16,START_CHALLENGE_PROVIDER_ERROR:17,SUBMIT_CHALLENGE_RESPONSE_VALIDATION_ATTEMPT_FAILED:18,SUBMIT_CHALLENGE_RESPONSE_VALIDATION_FAILED:19,SUBMIT_CHALLENGE_RESPONSE_USER_THROTTLED:20,SUBMIT_CHALLENGE_PROVIDER_ERROR:21,SYSTEM_ERROR:22,POLICY_VIOLATION_INVALID_PASSWORD:23,POLICY_VIOLATION_WEAK_PASSWORD:24,POLICY_VIOLATION_CONTAINS_USER_NAME:25,ON_PREMISES_SUCCESS_CLOUD_FAILURE:26,ON_PREMISES_POLICY_VIOLATION:27,ON_PREMISES_FAILURE:28,ON_PREMISES_ADMIN_ACTION_REQUIRED:29,ON_PREMISES_CONNECTIVITY_ERROR:30,INVALID_SESSION:31,FUZZY_POLICY_VIOLATION_INVALID_PASSWORD:33,TENANT_POLICY_VIOLATION_INVALID_PASSWORD:34,CONFIGURATION_ERROR_SERVICE_PRINCIPAL_MISCONFIGURED:35,USER_NOT_IN_SPECIFIED_TENANT:36,UPN_IN_MSFT_TENANT:37,USER_IS_GUEST:38,FAIRFAX_TENANT_NOT_SUPPORTED_IN_PROD:39,PROD_TENANT_NOT_SUPPORTED_IN_FAIRFAX:40,DIRECTORY_THROTTLED:41,MOONCAKE_TENANT_NOT_SUPPORTED_IN_PROD:42,CLOUD_SYNC_DOMAIN_NOT_CONFIGURED:45,ON_PREMISES_USER_NOT_FOUND:46}).constant("OTPDeviceType",{MICROSOFT_AUTH:1,SOFTWARE_AUTH:2,HARDWARE_AUTH:3}).config(["$routeProvider",function(n){n.when("/",{templateUrl:"/ng/views/passwordReset.cshtml",controller:"PasswordResetCtrl"}).otherwise({redirectTo:"/"})}]);angular.module("passwordResetApp").run(["$http",function(n){n.defaults.headers.common["X-XSRF-TOKEN"]=antiCsrfToken;n.defaults.headers.common.AjaxRequest=!0}]);angular.module("passwordResetApp").service("passwordResetDataProvider",["$http",function(n){this.passwordResetShared={StartSession:function(t){return n.post("/passwordreset/StartSession",null,{timeout:t})},SubmitUserId:function(t,i){return n.post("/passwordreset/SubmitUserId",{jsonContext:t},{timeout:i})},SetAccountRecoveryOption:function(t,i){return n.post("/passwordreset/SetAccountRecoveryOption",{jsonContext:t},{timeout:i})},StartChallenge:function(t,i){return n.post("/passwordreset/StartChallenge",{jsonContext:t},{timeout:i})},SubmitChallengeResponse:function(t,i){return n.post("/passwordreset/SubmitChallengeResponse",{jsonContext:t},{timeout:i})},SetNewPassword:function(t,i){return n.post("/passwordreset/SetNewPassword",{jsonContext:t},{timeout:i})},UnlockAccount:function(t,i){return n.post("/passwordreset/UnlockAccount",{jsonContext:t},{timeout:i})},ContactAdministrator:function(t){return n.post("/passwordreset/ContactAdministrator",null,{timeout:t})},AbandonSession:function(t){return n.post("/passwordreset/AbandonSession",null,{timeout:t})},GetThrottlingDuration:function(t,i){return n.post("/passwordreset/GetThrottlingDuration",{userId:t},{timeout:i})},GetBrandingInfo:function(t,i){return n.post("/passwordreset/GetBrandingInfo",{userId:t},{timeout:i})}}}]);angular.module("passwordResetApp").directive("accountUnlock",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/accountUnlock.cshtml"}});angular.module("passwordResetApp").directive("adminInFederatedDomain",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/adminInFederatedDomain.cshtml"}});angular.module("passwordResetApp").directive("adminNotified",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/adminNotified.cshtml"}});angular.module("passwordResetApp").directive("challengeResponseVerification",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/challengeResponseVerification.cshtml"}});angular.module("passwordResetApp").directive("challengeSelector",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/challengeSelector.cshtml"}});angular.module("passwordResetApp").directive("fairfaxTenantNotSupportedInProd",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/fairfaxTenantNotSupportedInProd.cshtml"}});angular.module("passwordResetApp").directive("featureNotAvailable",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/featureNotAvailable.cshtml"}});angular.module("passwordResetApp").directive("focusOn",["$timeout",function(n){return{scope:{trigger:"=focusOn"},link:function(t,i){t.$watch("trigger",function(r){if(r===!0)n(function(){i[0].focus();t.trigger=!1},300)})}}}]);angular.module("passwordResetApp").directive("genericError",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/genericError.cshtml"}});angular.module("passwordResetApp").directive("invalidSession",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/invalidSession.cshtml"}});angular.module("passwordResetApp").directive("invalidToken",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/invalidToken.cshtml"}});angular.module("passwordResetApp").directive("onPremisesAdminActionRequired",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/onPremisesAdminActionRequired.cshtml"}});angular.module("passwordResetApp").directive("onPremisesConnectivityFailure",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/onPremisesConnectivityFailure.cshtml"}});angular.module("passwordResetApp").directive("onPremisesSuccessCloudFailure",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/onPremisesSuccessCloudFailure.cshtml"}});angular.module("passwordResetApp").directive("passwordResetSuccess",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/passwordResetSuccess.cshtml"}});angular.module("passwordResetApp").directive("selectAccountRecoveryOption",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/selectAccountRecoveryOption.cshtml"}});angular.module("passwordResetApp").directive("selectChallengeMethod",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/selectChallengeMethod.cshtml"}});angular.module("passwordResetApp").directive("setNewPassword",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/setNewPassword.cshtml"}});angular.module("passwordResetApp").directive("tenantNotEnabled",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/tenantNotEnabled.cshtml"}});angular.module("passwordResetApp").directive("timeout",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/timeout.cshtml"}});angular.module("passwordResetApp").directive("userInFederatedDomain",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/userInFederatedDomain.cshtml"}});angular.module("passwordResetApp").directive("userNotConfiguredView",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/userNotConfiguredView.cshtml"}});angular.module("passwordResetApp").directive("userNotEnabled",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/userNotEnabled.cshtml"}});angular.module("passwordResetApp").directive("userThrottled",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/userThrottled.cshtml"}});angular.module("passwordResetApp").directive("viewUserIdentification",function(){return{restrict:"E",replace:!0,templateUrl:"/ng/views/viewUserIdentification.cshtml"}});"use strict";var app=angular.module("passwordResetApp");app.controller("PasswordResetCtrl",["$scope","$q","$timeout","$window","passwordResetDataProvider","PasswordResetUiState","PasswordResetClientType","PasswordResetConstants","PasswordResetSessionState","UserPasswordType","ChallengeType","AccountRecoveryOption","PasswordResetAPIResponseResultCode","OTPDeviceType",function(n,t,i,r,u,f,e,o,s,h,c,l,a,v){function y(n,t){var i;return function(){var r=this,u=arguments,f=function(){i=null;n.apply(r,u)};clearTimeout(i);i=setTimeout(f,t)}}n.initializeEaseOfAccessControls=function(){try{var t=new CloudExperienceHost.Bridge;t.invoke("CloudExperienceHost.shouldShowInputSwitchButton").done(function(t){n.passwordResetModel.showSwitcher=t},function(){})}catch(i){}};n.easeOfAccessClick=function(){try{var n=new CloudExperienceHost.Bridge,t=document.getElementById("easeOfAccessSwitch"),i=t.getBoundingClientRect();n.invoke("CloudExperienceHost.showEaseOfAccessFlyout",new CloudExperienceHost.ShowEaseOfAccessArgs(i))}catch(r){}};n.inputSwitchClick=function(){try{var n=new CloudExperienceHost.Bridge,t=document.getElementById("keyboardStandardSwitch"),i=t.getBoundingClientRect();n.invoke("CloudExperienceHost.showInputSwitchFlyout",new CloudExperienceHost.ShowEaseOfAccessArgs(i))}catch(r){}};n.disableBackButton=function(){try{var n=new CloudExperienceHost.Bridge;n.invoke("CloudExperienceHost.setDisableBackNavigation",!1)}catch(t){}};n.IgnoreNextUserIdValidationOnChange=!1;n.clearErrors=function(){n.passwordResetModel.errors={showUserIdInvalidError:!1,showNonOrgIdDomainsError:!1,showUserIdNotFoundError:!1,showBlockedUserError:!1,showSubmitUserIdUserThrottledError:!1,showStartChallengeValidationError:!1,showStartChallengeProviderError:!1,showSubmitChallengeResponseValidationError:!1,showSubmitChallengeResponseProviderError:!1,showPasswordContainsUsernameError:!1,showWeakPasswordError:!1,showPasswordPolicyError:!1,showOnPremisesPolicyViolationError:!1,showPasswordResetOnPremisesFailureError:!1,showPasswordMissingError:!1,showPasswordConfirmationMissingError:!1,showPasswordsDoNotMatchError:!1,showFuzzyPasswordPolicyError:!1,showUserIdNotInDomainError:!1,showTenantBannedPasswordPolicyError:!1,showDirectoryThrottledError:!1,showCloudSyncDomainNotConfiguredError:!1,showOnPremisesUserNotFoundError:!1}};n.initializePasswordResetModel=function(){n.step=f.INITIALIZING;n.correlationId="";n.currentTimeStamp=(new Date).toISOString();n.passwordResetModel={};n.passwordResetModel.userId=userName&&userName.length>0?userName:"";n.passwordResetModel.userIdFromServer=userName&&userName.length>0?!0:!1;n.passwordResetModel.tenantId=tenantId&&tenantId.length>0?tenantId:"";n.passwordResetModel.tenantIdFromServer=tenantId&&tenantId.length>0?!0:!1;n.passwordResetModel.autoSubmitUpn=autoSubmitWin10&&n.passwordResetModel.userIdFromServer?!0:!1;n.passwordResetModel.isOTPCheckEnabled=isOTPCheckEnabled;n.passwordResetModel.passwordResetClientType=n.passwordResetModel.tenantIdFromServer?e.HYBRID_AZURE_AD_JOINED:e.AZURE_AD_JOINED;n.passwordResetModel.challenges=[];n.passwordResetModel.challengeDataMappings=[];n.passwordResetModel.challengeMethod="";n.passwordResetModel.challengeData=[];n.passwordResetModel.challengeResponse=null;n.passwordResetModel.completedChallengesCount=0;n.passwordResetModel.accountRecoveryOption=l.PASSWORDRESET;n.passwordResetModel.userSubmittedValidationData="";n.passwordResetModel.selectedChallengeDataMapping={};n.passwordResetModel.challengeTypeStarted=-1;n.passwordResetModel.validationDataForStartedChallenge="";n.passwordResetModel.challengeDataMappingForStartedChallenge={};n.passwordResetModel.errors={};n.passwordResetModel.newPassword="";n.passwordResetModel.newPasswordConfirmation="";n.passwordResetModel.showUpsellLink=!1;n.passwordResetModel.showProgress=!1;n.passwordResetModel.nextDisabled=!0;n.passwordResetModel.setFocusOnNextButton=!1;n.passwordResetModel.errorPageTimeStamp="";n.passwordResetModel.showSubmitChallengeResponseContactAdministrator=!1;n.passwordResetModel.submitChallengeResponseContactAdministratorDisabled=!1;n.passwordResetModel.showSubmitChallengeResponseTryAgain=!1;n.passwordResetModel.timeElapsedSinceFirstAttempt=0;n.passwordResetModel.timeRemaining=0;n.passwordResetModel.brandingImageSource="";n.passwordResetModel.showBranding=!1;n.passwordResetModel.showEmailSlider=!1;n.passwordResetModel.showSwitcher=!0;n.passwordResetModel.userPasswordType=h.NOT_SUPPORTED;n.passwordResetModel.tenantIdFromServer?n.passwordResetModel.makeUserIdFieldNotEditable=!1:n.passwordResetModel.userIdFromServer?(n.passwordResetModel.makeUserIdFieldNotEditable=!0,n.passwordResetModel.setFocusOnNextButton=!0):n.passwordResetModel.makeUserIdFieldNotEditable=!1;n.passwordResetModel.IsNumberMatchingEnabled=!1;n.passwordResetModel.ValidEntropyNumber=0;n.clearErrors();n.initializeEaseOfAccessControls();n.disableBackButton()};n.OnUserIdPaste=y(function(){n.IgnoreNextUserIdValidationOnChange=!0;n.validateUserId();n.$apply()},20);n.OnUserIdChange=y(function(){n.IgnoreNextUserIdValidationOnChange===!0?n.IgnoreNextUserIdValidationOnChange=!1:(n.validateUserId(),n.$apply())},1e3);n.validateUserId=function(){n.clearErrors();var t=!1,i=new RegExp("@gmail.com|@hotmail.com|@yahoo.com|@aol.com|@icloud.com|@comcast.net|@contoso.com|@outlook.com|@office.com|@office365.com|@microsoftonline.com|@sharepoint.com|@windows.com","i");n.passwordResetModel.userId&&n.passwordResetModel.userId.trim()!==""?n.passwordResetModel.userId&&n.passwordResetModel.userId.trim()&&/^[a-zA-Z0-9~#^\\!.'_%-]+@[a-zA-Z0-9](?!.*\.\..*)[a-zA-Z0-9.-]*\.[a-zA-Z]{2,25}$/.test(n.passwordResetModel.userId)?i.test(n.passwordResetModel.userId)?n.passwordResetModel.errors.showNonOrgIdDomainsError=!0:(t=!0,n.getBrandingInfo()):n.passwordResetModel.errors.showUserIdInvalidError=!0:t=!1;t||(n.passwordResetModel.brandingImageSource="",n.passwordResetModel.showBranding=!1);n.passwordResetModel.nextDisabled=!t};n.validateChallengeResponseData=function(){var t,i,r;n.clearErrors();t=parseInt(n.passwordResetModel.challengeMethod);i=!1;t===c.SECURITY_QUESTIONS?n.passwordResetModel.challengeData.forEach(function(n){n.challengeResponse&&n.challengeResponse.trim()||(i=!0)}):(t===c.EMAIL_OTP||t===c.SMS_OTP||t===c.MOBILE_APP_CODE)&&(r=new RegExp("^([0-9]{6,})$"),i=!r.test(n.passwordResetModel.challengeResponse));n.passwordResetModel.nextDisabled=i};n.validateUserSubmittedValidationData=function(){var t,i;if(n.clearErrors(),t=parseInt(n.passwordResetModel.challengeMethod),t===c.SECURITY_QUESTIONS||t===c.EMAIL_OTP||t===c.MOBILE_APP_NOTIFICATION){n.passwordResetModel.nextDisabled=!1;return}i=new RegExp("(?=(.*\\d){5})(?=(^[0-9 \\s\\\\\\/\\(\\)\\-\\_\\.\\+]*$))");n.passwordResetModel.nextDisabled=i.test(n.passwordResetModel.userSubmittedValidationData)?!1:!0};n.validateNewPassword=function(){n.clearErrors();n.passwordResetModel.newPassword&&n.passwordResetModel.newPassword.trim()?n.passwordResetModel.newPasswordConfirmation&&n.passwordResetModel.newPasswordConfirmation.trim()?n.passwordResetModel.newPassword===n.passwordResetModel.newPasswordConfirmation?n.passwordResetModel.nextDisabled=!1:(n.passwordResetModel.errors.showPasswordsDoNotMatchError=!0,n.passwordResetModel.nextDisabled=!0):(n.passwordResetModel.errors.showPasswordConfirmationMissingError=!0,n.passwordResetModel.nextDisabled=!0):(n.passwordResetModel.errors.showPasswordMissingError=!0,n.passwordResetModel.nextDisabled=!0)};n.showProgressAndDisableNext=function(){n.passwordResetModel.showProgress=!0;n.passwordResetModel.nextDisabled=!0};n.hideProgressAndEnableNext=function(){n.passwordResetModel.showProgress=!1;n.passwordResetModel.nextDisabled=!1};n.showNext=function(){switch(n.step){case f.INITIALIZING:case f.VIEW_USER_IDENTIFICATION:case f.SELECT_ACCOUNT_RECOVERY_OPTION:case f.SELECT_CHALLENGE_METHOD:case f.SET_NEW_PASSWORD:return!0;case f.UNLOCK_ACCOUNT:return!1;case f.CHALLENGE_STARTED:return n.passwordResetModel.challengeTypeStarted===c.MOBILE_CALL||n.passwordResetModel.challengeTypeStarted===c.OFFICE_CALL||n.passwordResetModel.challengeTypeStarted===c.MOBILE_APP_NOTIFICATION?!1:!0;default:return!1}};n.showCancel=function(){switch(n.step){case f.PASSWORD_RESET_SUCCESS:case f.ON_PREMISES_SUCCESS_CLOUD_FAILURE:return!1;default:return!0}};n.startSession=function(){n.initializePasswordResetModel();var r=t.defer();u.passwordResetShared.StartSession(r.promise).then(n.startSessionSuccess,n.startSessionError);i(function(){r.resolve("request cancelled")},3e4)};n.abandonSession=function(n,r){var f=t.defer();u.passwordResetShared.AbandonSession(f.promise).then(n,r);i(function(){f.resolve("request cancelled")},3e4)};n.restartSession=function(){n.abandonSession(n.startSession,n.abandonSessionError)};n.cancelSession=function(){n.abandonSession(n.redirect,n.abandonSessionError)};n.redirect=function(){if(returnUrl&&returnUrl.length>0)r.location.href=returnUrl;else{n.startSession();var t=new CloudExperienceHost.Bridge;t.fireEvent(CloudExperienceHost.Events.done,CloudExperienceHost.AppResult.success)}};n.getChallengeResponse=function(){var t=parseInt(n.passwordResetModel.challengeMethod),i={};return t===c.SMS_OTP||t===c.EMAIL_OTP||t===c.MOBILE_APP_CODE?i[o.DEFAULT_CHALLENGE_RESPONSE_KEY]=n.passwordResetModel.challengeResponse:t===c.OFFICE_CALL||t===c.MOBILE_CALL||t===c.MOBILE_APP_NOTIFICATION?i=null:n.passwordResetModel.challengeData.forEach(function(n){n&&n.id&&n.challengeResponse&&(i[n.id]=n.challengeResponse)}),i};n.challengeMethodChange=function(){var t=parseInt(n.passwordResetModel.challengeMethod);if(n.passwordResetModel.challengeTypeStarted===t){n.passwordResetModel.userSubmittedValidationData=n.passwordResetModel.validationDataForStartedChallenge;n.passwordResetModel.selectedChallengeDataMapping=n.passwordResetModel.challengeDataMappingForStartedChallenge;n.step=f.CHALLENGE_STARTED;n.validateChallengeResponseData();return}n.passwordResetModel.errors.showStartChallengeValidationError=!1;n.passwordResetModel.errors.showStartChallengeProviderError=!1;n.step=f.SELECT_CHALLENGE_METHOD;n.passwordResetModel.userSubmittedValidationData=null;t===c.SECURITY_QUESTIONS||t===c.MOBILE_APP_NOTIFICATION||t===c.MOBILE_APP_CODE?(n.passwordResetModel.challengeDataMappings=null,n.passwordResetModel.selectedChallengeDataMapping=null):(n.passwordResetModel.challengeDataMappings=n.getChallengeDataMappings(t),n.passwordResetModel.selectedChallengeDataMapping=n.passwordResetModel.challengeDataMappings[0]);n.validateUserSubmittedValidationData();(t===c.SECURITY_QUESTIONS||t===c.MOBILE_APP_CODE)&&n.nextPage()};n.isChallengeTypeAvailable=function(t){var i=!1;return n.passwordResetModel&&n.passwordResetModel.challenges&&n.passwordResetModel.challenges.forEach(function(n){n&&n.challengeType&&n.challengeType===t&&(i=!0)}),i};n.getChallengeDataMappings=function(t){var i=[];return n.passwordResetModel&&n.passwordResetModel.challenges&&n.passwordResetModel.challenges.forEach(function(n){n&&n.challengeType&&n.challengeType===t&&(i=n.challengeDataMappings)}),i};n.selectDefaultChallenge=function(){n.isChallengeTypeAvailable(c.EMAIL_OTP)?(n.passwordResetModel.challengeMethod=c.EMAIL_OTP.toString(),n.passwordResetModel.nextDisabled=!1):n.isChallengeTypeAvailable(c.SMS_OTP)?n.passwordResetModel.challengeMethod=c.SMS_OTP.toString():n.isChallengeTypeAvailable(c.MOBILE_CALL)?n.passwordResetModel.challengeMethod=c.MOBILE_CALL.toString():n.isChallengeTypeAvailable(c.OFFICE_CALL)?n.passwordResetModel.challengeMethod=c.OFFICE_CALL.toString():n.isChallengeTypeAvailable(c.MOBILE_APP_NOTIFICATION)?(n.passwordResetModel.challengeMethod=c.MOBILE_APP_NOTIFICATION.toString(),n.passwordResetModel.nextDisabled=!1):n.isChallengeTypeAvailable(c.MOBILE_APP_CODE)?n.passwordResetModel.challengeMethod=c.MOBILE_APP_CODE.toString():n.isChallengeTypeAvailable(c.SECURITY_QUESTIONS)&&(n.passwordResetModel.challengeMethod=c.SECURITY_QUESTIONS.toString());n.challengeMethodChange()};n.selectDefaultAccountRecoveryOption=function(){n.passwordResetModel.accountRecoveryOption=l.PASSWORDRESET};n.pollForPhoneCallOrNotificationCompletion=function(r){var f=r||t.defer(),e=n.prepareContext(),o=JSON.stringify(e);return u.passwordResetShared.SubmitChallengeResponse(o).then(function(n){f.resolve(n)},function(t){var r=parseInt(t.data);t.status===400&&r===a.SUBMIT_CHALLENGE_RESPONSE_VALIDATION_ATTEMPT_FAILED?i(function(){n.pollForPhoneCallOrNotificationCompletion(f)},2e3):f.reject(t)}),f.promise};n.showTryAgainAndcontactAdministratorLinks=function(t){var r=0;isNaN(t)||(r=t);i(function(){n.passwordResetModel.showSubmitChallengeResponseTryAgain=!0;n.passwordResetModel.showSubmitChallengeResponseContactAdministrator=!0;n.passwordResetModel.submitChallengeResponseContactAdministratorDisabled=!1},r)};n.challengeTryAgain=function(){var r=t.defer(),f={challengeType:parseInt(n.passwordResetModel.challengeMethod),userSubmittedValidationData:n.passwordResetModel.validationDataForStartedChallenge,challengeDataKey:n.passwordResetModel.challengeDataMappingForStartedChallenge?n.passwordResetModel.challengeDataMappingForStartedChallenge.challengeDataKey:null},e=JSON.stringify(f);u.passwordResetShared.StartChallenge(e,r.promise).then(n.startChallengeSuccess,n.startChallengeError);n.showProgressAndDisableNext();i(function(){r.resolve("request cancelled")},3e4)};n.shouldShowCloudPasswordPolicyHint=function(){return n.passwordResetModel.userPasswordType===h.CLOUD};n.contactAdministrator=function(){if(!n.passwordResetModel.submitChallengeResponseContactAdministratorDisabled){n.passwordResetModel.submitChallengeResponseContactAdministratorDisabled=!0;var r=t.defer();n.showProgressAndDisableNext();u.passwordResetShared.ContactAdministrator(r.promise).then(n.contactAdministratorSuccess,n.contactAdministratorError);i(function(){r.resolve("request cancelled")},3e4)}};n.getThrottlingDuration=function(r){var f=t.defer(),e;n.showProgressAndDisableNext();e=function(t){n.getThrottlingDurationSuccess(t);typeof r=="function"&&r(t)};u.passwordResetShared.GetThrottlingDuration(n.passwordResetModel.userId,f.promise).then(e,n.getThrottlingDurationError);i(function(){f.resolve("request cancelled")},3e4)};n.getBrandingInfo=function(){var r=t.defer();u.passwordResetShared.GetBrandingInfo(n.passwordResetModel.userId,r.promise).then(n.getBrandingInfoSuccess);i(function(){r.resolve("request cancelled")},3e4)};n.startSessionSuccess=function(t){n.correlationId=t.data.replace(/"/g,"");n.step=f.VIEW_USER_IDENTIFICATION;n.validateUserId();n.passwordResetModel.userId&&n.passwordResetModel.userId.trim()||n.clearErrors();n.passwordResetModel.autoSubmitUpn&&n.nextPage()};n.startSessionError=function(t){if(t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}};n.setAccountRecoveryOptionSuccess=function(){n.hideProgressAndEnableNext();n.clearErrors();n.passwordResetModel.nextDisabled=!0;n.step=f.SELECT_CHALLENGE_METHOD;n.selectDefaultChallenge()};n.setAccountRecoveryOptionError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),!t){n.step=f.GENERIC_ERROR;return}};n.submitUserIdSuccess=function(t){n.hideProgressAndEnableNext();n.clearErrors();n.passwordResetModel.nextDisabled=!0;t.data&&t.data.challenges&&(n.passwordResetModel.challenges=[],n.passwordResetModel.challenges=t.data.challenges,n.passwordResetModel.showProgress=!1,n.passwordResetModel.userPasswordType=t.data.userPasswordType,t.data.allowedOTPDeviceTypes&&n.evaluateOTPDevices(t.data.allowedOTPDeviceTypes),t.data.allowAccountUnlock?(n.step=f.SELECT_ACCOUNT_RECOVERY_OPTION,n.selectDefaultAccountRecoveryOption(),n.passwordResetModel.nextDisabled=!1):(n.step=f.SELECT_CHALLENGE_METHOD,n.selectDefaultChallenge()))};n.evaluateOTPDevices=function(t){n.passwordResetModel.msAuthenticatorEnabled=t.indexOf(v.MICROSOFT_AUTH)>=0;n.passwordResetModel.softwareAuthEnabled=t.indexOf(v.SOFTWARE_AUTH)>=0;n.passwordResetModel.hardwareAuthEnabled=t.indexOf(v.HARDWARE_AUTH)>=0};n.submitUserIdError=function(t){var i,u,e,o;if(n.hideProgressAndEnableNext(),n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}i=parseInt(t.data);switch(i){case a.INVALID_USER_ID:n.passwordResetModel.errors.showUserIdNotFoundError=!0;break;case a.BLOCKED_USER:n.passwordResetModel.errors.showBlockedUserError=!0;break;case a.USER_NOT_IN_SPECIFIED_TENANT:n.passwordResetModel.errors.showUserIdNotInDomainError=!0;break;case a.UPN_IN_MSFT_TENANT:n.passwordResetModel.errors.showNonOrgIdDomainsError=!0;break;case a.USER_THROTTLED:n.getThrottlingDuration(function(){n.passwordResetModel.errors.showSubmitUserIdUserThrottledError=!0});break;case a.UNSUPPORTED_USER:n.step=f.FEATURE_NOT_AVAILABLE;break;case a.ON_PREMISES_PASSWORD_RESET_SERVICE_NOT_AVAILABLE:n.step=f.ON_PREMISES_CONNECTIVITY_FAILURE;break;case a.TENANT_SSPR_FLAG_DISABLED:n.step=f.TENANT_NOT_ENABLED;break;case a.WRITEBACK_NOT_ENABLED:n.step=f.USER_IN_FEDERATED_DOMAIN;break;case a.SSPR_NOT_ENABLED_IN_USER_POLICY:n.step=f.USER_NOT_ENABLED;break;case a.USER_NOT_LICENSED:n.step=f.USER_NOT_ENABLED;break;case a.USER_NOT_MEMBER_OF_SCOPED_ACCESS_GROUP:n.step=f.USER_NOT_ENABLED;break;case a.USER_IS_GUEST:n.step=f.USER_NOT_ENABLED;break;case a.USER_NOT_PROPERLY_CONFIGURED:n.step=f.USER_NOT_CONFIGURED;break;case a.CLOUD_SYNC_DOMAIN_NOT_CONFIGURED:n.step=f.USER_NOT_CONFIGURED;break;case a.INVALID_SESSION:n.step=f.INVALID_SESSION;break;case a.FAIRFAX_TENANT_NOT_SUPPORTED_IN_PROD:u="https://passwordreset.activedirectory.windowsazure.us/n/passwordreset?username="+n.passwordResetModel.userId;r.location.href=u;break;case a.MOONCAKE_TENANT_NOT_SUPPORTED_IN_PROD:e="https://passwordreset.activedirectory.windowsazure.cn/n/passwordreset?username="+n.passwordResetModel.userId;r.location.href=e;break;case a.PROD_TENANT_NOT_SUPPORTED_IN_FAIRFAX:n.step=f.FAIRFAX_TENANT_NOT_SUPPORTED_IN_PROD;break;case a.PROD_TENANT_NOT_SUPPORTED_IN_MOONCAKE:o="https://passwordreset.microsoftonline.com/n/passwordreset?username="+n.passwordResetModel.userId;r.location.href=o;break;case a.CONFIGURATION_ERROR_SERVICE_PRINCIPAL_MISCONFIGURED:n.step=f.FEATURE_NOT_AVAILABLE;break;default:n.step=f.GENERIC_ERROR}};n.startChallengeSuccess=function(t){var i,r;if(n.step=f.CHALLENGE_STARTED,n.hideProgressAndEnableNext(),n.clearErrors(),n.passwordResetModel.showSubmitChallengeResponseContactAdministrator=!1,n.passwordResetModel.submitChallengeResponseContactAdministratorDisabled=!1,n.passwordResetModel.showSubmitChallengeResponseTryAgain=!1,n.passwordResetModel.showEmailSlider=!1,n.passwordResetModel.nextDisabled=!0,i=parseInt(n.passwordResetModel.challengeMethod),n.passwordResetModel.challengeResponse="",n.passwordResetModel.challengeTypeStarted=i,n.passwordResetModel.validationDataForStartedChallenge=n.passwordResetModel.userSubmittedValidationData,n.passwordResetModel.challengeDataMappingForStartedChallenge=n.passwordResetModel.selectedChallengeDataMapping,n.passwordResetModel.challengeData=[],i===c.SECURITY_QUESTIONS){if(t&&t.data&&t.data.challengeData){for(r in t.data.challengeData)n.passwordResetModel.challengeData.push({id:r,text:t.data.challengeData[r],challengeResponse:""});n.showTryAgainAndcontactAdministratorLinks(15e3)}}else i===c.SMS_OTP||i===c.EMAIL_OTP||i===c.MOBILE_APP_CODE?n.showTryAgainAndcontactAdministratorLinks(15e3):(i===c.MOBILE_CALL||i===c.OFFICE_CALL||i===c.MOBILE_APP_NOTIFICATION)&&(i===c.MOBILE_APP_NOTIFICATION&&t&&t.data&&t.data.challengeData&&t.data.challengeData.hasOwnProperty("isNumberMatchingEnabled")&&!!t.data.challengeData.isNumberMatchingEnabled&&t.data.challengeData.hasOwnProperty("validEntropyNumber")&&(n.passwordResetModel.IsNumberMatchingEnabled=t.data.challengeData.isNumberMatchingEnabled.toLowerCase()==="true",n.passwordResetModel.ValidEntropyNumber=t.data.challengeData.validEntropyNumber),n.showProgressAndDisableNext(),n.pollForPhoneCallOrNotificationCompletion().then(n.submitChallengeResponseSuccess,n.submitChallengeResponseError))};n.startChallengeError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),n.passwordResetModel.challengeTypeStarted=-1,t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}var i=parseInt(t.data);switch(i){case a.START_CHALLENGE_VALIDATION_FAILED:n.passwordResetModel.errors.showStartChallengeValidationError=!0;break;case a.START_CHALLENGE_USER_THROTTLED:n.getThrottlingDuration(function(){n.step=f.USER_THROTTLED});break;case a.START_CHALLENGE_PROVIDER_ERROR:n.passwordResetModel.errors.showStartChallengeProviderError=!0;break;case a.INVALID_SESSION:n.step=f.INVALID_SESSION;break;default:n.step=f.GENERIC_ERROR}};n.submitChallengeResponseSuccess=function(t){n.hideProgressAndEnableNext();n.clearErrors();n.passwordResetModel.completedChallengesCount++;n.passwordResetModel.nextDisabled=!0;t&&t.data&&t.data.sessionData&&t.data.sessionData.sessionState&&(t.data.sessionData.sessionState===s.WAITING_FOR_CHALLENGE_SELECTION?(n.passwordResetModel.challenges=t.data.challenges,n.passwordResetModel.challengeDataMappings=null,n.passwordResetModel.selectedChallengeDataMapping={},n.passwordResetModel.challengeMethod="",n.passwordResetModel.challengeResponse=null,n.passwordResetModel.challengeData={},n.passwordResetModel.userSubmittedValidationData="",n.passwordResetModel.challengeTypeStarted=-1,n.passwordResetModel.validationDataForStartedChallenge="",n.passwordResetModel.challengeDataMappingForStartedChallenge={},n.step=f.SELECT_CHALLENGE_METHOD):t.data.sessionData.sessionState===s.AUTHORIZED_FOR_PASSWORD_RESET&&(n.passwordResetModel.accountRecoveryOption===l.PASSWORDRESET?n.step=f.SET_NEW_PASSWORD:(n.step=f.UNLOCK_ACCOUNT,n.nextPage())))};n.submitChallengeResponseError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}var i=parseInt(n.passwordResetModel.challengeMethod),r=parseInt(t.data);switch(r){case a.SUBMIT_CHALLENGE_RESPONSE_VALIDATION_ATTEMPT_FAILED:n.passwordResetModel.errors.showSubmitChallengeResponseValidationError=!0;n.passwordResetModel.challengeResponse="";n.passwordResetModel.challengeData.forEach(function(n){n&&n.id&&n.challengeResponse&&(n.challengeResponse="")});n.passwordResetModel.nextDisabled=!0;break;case a.SUBMIT_CHALLENGE_RESPONSE_VALIDATION_FAILED:i===c.MOBILE_CALL||i===c.OFFICE_CALL||i===c.MOBILE_APP_NOTIFICATION?(n.passwordResetModel.errors.showSubmitChallengeResponseValidationError=!0,n.showTryAgainAndcontactAdministratorLinks(0)):n.step=f.INVALID_TOKEN;break;case a.SUBMIT_CHALLENGE_PROVIDER_ERROR:n.passwordResetModel.errors.showSubmitChallengeResponseProviderError=!0;n.showTryAgainAndcontactAdministratorLinks(0);break;case a.SUBMIT_CHALLENGE_RESPONSE_USER_THROTTLED:n.getThrottlingDuration(function(){n.step=f.USER_THROTTLED});break;case a.INVALID_SESSION:n.step=f.INVALID_SESSION;break;default:n.step=f.GENERIC_ERROR}};n.unlockAccountSuccess=function(){n.step=f.PASSWORD_RESET_SUCCESS;n.hideProgressAndEnableNext();n.clearErrors()};n.unlockAccountError=function(t){if(n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}var i=parseInt(t.data);switch(i){case a.SYSTEM_ERROR:n.step=f.GENERIC_ERROR;break;case a.ON_PREMISES_ADMIN_ACTION_REQUIRED:n.step=f.ON_PREMISES_ADMIN_ACTION_REQUIRED;break;case a.ON_PREMISES_CONNECTIVITY_ERROR:n.step=f.ON_PREMISES_CONNECTIVITY_FAILURE;break;case a.INVALID_SESSION:n.step=f.INVALID_SESSION;break;default:n.step=f.GENERIC_ERROR}};n.setNewPasswordSuccess=function(){n.step=f.PASSWORD_RESET_SUCCESS;n.hideProgressAndEnableNext();n.clearErrors()};n.setNewPasswordError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}var i=parseInt(t.data);switch(i){case a.POLICY_VIOLATION_INVALID_PASSWORD:n.passwordResetModel.errors.showPasswordPolicyError=!0;break;case a.POLICY_VIOLATION_CONTAINS_USER_NAME:n.passwordResetModel.errors.showPasswordContainsUsernameError=!0;break;case a.POLICY_VIOLATION_WEAK_PASSWORD:n.passwordResetModel.errors.showWeakPasswordError=!0;break;case a.ON_PREMISES_POLICY_VIOLATION:n.passwordResetModel.errors.showOnPremisesPolicyViolationError=!0;break;case a.ON_PREMISES_FAILURE:n.passwordResetModel.errors.showPasswordResetOnPremisesFailureError=!0;break;case a.FUZZY_POLICY_VIOLATION_INVALID_PASSWORD:n.passwordResetModel.errors.showFuzzyPasswordPolicyError=!0;break;case a.TENANT_POLICY_VIOLATION_INVALID_PASSWORD:n.passwordResetModel.errors.showTenantBannedPasswordPolicyError=!0;break;case a.DIRECTORY_THROTTLED:n.passwordResetModel.errors.showDirectoryThrottledError=!0;break;case a.CLOUD_SYNC_DOMAIN_NOT_CONFIGURED:n.passwordResetModel.errors.showCloudSyncDomainNotConfiguredError=!0;break;case a.ON_PREMISES_USER_NOT_FOUND:n.passwordResetModel.errors.showOnPremisesUserNotFoundError=!0;break;case a.SYSTEM_ERROR:n.step=f.GENERIC_ERROR;break;case a.ON_PREMISES_ADMIN_ACTION_REQUIRED:n.step=f.ON_PREMISES_ADMIN_ACTION_REQUIRED;break;case a.ON_PREMISES_CONNECTIVITY_ERROR:n.step=f.ON_PREMISES_CONNECTIVITY_FAILURE;break;case a.ON_PREMISES_SUCCESS_CLOUD_FAILURE:n.step=f.ON_PREMISES_SUCCESS_CLOUD_FAILURE;break;case a.INVALID_SESSION:n.step=f.INVALID_SESSION;break;default:n.step=f.GENERIC_ERROR}};n.contactAdministratorSuccess=function(){n.step=f.ADMIN_NOTIFIED;n.hideProgressAndEnableNext();n.clearErrors()};n.contactAdministratorError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}};n.getThrottlingDurationSuccess=function(t){n.hideProgressAndEnableNext();n.clearErrors();t&&t.data&&t.data.timeElapsedSinceFirstAttempt&&t.data.timeElapsedSinceFirstAttempt.indexOf(":")!=-1?(n.passwordResetModel.timeElapsedSinceFirstAttempt=parseInt(t.data.timeElapsedSinceFirstAttempt.substring(0,t.data.timeElapsedSinceFirstAttempt.indexOf(":"))),n.passwordResetModel.timeElapsedSinceFirstAttempt++):n.passwordResetModel.timeElapsedSinceFirstAttempt=1;t&&t.data&&t.data.timeRemaining&&t.data.timeRemaining.indexOf(":")!=-1?(n.passwordResetModel.timeRemaining=parseInt(t.data.timeRemaining.substring(0,t.data.timeRemaining.indexOf(":"))),n.passwordResetModel.timeRemaining++):n.passwordResetModel.timeRemaining=1};n.getThrottlingDurationError=function(t){if(n.hideProgressAndEnableNext(),n.clearErrors(),t){if(t.status==0){n.step=f.TIMEOUT;return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;return}}else{n.step=f.GENERIC_ERROR;return}};n.getBrandingInfoSuccess=function(t){t&&t.data&&t.data.trim()&&(n.passwordResetModel.brandingImageSource=t.data.replace(/"/g,""),n.passwordResetModel.brandingImageSource!==null&&n.passwordResetModel.brandingImageSource!==""&&(n.passwordResetModel.showBranding=!0))};n.abandonSessionError=function(t){n.hideProgressAndEnableNext();n.clearErrors();var i=new CloudExperienceHost.Bridge;if(t){if(t.status==0){n.step=f.TIMEOUT;i.fireEvent(CloudExperienceHost.Events.done,CloudExperienceHost.AppResult.fail);return}if(t.status==500||t.status!=400){n.step=f.GENERIC_ERROR;i.fireEvent(CloudExperienceHost.Events.done,CloudExperienceHost.AppResult.fail);return}}else{n.step=f.GENERIC_ERROR;i.fireEvent(CloudExperienceHost.Events.done,CloudExperienceHost.AppResult.fail);return}};n.prepareContext=function(){var t={};switch(n.step){case f.VIEW_USER_IDENTIFICATION:t={userId:n.passwordResetModel.userId,tenantId:n.passwordResetModel.tenantId,passwordResetClientType:n.passwordResetModel.passwordResetClientType};break;case f.SELECT_ACCOUNT_RECOVERY_OPTION:t={accountRecoveryOption:n.passwordResetModel.accountRecoveryOption};break;case f.SELECT_CHALLENGE_METHOD:t={challengeType:parseInt(n.passwordResetModel.challengeMethod),userSubmittedValidationData:n.passwordResetModel.userSubmittedValidationData,challengeDataKey:n.passwordResetModel.selectedChallengeDataMapping?n.passwordResetModel.selectedChallengeDataMapping.challengeDataKey:null};break;case f.CHALLENGE_STARTED:t={challengeType:parseInt(n.passwordResetModel.challengeMethod),challengeResponse:n.getChallengeResponse()};break;case f.SET_NEW_PASSWORD:t={newPassword:n.passwordResetModel.newPassword};break;case f.UNLOCK_ACCOUNT:t={}}return t};n.nextPage=function(){n.clearErrors();var r=t.defer(),o=n.prepareContext(),e=JSON.stringify(o);switch(n.step){case f.VIEW_USER_IDENTIFICATION:u.passwordResetShared.SubmitUserId(e,r.promise).then(n.submitUserIdSuccess,n.submitUserIdError);break;case f.SELECT_ACCOUNT_RECOVERY_OPTION:u.passwordResetShared.SetAccountRecoveryOption(e,r.promise).then(n.setAccountRecoveryOptionSuccess,n.setAccountRecoveryOptionError);break;case f.SELECT_CHALLENGE_METHOD:u.passwordResetShared.StartChallenge(e,r.promise).then(n.startChallengeSuccess,n.startChallengeError);break;case f.CHALLENGE_STARTED:u.passwordResetShared.SubmitChallengeResponse(e,r.promise).then(n.submitChallengeResponseSuccess,n.submitChallengeResponseError);break;case f.SET_NEW_PASSWORD:u.passwordResetShared.SetNewPassword(e,r.promise).then(n.setNewPasswordSuccess,n.setNewPasswordError);break;case f.UNLOCK_ACCOUNT:u.passwordResetShared.UnlockAccount(e,r.promise).then(n.unlockAccountSuccess,n.unlockAccountError)}n.showProgressAndDisableNext();i(function(){r.resolve("request cancelled")},3e4)};n.enterButtonPressed=function(){event.keyCode==13&&n.passwordResetModel.nextDisabled===!1&&n.nextPage()};n.startSession()}])