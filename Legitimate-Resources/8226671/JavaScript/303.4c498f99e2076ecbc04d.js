(window.webpackJsonp=window.webpackJsonp||[]).push([[303,309],{1990:function(e,t,n){e.exports=n(2010)},2006:function(e,t,n){e.exports=n(2007)},2007:function(e,t,n){e.exports=n(2008)},2008:function(e,t,n){var r=n(2009);e.exports=r},2009:function(e,t,n){var r=n(701);e.exports=r},2010:function(e,t,n){e.exports=n(2011)},2011:function(e,t,n){var r=n(2012);e.exports=r},2012:function(e,t,n){var r=n(702);e.exports=r},2013:function(e,t,n){var r=n(2014),a=n(1990);e.exports=function(e,t){if(null==e)return{};var n,o,i={},s=r(e);for(o=0;o<s.length;o++)n=s[o],a(t).call(t,n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},2014:function(e,t,n){e.exports=n(2015)},2015:function(e,t,n){e.exports=n(2016)},2016:function(e,t,n){var r=n(2017);e.exports=r},2017:function(e,t,n){var r=n(700);e.exports=r},2025:function(e,t,n){var r=n(2006),a=n(1990),o=n(2013);e.exports=function(e,t){if(null==e)return{};var n,i,s=o(e,t);if(r){var u=r(e);for(i=0;i<u.length;i++)n=u[i],a(t).call(t,n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},2094:function(e,t,n){"use strict";var r=n(53),a=n.n(r);t.a={redirectToDeepLinkOrOpenStore:function(e,t){window.location.assign(e);var n=(new Date).getTime();a()((function(){if((new Date).getTime()-n<4e3){if("hidden"===document.visibilityState)return;window.location.assign(t)}}),3e3)}}},4889:function(e,t,n){"use strict";n.r(t);var r=n(13),a=n.n(r),o=n(21),i=n.n(o),s=n(17),u=n.n(s),p=n(22),c=n.n(p),l=n(11),d=n.n(l),f=n(23),g=n.n(f),m=n(32),b=n.n(m),v=n(30),h=n.n(v),w=n(2025),A=n.n(w),_=n(2),T=n.n(_),k=n(20),M=n.n(k),S=n(1),y=n.n(S),x=n(26),W=n.n(x),L=n(53),I=n.n(L),P=n(43),O=n(1530),E=n(5),D=n(439),U=n(8),F=n(198),$=n(2094),j=n(64),C=["updatedAt","userId"];function N(e,t){var n=a()(e);if(i.a){var r=i()(e);t&&(r=u()(r).call(r,(function(t){return c()(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n,r,a=null!=arguments[t]?arguments[t]:{};t%2?d()(n=N(Object(a),!0)).call(n,(function(t){M()(e,t,a[t])})):g.a?b()(e,g()(a)):d()(r=N(Object(a))).call(r,(function(t){h()(e,t,c()(a,t))}))}return e}var B={name:"WebToApp",components:{WebToAppModal:function(){return n.e(467).then(n.bind(null,5043))}},mixins:[D.a],computed:V(V(V({},Object(P.c)({isMobile:"isMobile",mWebToAppPopupPlacement:"mWebToAppPopupPlacement",guestMWebToAppPopupPlacement:"guestMWebToAppPopupPlacement",userFirstName:"userFirstName",userLastName:"userLastName",userHandle:"userHandle",getFeatureSettingV3:"getFeatureSettingV3",isMoEngageMWebToAppForBuyerEnabled:"isMoEngageMWebToAppForBuyerEnabled",externalUserId:"externalUserId"})),Object(P.e)({isIOS:function(e){return e.ua.iOS},isAndroid:function(e){return e.ua.androidOS},isTablet:function(e){return e.ua.isTablet},isUserLoggedIn:function(e){return e.auth.isUserLoggedIn},referrerInfo:function(e){return e.userCookies.referrerInfo},userActivity:function(e){return e.userCookies.userActivity},displayMWebToAppPopup:function(e){return e.displayMWebToAppPopup},userId:function(e){return e.auth.identity},domain:function(e){return e.domain},gender:function(e){return e.userCookies.userInfo.ge},createdAt:function(e){return e.userCookies.userInfo.cat},isDataSaleBlocked:function(e){return e.userCookies.dataSaleBlocked},appLink:function(e){return e.appLink},userTags:function(e){return e.common.userTags},lastActiveAt:function(e){return e.lastActiveAt}})),{},{isFromPoshmark:function(){var e=document.referrer,t=U.a.domain[this.domain];return e&&(W()(e).call(e,"://".concat(t))||W()(e).call(e,"://www.".concat(t)))},isUserActive:function(){var e,t,n=(null===(e=this.lastActiveAt)||void 0===e?void 0:e.ios)&&Object(j.differenceInMinutes)(new Date,new Date(this.lastActiveAt.ios))<U.a.userActiveDuration,r=(null===(t=this.lastActiveAt)||void 0===t?void 0:t.android)&&Object(j.differenceInMinutes)(new Date,new Date(this.lastActiveAt.android))<U.a.userActiveDuration;return!(!n&&!r)},isFirstPageInSession:function(){return!this.isFromPoshmark},isWhiteListedRoute:function(){var e;return null===(e=this.$route.meta)||void 0===e?void 0:e.showWebToAppModal},isWhiteListedListingRoute:function(){var e;return W()(e=["like","comment"]).call(e,this.$route.query.action_from)},isValidDevice:function(){return this.isMobile||this.isTablet},referrerData:function(){var e,t=null===(e=this.referrerInfo)||void 0===e?void 0:e.src;return t&&t[t.length-1]},isFromOrganicSource:function(){return!(document.referrer&&!this.isFromPoshmark)||!(this.referrerData&&"gdm"===this.referrerData.rs)},isValidFirstOrSecondPage:function(){return!this.$route.query.login||this.isFirstPageInSession},isMoEngageMWebToAppEnabled:function(){var e,t=this.getFeatureSettingV3("web_moe_mweb_app_logged_in");return null==t||null===(e=t.web)||void 0===e?void 0:e.enabled},appStoreLink:function(){return this.isIOS?F.a.mobileApp.iOS[this.domain]||F.a.mobileApp.iOS.default:F.a.mobileApp.androidOS[this.domain]||F.a.mobileApp.androidOS.default},deepLink:function(){return this.isIOS?E.a.iosAppPath(this.appLink):E.a.openAndroidAppOrStore(this.appLink)},daysSinceUserCreatedAt:function(){return this.createdAt&&Object(j.differenceInDays)(new Date,new Date(this.createdAt))},daysSinceLastAppUse:function(){var e=this.lastActiveAt;if(e&&(e.ios||e.android)){var t=Object(j.isAfter)(e.ios,e.android)?e.ios:e.android;return Object(j.differenceInDays)(new Date,new Date(t))}return 0}}),watch:{$route:function(){this.updateUserInfo(this.userId),this.isValidDevice&&(this.showMWebToAppModal(),this.showMoEngageWebAppModal())},displayMWebToAppPopup:function(e,t){t&&("signup"===this.$route.name?O.a.$emit("goToSetProfileInfo"):"guestOrderComplete"===this.$route.name&&this.$router.push({name:"setProfileInfo"}))},isUserActive:function(e){!e&&this.isValidDevice&&(this.showMWebToAppModal(),this.showMoEngageWebAppModal())}},mounted:function(){var e=this;return T()(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.updateUserInfo(e.userId);case 2:e.isValidDevice&&(e.throttleScrollAction=E.a.throttle(T()(y.a.mark((function t(){var n;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=window.screen.height,window.pageYOffset>n/2&&(e.setMWebToAppPopupState(!0),window.removeEventListener("scroll",e.handleScroll));case 3:case"end":return t.stop()}}),t)}))),300),e.showMWebToAppModal(),e.showMoEngageWebAppModal(),e.$root.$on("likeListingWebToAppPopup",(function(){window.Moengage&&window.Moengage.track_event("show_mweb_app_popup_buyer_like",{daysSinceLastAppUsage:e.daysSinceLastAppUse||0,daysSinceUserCreatedAt:e.daysSinceUserCreatedAt||0,isFromOrganicSrc:e.isFromOrganicSource||!1,isBuyerActivated:e.userTags&&e.userTags.buyer||!1,userActivity:e.userActivity||"none"})})));case 3:case"end":return t.stop()}}),t)})))()},methods:V(V(V({},Object(P.b)(["setMWebToAppPopupState","setLastActiveAt","setUserTagsInLocalStorage","fetchUserStateSummary"])),Object(P.d)(["SetUserTags"])),{},{showMWebToAppModal:function(){var e=this;return T()(y.a.mark((function t(){var n;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isUserLoggedIn&&e.isWhiteListedRoute&&!E.a.getCookie("mapp_rd_pop")&&("su"!==e.userActivity&&e.userActivity||!E.a.getCookie("gu_mapp_rd_pop")?e.isValidFirstOrSecondPage&&!e.isUserActive&&e.isFromOrganicSource&&e.mWebToAppPopupPlacement&&("secondPageLoad"===e.mWebToAppPopupPlacement?e.isFirstPageInSession||e.setMWebToAppPopupState(!0):"firstPageWithDelay"===e.mWebToAppPopupPlacement?n=I()((function(){e.setMWebToAppPopupState(!0),clearTimeout(n)}),5e3):"firstPageMid"===e.mWebToAppPopupPlacement&&window.addEventListener("scroll",e.handleScroll)):"onFeed"===e.guestMWebToAppPopupPlacement&&e.setMWebToAppPopupState(!0));case 1:case"end":return t.stop()}}),t)})))()},updateUserInfo:function(e){var t=this;return T()(y.a.mark((function n(){var r,a,o,i,s,u,p,c,l;return y.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e){n.next=16;break}if(a=t.getLastActiveFromLocalStorage(),o=t.getUserTagsFromLocalStorage(),!a||a.userId!==e||!o){n.next=11;break}if(i=a&&a.updated_at&&new Date(a.updated_at),s=o.updatedAt,void 0===s?null:s,u=o.userId,void 0===u?null:u,p=A()(o,C),36e5,!(i&&i.getTime()+36e5>(new Date).getTime())){n.next=11;break}return t.setLastActiveAt(a),t.SetUserTags(p||{}),n.abrupt("return");case 11:return n.next=13,t.fetchUserStateSummary({userId:t.userId});case 13:null!=(c=n.sent)&&null!==(r=c.user_info)&&void 0!==r&&r.last_active&&(l=V(V({},c.user_info.last_active),{},{userId:e,updated_at:(new Date).toString()}),t.setLastActiveAt(l),t.setLastActiveTimeInLocalStorage(l)),c.tags&&(t.SetUserTags(c.tags),t.setUserTagsInLocalStorage({tags:c.tags,userId:e}));case 16:case"end":return n.stop()}}),n)})))()},getLastActiveFromLocalStorage:function(){return this.$jStorage.getItem("last_active")},setLastActiveTimeInLocalStorage:function(e){this.$jStorage.removeItem("last_active"),this.$jStorage.setItem("last_active",e)},handleScroll:function(){var e=this;return T()(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.throttleScrollAction();case 1:case"end":return t.stop()}}),t)})))()},closeMWebToAppModal:function(){var e=this;return T()(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setMWebToAppPopupState(!1);case 1:case"end":return t.stop()}}),t)})))()},initMoEngageLib:function(){return T()(y.a.mark((function e(){var t,r;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=U.a.moEngage,e.next=3,n.e(645).then(n.bind(null,4347));case 3:r={app_id:t.appId,debug_logs:t.debugLogs},window.Moengage=moe(r);case 5:case"end":return e.stop()}}),e)})))()},showMoEngageWebAppModal:function(){var e=this;return T()(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isMoEngageMWebToAppEnabled||"li"!==e.userActivity||e.isUserActive||!e.isWhiteListedRoute&&!e.isWhiteListedListingRoute){t.next=17;break}return t.next=3,e.initialiseMoEAndEventTracking();case 3:if(!window.Moengage){t.next=15;break}if(!e.isWhiteListedListingRoute){t.next=14;break}t.t0=e.$route.query.action_from,t.next="like"===t.t0?8:"comment"===t.t0?10:12;break;case 8:return window.Moengage.track_event("show_mweb_app_popup_listing",{action:"like"}),t.abrupt("break",12);case 10:return window.Moengage.track_event("show_mweb_app_popup_listing",{action:"comment"}),t.abrupt("break",12);case 12:t.next=15;break;case 14:window.Moengage.track_event("show_mweb_app_popup");case 15:t.next=20;break;case 17:if(!e.isMoEngageMWebToAppForBuyerEnabled||!e.isUserLoggedIn){t.next=20;break}return t.next=20,e.initialiseMoEAndEventTracking();case 20:case"end":return t.stop()}}),t)})))()},handleMoEngageComms:function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.event;if(n){var r={etType:"page_element",etElementType:"link",etOnName:"moe_web_to_app_popup",etOnScreen_type:"popup"},a={etType:"page_element",etElementType:"link",etOnName:"moe_web_to_app_popup_buyer",etOnScreen_type:"popup"};switch(n){case"onsiteMsgShown":this.$eventTracker.pageView({etType:"page",screenName:"moe_web_to_app_popup",screenType:"popup"});break;case"continueWithApp":this.$eventTracker.clickTrack(null,V({etName:"moe_open_app"},r)),this.redirectToAppDownloadUrl();break;case"trackStayOnWeb":this.$eventTracker.clickTrack(null,V({etName:"moe_stay_on_web"},r));break;case"onsiteMsgShownBuyer":this.$eventTracker.pageView({etType:"page",screenName:"moe_web_to_app_popup_buyer",screenType:"popup"});break;case"continueWithAppBuyer":this.$eventTracker.clickTrack(null,V({etName:"moe_open_app_buyer"},a)),this.redirectToAppDownloadUrl();break;case"trackStayOnWebBuyer":this.$eventTracker.clickTrack(null,V({etName:"moe_stay_on_web_buyer"},a))}}},initialiseMoEAndEventTracking:function(){var e=this;return T()(y.a.mark((function t(){return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initMoEngageLib();case 2:window.Moengage&&(window.Moengage.add_unique_user_id(e.externalUserId),window.addEventListener("message",e.handleMoEngageComms,!1));case 3:case"end":return t.stop()}}),t)})))()},redirectToAppDownloadUrl:function(){$.a.redirectToDeepLinkOrOpenStore(this.deepLink,this.appStoreLink)}})},R=n(29),q=Object(R.a)(B,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"web-app-modal"},[e.displayMWebToAppPopup?n("WebToAppModal",{attrs:{message:e.$t("mWebToAppPopup.generalText"),etModalName:"web_to_app_popup"},on:{close:e.closeMWebToAppModal}}):e._e()],1)}),[],!1,null,null,null);t.default=q.exports}}]);